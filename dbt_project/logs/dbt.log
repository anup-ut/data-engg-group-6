[0m11:38:34.899544 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:38:34.918557 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:38:34.982026 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:38:34.990297 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:38:35.006874 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:38:35.011150 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:38:35.014989 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:38:34.706445 => 11:38:35.014568
[0m11:38:35.017641 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '376ef863-dda5-49f8-9fd1-aea17edd11d9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7630db2faeb0>]}
[0m11:38:35.019507 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.37s]
[0m11:38:35.021873 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:38:35.028266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:38:35.030204 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:38:35.031337 [debug] [MainThread]: On list__gold: Close
[0m11:38:35.033114 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:38:35.034897 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:38:35.040749 [info ] [MainThread]: 
[0m11:38:35.042452 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m11:38:35.045570 [debug] [MainThread]: Command end result
[0m11:38:35.080217 [info ] [MainThread]: 
[0m11:38:35.081492 [info ] [MainThread]: Completed successfully
[0m11:38:35.083101 [info ] [MainThread]: 
[0m11:38:35.084495 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:38:35.086613 [debug] [MainThread]: Command `dbt run` succeeded at 11:38:35.086424 after 1.53 seconds
[0m11:38:35.087591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7630e3803460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7630e1b0ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7630e00a6be0>]}
[0m11:38:35.088570 [debug] [MainThread]: Flushing usage events
[0m11:40:30.317594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a62c474c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a636d5e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a636e7790>]}


============================== 11:40:30.324860 | 21c89fb2-8182-4cb8-bdf9-5398894683ae ==============================
[0m11:40:30.324860 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:40:30.326164 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:40:30.429842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a636d5dc0>]}
[0m11:40:30.454340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a611a2f10>]}
[0m11:40:30.455987 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:40:30.481137 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:40:30.926656 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m11:40:30.927677 [debug] [MainThread]: Partial parsing: updated file: ck_project://models/gold/dim/dim_merchants.sql
[0m11:40:30.960201 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m11:40:30.972617 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m11:40:31.035564 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:40:31.043885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a60f35b80>]}
[0m11:40:31.075439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a61109d30>]}
[0m11:40:31.076726 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:40:31.078046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a61109cd0>]}
[0m11:40:31.081041 [info ] [MainThread]: 
[0m11:40:31.083214 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:40:31.085844 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:40:31.100416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:31.295261 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:40:31.300042 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:31.303709 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:40:31.310476 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:40:31.311526 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:40:31.315013 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:31.321672 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:31.362842 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:40:31.368777 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:31.371789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a611090a0>]}
[0m11:40:31.372874 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:40:31.373930 [info ] [MainThread]: 
[0m11:40:31.389426 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:40:31.390662 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:40:31.391719 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:40:31.392743 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:40:31.403617 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:40:31.416639 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:40:31.393239 => 11:40:31.415941
[0m11:40:31.417824 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:40:31.440090 [debug] [Thread-1  ]: Creating new relation dim_merchants
[0m11:40:31.474417 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:40:31.488943 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:31.500806 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:31.505847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:31.509917 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:40:31.523482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:40:31.556356 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:40:31.583746 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:31.589929 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:31.593698 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:40:31.418446 => 11:40:31.593247
[0m11:40:31.596386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '21c89fb2-8182-4cb8-bdf9-5398894683ae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a60ed6a00>]}
[0m11:40:31.598112 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.20s]
[0m11:40:31.599745 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:40:31.603013 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:31.604148 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:40:31.605380 [debug] [MainThread]: On list__silver: Close
[0m11:40:31.606183 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:40:31.607002 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:40:31.607925 [info ] [MainThread]: 
[0m11:40:31.608851 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.53 seconds (0.53s).
[0m11:40:31.610242 [debug] [MainThread]: Command end result
[0m11:40:31.643593 [info ] [MainThread]: 
[0m11:40:31.645183 [info ] [MainThread]: Completed successfully
[0m11:40:31.646837 [info ] [MainThread]: 
[0m11:40:31.648176 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:31.650477 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:31.650245 after 1.37 seconds
[0m11:40:31.651528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a62c474c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a5a539f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x729a60f47e20>]}
[0m11:40:31.652606 [debug] [MainThread]: Flushing usage events
[0m11:40:43.750993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773298a1f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77329946fe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77329946fdf0>]}


============================== 11:40:43.757813 | 04e24b29-e89f-4632-a6b2-3228dc60d7d7 ==============================
[0m11:40:43.757813 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:40:43.758977 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:40:43.865712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77329946fe80>]}
[0m11:40:43.895073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773296f21eb0>]}
[0m11:40:43.897017 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:40:43.942250 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:40:44.424546 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:40:44.425571 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:40:44.426943 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:40:44.434884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773296d2b8b0>]}
[0m11:40:44.467178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773296e89bb0>]}
[0m11:40:44.468279 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:40:44.469378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773296e89b50>]}
[0m11:40:44.471259 [info ] [MainThread]: 
[0m11:40:44.472636 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:40:44.475901 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:40:44.493924 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:44.787171 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:40:44.790862 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:44.795002 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:40:44.801870 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:40:44.803458 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:40:44.806366 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:44.813360 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:44.850727 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:40:44.857999 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:44.861473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732952f2d00>]}
[0m11:40:44.863291 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:40:44.864652 [info ] [MainThread]: 
[0m11:40:44.881418 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:40:44.882587 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:40:44.884085 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:40:44.885179 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:40:44.894155 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:40:44.912367 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:40:44.886005 => 11:40:44.911783
[0m11:40:44.913495 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:40:44.970224 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:40:44.983597 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:44.998016 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:45.003782 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:45.008794 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:40:45.024575 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:40:45.036857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:45.046809 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:40:45.050543 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:45.076297 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:45.081476 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:45.092307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:40:45.096535 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:45.099809 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:40:44.914234 => 11:40:45.099402
[0m11:40:45.101455 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04e24b29-e89f-4632-a6b2-3228dc60d7d7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732943bb730>]}
[0m11:40:45.102637 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.22s]
[0m11:40:45.104278 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:40:45.107475 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:45.108452 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:40:45.109351 [debug] [MainThread]: On list__silver: Close
[0m11:40:45.110318 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:40:45.111024 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:40:45.111850 [info ] [MainThread]: 
[0m11:40:45.113000 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m11:40:45.114571 [debug] [MainThread]: Command end result
[0m11:40:45.141825 [info ] [MainThread]: 
[0m11:40:45.142940 [info ] [MainThread]: Completed successfully
[0m11:40:45.143902 [info ] [MainThread]: 
[0m11:40:45.145321 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:45.146941 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:45.146728 after 1.43 seconds
[0m11:40:45.147902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773298a1f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x773296d0ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77329453d1c0>]}
[0m11:40:45.148728 [debug] [MainThread]: Flushing usage events
[0m11:40:50.661255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420883c3400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742088e29d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742088e29dc0>]}


============================== 11:40:50.671803 | 24182419-afeb-4d4b-b0ed-a3f213b109ac ==============================
[0m11:40:50.671803 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:40:50.673474 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:40:50.722658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a970f9e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a9719f8d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a9719f8df0>]}


============================== 11:40:50.732269 | f46e33c0-3374-4920-b38a-59fc59c566c9 ==============================
[0m11:40:50.732269 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:40:50.724152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13c152e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13c1f8cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13c1f8cfd0>]}
[0m11:40:50.734358 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}


============================== 11:40:50.735289 | 7abba28d-760c-4ae0-a268-c38279e3c25d ==============================
[0m11:40:50.735289 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:40:50.736790 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:40:50.831604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742088e29d90>]}
[0m11:40:50.877804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420868e8dc0>]}
[0m11:40:50.879881 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:40:50.889916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a9719f8dc0>]}
[0m11:40:50.893775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13c1f8cdf0>]}
[0m11:40:50.905024 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:40:50.932200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bfa24e50>]}
[0m11:40:50.934173 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:40:50.936415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96f49adf0>]}
[0m11:40:50.938054 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:40:50.965128 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:40:50.969423 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:40:51.265819 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:40:51.267009 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:40:51.268400 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:40:51.270882 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:40:51.272093 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:40:51.273884 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:40:51.277868 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:40:51.279534 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:40:51.280749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bf82c850>]}
[0m11:40:51.281478 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:40:51.287011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96f2ac820>]}
[0m11:40:51.293834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420866ed7f0>]}
[0m11:40:51.315624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bf992b50>]}
[0m11:40:51.316853 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:40:51.318034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bf992af0>]}
[0m11:40:51.321618 [info ] [MainThread]: 
[0m11:40:51.324343 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:40:51.326877 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:40:51.346262 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:51.382072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742086849af0>]}
[0m11:40:51.382572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96f412b20>]}
[0m11:40:51.383923 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:40:51.385594 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:40:51.387165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742086849a90>]}
[0m11:40:51.387483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96f412ac0>]}
[0m11:40:51.390077 [info ] [MainThread]: 
[0m11:40:51.390686 [info ] [MainThread]: 
[0m11:40:51.392563 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:40:51.392821 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:40:51.396864 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:40:51.396948 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:40:51.419921 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:51.423158 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:51.650996 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:40:51.656618 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:51.663051 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:40:51.665090 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:40:51.686655 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:40:51.690181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:51.699886 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.729165 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:40:51.733922 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:40:51.735640 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:51.739591 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:51.741761 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:40:51.745993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:40:51.743575 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:40:51.747708 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:40:51.757040 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:40:51.762847 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:40:51.762809 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:51.759380 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:40:51.766814 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.766801 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:51.774197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bf7f4c40>]}
[0m11:40:51.774604 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.774640 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.776868 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:40:51.779474 [info ] [MainThread]: 
[0m11:40:51.809749 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:40:51.811547 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:40:51.813471 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:40:51.814984 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:40:51.830820 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:40:51.835551 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:40:51.837070 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:40:51.844237 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.847272 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.849375 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:40:51.816125 => 11:40:51.848771
[0m11:40:51.850475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420866b6be0>]}
[0m11:40:51.850684 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:40:51.852980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96d85ec70>]}
[0m11:40:51.852836 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:40:51.855044 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:40:51.855605 [info ] [MainThread]: 
[0m11:40:51.856746 [info ] [MainThread]: 
[0m11:40:51.882870 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:40:51.883563 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:40:51.884818 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:40:51.885344 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:40:51.887094 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:40:51.886930 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:40:51.888282 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:40:51.888449 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:40:51.905461 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:40:51.905823 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:40:51.916261 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:40:51.889299 => 11:40:51.915639
[0m11:40:51.917662 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:40:51.918813 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:40:51.889154 => 11:40:51.918393
[0m11:40:51.919713 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:40:51.964751 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:40:51.978786 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:51.996758 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:52.003470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:52.012217 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:40:52.017917 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:40:52.022154 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:40:52.031117 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:40:52.038029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:40:52.039842 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:40:52.045857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:52.054790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:40:52.056134 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:52.056878 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:52.060260 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.063324 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.063372 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:52.069188 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:40:52.069574 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:40:52.080726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:40:52.083109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:40:52.095974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:52.109790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:52.114514 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:40:52.118260 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.120408 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.122657 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:40:52.132737 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:40:52.133020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:40:52.137008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.136771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.141086 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:40:51.851848 => 11:40:52.140640
[0m11:40:52.143038 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7abba28d-760c-4ae0-a268-c38279e3c25d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bceb8dc0>]}
[0m11:40:52.144963 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.33s]
[0m11:40:52.146523 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:40:52.150813 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:52.153524 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:40:52.155114 [debug] [MainThread]: On list__gold: Close
[0m11:40:52.156178 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:40:52.156715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:52.156933 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:40:52.157897 [info ] [MainThread]: 
[0m11:40:52.158922 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m11:40:52.160818 [debug] [MainThread]: Command end result
[0m11:40:52.162811 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.174662 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:40:52.178820 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.183353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:52.183741 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:40:51.918589 => 11:40:52.183152
[0m11:40:52.185598 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f46e33c0-3374-4920-b38a-59fc59c566c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96cab8dc0>]}
[0m11:40:52.187154 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.30s]
[0m11:40:52.188973 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:40:52.190352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:52.194475 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:52.195877 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:40:52.195918 [info ] [MainThread]: 
[0m11:40:52.197252 [debug] [MainThread]: On list__silver: Close
[0m11:40:52.197328 [info ] [MainThread]: Completed successfully
[0m11:40:52.198302 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:40:52.198730 [info ] [MainThread]: 
[0m11:40:52.199202 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:40:52.200360 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:52.201119 [info ] [MainThread]: 
[0m11:40:52.202505 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:52.202177 after 1.54 seconds
[0m11:40:52.202572 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m11:40:52.203824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13c152e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bd008ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d13bf80ed00>]}
[0m11:40:52.205045 [debug] [MainThread]: Command end result
[0m11:40:52.205241 [debug] [MainThread]: Flushing usage events
[0m11:40:52.212432 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:40:52.220090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:52.225353 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:40:51.920445 => 11:40:52.224802
[0m11:40:52.228075 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24182419-afeb-4d4b-b0ed-a3f213b109ac', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x742084584f40>]}
[0m11:40:52.233058 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.34s]
[0m11:40:52.236867 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:40:52.243291 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:52.245100 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:40:52.246518 [debug] [MainThread]: On list__gold: Close
[0m11:40:52.247781 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:40:52.248729 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:40:52.250306 [info ] [MainThread]: 
[0m11:40:52.252927 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:40:52.255982 [info ] [MainThread]: 
[0m11:40:52.257867 [debug] [MainThread]: Command end result
[0m11:40:52.263453 [info ] [MainThread]: Completed successfully
[0m11:40:52.266028 [info ] [MainThread]: 
[0m11:40:52.267512 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:52.269636 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:52.269342 after 1.58 seconds
[0m11:40:52.270822 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a970f9e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96f49adf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74a96cad82e0>]}
[0m11:40:52.276415 [debug] [MainThread]: Flushing usage events
[0m11:40:52.309691 [info ] [MainThread]: 
[0m11:40:52.311607 [info ] [MainThread]: Completed successfully
[0m11:40:52.313027 [info ] [MainThread]: 
[0m11:40:52.314400 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:52.316630 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:52.316313 after 1.69 seconds
[0m11:40:52.317676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420883c3400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420868e8dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7420845939a0>]}
[0m11:40:52.319562 [debug] [MainThread]: Flushing usage events
[0m11:40:58.445025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816cc47e4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ccea0e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816cceb2790>]}


============================== 11:40:58.455168 | 5b54ec96-a89f-404e-a3d6-cd9551b21cb5 ==============================
[0m11:40:58.455168 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:40:58.457194 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:40:58.588786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ccea0dc0>]}
[0m11:40:58.619432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ca964f10>]}
[0m11:40:58.621107 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:40:58.655264 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:40:59.224643 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:40:59.225453 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:40:59.227353 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:40:59.237604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ca76c910>]}
[0m11:40:59.268634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ca8c6c10>]}
[0m11:40:59.269801 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:40:59.270959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ca8c6bb0>]}
[0m11:40:59.275290 [info ] [MainThread]: 
[0m11:40:59.277738 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:40:59.280022 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:40:59.298645 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:59.510617 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:40:59.515365 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:59.519271 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:40:59.520556 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:40:59.529340 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:40:59.531586 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:40:59.540190 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:59.590807 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:40:59.597754 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:59.601733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816c8d31d60>]}
[0m11:40:59.603588 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:40:59.604857 [info ] [MainThread]: 
[0m11:40:59.623398 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:40:59.624873 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:40:59.626345 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:40:59.627472 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:40:59.638500 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:40:59.656261 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:40:59.628373 => 11:40:59.655565
[0m11:40:59.657726 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:40:59.716608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:40:59.738762 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:40:59.750743 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:59.756995 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:59.761671 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:40:59.777242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:40:59.788470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:40:59.796254 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:40:59.799926 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:59.826221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:40:59.831074 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:59.840168 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:40:59.843806 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:40:59.847376 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:40:59.658481 => 11:40:59.847087
[0m11:40:59.848773 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5b54ec96-a89f-404e-a3d6-cd9551b21cb5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816c861a940>]}
[0m11:40:59.850017 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.22s]
[0m11:40:59.851799 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:40:59.854964 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:40:59.855779 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:40:59.856859 [debug] [MainThread]: On list__silver: Close
[0m11:40:59.857740 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:40:59.858592 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:40:59.859380 [info ] [MainThread]: 
[0m11:40:59.860178 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m11:40:59.861337 [debug] [MainThread]: Command end result
[0m11:40:59.888192 [info ] [MainThread]: 
[0m11:40:59.889440 [info ] [MainThread]: Completed successfully
[0m11:40:59.890298 [info ] [MainThread]: 
[0m11:40:59.891149 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:40:59.892534 [debug] [MainThread]: Command `dbt run` succeeded at 11:40:59.892346 after 1.49 seconds
[0m11:40:59.893504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816cc47e4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816c8743c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7816ca750dc0>]}
[0m11:40:59.894363 [debug] [MainThread]: Flushing usage events
[0m11:41:05.484326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a014940340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a0153accd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a0153acd60>]}


============================== 11:41:05.494187 | d2d5bb33-1b82-421d-a6cd-29e628744b9f ==============================
[0m11:41:05.494187 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:05.496433 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:05.556152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433eeaee460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ef525fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ef525df0>]}
[0m11:41:05.556779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640b31e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640bcfed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640bcfefd0>]}


============================== 11:41:05.567043 | 74eece94-1f36-401b-80d5-44dbd01a58ea ==============================
[0m11:41:05.567043 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:41:05.567898 | b23e85c4-0330-4d11-8baa-17e6ca345024 ==============================
[0m11:41:05.567898 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:05.568335 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:05.569014 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:05.672370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a0153acd30>]}
[0m11:41:05.725429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a012eb1d60>]}
[0m11:41:05.727806 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:05.747683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ef525e50>]}
[0m11:41:05.749567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640bcfedf0>]}
[0m11:41:05.757420 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:05.793259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ecfe8eb0>]}
[0m11:41:05.795783 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:05.798980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6409871e50>]}
[0m11:41:05.800653 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:05.834009 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:05.833980 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:06.119589 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:06.119585 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:06.120524 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:06.120564 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:06.121858 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:06.122283 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:06.126698 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:06.128303 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:06.130248 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:41:06.136956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ecdec8b0>]}
[0m11:41:06.137527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640966c850>]}
[0m11:41:06.139740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a012cac790>]}
[0m11:41:06.172517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f64097c9b50>]}
[0m11:41:06.173757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ecf52bb0>]}
[0m11:41:06.174142 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:06.175592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f64097c9af0>]}
[0m11:41:06.175602 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:06.176846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433ecf52b50>]}
[0m11:41:06.178743 [info ] [MainThread]: 
[0m11:41:06.180926 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:06.181290 [info ] [MainThread]: 
[0m11:41:06.183027 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:06.185223 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:06.187705 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:06.205285 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:06.206219 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:06.223067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a012e06a60>]}
[0m11:41:06.224335 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:06.225342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a012e06a90>]}
[0m11:41:06.227856 [info ] [MainThread]: 
[0m11:41:06.229467 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:06.231308 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:06.250935 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:06.546785 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:06.549182 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:06.553886 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:06.558022 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:06.560989 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:06.568312 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:41:06.562977 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:06.570818 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:41:06.579675 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:06.583457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:06.589744 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:06.590309 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:06.592768 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.595607 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:06.596188 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.603632 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:06.604485 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.612151 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:06.626153 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:06.632291 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:06.640753 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.660524 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:06.668981 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:06.669469 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.675592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433e7375d00>]}
[0m11:41:06.678456 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.678346 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:06.679870 [info ] [MainThread]: 
[0m11:41:06.683395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6409636c40>]}
[0m11:41:06.685816 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:06.689596 [info ] [MainThread]: 
[0m11:41:06.706513 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:06.716063 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.716868 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:41:06.718240 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:41:06.720359 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:41:06.721213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a010d22730>]}
[0m11:41:06.721331 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:41:06.721897 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:41:06.723620 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:41:06.723518 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:06.725030 [info ] [MainThread]: 
[0m11:41:06.725491 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:41:06.727032 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:41:06.741618 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:41:06.748528 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:41:06.758742 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:41:06.722858 => 11:41:06.758080
[0m11:41:06.761121 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:41:06.761858 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:41:06.764202 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:41:06.728172 => 11:41:06.763558
[0m11:41:06.764129 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:41:06.765858 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:41:06.766758 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:41:06.768010 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:41:06.786294 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:41:06.836163 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:41:06.769480 => 11:41:06.835324
[0m11:41:06.837509 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:41:06.894949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:41:06.905445 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:41:06.912579 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:06.925748 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:06.931640 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:06.939072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.943877 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:41:06.944177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:06.947189 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:41:06.950488 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:06.957545 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:41:06.958763 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.965852 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:41:06.968519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:41:06.981344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:06.986234 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:06.990086 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:06.995892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:41:06.996677 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:41:06.999957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.000127 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:41:07.015124 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:41:07.020437 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.021993 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:41:07.036763 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:07.039589 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:07.045935 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:07.046225 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:41:07.049635 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.057380 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:41:07.059332 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:07.061146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.065411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.066768 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:41:06.766942 => 11:41:07.066504
[0m11:41:07.068195 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b23e85c4-0330-4d11-8baa-17e6ca345024', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6402cbbdc0>]}
[0m11:41:07.069451 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.34s]
[0m11:41:07.070798 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:41:07.074297 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:07.075545 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:41:07.076529 [debug] [MainThread]: On list__gold: Close
[0m11:41:07.077357 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:41:07.078291 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:41:07.078238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:41:07.079579 [info ] [MainThread]: 
[0m11:41:07.080671 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.90 seconds (0.90s).
[0m11:41:07.081791 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.082479 [debug] [MainThread]: Command end result
[0m11:41:07.085990 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:41:06.763675 => 11:41:07.085375
[0m11:41:07.087691 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '74eece94-1f36-401b-80d5-44dbd01a58ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433e645b8e0>]}
[0m11:41:07.088600 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:07.088907 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.37s]
[0m11:41:07.090554 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:41:07.095972 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:07.096075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:07.097080 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:07.098120 [debug] [MainThread]: On list__silver: Close
[0m11:41:07.099359 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:41:07.100573 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:41:07.101573 [info ] [MainThread]: 
[0m11:41:07.102963 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m11:41:07.104817 [debug] [MainThread]: Command end result
[0m11:41:07.109173 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:41:07.113609 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:07.115211 [info ] [MainThread]: 
[0m11:41:07.116964 [info ] [MainThread]: Completed successfully
[0m11:41:07.117895 [info ] [MainThread]: 
[0m11:41:07.118076 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:41:06.838549 => 11:41:07.117643
[0m11:41:07.119015 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:07.119999 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2d5bb33-1b82-421d-a6cd-29e628744b9f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a01033af10>]}
[0m11:41:07.120679 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:07.120439 after 1.61 seconds
[0m11:41:07.121584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640b31e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f6408057cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f640964fd00>]}
[0m11:41:07.121663 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.35s]
[0m11:41:07.122971 [debug] [MainThread]: Flushing usage events
[0m11:41:07.123850 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:41:07.129288 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:07.130645 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:07.132277 [debug] [MainThread]: On list__silver: Close
[0m11:41:07.134898 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:41:07.137596 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:41:07.139402 [info ] [MainThread]: 
[0m11:41:07.142198 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m11:41:07.147605 [debug] [MainThread]: Command end result
[0m11:41:07.158425 [info ] [MainThread]: 
[0m11:41:07.159896 [info ] [MainThread]: Completed successfully
[0m11:41:07.161866 [info ] [MainThread]: 
[0m11:41:07.163542 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:07.165423 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:07.165116 after 1.68 seconds
[0m11:41:07.166620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433eeaee460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433e642cca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433e658fc40>]}
[0m11:41:07.167751 [debug] [MainThread]: Flushing usage events
[0m11:41:07.198933 [info ] [MainThread]: 
[0m11:41:07.200313 [info ] [MainThread]: Completed successfully
[0m11:41:07.201419 [info ] [MainThread]: 
[0m11:41:07.202750 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:07.204270 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:07.204039 after 1.76 seconds
[0m11:41:07.205650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a014940340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a012eb1d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a01048ca90>]}
[0m11:41:07.206965 [debug] [MainThread]: Flushing usage events
[0m11:41:13.035746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedcfca7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedd061ee20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedd062f790>]}


============================== 11:41:13.042913 | 7bd66f2d-d03b-4716-8c00-4b5fbc105571 ==============================
[0m11:41:13.042913 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:13.044382 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:13.149622 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedd061ee80>]}
[0m11:41:13.188179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedce1a2ee0>]}
[0m11:41:13.189488 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:13.216057 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:13.881699 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:13.882814 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:13.884405 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:13.890652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedcdfac8e0>]}
[0m11:41:13.918464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedce109be0>]}
[0m11:41:13.919749 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:13.920903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedce109b80>]}
[0m11:41:13.923569 [info ] [MainThread]: 
[0m11:41:13.925574 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:13.928139 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:13.946132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:14.127625 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:14.131160 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:14.135771 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:41:14.136902 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:41:14.143866 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:14.147145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:14.154127 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:14.195816 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:14.201803 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:14.206979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedc7fe68b0>]}
[0m11:41:14.208586 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:14.209592 [info ] [MainThread]: 
[0m11:41:14.231038 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:41:14.232258 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:41:14.233961 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:41:14.235515 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:41:14.249008 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:41:14.266475 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:41:14.236371 => 11:41:14.265751
[0m11:41:14.267730 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:41:14.358429 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:41:14.381292 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:14.399638 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:14.405085 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:14.409702 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:41:14.421892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:41:14.433698 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:14.440545 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:41:14.444484 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:14.495518 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:14.503427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:14.517734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:41:14.521203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:14.525149 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:41:14.268551 => 11:41:14.524586
[0m11:41:14.527358 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7bd66f2d-d03b-4716-8c00-4b5fbc105571', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedc75ffcd0>]}
[0m11:41:14.529020 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.29s]
[0m11:41:14.530641 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:41:14.534350 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:14.535960 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:41:14.537016 [debug] [MainThread]: On list__gold: Close
[0m11:41:14.538594 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:41:14.539941 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:41:14.541633 [info ] [MainThread]: 
[0m11:41:14.543129 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m11:41:14.547872 [debug] [MainThread]: Command end result
[0m11:41:14.634865 [info ] [MainThread]: 
[0m11:41:14.638487 [info ] [MainThread]: Completed successfully
[0m11:41:14.640023 [info ] [MainThread]: 
[0m11:41:14.641800 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:14.648731 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:14.648414 after 1.64 seconds
[0m11:41:14.651266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedcfca7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedc774bd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bedcdf8ed90>]}
[0m11:41:14.653581 [debug] [MainThread]: Flushing usage events
[0m11:41:20.743322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d933e370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d9db2d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d9db2d90>]}


============================== 11:41:20.753507 | e1f54202-c1a6-4f8f-82ec-54ecc60f9c45 ==============================
[0m11:41:20.753507 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:20.755059 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:20.815415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2e7be4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2f13efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2f13edf0>]}


============================== 11:41:20.825951 | 6a8adcdc-323f-4678-a450-fc9fce5616b6 ==============================
[0m11:41:20.825951 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:20.827620 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:20.888535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350938ef3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350942c1d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350942c1df0>]}


============================== 11:41:20.904670 | 2b6e4169-f139-4aa4-9938-77e7893da502 ==============================
[0m11:41:20.904670 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:20.906574 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:20.935768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d9db2d60>]}
[0m11:41:20.991502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d786fd90>]}
[0m11:41:20.994543 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:21.041840 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:21.042410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2f13ee50>]}
[0m11:41:21.107577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2ccb0eb0>]}
[0m11:41:21.109736 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:21.141080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350942c1dc0>]}
[0m11:41:21.149439 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:21.188207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735091e24df0>]}
[0m11:41:21.189994 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:21.226306 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:21.450808 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:21.451943 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:21.453631 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:41:21.464840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d766d7c0>]}
[0m11:41:21.499617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d77c9a90>]}
[0m11:41:21.501429 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:21.502852 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d77c9ac0>]}
[0m11:41:21.506135 [info ] [MainThread]: 
[0m11:41:21.508173 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:21.510863 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:21.538154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:21.548935 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:21.550032 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:21.553725 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:41:21.569258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2caac8b0>]}
[0m11:41:21.607965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2cc12bb0>]}
[0m11:41:21.609794 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:21.611884 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2cc12b50>]}
[0m11:41:21.618599 [info ] [MainThread]: 
[0m11:41:21.620823 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:21.624057 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:21.646388 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:21.647509 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:21.651242 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:21.653326 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:21.670269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735091c2b820>]}
[0m11:41:21.707358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735091d9bb20>]}
[0m11:41:21.709284 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:21.710966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735091d9bac0>]}
[0m11:41:21.715498 [info ] [MainThread]: 
[0m11:41:21.717841 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:21.720710 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:21.744337 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:21.910424 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:21.917043 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:21.923393 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:21.926193 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:21.946959 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:21.952507 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:21.962313 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.008538 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:22.016270 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.023625 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:22.028984 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:22.026911 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:22.038524 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.045179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d5c1ec10>]}
[0m11:41:22.046791 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:22.047977 [info ] [MainThread]: 
[0m11:41:22.047957 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:22.055492 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:22.064592 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.077688 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:41:22.079428 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:41:22.081831 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:41:22.083823 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:41:22.095177 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:22.100816 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.102708 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:41:22.107517 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:22.125546 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:41:22.085386 => 11:41:22.124448
[0m11:41:22.126806 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:41:22.111948 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:22.133248 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:22.129765 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:22.135630 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:22.145648 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.146449 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.152591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2b073d00>]}
[0m11:41:22.155291 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:22.156820 [info ] [MainThread]: 
[0m11:41:22.190221 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:41:22.192334 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:41:22.195589 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:41:22.196830 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:41:22.216780 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:41:22.219786 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:22.228608 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.233819 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:41:22.198378 => 11:41:22.233008
[0m11:41:22.235092 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:41:22.236099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350901dec70>]}
[0m11:41:22.237863 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:22.239067 [info ] [MainThread]: 
[0m11:41:22.253999 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:41:22.270368 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:41:22.272032 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:41:22.274567 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:41:22.275926 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:22.276448 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:41:22.291608 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:41:22.300939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:22.309444 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.309580 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:41:22.277488 => 11:41:22.308899
[0m11:41:22.311100 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:41:22.319763 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:41:22.335482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:41:22.351491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.357250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:41:22.361399 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:41:22.367862 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.375485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:22.396241 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:22.402323 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.409658 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:41:22.415168 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:22.422346 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.427132 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:41:22.435475 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:41:22.436753 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:41:22.444762 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.448631 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:41:22.127980 => 11:41:22.448284
[0m11:41:22.450300 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1f54202-c1a6-4f8f-82ec-54ecc60f9c45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d4cf8d60>]}
[0m11:41:22.451813 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.37s]
[0m11:41:22.453570 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:41:22.459361 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:22.460140 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:22.461246 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:22.462070 [debug] [MainThread]: On list__silver: Close
[0m11:41:22.463172 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:41:22.464275 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:41:22.465715 [info ] [MainThread]: 
[0m11:41:22.467024 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m11:41:22.468924 [debug] [MainThread]: Command end result
[0m11:41:22.478536 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:22.485987 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.493480 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:41:22.499703 [info ] [MainThread]: 
[0m11:41:22.501504 [info ] [MainThread]: Completed successfully
[0m11:41:22.502997 [info ] [MainThread]: 
[0m11:41:22.504530 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:22.506789 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:22.506516 after 1.80 seconds
[0m11:41:22.508004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d933e370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d4d0caf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72f3d56edee0>]}
[0m11:41:22.510041 [debug] [MainThread]: Flushing usage events
[0m11:41:22.511532 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:41:22.530733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:22.543689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:41:22.547925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.584584 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m11:41:22.588634 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:22.594064 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:41:22.595348 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.598312 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.610170 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:41:22.614568 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.618071 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:41:22.312607 => 11:41:22.617532
[0m11:41:22.620484 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2b6e4169-f139-4aa4-9938-77e7893da502', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73508b27ef10>]}
[0m11:41:22.622777 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.35s]
[0m11:41:22.625333 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:41:22.629423 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:22.630801 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:22.632095 [debug] [MainThread]: On list__silver: Close
[0m11:41:22.633441 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:41:22.634612 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:41:22.635804 [info ] [MainThread]: 
[0m11:41:22.636967 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m11:41:22.638854 [debug] [MainThread]: Command end result
[0m11:41:22.647435 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:22.655515 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:22.673877 [info ] [MainThread]: 
[0m11:41:22.675392 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:41:22.676150 [info ] [MainThread]: Completed successfully
[0m11:41:22.677567 [info ] [MainThread]: 
[0m11:41:22.679215 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:22.681347 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:22.681021 after 1.85 seconds
[0m11:41:22.681751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:22.683874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7350938ef3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735091e24df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735090107be0>]}
[0m11:41:22.685406 [debug] [MainThread]: Flushing usage events
[0m11:41:22.687204 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:41:22.235848 => 11:41:22.686796
[0m11:41:22.689238 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a8adcdc-323f-4678-a450-fc9fce5616b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2a135eb0>]}
[0m11:41:22.690738 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.49s]
[0m11:41:22.700459 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:41:22.706339 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:22.707711 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:22.708626 [debug] [MainThread]: On list__silver: Close
[0m11:41:22.709936 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:41:22.711286 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:41:22.713212 [info ] [MainThread]: 
[0m11:41:22.715449 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.09 seconds (1.09s).
[0m11:41:22.717492 [debug] [MainThread]: Command end result
[0m11:41:22.747674 [info ] [MainThread]: 
[0m11:41:22.749687 [info ] [MainThread]: Completed successfully
[0m11:41:22.751404 [info ] [MainThread]: 
[0m11:41:22.752755 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:22.755237 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:22.754876 after 2.01 seconds
[0m11:41:22.756271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2e7be4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2ccb0eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cfb2a2e4370>]}
[0m11:41:22.757309 [debug] [MainThread]: Flushing usage events
[0m11:41:28.609457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac5d6f3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac67e8d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac67e8df0>]}


============================== 11:41:28.618269 | d2328207-4caf-4eb2-a31a-64d32d6ca83e ==============================
[0m11:41:28.618269 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:28.619558 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:28.751776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac67e8dc0>]}
[0m11:41:28.784566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac429ddf0>]}
[0m11:41:28.786483 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:28.819889 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:29.327784 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:29.328770 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:29.330378 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:29.341187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac40ac820>]}
[0m11:41:29.380415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac4212b20>]}
[0m11:41:29.382210 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:29.383781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac4212ac0>]}
[0m11:41:29.387428 [info ] [MainThread]: 
[0m11:41:29.389433 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:29.392155 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:29.412658 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:29.664191 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:29.669041 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:29.674586 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:29.676570 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:29.685319 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:29.687893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:29.696785 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:29.745859 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:29.753785 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:29.758853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac265ec70>]}
[0m11:41:29.760797 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:29.762812 [info ] [MainThread]: 
[0m11:41:29.792685 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:41:29.794744 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:41:29.797110 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:41:29.798541 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:41:29.819109 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:41:29.840702 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:41:29.799469 => 11:41:29.840278
[0m11:41:29.842073 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:41:29.902038 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:41:29.925811 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:29.936814 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:29.942779 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:29.949501 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:41:29.976417 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:41:29.987835 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:29.994548 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:41:29.998205 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:30.023949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:30.029832 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:30.039376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:41:30.043346 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:30.046438 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:41:29.842905 => 11:41:30.046051
[0m11:41:30.047937 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2328207-4caf-4eb2-a31a-64d32d6ca83e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac1739f70>]}
[0m11:41:30.049349 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.25s]
[0m11:41:30.050782 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:41:30.054750 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:30.055560 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:30.056542 [debug] [MainThread]: On list__silver: Close
[0m11:41:30.058334 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:41:30.059295 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:41:30.060481 [info ] [MainThread]: 
[0m11:41:30.061947 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.67 seconds (0.67s).
[0m11:41:30.063997 [debug] [MainThread]: Command end result
[0m11:41:30.095645 [info ] [MainThread]: 
[0m11:41:30.098357 [info ] [MainThread]: Completed successfully
[0m11:41:30.099879 [info ] [MainThread]: 
[0m11:41:30.101125 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:30.102778 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:30.102499 after 1.53 seconds
[0m11:41:30.104004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac5d6f3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac1882c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b4ac408ecd0>]}
[0m11:41:30.105345 [debug] [MainThread]: Flushing usage events
[0m11:41:36.875801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f5d2f3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f678ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f678edc0>]}


============================== 11:41:36.896303 | b963a1e7-0473-46c2-8870-54ad9f7a68ed ==============================
[0m11:41:36.896303 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:36.900599 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:37.035797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744548507490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744548f8adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744548f8ae50>]}


============================== 11:41:37.058983 | d471ee0f-b3d7-4c78-be92-61adaac714a2 ==============================
[0m11:41:37.058983 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:37.066199 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:37.054879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747d867490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747e29cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747e2ad790>]}


============================== 11:41:37.077768 | d26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e ==============================
[0m11:41:37.077768 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:37.080680 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:37.305146 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f678ed90>]}
[0m11:41:37.418112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f422fdc0>]}
[0m11:41:37.434045 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:37.439899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744548f8ad60>]}
[0m11:41:37.503680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747e29cfd0>]}
[0m11:41:37.516021 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:37.559053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744546a2de80>]}
[0m11:41:37.567589 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:37.601820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747bd68ee0>]}
[0m11:41:37.613326 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:37.679750 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:37.792284 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:38.766340 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:38.767775 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:38.770334 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:41:38.774568 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:38.779747 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:38.786241 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:41:38.790407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f402c7f0>]}
[0m11:41:38.816491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747bb6d8e0>]}
[0m11:41:38.851681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f4192af0>]}
[0m11:41:38.853624 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:38.855378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f4192a90>]}
[0m11:41:38.859229 [info ] [MainThread]: 
[0m11:41:38.866892 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:38.871099 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:38.895245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747bcc9be0>]}
[0m11:41:38.897275 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:38.898837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747bcc9b80>]}
[0m11:41:38.901271 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:38.902807 [info ] [MainThread]: 
[0m11:41:38.905385 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:38.905951 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:38.906833 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:38.908991 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:38.908730 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:38.923174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74454682c880>]}
[0m11:41:38.931125 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:38.968370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744546992b80>]}
[0m11:41:38.970884 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:38.972301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744546992b20>]}
[0m11:41:38.976373 [info ] [MainThread]: 
[0m11:41:38.979943 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:38.983320 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:39.011779 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:39.405930 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:39.423585 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:39.434693 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:39.437264 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:39.438500 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:39.449144 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:39.457251 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:39.462917 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:39.491131 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:39.492076 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:39.496804 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:39.517778 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:39.519371 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:39.534645 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:39.623782 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:39.637180 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:39.645794 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:41:39.647631 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:39.649690 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:41:39.655920 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:39.659529 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:39.669284 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:39.675015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f25f2c40>]}
[0m11:41:39.678155 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:39.684999 [info ] [MainThread]: 
[0m11:41:39.686910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747a131d30>]}
[0m11:41:39.690194 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:39.696406 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:39.700223 [info ] [MainThread]: 
[0m11:41:39.699237 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:39.757142 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:41:39.788551 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:41:39.795842 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:41:39.799610 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:41:39.791831 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:41:39.804436 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:41:39.807398 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:41:39.807769 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:41:39.809524 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:41:39.842263 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:41:39.854517 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:39.867205 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:41:39.880569 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:39.895818 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:41:39.812399 => 11:41:39.894465
[0m11:41:39.898827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7445467f4b80>]}
[0m11:41:39.900536 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:41:39.904806 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:39.909100 [info ] [MainThread]: 
[0m11:41:39.915484 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:41:39.817549 => 11:41:39.914529
[0m11:41:39.917655 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:41:39.979822 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:41:39.982719 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:41:39.985488 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:41:39.990917 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:41:40.034118 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:41:40.092503 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:41:39.994538 => 11:41:40.091578
[0m11:41:40.095921 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:41:40.194269 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:41:40.195726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:41:40.248382 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:41:40.253629 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:41:40.310136 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:40.322436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:40.333297 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:40.344616 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:40.349152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:41:40.357104 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:41:40.370104 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:41:40.390360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:41:40.397931 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:41:40.407714 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:41:40.435680 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:41:40.444461 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:40.457019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:41:40.469383 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:41:40.473080 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:40.476310 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:40.485929 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:41:40.490729 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:41:40.492044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:40.521490 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:41:40.618350 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:40.618620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m11:41:40.634037 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:40.641085 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:41:40.647691 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:40.651063 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:41:40.661444 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:40.691076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:41:40.691192 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:41:40.698420 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:40.699979 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:40.705899 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:41:39.903385 => 11:41:40.705151
[0m11:41:40.711210 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:41:39.918871 => 11:41:40.710616
[0m11:41:40.715599 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b963a1e7-0473-46c2-8870-54ad9f7a68ed', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f16b6fd0>]}
[0m11:41:40.717600 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd26a6b99-17aa-4a28-b6a6-b4fc62c6fa1e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7479377ee0>]}
[0m11:41:40.720427 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.91s]
[0m11:41:40.727700 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.91s]
[0m11:41:40.732771 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:41:40.733103 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:41:40.740635 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:40.741381 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:40.743414 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:40.745524 [debug] [MainThread]: On list__silver: Close
[0m11:41:40.743380 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:40.747622 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:41:40.748728 [debug] [MainThread]: On list__silver: Close
[0m11:41:40.749004 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:41:40.750341 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:41:40.750471 [info ] [MainThread]: 
[0m11:41:40.752110 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:41:40.752210 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.89 seconds (1.89s).
[0m11:41:40.755842 [debug] [MainThread]: Command end result
[0m11:41:40.755226 [info ] [MainThread]: 
[0m11:41:40.765880 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.85 seconds (1.85s).
[0m11:41:40.768696 [debug] [MainThread]: Command end result
[0m11:41:40.781693 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:40.791468 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:40.827382 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:41:40.833234 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:40.848585 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:41:40.099856 => 11:41:40.848163
[0m11:41:40.853104 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd471ee0f-b3d7-4c78-be92-61adaac714a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74453ffffe50>]}
[0m11:41:40.855606 [info ] [MainThread]: 
[0m11:41:40.858589 [info ] [MainThread]: Completed successfully
[0m11:41:40.860455 [info ] [MainThread]: 
[0m11:41:40.863124 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:40.866790 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:40.866375 after 4.18 seconds
[0m11:41:40.867850 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.87s]
[0m11:41:40.870654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f5d2f3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f16f53a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c79f400eca0>]}
[0m11:41:40.871187 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:41:40.882407 [debug] [MainThread]: Flushing usage events
[0m11:41:40.901326 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:40.903095 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:41:40.912347 [debug] [MainThread]: On list__gold: Close
[0m11:41:40.913810 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:41:40.917645 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:41:40.920041 [info ] [MainThread]: 
[0m11:41:40.923086 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.94 seconds (1.94s).
[0m11:41:40.926319 [debug] [MainThread]: Command end result
[0m11:41:40.954398 [info ] [MainThread]: 
[0m11:41:40.957072 [info ] [MainThread]: Completed successfully
[0m11:41:40.967156 [info ] [MainThread]: 
[0m11:41:40.980643 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:40.986159 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:40.985590 after 3.99 seconds
[0m11:41:40.987701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747d867490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c747bb4fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7479209460>]}
[0m11:41:40.989956 [debug] [MainThread]: Flushing usage events
[0m11:41:41.041325 [info ] [MainThread]: 
[0m11:41:41.105917 [info ] [MainThread]: Completed successfully
[0m11:41:41.156525 [info ] [MainThread]: 
[0m11:41:41.169523 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:41.171695 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:41.171413 after 4.29 seconds
[0m11:41:41.173115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744548507490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74454680ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x744544060be0>]}
[0m11:41:41.174851 [debug] [MainThread]: Flushing usage events
[0m11:41:47.451776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625bc62f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625bd08ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625bd09e790>]}


============================== 11:41:47.464187 | 07ade07a-2e9c-40cd-85bb-624586668604 ==============================
[0m11:41:47.464187 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:47.466258 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:47.601628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625bd08de20>]}
[0m11:41:47.640917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625bab25ee0>]}
[0m11:41:47.644219 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:47.680853 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:48.146240 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:48.147062 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:48.148112 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:48.154862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625ba92e8e0>]}
[0m11:41:48.179647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625baa89be0>]}
[0m11:41:48.180843 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:48.181958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625baa89b80>]}
[0m11:41:48.184354 [info ] [MainThread]: 
[0m11:41:48.185941 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:48.187984 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:48.204464 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:48.408489 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:48.413200 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:48.419030 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:48.420164 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:48.429509 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:48.433225 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:48.441611 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:48.488093 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:48.494339 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:48.498840 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625b8ef1d30>]}
[0m11:41:48.500404 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:48.501261 [info ] [MainThread]: 
[0m11:41:48.519369 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:41:48.520436 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:41:48.521596 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:41:48.522463 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:41:48.533938 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:41:48.549114 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:41:48.523211 => 11:41:48.548711
[0m11:41:48.550210 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:41:48.605709 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:41:48.621119 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:48.632719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:48.638624 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:48.643822 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:41:48.665427 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:41:48.676542 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:48.683277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:41:48.687489 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:48.718585 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:48.723844 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:48.734724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:41:48.738695 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:48.740991 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:41:48.551147 => 11:41:48.740689
[0m11:41:48.742769 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '07ade07a-2e9c-40cd-85bb-624586668604', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625b3f81cd0>]}
[0m11:41:48.744549 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.22s]
[0m11:41:48.746877 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:41:48.750104 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:48.751174 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:48.752096 [debug] [MainThread]: On list__silver: Close
[0m11:41:48.753257 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:41:48.754728 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:41:48.756074 [info ] [MainThread]: 
[0m11:41:48.757337 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m11:41:48.758641 [debug] [MainThread]: Command end result
[0m11:41:48.790494 [info ] [MainThread]: 
[0m11:41:48.791647 [info ] [MainThread]: Completed successfully
[0m11:41:48.792696 [info ] [MainThread]: 
[0m11:41:48.793862 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:48.795303 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:48.795135 after 1.38 seconds
[0m11:41:48.796170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625bc62f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625ba911d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7625b3f6a220>]}
[0m11:41:48.797113 [debug] [MainThread]: Flushing usage events
[0m11:41:56.557784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737d14433d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737d1e19d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737d1e19df0>]}


============================== 11:41:56.570076 | dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b ==============================
[0m11:41:56.570076 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:56.572407 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:56.641480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe110e73a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe11b4ad30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe11b4adc0>]}


============================== 11:41:56.656309 | 4642c68d-fd78-49a0-a07e-a414e16a9b7d ==============================
[0m11:41:56.656309 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:56.658955 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:56.736278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1e8e7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1f35adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1f35ae50>]}


============================== 11:41:56.752836 | b617d4dc-a095-41dc-9a29-880ccaa6c17f ==============================
[0m11:41:56.752836 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:41:56.754968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:41:56.790046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737d1e19dc0>]}
[0m11:41:56.857117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cf99ddf0>]}
[0m11:41:56.864102 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:56.892617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe11b4ad90>]}
[0m11:41:56.916028 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:56.956204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0f5f1dc0>]}
[0m11:41:56.958337 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:57.017140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1f35ad60>]}
[0m11:41:57.023121 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:57.091511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1ce28e80>]}
[0m11:41:57.094298 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:41:57.137186 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:41:57.404651 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:57.405812 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:57.407725 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:57.422018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cf7ac820>]}
[0m11:41:57.439572 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:57.440638 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:57.442984 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:41:57.458816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0f3ec7f0>]}
[0m11:41:57.459650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cf909b20>]}
[0m11:41:57.461923 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:57.463673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cf909ac0>]}
[0m11:41:57.467171 [info ] [MainThread]: 
[0m11:41:57.469362 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:57.472677 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:57.500002 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:57.504584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0f552af0>]}
[0m11:41:57.506049 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:57.507613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0f552a90>]}
[0m11:41:57.511391 [info ] [MainThread]: 
[0m11:41:57.514123 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:57.517044 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:57.555679 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:57.622626 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:41:57.625731 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:41:57.628575 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:41:57.646257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1cc2c880>]}
[0m11:41:57.693915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1cd89b80>]}
[0m11:41:57.697025 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:41:57.700055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1cd89b20>]}
[0m11:41:57.709897 [info ] [MainThread]: 
[0m11:41:57.718162 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:41:57.721999 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:41:57.747292 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:57.984998 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:57.996167 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.008306 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:41:58.010997 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:41:58.034866 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:58.045029 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.053172 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:58.055738 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:58.054306 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:58.058655 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:58.072608 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:58.100366 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:58.106216 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:58.124528 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:58.207995 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:58.220391 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:58.222216 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.228958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cf774c10>]}
[0m11:41:58.231317 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:58.233529 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.234794 [info ] [MainThread]: 
[0m11:41:58.240787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0d99ec40>]}
[0m11:41:58.243757 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:58.247999 [info ] [MainThread]: 
[0m11:41:58.295019 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:41:58.300022 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:41:58.298781 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:41:58.302730 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:41:58.309252 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.306214 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:41:58.321484 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:41:58.324449 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:41:58.328541 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:41:58.327178 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:41:58.382511 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:41:58.331750 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:41:58.385971 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:41:58.407709 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:41:58.437708 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:41:58.464841 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:41:58.477188 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:58.501533 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:41:58.315540 => 11:41:58.500240
[0m11:41:58.503202 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:41:58.505540 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:41:58.426095 => 11:41:58.504697
[0m11:41:58.507113 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:41:58.682421 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:41:58.701591 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.726981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1b1b2cd0>]}
[0m11:41:58.735673 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:41:58.739767 [info ] [MainThread]: 
[0m11:41:58.757791 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:41:58.806481 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:41:58.837894 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:41:58.844613 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:58.845865 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:41:58.848751 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:41:58.851010 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:41:58.856352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.866128 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:41:58.872353 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:41:58.889490 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:41:58.897610 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:41:58.898045 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:41:58.940302 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:41:58.948720 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:58.957316 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:41:58.854473 => 11:41:58.956563
[0m11:41:58.960859 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:41:58.962323 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.966442 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:41:58.983170 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:58.990442 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:41:59.009988 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:41:59.068178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:41:59.071854 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:59.084937 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:59.090286 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:41:59.099430 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:59.111512 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:41:59.117854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:59.123469 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:41:58.508385 => 11:41:59.122913
[0m11:41:59.128509 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4642c68d-fd78-49a0-a07e-a414e16a9b7d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0ca78d60>]}
[0m11:41:59.130833 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.80s]
[0m11:41:59.133656 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:41:59.160764 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:59.168307 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:59.170285 [debug] [MainThread]: On list__silver: Close
[0m11:41:59.173526 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:41:59.187025 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:41:59.188833 [info ] [MainThread]: 
[0m11:41:59.188944 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:41:59.190867 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.68 seconds (1.68s).
[0m11:41:59.196104 [debug] [MainThread]: Command end result
[0m11:41:59.204557 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:59.212182 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:41:59.214852 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:59.237131 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:41:59.236769 [info ] [MainThread]: 
[0m11:41:59.237465 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:59.238627 [info ] [MainThread]: Completed successfully
[0m11:41:59.240095 [info ] [MainThread]: 
[0m11:41:59.241576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:59.242656 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:59.247604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:59.249622 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:59.249034 after 2.71 seconds
[0m11:41:59.250089 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:41:58.504742 => 11:41:59.249682
[0m11:41:59.251554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe110e73a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0cbe1c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x6ffe0f3ceca0>]}
[0m11:41:59.252955 [debug] [MainThread]: Flushing usage events
[0m11:41:59.252921 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd9aa76d-8c39-436a-9a7c-d4eb57b57a1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cce0c6a0>]}
[0m11:41:59.254910 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.95s]
[0m11:41:59.257683 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:41:59.258935 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:41:59.268648 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:59.269890 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:41:59.271030 [debug] [MainThread]: On list__gold: Close
[0m11:41:59.272508 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:41:59.274341 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:41:59.279230 [info ] [MainThread]: 
[0m11:41:59.282135 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.81 seconds (1.81s).
[0m11:41:59.284864 [debug] [MainThread]: Command end result
[0m11:41:59.296177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:41:59.312019 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:41:59.322799 [info ] [MainThread]: 
[0m11:41:59.323756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:41:59.326192 [info ] [MainThread]: Completed successfully
[0m11:41:59.328312 [info ] [MainThread]: 
[0m11:41:59.330258 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:59.330099 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:59.332322 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:59.332024 after 2.83 seconds
[0m11:41:59.333628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737d14433d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737cf78ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7737ccf8dbe0>]}
[0m11:41:59.335230 [debug] [MainThread]: Flushing usage events
[0m11:41:59.382201 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:41:59.388406 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:59.401893 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:41:59.405867 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:41:59.409648 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:41:58.964424 => 11:41:59.409172
[0m11:41:59.411638 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b617d4dc-a095-41dc-9a29-880ccaa6c17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1a27cf70>]}
[0m11:41:59.412982 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.56s]
[0m11:41:59.414973 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:41:59.419907 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:41:59.421517 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:41:59.422336 [debug] [MainThread]: On list__silver: Close
[0m11:41:59.423457 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:41:59.425211 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:41:59.426517 [info ] [MainThread]: 
[0m11:41:59.427740 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m11:41:59.428984 [debug] [MainThread]: Command end result
[0m11:41:59.457086 [info ] [MainThread]: 
[0m11:41:59.459313 [info ] [MainThread]: Completed successfully
[0m11:41:59.460836 [info ] [MainThread]: 
[0m11:41:59.462447 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:41:59.465426 [debug] [MainThread]: Command `dbt run` succeeded at 11:41:59.465077 after 2.80 seconds
[0m11:41:59.466583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1e8e7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1ce28e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79da1a423070>]}
[0m11:41:59.467542 [debug] [MainThread]: Flushing usage events
[0m11:42:05.609462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a39cc490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a444ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a445e790>]}


============================== 11:42:05.617091 | 49844996-562a-464b-bd09-e75026d5d392 ==============================
[0m11:42:05.617091 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:05.618348 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:05.745009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a444de20>]}
[0m11:42:05.769473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a1ef0ee0>]}
[0m11:42:05.771017 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:05.804451 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:06.273133 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:06.275000 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:06.284372 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:06.292116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a1cec8e0>]}
[0m11:42:06.325887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a1e52be0>]}
[0m11:42:06.327271 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:06.328334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a1e52b80>]}
[0m11:42:06.330188 [info ] [MainThread]: 
[0m11:42:06.331811 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:06.334531 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:06.350224 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:06.550414 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:06.555047 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:06.559126 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:06.560447 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:06.567872 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:06.570127 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:06.579616 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:06.635047 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:06.645528 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:06.649380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a02b0d30>]}
[0m11:42:06.651749 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:06.653204 [info ] [MainThread]: 
[0m11:42:06.677438 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:42:06.678935 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:42:06.682310 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:42:06.683902 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:42:06.694643 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:42:06.707487 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:42:06.684726 => 11:42:06.707118
[0m11:42:06.708524 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:42:06.791471 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:42:06.805104 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:06.816562 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:06.821335 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:06.827209 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:42:06.843484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:42:06.859231 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:06.868148 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:42:06.871227 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:06.902484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:06.908283 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:06.919022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:42:06.924043 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:06.928331 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:42:06.709385 => 11:42:06.928071
[0m11:42:06.930578 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49844996-562a-464b-bd09-e75026d5d392', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a007dfd0>]}
[0m11:42:06.933730 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.25s]
[0m11:42:06.936097 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:42:06.939289 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:06.940037 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:06.940701 [debug] [MainThread]: On list__silver: Close
[0m11:42:06.941716 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:42:06.943159 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:42:06.944721 [info ] [MainThread]: 
[0m11:42:06.946205 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m11:42:06.947440 [debug] [MainThread]: Command end result
[0m11:42:06.977758 [info ] [MainThread]: 
[0m11:42:06.980211 [info ] [MainThread]: Completed successfully
[0m11:42:06.981739 [info ] [MainThread]: 
[0m11:42:06.983036 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:06.984782 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:06.984562 after 1.41 seconds
[0m11:42:06.985930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a39cc490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a1cced90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7890a026c700>]}
[0m11:42:06.986986 [debug] [MainThread]: Flushing usage events
[0m11:42:12.937844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7851049af430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78510540cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78510540ce50>]}
[0m11:42:12.937029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa262f400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa2f9cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa2f9cfd0>]}


============================== 11:42:12.948267 | acfb3882-2018-4c89-a604-0f11408e3ac6 ==============================
[0m11:42:12.948267 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:12.949352 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}


============================== 11:42:12.949350 | 1d553879-4ca4-45d1-a4b8-4da82df387a6 ==============================
[0m11:42:12.949350 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:12.950633 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:13.055454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da9389e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da94308dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da94308e50>]}


============================== 11:42:13.064536 | aad124a6-9089-414f-80b7-92ce4276ff88 ==============================
[0m11:42:13.064536 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:13.066052 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:13.108131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa2f9cdf0>]}
[0m11:42:13.112977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78510540cd60>]}
[0m11:42:13.152115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa0b1de50>]}
[0m11:42:13.153714 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:13.157328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785102e9be80>]}
[0m11:42:13.159082 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:13.189040 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:13.188962 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:13.234335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da94308d60>]}
[0m11:42:13.276365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da91d9be80>]}
[0m11:42:13.277833 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:13.309177 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:13.502297 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:13.502536 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:13.503644 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:13.503787 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:13.505215 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:13.505803 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:13.515428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa092b850>]}
[0m11:42:13.516763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785102cac880>]}
[0m11:42:13.549300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785102e12b80>]}
[0m11:42:13.550003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa0a9ab50>]}
[0m11:42:13.550686 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:13.551445 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:13.552066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785102e12b20>]}
[0m11:42:13.552722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa0a9aaf0>]}
[0m11:42:13.556427 [info ] [MainThread]: 
[0m11:42:13.556801 [info ] [MainThread]: 
[0m11:42:13.558966 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:13.558455 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:13.561653 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:13.561757 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:13.585086 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:13.586005 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:13.805119 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:13.806548 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:13.808270 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:13.821574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da91bac880>]}
[0m11:42:13.861474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da91d12b80>]}
[0m11:42:13.863211 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:13.865035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da91d12b20>]}
[0m11:42:13.869576 [info ] [MainThread]: 
[0m11:42:13.871714 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:13.874677 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:13.890097 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:13.896102 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:13.901047 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:13.902611 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:13.902464 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:13.909093 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:13.905085 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:13.915643 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:42:13.925354 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:13.928978 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:13.919044 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:42:13.930597 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:13.934760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:13.937216 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:13.943775 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:13.998256 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:14.004413 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:14.009519 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.013570 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.017138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9a9eedeca0>]}
[0m11:42:14.020319 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785102c75be0>]}
[0m11:42:14.020812 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:14.023486 [info ] [MainThread]: 
[0m11:42:14.023848 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:14.025794 [info ] [MainThread]: 
[0m11:42:14.049399 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:42:14.051041 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:42:14.051936 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:42:14.053327 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:42:14.053546 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:42:14.055077 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:42:14.055713 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:42:14.056942 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:42:14.070603 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:42:14.073172 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:42:14.081010 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:42:14.056014 => 11:42:14.080405
[0m11:42:14.083559 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:42:14.057825 => 11:42:14.083033
[0m11:42:14.084061 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:42:14.084994 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:42:14.172730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:42:14.175848 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:42:14.199822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:42:14.206301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:14.217117 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:14.223649 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:14.224052 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.231077 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.232039 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:42:14.233049 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:14.238497 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.239170 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:42:14.243297 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:14.245660 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:42:14.247564 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:42:14.250284 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:14.260027 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.261320 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.262964 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:14.266896 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:14.269485 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:42:14.270346 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:42:14.275376 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.275281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.275500 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.322882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:14.327337 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:14.331432 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.335748 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.345194 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:14.351038 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:42:14.357167 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.357251 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:42:14.357922 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.361297 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:42:14.084916 => 11:42:14.360917
[0m11:42:14.361631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.363231 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1d553879-4ca4-45d1-a4b8-4da82df387a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9a9dfb8df0>]}
[0m11:42:14.364231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da90173cd0>]}
[0m11:42:14.364856 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.31s]
[0m11:42:14.365358 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:42:14.085706 => 11:42:14.364989
[0m11:42:14.365961 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:14.366481 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:42:14.366761 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'acfb3882-2018-4c89-a604-0f11408e3ac6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785100339fa0>]}
[0m11:42:14.366930 [info ] [MainThread]: 
[0m11:42:14.367986 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.31s]
[0m11:42:14.369669 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:14.370394 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:14.370609 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:42:14.371328 [debug] [MainThread]: On list__silver: Close
[0m11:42:14.372236 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:42:14.373306 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:42:14.374350 [info ] [MainThread]: 
[0m11:42:14.375922 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:42:14.376470 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:14.377935 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:42:14.378189 [debug] [MainThread]: Command end result
[0m11:42:14.379156 [debug] [MainThread]: On list__gold: Close
[0m11:42:14.380317 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:42:14.381415 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:42:14.382905 [info ] [MainThread]: 
[0m11:42:14.384335 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:42:14.386104 [debug] [MainThread]: Command end result
[0m11:42:14.395173 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:42:14.396779 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:42:14.398253 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:42:14.399246 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:42:14.410467 [info ] [MainThread]: 
[0m11:42:14.412231 [info ] [MainThread]: Completed successfully
[0m11:42:14.413716 [info ] [MainThread]: 
[0m11:42:14.415854 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:14.418249 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:14.417856 after 1.52 seconds
[0m11:42:14.419435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa262f400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9aa0b1de50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e9a9dfedf40>]}
[0m11:42:14.419479 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:42:14.420332 [debug] [MainThread]: Flushing usage events
[0m11:42:14.446449 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:42:14.401246 => 11:42:14.445884
[0m11:42:14.447624 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:42:14.461526 [info ] [MainThread]: 
[0m11:42:14.463825 [info ] [MainThread]: Completed successfully
[0m11:42:14.466443 [info ] [MainThread]: 
[0m11:42:14.467911 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:14.469841 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:14.469532 after 1.56 seconds
[0m11:42:14.470950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7851049af430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785100483c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x785102c8ed30>]}
[0m11:42:14.472042 [debug] [MainThread]: Flushing usage events
[0m11:42:14.553106 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:42:14.574390 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:14.597519 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:14.606522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.620813 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:42:14.664637 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:42:14.706847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:42:14.721008 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:42:14.725978 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.796028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:14.806486 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:14.826238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:42:14.830757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:14.835425 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:42:14.448485 => 11:42:14.835004
[0m11:42:14.837165 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aad124a6-9089-414f-80b7-92ce4276ff88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da900ee9a0>]}
[0m11:42:14.838651 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.44s]
[0m11:42:14.841185 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:42:14.847756 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:14.849099 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:14.849968 [debug] [MainThread]: On list__silver: Close
[0m11:42:14.850983 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:42:14.852119 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:42:14.853568 [info ] [MainThread]: 
[0m11:42:14.856731 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.98 seconds (0.98s).
[0m11:42:14.858627 [debug] [MainThread]: Command end result
[0m11:42:14.885473 [info ] [MainThread]: 
[0m11:42:14.887051 [info ] [MainThread]: Completed successfully
[0m11:42:14.888529 [info ] [MainThread]: 
[0m11:42:14.890147 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:14.892281 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:14.891957 after 1.90 seconds
[0m11:42:14.893596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da9389e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da91b8ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78da900c57f0>]}
[0m11:42:14.895409 [debug] [MainThread]: Flushing usage events
[0m11:42:20.408442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf8e43460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf98cfe20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf98cfdf0>]}


============================== 11:42:20.416656 | db801af7-8524-46d7-bd4b-8c0547294fd8 ==============================
[0m11:42:20.416656 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:20.417759 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:20.551130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf98cfe80>]}
[0m11:42:20.586578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf73a4eb0>]}
[0m11:42:20.588401 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:20.633111 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:21.530501 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:21.531811 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:21.534056 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:42:21.542469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf71ab8b0>]}
[0m11:42:21.568593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf7309bb0>]}
[0m11:42:21.569936 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:21.571525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf7309b50>]}
[0m11:42:21.575023 [info ] [MainThread]: 
[0m11:42:21.577175 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:21.580924 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:21.596187 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:21.806343 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:21.811292 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:21.816970 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:21.824361 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:21.840229 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:21.841817 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:21.850368 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:21.894246 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:21.900036 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:21.903961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf5731d00>]}
[0m11:42:21.905322 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:21.906095 [info ] [MainThread]: 
[0m11:42:21.923887 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:42:21.925627 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:42:21.927044 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:42:21.928136 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:42:21.940591 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:42:21.956544 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:42:21.928819 => 11:42:21.956069
[0m11:42:21.958047 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:42:22.021291 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:42:22.042037 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:22.052697 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:22.059073 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:22.068971 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:42:22.091980 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:42:22.102671 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:22.110768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:42:22.115781 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:22.156356 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:22.162694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:22.173864 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:42:22.178009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:22.180452 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:42:21.958988 => 11:42:22.180264
[0m11:42:22.182286 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db801af7-8524-46d7-bd4b-8c0547294fd8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf49a69a0>]}
[0m11:42:22.184137 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.26s]
[0m11:42:22.185981 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:42:22.189889 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:22.190976 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:22.191954 [debug] [MainThread]: On list__silver: Close
[0m11:42:22.193129 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:42:22.194088 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:42:22.195270 [info ] [MainThread]: 
[0m11:42:22.196399 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m11:42:22.197780 [debug] [MainThread]: Command end result
[0m11:42:22.231449 [info ] [MainThread]: 
[0m11:42:22.232917 [info ] [MainThread]: Completed successfully
[0m11:42:22.234703 [info ] [MainThread]: 
[0m11:42:22.236166 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:22.237806 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:22.237643 after 1.86 seconds
[0m11:42:22.238957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf8e43460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf495bc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e5cf49a0460>]}
[0m11:42:22.240035 [debug] [MainThread]: Flushing usage events
[0m11:42:28.319947 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd21876f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd2191dddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd2191ee790>]}


============================== 11:42:28.332254 | ad0e4c30-663c-4da0-a455-c716898f5047 ==============================
[0m11:42:28.332254 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:28.334747 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:28.415308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b439c6460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b44388fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b44388df0>]}
[0m11:42:28.415714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cc03c3430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cc0e3adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cc0e3ae50>]}


============================== 11:42:28.432257 | dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c ==============================
[0m11:42:28.432257 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:42:28.433087 | e8d2e0d4-65c8-4c34-832c-5c51fd43acf4 ==============================
[0m11:42:28.433087 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:28.434929 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:28.435218 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:28.541952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd2191ddfd0>]}
[0m11:42:28.598099 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd216ca7ee0>]}
[0m11:42:28.599900 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:28.630257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cc0e3ad60>]}
[0m11:42:28.635164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b44388e50>]}
[0m11:42:28.640941 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:28.669118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbe8dde80>]}
[0m11:42:28.670974 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:28.678100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b41ee2eb0>]}
[0m11:42:28.680069 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:28.705423 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:28.715141 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:29.049657 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:29.050756 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:29.052855 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:29.052773 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:42:29.054404 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:29.055774 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:29.063144 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:29.064762 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:29.066699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbe6ec880>]}
[0m11:42:29.066611 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:29.067106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd216aac8e0>]}
[0m11:42:29.078262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b41ced8b0>]}
[0m11:42:29.100327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd216c12be0>]}
[0m11:42:29.101662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbe852b80>]}
[0m11:42:29.101713 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:29.103029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd216c12b80>]}
[0m11:42:29.103518 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:29.105918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbe852b20>]}
[0m11:42:29.106190 [info ] [MainThread]: 
[0m11:42:29.108173 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:29.108874 [info ] [MainThread]: 
[0m11:42:29.111257 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:29.111946 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:29.115370 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:29.135593 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:29.139927 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:29.178223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b41e46bb0>]}
[0m11:42:29.180085 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:29.181436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b41e46b50>]}
[0m11:42:29.185324 [info ] [MainThread]: 
[0m11:42:29.187683 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:29.190750 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:29.217614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:29.474327 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:29.481310 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:29.489900 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:29.490234 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:29.496349 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.492401 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:29.504661 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:42:29.516064 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:42:29.521973 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:29.523526 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:29.523684 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:29.529735 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:29.536380 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.545657 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.577689 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:29.588378 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.596414 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:29.603980 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:29.614467 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:29.620049 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:29.623213 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:29.633788 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.635346 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.643055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd215031d30>]}
[0m11:42:29.646660 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:29.647896 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:29.649773 [info ] [MainThread]: 
[0m11:42:29.662010 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.670742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbc75f820>]}
[0m11:42:29.673247 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:29.675619 [info ] [MainThread]: 
[0m11:42:29.690339 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:42:29.692776 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:42:29.696224 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:42:29.698376 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:42:29.710982 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:42:29.711697 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:29.713114 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:42:29.715743 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:42:29.717447 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:42:29.720023 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:42:29.720780 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.727558 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b402b3d00>]}
[0m11:42:29.729505 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:29.730646 [info ] [MainThread]: 
[0m11:42:29.736131 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:42:29.740165 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:42:29.699399 => 11:42:29.739240
[0m11:42:29.742085 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:42:29.747538 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:42:29.718530 => 11:42:29.746733
[0m11:42:29.748956 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:42:29.762818 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:42:29.764568 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:42:29.766296 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:42:29.767888 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:42:29.784366 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:42:29.800831 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:42:29.768658 => 11:42:29.800178
[0m11:42:29.802757 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:42:29.854189 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:42:29.862061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:42:29.883504 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:42:29.885661 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:29.899888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:29.906067 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:29.907148 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.914256 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.915690 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:42:29.921341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:42:29.922385 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:42:29.933071 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:42:29.935229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:42:29.940666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:29.949774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.961988 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:29.963481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:42:29.967904 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:29.969559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:29.973031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:42:29.980699 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:42:29.984957 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:42:29.989962 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:30.000184 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:42:30.018997 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:30.025428 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:30.029895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:42:30.031867 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:30.035532 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:30.046699 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:42:30.049288 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:30.050998 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:30.054701 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:42:29.743085 => 11:42:30.054371
[0m11:42:30.056525 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ad0e4c30-663c-4da0-a455-c716898f5047', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd2140f8e50>]}
[0m11:42:30.057132 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:30.058447 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.36s]
[0m11:42:30.059882 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:42:30.064679 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:30.066010 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:30.067297 [debug] [MainThread]: On list__silver: Close
[0m11:42:30.068603 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:42:30.069694 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:42:30.070723 [info ] [MainThread]: 
[0m11:42:30.072126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:42:30.072010 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m11:42:30.074059 [debug] [MainThread]: Command end result
[0m11:42:30.076362 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:30.078169 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:30.079500 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:42:29.750051 => 11:42:30.079087
[0m11:42:30.081399 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8d2e0d4-65c8-4c34-832c-5c51fd43acf4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbc57d760>]}
[0m11:42:30.083242 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.37s]
[0m11:42:30.086105 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:42:30.086066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:30.090046 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:30.091028 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:42:30.092514 [debug] [MainThread]: On list__gold: Close
[0m11:42:30.093980 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:42:30.095375 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:42:30.096664 [info ] [MainThread]: 
[0m11:42:30.098169 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.99 seconds (0.99s).
[0m11:42:30.100717 [debug] [MainThread]: Command end result
[0m11:42:30.105766 [info ] [MainThread]: 
[0m11:42:30.107292 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:42:30.107307 [info ] [MainThread]: Completed successfully
[0m11:42:30.108668 [info ] [MainThread]: 
[0m11:42:30.110816 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:30.112081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:30.113620 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:30.113200 after 1.84 seconds
[0m11:42:30.116470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd21876f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd214247d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dd216a8ed90>]}
[0m11:42:30.118005 [debug] [MainThread]: Flushing usage events
[0m11:42:30.118328 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:42:29.804265 => 11:42:30.117877
[0m11:42:30.120375 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcb3ed12-4bf5-4626-a1f6-900dc2b1f35c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b4007f6d0>]}
[0m11:42:30.123518 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.35s]
[0m11:42:30.127877 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:42:30.133734 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:30.137109 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:30.139619 [debug] [MainThread]: On list__silver: Close
[0m11:42:30.142607 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:42:30.146399 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:42:30.148452 [info ] [MainThread]: 
[0m11:42:30.150752 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m11:42:30.153717 [debug] [MainThread]: Command end result
[0m11:42:30.167391 [info ] [MainThread]: 
[0m11:42:30.168881 [info ] [MainThread]: Completed successfully
[0m11:42:30.170460 [info ] [MainThread]: 
[0m11:42:30.172469 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:30.174762 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:30.174181 after 1.80 seconds
[0m11:42:30.176949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cc03c3430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbe6ced30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x709cbc7151c0>]}
[0m11:42:30.178686 [debug] [MainThread]: Flushing usage events
[0m11:42:30.209337 [info ] [MainThread]: 
[0m11:42:30.210660 [info ] [MainThread]: Completed successfully
[0m11:42:30.212077 [info ] [MainThread]: 
[0m11:42:30.213430 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:30.215109 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:30.214819 after 1.91 seconds
[0m11:42:30.216001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b439c6460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b41ccfd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x757b4005c730>]}
[0m11:42:30.216847 [debug] [MainThread]: Flushing usage events
[0m11:42:35.944550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec45ea7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec468ffd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec468ffe20>]}


============================== 11:42:35.952338 | 7cfac691-40e4-4773-ad71-2a3cb92fc1c1 ==============================
[0m11:42:35.952338 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:35.953527 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:36.072710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec468ffdf0>]}
[0m11:42:36.101335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec4439be50>]}
[0m11:42:36.102808 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:36.125648 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:36.743367 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:36.744613 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:36.746496 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:42:36.753791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec441ab850>]}
[0m11:42:36.796833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec44312b50>]}
[0m11:42:36.798467 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:36.799825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec44312af0>]}
[0m11:42:36.802621 [info ] [MainThread]: 
[0m11:42:36.804373 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:36.806618 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:36.824488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:37.085058 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:37.089602 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:37.096310 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:42:37.103300 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:42:37.108563 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:37.111877 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:37.120274 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:37.173173 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:37.180669 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:37.186591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec42222790>]}
[0m11:42:37.188945 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:37.190951 [info ] [MainThread]: 
[0m11:42:37.214241 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:42:37.216015 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:42:37.218296 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:42:37.219552 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:42:37.232225 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:42:37.257398 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:42:37.220487 => 11:42:37.256696
[0m11:42:37.258714 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:42:37.336220 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:42:37.351494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:37.362422 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:37.367911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:37.372930 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:42:37.394516 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:42:37.408557 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:37.416118 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:42:37.421384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:37.460197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:37.466131 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:37.473828 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:42:37.478334 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:37.480639 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:42:37.259714 => 11:42:37.480448
[0m11:42:37.482198 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7cfac691-40e4-4773-ad71-2a3cb92fc1c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec4183b670>]}
[0m11:42:37.483761 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.26s]
[0m11:42:37.485044 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:42:37.488275 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:37.489061 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:42:37.489765 [debug] [MainThread]: On list__gold: Close
[0m11:42:37.490781 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:42:37.492022 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:42:37.493875 [info ] [MainThread]: 
[0m11:42:37.495735 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m11:42:37.498011 [debug] [MainThread]: Command end result
[0m11:42:37.528860 [info ] [MainThread]: 
[0m11:42:37.531322 [info ] [MainThread]: Completed successfully
[0m11:42:37.533310 [info ] [MainThread]: 
[0m11:42:37.535154 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:37.537416 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:37.537107 after 1.62 seconds
[0m11:42:37.538780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec45ea7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec4439be50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ec4186df40>]}
[0m11:42:37.540469 [debug] [MainThread]: Flushing usage events
[0m11:42:44.260366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7304405de490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x730441042dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x730441053790>]}


============================== 11:42:44.276713 | c14d0c06-1627-40f8-b9ef-bc5969063ac5 ==============================
[0m11:42:44.276713 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:44.278460 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:44.361721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4c19dd460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4c2442fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4c2442df0>]}
[0m11:42:44.362072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431e6e7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431f124dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431f135790>]}


============================== 11:42:44.370389 | 8df6c5ae-4fbc-46c8-9d62-fab3e29aa387 ==============================
[0m11:42:44.370389 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:42:44.371073 | 41b49f16-a9e8-42b3-a4db-38a47b4e668f ==============================
[0m11:42:44.371073 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:44.371748 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:44.372262 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:44.467465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x730441042fd0>]}
[0m11:42:44.507021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043eae4ee0>]}
[0m11:42:44.508829 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:44.517371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4c2442e50>]}
[0m11:42:44.527030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431f124fd0>]}
[0m11:42:44.537757 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:44.574410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bfeedeb0>]}
[0m11:42:44.577644 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:44.586737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431cbe0ee0>]}
[0m11:42:44.589328 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:44.625111 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:44.643347 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:45.004574 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:45.006297 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:45.007764 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:45.018118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043e8ec8e0>]}
[0m11:42:45.044315 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:45.045689 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:45.047432 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:45.050778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043ea52be0>]}
[0m11:42:45.052170 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:45.053766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043ea52b80>]}
[0m11:42:45.056945 [info ] [MainThread]: 
[0m11:42:45.059421 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:45.061899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bfcec8b0>]}
[0m11:42:45.062708 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:45.087864 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:45.115901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bfe52bb0>]}
[0m11:42:45.118493 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:45.120063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bfe52b50>]}
[0m11:42:45.127252 [info ] [MainThread]: 
[0m11:42:45.129631 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:45.135412 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:45.154939 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:45.160255 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:45.161205 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:45.164450 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:45.174391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431c9ec8e0>]}
[0m11:42:45.208110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431cb52be0>]}
[0m11:42:45.209515 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:45.210872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431cb52b80>]}
[0m11:42:45.213726 [info ] [MainThread]: 
[0m11:42:45.215560 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:45.217872 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:45.235583 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:45.409927 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:45.415146 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.420169 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:42:45.421667 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:42:45.433815 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:45.437560 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:45.439803 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:45.445384 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.447667 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.455596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:42:45.463594 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:42:45.484267 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:45.486205 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:45.494840 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.514880 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:45.523381 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.529909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043ceb1d30>]}
[0m11:42:45.531542 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:45.532614 [info ] [MainThread]: 
[0m11:42:45.547985 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:45.552390 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.553062 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:45.557395 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:42:45.560498 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.564117 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:42:45.566220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bdd5f850>]}
[0m11:42:45.565803 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:42:45.567586 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:42:45.567621 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:45.568565 [info ] [MainThread]: 
[0m11:42:45.569176 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:42:45.559032 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:42:45.571772 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:45.577082 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:45.586720 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.587282 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:42:45.597587 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:42:45.599033 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:42:45.600906 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:42:45.602622 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:42:45.604116 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:42:45.570054 => 11:42:45.603523
[0m11:42:45.605702 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:42:45.619049 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:42:45.632816 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:42:45.603828 => 11:42:45.631879
[0m11:42:45.634251 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:42:45.639643 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:45.647553 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.651673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431aa608b0>]}
[0m11:42:45.653609 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:45.654911 [info ] [MainThread]: 
[0m11:42:45.680568 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:42:45.681893 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:42:45.683861 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:42:45.685349 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:42:45.696646 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:42:45.698331 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:42:45.714151 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:45.719106 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:42:45.686035 => 11:42:45.718487
[0m11:42:45.720545 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:42:45.722458 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:42:45.733731 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:45.736195 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.740674 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.747562 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:42:45.755715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:45.761724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:42:45.762092 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.770037 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:42:45.794974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:42:45.800180 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:42:45.813185 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:42:45.817890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:42:45.822292 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.825379 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:42:45.826928 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:42:45.829744 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.839266 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.855347 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:45.861456 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.861917 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:45.867798 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:42:45.868302 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.869882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:45.876893 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.882456 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:42:45.883642 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:42:45.886668 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.889109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:42:45.890091 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:42:45.606849 => 11:42:45.889822
[0m11:42:45.892184 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c14d0c06-1627-40f8-b9ef-bc5969063ac5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x730437f5f910>]}
[0m11:42:45.892492 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.894218 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.32s]
[0m11:42:45.895924 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:42:45.635402 => 11:42:45.895592
[0m11:42:45.895855 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.896917 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:42:45.897752 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8df6c5ae-4fbc-46c8-9d62-fab3e29aa387', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bd52d9d0>]}
[0m11:42:45.899221 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.30s]
[0m11:42:45.900821 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:42:45.901098 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:45.902110 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:42:45.903516 [debug] [MainThread]: On list__silver: Close
[0m11:42:45.904411 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:42:45.904948 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:45.905467 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:42:45.906177 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:42:45.906625 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:42:45.906454 [info ] [MainThread]: 
[0m11:42:45.907021 [debug] [MainThread]: On list__gold: Close
[0m11:42:45.907544 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m11:42:45.908021 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:42:45.910315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.910368 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:42:45.910781 [debug] [MainThread]: Command end result
[0m11:42:45.911577 [info ] [MainThread]: 
[0m11:42:45.912703 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.78 seconds (0.78s).
[0m11:42:45.914822 [debug] [MainThread]: Command end result
[0m11:42:45.939972 [info ] [MainThread]: 
[0m11:42:45.941422 [info ] [MainThread]: Completed successfully
[0m11:42:45.941622 [info ] [MainThread]: 
[0m11:42:45.943228 [info ] [MainThread]: 
[0m11:42:45.943331 [info ] [MainThread]: Completed successfully
[0m11:42:45.944824 [info ] [MainThread]: 
[0m11:42:45.944918 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:45.946193 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:45.947628 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:45.947453 after 1.70 seconds
[0m11:42:45.947423 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:45.947151 after 1.75 seconds
[0m11:42:45.948567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4c19dd460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bfeedeb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e4bd4dad30>]}
[0m11:42:45.948587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7304405de490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043eae4ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73043c116850>]}
[0m11:42:45.949640 [debug] [MainThread]: Flushing usage events
[0m11:42:45.949643 [debug] [MainThread]: Flushing usage events
[0m11:42:45.957620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:45.966333 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:45.978074 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:42:45.981389 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:45.984223 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:42:45.721534 => 11:42:45.983892
[0m11:42:45.985883 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41b49f16-a9e8-42b3-a4db-38a47b4e668f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431a079df0>]}
[0m11:42:45.987098 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.30s]
[0m11:42:45.988319 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:42:45.991672 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:45.993213 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:42:45.994146 [debug] [MainThread]: On list__gold: Close
[0m11:42:45.995160 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:42:45.996177 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:42:45.997091 [info ] [MainThread]: 
[0m11:42:45.998207 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.78 seconds (0.78s).
[0m11:42:45.999545 [debug] [MainThread]: Command end result
[0m11:42:46.031038 [info ] [MainThread]: 
[0m11:42:46.032347 [info ] [MainThread]: Completed successfully
[0m11:42:46.033767 [info ] [MainThread]: 
[0m11:42:46.035348 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:46.037269 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:46.036940 after 1.77 seconds
[0m11:42:46.045476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431e6e7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431cbe0ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71431a1c9bb0>]}
[0m11:42:46.047618 [debug] [MainThread]: Flushing usage events
[0m11:42:51.780851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df355b5d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df3565d0d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df3565d0e20>]}


============================== 11:42:51.787544 | 2813ce04-8747-4083-a826-c8ece1399929 ==============================
[0m11:42:51.787544 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:51.788623 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:51.893140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df3565d0df0>]}
[0m11:42:51.918080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df3540b0e50>]}
[0m11:42:51.919660 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:51.944033 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:52.360493 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:52.361535 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:52.363923 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:42:52.370652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df353eaa850>]}
[0m11:42:52.397607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df354009b50>]}
[0m11:42:52.398996 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:52.400216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df354009af0>]}
[0m11:42:52.403358 [info ] [MainThread]: 
[0m11:42:52.405275 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:52.407514 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:52.424604 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:52.621547 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:42:52.626819 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:52.630858 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:42:52.632334 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:42:52.641794 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:42:52.645323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:52.653142 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:52.701706 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:42:52.708910 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:52.713592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df353e74c40>]}
[0m11:42:52.715291 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:42:52.716612 [info ] [MainThread]: 
[0m11:42:52.737454 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:42:52.738645 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:42:52.740121 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:42:52.741342 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:42:52.751530 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:42:52.764774 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:42:52.742264 => 11:42:52.764293
[0m11:42:52.765836 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:42:52.843494 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:42:52.857378 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:52.870574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:52.876889 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:52.881833 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:42:52.895407 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:42:52.906770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:42:52.913520 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:42:52.916590 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:52.943764 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:42:52.948770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:52.959176 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:42:52.962440 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:42:52.964822 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:42:52.766730 => 11:42:52.964624
[0m11:42:52.965999 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2813ce04-8747-4083-a826-c8ece1399929', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df3514f9fa0>]}
[0m11:42:52.967019 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.23s]
[0m11:42:52.968174 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:42:52.975149 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:42:52.976216 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:42:52.977258 [debug] [MainThread]: On list__gold: Close
[0m11:42:52.978141 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:42:52.978914 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:42:52.980020 [info ] [MainThread]: 
[0m11:42:52.981102 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m11:42:52.982742 [debug] [MainThread]: Command end result
[0m11:42:53.012205 [info ] [MainThread]: 
[0m11:42:53.014102 [info ] [MainThread]: Completed successfully
[0m11:42:53.015335 [info ] [MainThread]: 
[0m11:42:53.016660 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:42:53.018003 [debug] [MainThread]: Command `dbt run` succeeded at 11:42:53.017852 after 1.27 seconds
[0m11:42:53.018794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df355b5d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df3540b0e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df353f0b880>]}
[0m11:42:53.019720 [debug] [MainThread]: Flushing usage events
[0m11:42:59.065626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c8b4af490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c8bef7dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c8bef7e50>]}


============================== 11:42:59.073840 | a62625e0-1b03-4ecb-80a4-de4771a252c5 ==============================
[0m11:42:59.073840 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:59.075346 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:59.156165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9f887400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ba026fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ba026ffd0>]}
[0m11:42:59.155990 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7838845ef460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783885055fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783885055df0>]}


============================== 11:42:59.164308 | 64e86102-ca93-4f01-8a6b-aff27d17f6da ==============================
[0m11:42:59.164308 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:42:59.164668 | ac1114de-cc6d-4ad9-ab47-8abf0ecfa728 ==============================
[0m11:42:59.164668 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:42:59.165726 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:59.165832 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:42:59.213516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c8bef7d60>]}
[0m11:42:59.252387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c899b0e80>]}
[0m11:42:59.254765 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:59.286477 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:59.312500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6ba026fdf0>]}
[0m11:42:59.313709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783885055e50>]}
[0m11:42:59.350225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9dddde50>]}
[0m11:42:59.351990 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:59.354464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783882b22eb0>]}
[0m11:42:59.356133 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:42:59.384447 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:59.393169 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:42:59.609913 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:59.611296 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:59.613093 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:42:59.625435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c897ac880>]}
[0m11:42:59.656782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c89907b80>]}
[0m11:42:59.658790 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:59.660291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c89907b20>]}
[0m11:42:59.663427 [info ] [MainThread]: 
[0m11:42:59.665622 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:59.668129 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:59.674759 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:59.675726 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:59.677607 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:42:59.686505 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:59.688607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78388292a8b0>]}
[0m11:42:59.717578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783882a92bb0>]}
[0m11:42:59.718915 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:59.720175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783882a92b50>]}
[0m11:42:59.723837 [info ] [MainThread]: 
[0m11:42:59.726066 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:59.728283 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:59.729238 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:42:59.730112 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:42:59.731761 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:42:59.743770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9dbec850>]}
[0m11:42:59.749470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:59.771391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9dd49b50>]}
[0m11:42:59.773055 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:42:59.774988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9dd49af0>]}
[0m11:42:59.777719 [info ] [MainThread]: 
[0m11:42:59.779424 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:42:59.781550 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:42:59.797812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:42:59.996347 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:00.004341 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.012880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:00.017322 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:00.045672 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:00.052430 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.054491 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:00.056358 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:00.061931 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:00.068350 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.076088 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:00.094562 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:00.100206 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:00.116642 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.145339 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:00.154639 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.156181 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:00.161656 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c89773bb0>]}
[0m11:43:00.162107 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.164109 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:00.165563 [info ] [MainThread]: 
[0m11:43:00.168536 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:00.176418 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:00.178973 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:00.189129 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.195048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7838828f1c40>]}
[0m11:43:00.197213 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:00.197449 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:00.198412 [info ] [MainThread]: 
[0m11:43:00.198961 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:00.200095 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:43:00.201813 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:43:00.204867 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:43:00.206771 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:43:00.211381 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.222383 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:43:00.229088 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:43:00.230759 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:43:00.233097 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:43:00.234984 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:43:00.239918 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:43:00.207869 => 11:43:00.239479
[0m11:43:00.241080 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:43:00.250146 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:43:00.266285 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:00.270012 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:43:00.235820 => 11:43:00.269267
[0m11:43:00.271815 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:43:00.275436 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.283695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9c1b3ca0>]}
[0m11:43:00.286180 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:00.288203 [info ] [MainThread]: 
[0m11:43:00.321496 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:43:00.323869 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:43:00.326212 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:43:00.327763 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:43:00.343552 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:43:00.355087 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:43:00.360663 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:43:00.328632 => 11:43:00.359959
[0m11:43:00.361868 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:43:00.371080 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.384952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:43:00.390248 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:00.397363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.400360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.405100 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:43:00.415973 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:00.420754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:43:00.424135 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.429721 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:43:00.436276 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.445328 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:43:00.445878 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:43:00.449125 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.452291 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:43:00.469634 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:00.478496 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:43:00.486202 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:43:00.486351 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:00.489948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.492497 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.495776 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:00.500338 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:43:00.502288 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.514726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:43:00.514940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:43:00.518074 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.523821 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:43:00.241932 => 11:43:00.523515
[0m11:43:00.525572 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a62625e0-1b03-4ecb-80a4-de4771a252c5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c881b8fd0>]}
[0m11:43:00.527035 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.32s]
[0m11:43:00.528369 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.528670 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:43:00.532167 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:00.532874 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:00.533907 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:43:00.534861 [debug] [MainThread]: On list__gold: Close
[0m11:43:00.536348 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:43:00.537525 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:43:00.538683 [info ] [MainThread]: 
[0m11:43:00.539118 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.539443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:43:00.540095 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m11:43:00.543550 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.544639 [debug] [MainThread]: Command end result
[0m11:43:00.550835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:43:00.554728 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.558012 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:43:00.273354 => 11:43:00.557634
[0m11:43:00.559496 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ac1114de-cc6d-4ad9-ab47-8abf0ecfa728', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x783880929970>]}
[0m11:43:00.560946 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.33s]
[0m11:43:00.562869 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:43:00.566980 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:00.567914 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:43:00.568719 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:43:00.569742 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:00.570739 [debug] [MainThread]: On list__silver: Close
[0m11:43:00.571990 [info ] [MainThread]: 
[0m11:43:00.573444 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m11:43:00.576006 [debug] [MainThread]: Command end result
[0m11:43:00.576172 [info ] [MainThread]: 
[0m11:43:00.577862 [info ] [MainThread]: Completed successfully
[0m11:43:00.579118 [info ] [MainThread]: 
[0m11:43:00.580158 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:00.582181 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:00.581925 after 1.55 seconds
[0m11:43:00.583635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c8b4af490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c8822e6a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f2c88223d30>]}
[0m11:43:00.585253 [debug] [MainThread]: Flushing usage events
[0m11:43:00.588376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:00.596606 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:00.615388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:43:00.619407 [info ] [MainThread]: 
[0m11:43:00.620122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:00.621093 [info ] [MainThread]: Completed successfully
[0m11:43:00.622210 [info ] [MainThread]: 
[0m11:43:00.624362 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:43:00.362575 => 11:43:00.623908
[0m11:43:00.623807 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:00.626166 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:00.625888 after 1.57 seconds
[0m11:43:00.626342 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '64e86102-ca93-4f01-8a6b-aff27d17f6da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9723af70>]}
[0m11:43:00.627337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7838845ef460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78388290ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78388093af40>]}
[0m11:43:00.628238 [debug] [MainThread]: Flushing usage events
[0m11:43:00.628006 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.30s]
[0m11:43:00.629640 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:43:00.634800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:00.635942 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:00.637456 [debug] [MainThread]: On list__silver: Close
[0m11:43:00.638822 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:43:00.639960 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:43:00.641438 [info ] [MainThread]: 
[0m11:43:00.642748 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:43:00.645274 [debug] [MainThread]: Command end result
[0m11:43:00.670928 [info ] [MainThread]: 
[0m11:43:00.672614 [info ] [MainThread]: Completed successfully
[0m11:43:00.674221 [info ] [MainThread]: 
[0m11:43:00.675655 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:00.676999 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:00.676833 after 1.62 seconds
[0m11:43:00.677849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9f887400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9dbced00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6b9c12a2b0>]}
[0m11:43:00.678713 [debug] [MainThread]: Flushing usage events
[0m11:43:06.187661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cdbb9e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cdc608d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cdc608e20>]}


============================== 11:43:06.194493 | e9c4b058-7182-499a-a892-3138c05601f4 ==============================
[0m11:43:06.194493 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:06.195562 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:06.299912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cdc608df0>]}
[0m11:43:06.327820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cda09ae50>]}
[0m11:43:06.329636 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:06.354416 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:06.777330 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:06.778437 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:06.780053 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:06.788382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cd9eab850>]}
[0m11:43:06.817821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cda009b50>]}
[0m11:43:06.819298 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:06.820744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cda009af0>]}
[0m11:43:06.824775 [info ] [MainThread]: 
[0m11:43:06.827310 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:06.830149 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:06.849579 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:07.060969 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:07.065325 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:07.069815 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:07.071051 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:07.081179 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:07.085603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:07.092488 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:07.133056 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:07.138782 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:07.142348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cd845eca0>]}
[0m11:43:07.144270 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:07.145038 [info ] [MainThread]: 
[0m11:43:07.161869 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:43:07.163429 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:43:07.165120 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:43:07.166042 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:43:07.176066 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:43:07.188146 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:43:07.166648 => 11:43:07.187771
[0m11:43:07.189057 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:43:07.247382 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:43:07.267611 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:07.287478 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:07.295343 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:07.303966 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:43:07.323752 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:43:07.335146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:07.342487 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:43:07.346336 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:07.376385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:07.382692 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:07.393156 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:43:07.396843 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:07.400543 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:43:07.189812 => 11:43:07.399111
[0m11:43:07.408302 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e9c4b058-7182-499a-a892-3138c05601f4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cd823bfa0>]}
[0m11:43:07.409640 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:43:07.411559 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:43:07.416194 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:07.417698 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:07.418998 [debug] [MainThread]: On list__silver: Close
[0m11:43:07.420003 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:43:07.420995 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:43:07.422409 [info ] [MainThread]: 
[0m11:43:07.424636 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m11:43:07.426418 [debug] [MainThread]: Command end result
[0m11:43:07.460750 [info ] [MainThread]: 
[0m11:43:07.462142 [info ] [MainThread]: Completed successfully
[0m11:43:07.463264 [info ] [MainThread]: 
[0m11:43:07.464938 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:07.467324 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:07.467043 after 1.31 seconds
[0m11:43:07.468980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cdbb9e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cd9e8ed00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734cd8405520>]}
[0m11:43:07.471131 [debug] [MainThread]: Flushing usage events
[0m11:43:12.826460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784736c1d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784737662fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784737662df0>]}


============================== 11:43:12.837677 | 43aa717e-98c7-43a6-9d0e-f314c2361a53 ==============================
[0m11:43:12.837677 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:12.839147 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:12.935489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdc77e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdd1cddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdd1cde50>]}
[0m11:43:12.936074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b3143e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b31e8bfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b31e8bdf0>]}


============================== 11:43:12.948460 | 6bb84507-957c-4f3d-a703-e251789c5142 ==============================
[0m11:43:12.948460 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:12.949797 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}


============================== 11:43:12.949680 | 3a22004c-1db3-430d-afb7-1cc96a20d1a5 ==============================
[0m11:43:12.949680 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:12.951510 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:13.009036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784737662e50>]}
[0m11:43:13.059211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784735124eb0>]}
[0m11:43:13.062768 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:13.099803 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:13.130358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b31e8be50>]}
[0m11:43:13.131778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdd1cdd60>]}
[0m11:43:13.177076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2f930eb0>]}
[0m11:43:13.179120 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:13.180137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdac64e80>]}
[0m11:43:13.181566 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:13.216751 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:13.217290 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:13.453033 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:13.454003 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:13.455995 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:13.467156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784734f2c8b0>]}
[0m11:43:13.496741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784735092bb0>]}
[0m11:43:13.498467 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:13.499820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784735092b50>]}
[0m11:43:13.501854 [info ] [MainThread]: 
[0m11:43:13.504184 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:13.506382 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:13.514130 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:13.515709 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:13.517183 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:13.526724 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:13.528772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdaa6b880>]}
[0m11:43:13.558795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdabdab80>]}
[0m11:43:13.560212 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:13.561553 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdabdab20>]}
[0m11:43:13.565023 [info ] [MainThread]: 
[0m11:43:13.566957 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:13.569135 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:13.572627 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:13.574101 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:13.577285 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:13.586416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:13.591896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2f72d8b0>]}
[0m11:43:13.621957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2f889bb0>]}
[0m11:43:13.623806 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:13.626867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2f889b50>]}
[0m11:43:13.628962 [info ] [MainThread]: 
[0m11:43:13.630353 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:13.632559 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:13.650295 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:13.818168 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:13.822387 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:13.829038 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:13.831010 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:13.849367 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:13.852719 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:13.863305 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:13.865417 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:13.869969 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:13.876224 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:13.878571 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:13.898084 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:13.901227 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:13.909482 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:13.914867 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:13.922562 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:13.928107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78472f4b4d00>]}
[0m11:43:13.930172 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:13.931575 [info ] [MainThread]: 
[0m11:43:13.953195 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:13.958732 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:13.958811 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:43:13.960054 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:43:13.961586 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:43:13.963235 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:43:13.963511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:13.967203 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:13.970741 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:13.974957 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:13.979816 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:43:13.980244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdaa32be0>]}
[0m11:43:13.981134 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:13.982556 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:13.982347 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:13.984206 [info ] [MainThread]: 
[0m11:43:13.993048 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.001873 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:43:13.964260 => 11:43:14.001388
[0m11:43:14.003324 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:43:14.012258 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:43:14.014123 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:43:14.016247 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:43:14.018117 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:43:14.032013 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:43:14.040529 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:14.047861 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:43:14.019294 => 11:43:14.047313
[0m11:43:14.049058 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:43:14.050176 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.054866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2dcf3d00>]}
[0m11:43:14.056914 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:14.058959 [info ] [MainThread]: 
[0m11:43:14.087226 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:43:14.088464 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:43:14.089967 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:43:14.091464 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:43:14.103224 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:43:14.107112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:43:14.119014 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:43:14.092209 => 11:43:14.118481
[0m11:43:14.120113 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:43:14.122859 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.137341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:14.144079 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.146646 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:43:14.149709 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:43:14.161606 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.164795 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:43:14.180177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:14.188889 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.196169 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:43:14.196237 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:43:14.205927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:43:14.209809 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.212075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:43:14.223391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:43:14.227394 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.236419 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:43:14.240381 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.240846 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:14.260273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:14.264714 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:14.267254 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.270830 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.273171 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:43:14.282919 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:14.285175 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:43:14.288973 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.290033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.291028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:43:14.293935 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:43:14.004620 => 11:43:14.293388
[0m11:43:14.296113 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43aa717e-98c7-43a6-9d0e-f314c2361a53', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78472e59c940>]}
[0m11:43:14.297623 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.33s]
[0m11:43:14.299599 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:43:14.303800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:14.304835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:43:14.305368 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:14.306527 [debug] [MainThread]: On list__silver: Close
[0m11:43:14.307973 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:43:14.308630 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:14.308816 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.309230 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:43:14.310372 [info ] [MainThread]: 
[0m11:43:14.312261 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:43:14.049894 => 11:43:14.311958
[0m11:43:14.311790 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.81 seconds (0.81s).
[0m11:43:14.313763 [debug] [MainThread]: Command end result
[0m11:43:14.314404 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6bb84507-957c-4f3d-a703-e251789c5142', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcd80f7e20>]}
[0m11:43:14.316213 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.30s]
[0m11:43:14.318124 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:43:14.318564 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:43:14.322008 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:14.322658 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.323580 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:43:14.324754 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:43:14.326171 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:14.327390 [debug] [MainThread]: On list__silver: Close
[0m11:43:14.328624 [info ] [MainThread]: 
[0m11:43:14.329750 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m11:43:14.331217 [debug] [MainThread]: Command end result
[0m11:43:14.346503 [info ] [MainThread]: 
[0m11:43:14.347903 [info ] [MainThread]: Completed successfully
[0m11:43:14.348911 [info ] [MainThread]: 
[0m11:43:14.349907 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:14.351378 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:14.351137 after 1.56 seconds
[0m11:43:14.352520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784736c1d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78472ef6ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x784734f0ed60>]}
[0m11:43:14.353684 [debug] [MainThread]: Flushing usage events
[0m11:43:14.377368 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:14.389326 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:14.407488 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:43:14.412324 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:14.419620 [info ] [MainThread]: 
[0m11:43:14.421422 [info ] [MainThread]: Completed successfully
[0m11:43:14.421235 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:43:14.120866 => 11:43:14.417050
[0m11:43:14.423141 [info ] [MainThread]: 
[0m11:43:14.425662 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a22004c-1db3-430d-afb7-1cc96a20d1a5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2cdbf6d0>]}
[0m11:43:14.426860 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:14.427506 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.34s]
[0m11:43:14.428980 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:14.428683 after 1.56 seconds
[0m11:43:14.429396 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:43:14.430262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdc77e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcd8248be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bcdaa4ed30>]}
[0m11:43:14.431839 [debug] [MainThread]: Flushing usage events
[0m11:43:14.435762 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:14.437126 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:14.438364 [debug] [MainThread]: On list__silver: Close
[0m11:43:14.439570 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:43:14.443172 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:43:14.445471 [info ] [MainThread]: 
[0m11:43:14.446871 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:43:14.448384 [debug] [MainThread]: Command end result
[0m11:43:14.475392 [info ] [MainThread]: 
[0m11:43:14.476649 [info ] [MainThread]: Completed successfully
[0m11:43:14.477583 [info ] [MainThread]: 
[0m11:43:14.478497 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:14.479760 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:14.479551 after 1.66 seconds
[0m11:43:14.480941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b3143e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2f70ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x760b2d785730>]}
[0m11:43:14.481961 [debug] [MainThread]: Flushing usage events
[0m11:43:19.704991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337dca7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337e714dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337e714e80>]}


============================== 11:43:19.711247 | a7a317fb-275c-44c3-ac79-50a2c4c86189 ==============================
[0m11:43:19.711247 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:19.712585 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:19.822391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337e714d60>]}
[0m11:43:19.845727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337c1dfe80>]}
[0m11:43:19.847008 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:19.869464 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:20.346447 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:20.347541 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:20.348937 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:20.356413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337bfec880>]}
[0m11:43:20.388386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337c152b80>]}
[0m11:43:20.390071 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:20.391641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337c152b20>]}
[0m11:43:20.395491 [info ] [MainThread]: 
[0m11:43:20.397516 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:20.400217 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:20.420097 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:20.627796 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:20.631293 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:20.634848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:20.635852 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:20.643012 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:20.645424 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:20.651651 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:20.697818 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:20.704568 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:20.708189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337a572cd0>]}
[0m11:43:20.709833 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:20.710977 [info ] [MainThread]: 
[0m11:43:20.729707 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:43:20.731458 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:43:20.733193 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:43:20.734275 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:43:20.744175 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:43:20.759014 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:43:20.735000 => 11:43:20.758478
[0m11:43:20.759990 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:43:20.816269 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:43:20.837673 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:20.848667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:20.855821 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:20.860706 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:43:20.881275 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:43:20.893294 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:20.899022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:43:20.902631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:20.927256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:20.932851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:20.942770 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:43:20.946226 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:20.949475 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:43:20.760644 => 11:43:20.949233
[0m11:43:20.951125 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7a317fb-275c-44c3-ac79-50a2c4c86189', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x713379639fd0>]}
[0m11:43:20.952549 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.22s]
[0m11:43:20.953927 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:43:20.956694 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:20.957648 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:20.958735 [debug] [MainThread]: On list__silver: Close
[0m11:43:20.959731 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:43:20.960580 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:43:20.961652 [info ] [MainThread]: 
[0m11:43:20.962984 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m11:43:20.964250 [debug] [MainThread]: Command end result
[0m11:43:20.995045 [info ] [MainThread]: 
[0m11:43:20.996392 [info ] [MainThread]: Completed successfully
[0m11:43:20.997412 [info ] [MainThread]: 
[0m11:43:20.998367 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:20.999520 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:20.999395 after 1.33 seconds
[0m11:43:21.000432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337dca7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337c1dfe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71337c152c40>]}
[0m11:43:21.001499 [debug] [MainThread]: Flushing usage events
[0m11:43:27.731675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d433c47490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d43469ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d43469de50>]}


============================== 11:43:27.751243 | bdbedc30-64e2-4594-ad62-0bdc2505418c ==============================
[0m11:43:27.751243 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:27.753511 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:27.917061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff31fee430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff32a21dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff32a21e50>]}


============================== 11:43:27.938536 | 738cd185-775b-423b-979b-784713c57f56 ==============================
[0m11:43:27.938536 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:27.941198 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:27.919785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734262a983a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73426349dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73426349dd60>]}


============================== 11:43:27.945618 | 894bb860-5dbc-4807-97a1-6015eeed9a60 ==============================
[0m11:43:27.945618 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:27.947759 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:28.026877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d43469dd60>]}
[0m11:43:28.106555 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d432160e80>]}
[0m11:43:28.108556 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:28.150034 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:28.200982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff32a21d60>]}
[0m11:43:28.207033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73426349dd30>]}
[0m11:43:28.265526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff304e0e80>]}
[0m11:43:28.267551 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:28.271573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734260fb1d60>]}
[0m11:43:28.275567 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:28.315178 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:28.324011 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:28.587177 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:28.588410 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:28.590978 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:28.617505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d431f6d880>]}
[0m11:43:28.671347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d4320c6b80>]}
[0m11:43:28.676564 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:28.679368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d4320c6b20>]}
[0m11:43:28.683560 [info ] [MainThread]: 
[0m11:43:28.685961 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:28.697293 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:28.720134 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:28.759806 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:28.760818 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:28.763155 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:28.776567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff302ed880>]}
[0m11:43:28.818197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff30449b80>]}
[0m11:43:28.819855 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:28.821358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff30449b20>]}
[0m11:43:28.825058 [info ] [MainThread]: 
[0m11:43:28.827515 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:28.830501 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:28.839333 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:28.840680 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:28.842865 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:28.854185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734260dac790>]}
[0m11:43:28.855407 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:28.891019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734260f09a60>]}
[0m11:43:28.893813 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:28.897664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734260f09a90>]}
[0m11:43:28.901908 [info ] [MainThread]: 
[0m11:43:28.904488 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:28.907598 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:28.934167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:29.084603 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:29.093734 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.100192 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:29.107831 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:29.121786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:29.123192 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:29.134576 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.192016 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:29.200437 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.207595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d430532cd0>]}
[0m11:43:29.209274 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:29.210646 [info ] [MainThread]: 
[0m11:43:29.216792 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:29.222073 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.228071 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:29.230478 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:29.239391 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:43:29.243786 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:43:29.245742 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:43:29.247057 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:43:29.248566 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:29.252343 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:29.261572 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.263213 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:43:29.279113 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:29.281599 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:43:29.247828 => 11:43:29.280551
[0m11:43:29.283075 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:43:29.284229 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.289047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:29.296451 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:29.301941 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:29.306833 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:29.317181 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.325141 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:29.333385 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.341112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff2e8b3cd0>]}
[0m11:43:29.343231 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:29.344927 [info ] [MainThread]: 
[0m11:43:29.369350 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:43:29.370655 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:43:29.372563 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:43:29.374208 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:43:29.376444 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:29.384951 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.388482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:43:29.389576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73425b320fd0>]}
[0m11:43:29.389654 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:43:29.392127 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:29.393579 [info ] [MainThread]: 
[0m11:43:29.409090 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:43:29.375112 => 11:43:29.408554
[0m11:43:29.410108 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:43:29.410506 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:29.421171 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:43:29.422749 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:43:29.424408 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:43:29.425516 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:43:29.427342 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:29.434227 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.439718 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:43:29.445276 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:43:29.453209 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:43:29.459056 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:43:29.426235 => 11:43:29.457969
[0m11:43:29.460221 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:43:29.469168 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.477282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:43:29.480906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.507296 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:43:29.523217 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.525585 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:29.531185 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.541445 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:29.547452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.548955 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:43:29.552097 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.553815 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:43:29.555848 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:43:29.284196 => 11:43:29.555454
[0m11:43:29.557707 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bdbedc30-64e2-4594-ad62-0bdc2505418c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d4302fbfd0>]}
[0m11:43:29.558014 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:43:29.558954 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.31s]
[0m11:43:29.560451 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:43:29.564903 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:29.566014 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:29.566933 [debug] [MainThread]: On list__silver: Close
[0m11:43:29.568204 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:43:29.569073 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:43:29.569206 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:43:29.570283 [info ] [MainThread]: 
[0m11:43:29.571670 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m11:43:29.574227 [debug] [MainThread]: Command end result
[0m11:43:29.579335 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:29.582750 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.593906 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:43:29.596238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:29.597585 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.602207 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.604127 [info ] [MainThread]: 
[0m11:43:29.605899 [info ] [MainThread]: Completed successfully
[0m11:43:29.607133 [info ] [MainThread]: 
[0m11:43:29.608251 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:29.610011 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:29.609683 after 1.99 seconds
[0m11:43:29.610999 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:43:29.611323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d433c47490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d432160e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74d4304a4910>]}
[0m11:43:29.612617 [debug] [MainThread]: Flushing usage events
[0m11:43:29.629882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:43:29.658384 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:29.665795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:29.665980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:43:29.674489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:43:29.677909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.680072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:43:29.684225 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.687030 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:43:29.410882 => 11:43:29.686777
[0m11:43:29.688590 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '738cd185-775b-423b-979b-784713c57f56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff2d97bd90>]}
[0m11:43:29.690117 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.32s]
[0m11:43:29.691856 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:43:29.696182 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:29.697465 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:29.698482 [debug] [MainThread]: On list__silver: Close
[0m11:43:29.699352 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:43:29.700117 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:43:29.701468 [info ] [MainThread]: 
[0m11:43:29.702958 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m11:43:29.704723 [debug] [MainThread]: Command end result
[0m11:43:29.715617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:29.721863 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.733488 [info ] [MainThread]: 
[0m11:43:29.735028 [info ] [MainThread]: Completed successfully
[0m11:43:29.735433 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:43:29.735959 [info ] [MainThread]: 
[0m11:43:29.737286 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:29.739197 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:29.738917 after 1.98 seconds
[0m11:43:29.739928 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:29.740334 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff31fee430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff302cfd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ff2db160d0>]}
[0m11:43:29.741801 [debug] [MainThread]: Flushing usage events
[0m11:43:29.744607 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:43:29.461312 => 11:43:29.744158
[0m11:43:29.746177 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '894bb860-5dbc-4807-97a1-6015eeed9a60', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73425a3fd610>]}
[0m11:43:29.747792 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.32s]
[0m11:43:29.751482 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:43:29.756008 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:29.757192 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:43:29.759028 [debug] [MainThread]: On list__gold: Close
[0m11:43:29.760572 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:43:29.761828 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:43:29.763462 [info ] [MainThread]: 
[0m11:43:29.765266 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:43:29.766870 [debug] [MainThread]: Command end result
[0m11:43:29.799606 [info ] [MainThread]: 
[0m11:43:29.801650 [info ] [MainThread]: Completed successfully
[0m11:43:29.803174 [info ] [MainThread]: 
[0m11:43:29.804573 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:29.806960 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:29.806669 after 2.07 seconds
[0m11:43:29.808383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734262a983a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73425adc84c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x734260d67190>]}
[0m11:43:29.809785 [debug] [MainThread]: Flushing usage events
[0m11:43:35.699784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09d52f400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09df83d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09df83e20>]}


============================== 11:43:35.710637 | b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2 ==============================
[0m11:43:35.710637 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:35.712574 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:35.835048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09df83df0>]}
[0m11:43:35.877335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09ba1be50>]}
[0m11:43:35.879312 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:35.905070 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:36.370908 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:36.372505 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:36.378453 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:36.391838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09b82c850>]}
[0m11:43:36.435411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09b992b50>]}
[0m11:43:36.437469 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:36.438982 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09b992af0>]}
[0m11:43:36.442905 [info ] [MainThread]: 
[0m11:43:36.445436 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:36.448474 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:36.469055 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:36.671843 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:36.676660 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:36.680714 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:36.687611 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:36.691695 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:36.694860 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:36.703135 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:36.755781 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:36.765690 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:36.770209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09989f7f0>]}
[0m11:43:36.771699 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:36.772915 [info ] [MainThread]: 
[0m11:43:36.795772 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:43:36.798713 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:43:36.808696 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:43:36.810253 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:43:36.827498 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:43:36.841505 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:43:36.811494 => 11:43:36.840837
[0m11:43:36.842966 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:43:36.917861 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:43:36.936104 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:36.946577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:36.952266 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:36.958782 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:43:36.973634 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:43:36.985452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:36.993346 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:43:36.996540 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:37.028149 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:37.033071 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:37.041282 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:43:37.045138 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:37.047311 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:43:36.844145 => 11:43:37.047129
[0m11:43:37.048234 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6ab1876-4ecb-4ebf-af6a-cf99e932d9e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea098eba670>]}
[0m11:43:37.049101 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:43:37.050035 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:43:37.052948 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:37.054436 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:43:37.055659 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:43:37.056845 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:37.058984 [debug] [MainThread]: On list__silver: Close
[0m11:43:37.060195 [info ] [MainThread]: 
[0m11:43:37.061313 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m11:43:37.062665 [debug] [MainThread]: Command end result
[0m11:43:37.086705 [info ] [MainThread]: 
[0m11:43:37.087728 [info ] [MainThread]: Completed successfully
[0m11:43:37.088704 [info ] [MainThread]: 
[0m11:43:37.089863 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:37.091575 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:37.091324 after 1.43 seconds
[0m11:43:37.092651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09d52f400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea09b80ed00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ea099052e80>]}
[0m11:43:37.094186 [debug] [MainThread]: Flushing usage events
[0m11:43:42.446780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d781d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d81b6fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d81b6df0>]}


============================== 11:43:42.455248 | 3bcd6b52-5100-4fec-8ff8-4dc34d2177fb ==============================
[0m11:43:42.455248 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:42.456643 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:42.605780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d81b6e50>]}
[0m11:43:42.634794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d5d25eb0>]}
[0m11:43:42.636334 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:42.655798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa67785d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa6781f1fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa6781f1df0>]}


============================== 11:43:42.668702 | cfc4a0b0-71eb-42fb-a322-f5674b356d49 ==============================
[0m11:43:42.668702 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:42.670166 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:42.673593 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:42.744960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feed76f3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feee1d1d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feee1d1dc0>]}


============================== 11:43:42.755123 | d6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c ==============================
[0m11:43:42.755123 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:42.756486 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:42.818680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa6781f1e50>]}
[0m11:43:42.866253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa675d62eb0>]}
[0m11:43:42.867995 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:42.899033 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:42.913701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feee1d1d90>]}
[0m11:43:42.955916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feebcafdc0>]}
[0m11:43:42.957798 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:42.990977 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:43.099824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:43.101180 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:43.103360 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:43.115181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d5b2c8b0>]}
[0m11:43:43.145839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d5c92bb0>]}
[0m11:43:43.147117 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:43.148114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d5c92b50>]}
[0m11:43:43.150553 [info ] [MainThread]: 
[0m11:43:43.153265 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:43.156496 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:43.175145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:43.229144 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:43.230298 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:43.231841 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:43.244348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa675b6c8b0>]}
[0m11:43:43.276561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa675cd2bb0>]}
[0m11:43:43.278308 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:43.279636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa675cd2b50>]}
[0m11:43:43.283329 [info ] [MainThread]: 
[0m11:43:43.286066 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:43.289308 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:43.312276 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:43.370511 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:43.371592 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:43.374392 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:43.385040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feebaac7f0>]}
[0m11:43:43.417632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feebc12af0>]}
[0m11:43:43.419104 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:43.420548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feebc12a90>]}
[0m11:43:43.425720 [info ] [MainThread]: 
[0m11:43:43.429240 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:43.431875 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:43.453691 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:43.461551 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:43.466170 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:43.470035 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:43.476586 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:43.481724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:43.485531 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:43.494284 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.549962 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:43.559758 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.564557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d40f3d00>]}
[0m11:43:43.566482 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:43.567597 [info ] [MainThread]: 
[0m11:43:43.593159 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:43:43.594742 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:43:43.596336 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:43:43.597644 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:43:43.598868 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:43.603531 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:43.608644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:43.610503 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:43:43.610515 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:43.623876 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:43:43.598421 => 11:43:43.623270
[0m11:43:43.625397 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:43:43.620464 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:43.626247 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:43.634973 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.686325 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:43.694326 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.700505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa674132d00>]}
[0m11:43:43.702130 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:43.703341 [info ] [MainThread]: 
[0m11:43:43.726880 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:43:43.733427 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:43:43.735128 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:43:43.736666 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:43:43.738937 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:43:43.744218 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:43.745582 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:43.749746 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:43.751993 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:43:43.755671 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:43.763144 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:43.763119 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:43.769175 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:43:43.740121 => 11:43:43.768653
[0m11:43:43.770294 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:43:43.770463 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.776241 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:43:43.777261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:43.779765 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:43.793327 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.794913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:43:43.842819 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:43:43.859409 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:43:43.865578 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:43.869820 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:43.883816 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.891406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee9adf790>]}
[0m11:43:43.895355 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:43.896873 [info ] [MainThread]: 
[0m11:43:43.913971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:43:43.930356 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:43.930993 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:43.932387 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:43:43.934409 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:43:43.936946 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:43:43.938317 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:43:43.938179 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.971892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:43:43.984175 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:43.984579 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:43:43.987664 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:43.991754 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:43:43.626634 => 11:43:43.991272
[0m11:43:43.996390 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3bcd6b52-5100-4fec-8ff8-4dc34d2177fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862cf188730>]}
[0m11:43:43.997574 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:44.000016 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.40s]
[0m11:43:44.004109 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:43:44.007194 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:43:44.010272 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:44.013154 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:44.014838 [debug] [MainThread]: On list__silver: Close
[0m11:43:44.016691 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:43:44.019057 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:43:44.020955 [info ] [MainThread]: 
[0m11:43:44.025496 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m11:43:44.029481 [debug] [MainThread]: Command end result
[0m11:43:44.029741 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:43:43.939352 => 11:43:44.029114
[0m11:43:44.031131 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:43:44.039910 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:43:44.056544 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:44.073658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:43:44.079974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:44.087808 [info ] [MainThread]: 
[0m11:43:44.093152 [info ] [MainThread]: Completed successfully
[0m11:43:44.096379 [info ] [MainThread]: 
[0m11:43:44.101183 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:44.104364 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:44.103934 after 1.69 seconds
[0m11:43:44.107338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d781d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d5b0ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7862d40afb20>]}
[0m11:43:44.120355 [debug] [MainThread]: Flushing usage events
[0m11:43:44.172126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:44.186944 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:44.209688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:43:44.214430 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:43:44.215264 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:44.221260 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:43:43.771060 => 11:43:44.220739
[0m11:43:44.227821 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfc4a0b0-71eb-42fb-a322-f5674b356d49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa66f1bdfd0>]}
[0m11:43:44.229937 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.49s]
[0m11:43:44.233008 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:43:44.239459 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:44.241319 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:44.241676 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:44.247582 [debug] [MainThread]: On list__silver: Close
[0m11:43:44.248841 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:43:44.250089 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:43:44.251565 [info ] [MainThread]: 
[0m11:43:44.254555 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m11:43:44.258773 [debug] [MainThread]: Command end result
[0m11:43:44.272641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:44.283712 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:44.302969 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:43:44.324265 [info ] [MainThread]: 
[0m11:43:44.328858 [info ] [MainThread]: Completed successfully
[0m11:43:44.335895 [info ] [MainThread]: 
[0m11:43:44.343722 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:44.349036 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:44.348192 after 1.81 seconds
[0m11:43:44.351002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa67785d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa67404bc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa66f1a4c40>]}
[0m11:43:44.353732 [debug] [MainThread]: Flushing usage events
[0m11:43:44.365564 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:43:44.386100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:44.398675 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:43:44.404968 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:44.450521 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:44.457027 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:44.467434 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:43:44.471018 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:44.474432 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:43:44.032776 => 11:43:44.474115
[0m11:43:44.476235 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd6b21cfa-8ce0-4b0f-9a3d-85d7d64b577c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee9278cd0>]}
[0m11:43:44.477449 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.54s]
[0m11:43:44.478685 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:43:44.481989 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:44.483283 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:43:44.484415 [debug] [MainThread]: On list__gold: Close
[0m11:43:44.485681 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:43:44.486668 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:43:44.487609 [info ] [MainThread]: 
[0m11:43:44.488591 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.06 seconds (1.06s).
[0m11:43:44.490225 [debug] [MainThread]: Command end result
[0m11:43:44.514343 [info ] [MainThread]: 
[0m11:43:44.516361 [info ] [MainThread]: Completed successfully
[0m11:43:44.517998 [info ] [MainThread]: 
[0m11:43:44.519059 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:44.520639 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:44.520415 after 1.99 seconds
[0m11:43:44.521631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feed76f3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78fee910bac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78feeba8eca0>]}
[0m11:43:44.522963 [debug] [MainThread]: Flushing usage events
[0m11:43:49.067040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb4036e490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb40deddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb40dfe790>]}


============================== 11:43:49.074019 | 74657052-05e3-4699-9496-61998a411c35 ==============================
[0m11:43:49.074019 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:49.076272 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:49.180819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb40dede20>]}
[0m11:43:49.206585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3e8a4ee0>]}
[0m11:43:49.207994 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:49.234840 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:49.687183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:49.687977 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:49.689499 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:43:49.699077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3e6ac8e0>]}
[0m11:43:49.724767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3e812be0>]}
[0m11:43:49.726118 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:49.727186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3e812b80>]}
[0m11:43:49.730045 [info ] [MainThread]: 
[0m11:43:49.732355 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:49.735306 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:49.752869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:49.939898 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:49.944452 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:49.948449 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:49.950389 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:49.959260 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:49.962933 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:49.969807 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:50.021715 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:50.028295 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:50.032604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3cc70d30>]}
[0m11:43:50.034378 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:50.035564 [info ] [MainThread]: 
[0m11:43:50.057398 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:43:50.058660 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:43:50.059982 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:43:50.061118 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:43:50.070690 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:43:50.091753 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:43:50.061806 => 11:43:50.091033
[0m11:43:50.092939 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:43:50.173807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:43:50.195363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:50.211438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:50.217304 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:50.223678 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:43:50.239291 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:43:50.250582 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:50.257921 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:43:50.261337 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:50.285743 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:50.291912 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:50.302608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:43:50.305983 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:50.308208 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:43:50.094166 => 11:43:50.308012
[0m11:43:50.309540 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '74657052-05e3-4699-9496-61998a411c35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3c53bfd0>]}
[0m11:43:50.310913 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.25s]
[0m11:43:50.312028 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:43:50.314927 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:50.315688 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:50.316410 [debug] [MainThread]: On list__silver: Close
[0m11:43:50.317194 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:43:50.317854 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:43:50.319234 [info ] [MainThread]: 
[0m11:43:50.320414 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.59 seconds (0.59s).
[0m11:43:50.322195 [debug] [MainThread]: Command end result
[0m11:43:50.348198 [info ] [MainThread]: 
[0m11:43:50.349615 [info ] [MainThread]: Completed successfully
[0m11:43:50.351024 [info ] [MainThread]: 
[0m11:43:50.352513 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:50.354230 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:50.353995 after 1.33 seconds
[0m11:43:50.355149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb4036e490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3e8a4ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74eb3c6c6040>]}
[0m11:43:50.356040 [debug] [MainThread]: Flushing usage events
[0m11:43:56.087348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f18235d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f182d04af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f182d04e50>]}
[0m11:43:56.087539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b6567430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b6fe8dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b6fe8e50>]}


============================== 11:43:56.099716 | fc82f3eb-0281-4c4f-9a8d-78c272a3c230 ==============================
[0m11:43:56.099716 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:43:56.099777 | e3c0df54-a2b6-437c-9f85-a3b759d3ba04 ==============================
[0m11:43:56.099777 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:56.101102 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:56.101668 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:56.152889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2afb52f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2afbeeedc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2afbf01790>]}


============================== 11:43:56.160572 | dbdd98f2-f2e1-41c4-9ecc-91b2392036f6 ==============================
[0m11:43:56.160572 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:43:56.162539 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:43:56.227620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f182d04e80>]}
[0m11:43:56.236759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b6fe8d60>]}
[0m11:43:56.265480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f180860eb0>]}
[0m11:43:56.267306 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:56.278732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b4aa8e80>]}
[0m11:43:56.280334 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:56.297426 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:56.298551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2afbeeefd0>]}
[0m11:43:56.322454 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:56.338407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af9a70ee0>]}
[0m11:43:56.340645 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:43:56.370169 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:43:56.599097 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:56.600310 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:56.602483 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:56.612068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f18066d8b0>]}
[0m11:43:56.631148 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:56.632355 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:56.634333 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:43:56.634409 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:56.635148 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:43:56.636920 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:43:56.641623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f1807c6bb0>]}
[0m11:43:56.645157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af986c8e0>]}
[0m11:43:56.645362 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:56.646226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f1807c6b50>]}
[0m11:43:56.647192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b48ad880>]}
[0m11:43:56.648827 [info ] [MainThread]: 
[0m11:43:56.651300 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:56.655134 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:56.673228 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:56.681861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af99d2be0>]}
[0m11:43:56.683696 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:56.684058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b4a09b80>]}
[0m11:43:56.684750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af99d2b80>]}
[0m11:43:56.685327 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:43:56.686583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b4a09b20>]}
[0m11:43:56.688598 [info ] [MainThread]: 
[0m11:43:56.690303 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:56.690253 [info ] [MainThread]: 
[0m11:43:56.692183 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:43:56.693179 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:56.694923 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:43:56.711726 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:56.714741 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:56.945776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:56.950078 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:56.959841 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:43:56.967583 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:43:56.981401 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:56.982129 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:56.985135 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:56.986699 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:56.993247 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:56.994116 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.000736 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:57.005041 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:43:57.008232 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:57.013018 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.012677 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:57.018878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:43:57.022213 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.021536 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:43:57.034256 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:57.037912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:43:57.046986 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.048588 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:43:57.058567 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.064443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f17ec33d00>]}
[0m11:43:57.066118 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:57.067284 [info ] [MainThread]: 
[0m11:43:57.085350 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:57.095342 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.099897 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:43:57.102341 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:43:57.103076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af82e28b0>]}
[0m11:43:57.104693 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:43:57.105335 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:57.106332 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:43:57.106780 [info ] [MainThread]: 
[0m11:43:57.111546 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:43:57.120598 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.123155 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:43:57.126773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b48799a0>]}
[0m11:43:57.130428 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:43:57.132494 [info ] [MainThread]: 
[0m11:43:57.135937 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:43:57.137439 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:43:57.139366 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:43:57.141184 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:43:57.144622 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:43:57.107183 => 11:43:57.143985
[0m11:43:57.145762 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:43:57.159030 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:43:57.167889 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:43:57.170555 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:43:57.173885 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:43:57.176729 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:43:57.186691 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:43:57.142666 => 11:43:57.185996
[0m11:43:57.188126 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:43:57.195410 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:43:57.211298 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:43:57.177843 => 11:43:57.210612
[0m11:43:57.212915 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:43:57.249255 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:43:57.267963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:57.279691 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:43:57.282787 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:57.289370 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.295017 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.298713 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:43:57.303872 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:43:57.310609 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:57.314425 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:43:57.317804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.323425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:57.327696 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:43:57.347242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:43:57.348402 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:57.349319 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:43:57.355939 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.362257 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:43:57.364810 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:43:57.366549 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:43:57.367139 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.380287 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:43:57.381276 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:43:57.384939 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.396223 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.409741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:43:57.414702 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.423927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:57.432829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.445701 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:57.456548 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.460738 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:43:57.466070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.470291 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:43:57.146530 => 11:43:57.469704
[0m11:43:57.472773 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3c0df54-a2b6-437c-9f85-a3b759d3ba04', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f17dcf7e80>]}
[0m11:43:57.474557 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.37s]
[0m11:43:57.475890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:43:57.476382 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:43:57.480459 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.481430 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:57.482663 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:43:57.482885 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:43:57.483900 [debug] [MainThread]: On list__silver: Close
[0m11:43:57.484878 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:43:57.484940 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:43:57.189496 => 11:43:57.484486
[0m11:43:57.486269 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:43:57.488183 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dbdd98f2-f2e1-41c4-9ecc-91b2392036f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af8100700>]}
[0m11:43:57.489859 [info ] [MainThread]: 
[0m11:43:57.491145 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:43:57.491090 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.35s]
[0m11:43:57.491833 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m11:43:57.493511 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:43:57.494187 [debug] [MainThread]: Command end result
[0m11:43:57.498208 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:57.499703 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:43:57.501434 [debug] [MainThread]: On list__gold: Close
[0m11:43:57.503575 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:43:57.504867 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:43:57.506202 [info ] [MainThread]: 
[0m11:43:57.507809 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:43:57.510562 [debug] [MainThread]: Command end result
[0m11:43:57.510895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:43:57.515706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:43:57.519315 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:43:57.213813 => 11:43:57.518758
[0m11:43:57.523509 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc82f3eb-0281-4c4f-9a8d-78c272a3c230', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b1f39f70>]}
[0m11:43:57.526128 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.35s]
[0m11:43:57.528251 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:43:57.531779 [info ] [MainThread]: 
[0m11:43:57.534391 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:43:57.537561 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:43:57.538028 [info ] [MainThread]: Completed successfully
[0m11:43:57.539241 [debug] [MainThread]: On list__gold: Close
[0m11:43:57.539911 [info ] [MainThread]: 
[0m11:43:57.541407 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:43:57.541575 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:57.542832 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:43:57.543875 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:57.543646 after 1.48 seconds
[0m11:43:57.544315 [info ] [MainThread]: 
[0m11:43:57.544934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f18235d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f180860eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74f17de3ab20>]}
[0m11:43:57.545988 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m11:43:57.546313 [debug] [MainThread]: Flushing usage events
[0m11:43:57.548213 [debug] [MainThread]: Command end result
[0m11:43:57.575447 [info ] [MainThread]: 
[0m11:43:57.577744 [info ] [MainThread]: Completed successfully
[0m11:43:57.579714 [info ] [MainThread]: 
[0m11:43:57.583943 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:57.586654 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:57.586255 after 1.48 seconds
[0m11:43:57.588187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2afb52f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af8240490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a2af984ed90>]}
[0m11:43:57.589516 [debug] [MainThread]: Flushing usage events
[0m11:43:57.619867 [info ] [MainThread]: 
[0m11:43:57.622170 [info ] [MainThread]: Completed successfully
[0m11:43:57.623434 [info ] [MainThread]: 
[0m11:43:57.624443 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:43:57.625883 [debug] [MainThread]: Command `dbt run` succeeded at 11:43:57.625716 after 1.57 seconds
[0m11:43:57.627206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b6567430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b207bca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d1b488fd30>]}
[0m11:43:57.628594 [debug] [MainThread]: Flushing usage events
[0m11:44:02.814435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a69ca430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a7434dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a7434e80>]}


============================== 11:44:02.820448 | d2c6c3f0-4912-4226-9b0b-01b7ba384ea2 ==============================
[0m11:44:02.820448 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:02.822083 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:02.914776 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a7434d60>]}
[0m11:44:02.940347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4edbe80>]}
[0m11:44:02.942232 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:02.968124 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:03.416903 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:03.418089 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:03.420462 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:03.428592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4cec880>]}
[0m11:44:03.456431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4e49b80>]}
[0m11:44:03.458010 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:03.459186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4e49b20>]}
[0m11:44:03.461898 [info ] [MainThread]: 
[0m11:44:03.463523 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:03.465439 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:03.478785 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:03.669535 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:03.674529 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:03.678584 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:44:03.679915 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:44:03.689698 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:03.692527 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:03.701529 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:03.757074 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:03.763753 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:03.767618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4cb5b80>]}
[0m11:44:03.769930 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:03.771575 [info ] [MainThread]: 
[0m11:44:03.792680 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:44:03.794185 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:44:03.795542 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:44:03.796747 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:44:03.806990 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:44:03.823582 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:44:03.797531 => 11:44:03.823006
[0m11:44:03.824686 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:44:03.885939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:44:03.899903 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:03.910257 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:03.915507 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:03.919850 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:44:03.932951 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:44:03.944731 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:03.950326 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:44:03.955010 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:03.983534 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:03.989729 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:03.999005 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:44:04.003778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:04.006643 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:44:03.825491 => 11:44:04.006345
[0m11:44:04.007951 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd2c6c3f0-4912-4226-9b0b-01b7ba384ea2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a237bf70>]}
[0m11:44:04.008888 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.21s]
[0m11:44:04.010400 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:44:04.013919 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:04.014918 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:44:04.015655 [debug] [MainThread]: On list__gold: Close
[0m11:44:04.016791 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:44:04.017606 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:44:04.018593 [info ] [MainThread]: 
[0m11:44:04.019581 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m11:44:04.021329 [debug] [MainThread]: Command end result
[0m11:44:04.047610 [info ] [MainThread]: 
[0m11:44:04.049175 [info ] [MainThread]: Completed successfully
[0m11:44:04.050253 [info ] [MainThread]: 
[0m11:44:04.051426 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:04.053117 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:04.052784 after 1.27 seconds
[0m11:44:04.054125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a69ca430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4edbe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b12a4cd5b50>]}
[0m11:44:04.054947 [debug] [MainThread]: Flushing usage events
[0m11:44:10.104129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62ea65e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62eb0a3d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62eb0a3dc0>]}


============================== 11:44:10.113370 | 8a213421-680e-414e-8e1d-ac1da528c54c ==============================
[0m11:44:10.113370 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:10.114651 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:10.244388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942f847430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d943029fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d943029fe50>]}
[0m11:44:10.244194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e852af370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e85d12d00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e85d12d90>]}


============================== 11:44:10.252380 | a64235e8-668c-4f27-8bf5-1ef6923bba92 ==============================
[0m11:44:10.252380 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:44:10.252539 | 48bdcfe2-23f5-4f27-b6c6-6c07ad14216d ==============================
[0m11:44:10.252539 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:10.254034 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:10.254752 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:10.256636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62eb0a3d90>]}
[0m11:44:10.298546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e8b70dc0>]}
[0m11:44:10.300696 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:10.326832 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:10.398093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d943029fd60>]}
[0m11:44:10.404484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e85d12d60>]}
[0m11:44:10.433081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942dd5be80>]}
[0m11:44:10.434625 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:10.441862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e837e7d90>]}
[0m11:44:10.443711 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:10.464404 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:10.473822 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:10.684023 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:10.684906 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:10.686623 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:10.696499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e896c7f0>]}
[0m11:44:10.714031 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:10.715242 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:10.717356 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:10.721807 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:10.722758 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:10.724587 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:10.728067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e8ad2af0>]}
[0m11:44:10.728066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e835ec7c0>]}
[0m11:44:10.729880 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:10.731325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e8ad2a90>]}
[0m11:44:10.734445 [info ] [MainThread]: 
[0m11:44:10.737189 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:10.738691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942db6c880>]}
[0m11:44:10.739874 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:10.761869 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:10.769371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e83752a90>]}
[0m11:44:10.771171 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:10.773101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e83752ac0>]}
[0m11:44:10.776711 [info ] [MainThread]: 
[0m11:44:10.779447 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:10.782394 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:10.803986 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:10.829411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942dcd2b80>]}
[0m11:44:10.830679 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:10.832035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942dcd2b20>]}
[0m11:44:10.835217 [info ] [MainThread]: 
[0m11:44:10.837630 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:10.840453 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:10.854470 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:11.039464 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:11.044982 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.050630 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:11.058328 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:11.073155 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:11.075995 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:11.084129 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.085628 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:11.093180 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.098504 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:11.099860 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:11.117738 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:11.122799 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:11.129696 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.140620 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:11.145296 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:11.146158 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.152743 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.156366 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:11.157816 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e6f33c40>]}
[0m11:44:11.159391 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:11.160817 [info ] [MainThread]: 
[0m11:44:11.158113 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:11.168640 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:11.173896 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:11.183610 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.185770 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:11.186256 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:44:11.187489 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:44:11.189226 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:44:11.190579 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:44:11.193734 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.198602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e81b5ec10>]}
[0m11:44:11.200207 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:11.201495 [info ] [MainThread]: 
[0m11:44:11.207476 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:44:11.223603 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:44:11.191647 => 11:44:11.222746
[0m11:44:11.224952 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:44:11.232016 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:44:11.233740 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:44:11.235535 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:44:11.237015 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:44:11.241103 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:11.249184 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.254635 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:44:11.254815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942c133cd0>]}
[0m11:44:11.257533 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:11.258820 [info ] [MainThread]: 
[0m11:44:11.272733 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:44:11.238083 => 11:44:11.271662
[0m11:44:11.276440 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:44:11.294207 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:44:11.296186 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:44:11.298606 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:44:11.300336 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:44:11.319251 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:44:11.334146 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:44:11.305190 => 11:44:11.333547
[0m11:44:11.335692 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:44:11.339170 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:44:11.352665 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.365527 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:11.372723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.377056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:44:11.378309 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:44:11.393675 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:44:11.395260 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:11.405691 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.412864 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:11.413317 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:44:11.417539 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.419846 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.425975 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:44:11.430741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:44:11.441365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:44:11.445950 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.460517 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:11.467129 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.467150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:11.468586 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:44:11.473841 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:11.477765 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:44:11.480513 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:44:11.480782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:44:11.481436 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.484666 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.487954 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:44:11.225788 => 11:44:11.487678
[0m11:44:11.489823 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8a213421-680e-414e-8e1d-ac1da528c54c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e5ff7df0>]}
[0m11:44:11.491638 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.30s]
[0m11:44:11.493808 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:44:11.497835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:44:11.498461 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:11.499515 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:11.500564 [debug] [MainThread]: On list__silver: Close
[0m11:44:11.501541 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:44:11.502544 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:44:11.503780 [info ] [MainThread]: 
[0m11:44:11.504885 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.77 seconds (0.77s).
[0m11:44:11.507006 [debug] [MainThread]: Command end result
[0m11:44:11.514923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:11.523760 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:44:11.524291 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:11.527891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.530359 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.536719 [info ] [MainThread]: 
[0m11:44:11.538530 [info ] [MainThread]: Completed successfully
[0m11:44:11.539648 [info ] [MainThread]: 
[0m11:44:11.541247 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:11.543759 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:11.543444 after 1.47 seconds
[0m11:44:11.544930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62ea65e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e894eca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d62e89347c0>]}
[0m11:44:11.545906 [debug] [MainThread]: Flushing usage events
[0m11:44:11.547663 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:44:11.551726 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.556468 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:44:11.277321 => 11:44:11.556075
[0m11:44:11.558836 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48bdcfe2-23f5-4f27-b6c6-6c07ad14216d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e80c44f70>]}
[0m11:44:11.560903 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.32s]
[0m11:44:11.562852 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:44:11.568712 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:11.570908 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:11.572429 [debug] [MainThread]: On list__silver: Close
[0m11:44:11.574229 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:44:11.575333 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:44:11.576755 [info ] [MainThread]: 
[0m11:44:11.578186 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.80 seconds (0.80s).
[0m11:44:11.579549 [debug] [MainThread]: Command end result
[0m11:44:11.582728 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:11.588760 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.599194 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:44:11.602880 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:11.606160 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:44:11.337347 => 11:44:11.605870
[0m11:44:11.606816 [info ] [MainThread]: 
[0m11:44:11.607907 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a64235e8-668c-4f27-8bf5-1ef6923bba92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d94271bcfa0>]}
[0m11:44:11.607958 [info ] [MainThread]: Completed successfully
[0m11:44:11.609170 [info ] [MainThread]: 
[0m11:44:11.609376 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.31s]
[0m11:44:11.610507 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:11.611500 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:44:11.612064 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:11.611855 after 1.50 seconds
[0m11:44:11.613176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e852af370>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e81605640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c7e8162a520>]}
[0m11:44:11.614501 [debug] [MainThread]: Flushing usage events
[0m11:44:11.616322 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:11.617461 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:11.618266 [debug] [MainThread]: On list__silver: Close
[0m11:44:11.619098 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:44:11.620785 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:44:11.622600 [info ] [MainThread]: 
[0m11:44:11.624185 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m11:44:11.625991 [debug] [MainThread]: Command end result
[0m11:44:11.651635 [info ] [MainThread]: 
[0m11:44:11.653079 [info ] [MainThread]: Completed successfully
[0m11:44:11.654106 [info ] [MainThread]: 
[0m11:44:11.655072 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:11.656424 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:11.656257 after 1.53 seconds
[0m11:44:11.657211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942f847430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d94271a0c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d942db4ed30>]}
[0m11:44:11.658018 [debug] [MainThread]: Flushing usage events
[0m11:44:17.148885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2f52f4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2ffa1e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2ffb2790>]}


============================== 11:44:17.156921 | ca5822c0-2c89-4622-81ef-6049e2e2e46d ==============================
[0m11:44:17.156921 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:17.158018 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:17.268973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2ffa1dc0>]}
[0m11:44:17.294778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2da62f10>]}
[0m11:44:17.296563 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:17.323298 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:17.823275 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:17.824468 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:17.825592 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:17.832269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2d86c910>]}
[0m11:44:17.854573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2d9d2c10>]}
[0m11:44:17.856715 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:17.858136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2d9d2bb0>]}
[0m11:44:17.861156 [info ] [MainThread]: 
[0m11:44:17.863344 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:17.865213 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:17.879261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:18.068189 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:18.073233 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:18.077940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:18.078935 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:18.086693 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:18.089245 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:18.098463 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:18.144717 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:18.150512 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:18.155230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2c331d60>]}
[0m11:44:18.156789 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:18.157884 [info ] [MainThread]: 
[0m11:44:18.175735 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:44:18.177626 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:44:18.179124 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:44:18.180616 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:44:18.192838 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:44:18.214953 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:44:18.181657 => 11:44:18.214279
[0m11:44:18.216782 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:44:18.276400 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:44:18.295477 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:18.307193 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:18.314094 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:18.318680 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:44:18.343426 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:44:18.355625 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:18.362259 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:44:18.366029 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:18.394750 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:18.402087 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:18.412718 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:44:18.416849 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:18.419476 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:44:18.217700 => 11:44:18.419247
[0m11:44:18.421784 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca5822c0-2c89-4622-81ef-6049e2e2e46d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2c1132b0>]}
[0m11:44:18.423741 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:44:18.425679 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:44:18.429143 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:18.430259 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:18.431059 [debug] [MainThread]: On list__silver: Close
[0m11:44:18.432089 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:44:18.433084 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:44:18.434348 [info ] [MainThread]: 
[0m11:44:18.435849 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m11:44:18.437744 [debug] [MainThread]: Command end result
[0m11:44:18.473616 [info ] [MainThread]: 
[0m11:44:18.475214 [info ] [MainThread]: Completed successfully
[0m11:44:18.476446 [info ] [MainThread]: 
[0m11:44:18.477629 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:18.478822 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:18.478699 after 1.36 seconds
[0m11:44:18.479856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2f52f4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2c23dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dbc2d84edc0>]}
[0m11:44:18.481191 [debug] [MainThread]: Flushing usage events
[0m11:44:24.213518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264365dd460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72643702afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72643702adf0>]}


============================== 11:44:24.225908 | 25cb047e-9db0-437d-81aa-c925e5c0e84e ==============================
[0m11:44:24.225908 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:24.227450 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:24.351467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72643702ae50>]}
[0m11:44:24.369623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70091505d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700915ad0fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700915ad0df0>]}


============================== 11:44:24.381320 | 9c691b75-034d-4f58-afc6-c75b5034ae73 ==============================
[0m11:44:24.381320 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:24.383736 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:24.399073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726434ae5eb0>]}
[0m11:44:24.401183 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:24.430340 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:24.476839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12ab2a7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12abc72dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12abc72e50>]}


============================== 11:44:24.487989 | f5c3d509-4351-411a-a4bd-9af57bf72f64 ==============================
[0m11:44:24.487989 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:24.489326 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:24.529235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700915ad0e50>]}
[0m11:44:24.574612 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7009135a1eb0>]}
[0m11:44:24.576495 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:24.605436 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:24.670009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12abc72d60>]}
[0m11:44:24.749749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a97dbe80>]}
[0m11:44:24.752308 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:24.815243 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:24.947961 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:24.948955 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:24.950708 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:24.961479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264348ec8b0>]}
[0m11:44:24.997408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726434a52bb0>]}
[0m11:44:24.998987 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:25.000310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726434a52b50>]}
[0m11:44:25.004139 [info ] [MainThread]: 
[0m11:44:25.006760 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:25.009675 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:25.034000 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:25.088118 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:25.089244 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:25.091694 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:25.106443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7009133aa8b0>]}
[0m11:44:25.135850 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700913512bb0>]}
[0m11:44:25.138104 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:25.139775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700913512b50>]}
[0m11:44:25.143519 [info ] [MainThread]: 
[0m11:44:25.146065 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:25.148671 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:25.177500 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:25.298146 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:25.299467 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:25.301655 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:25.316328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a95ec880>]}
[0m11:44:25.339715 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:25.345559 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:25.350419 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:25.351515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a9753b80>]}
[0m11:44:25.353136 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:25.354753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a9753b20>]}
[0m11:44:25.358245 [info ] [MainThread]: 
[0m11:44:25.358203 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:25.360415 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:25.363212 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:25.373986 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:25.378716 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:25.385552 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:25.387199 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.439904 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:25.446298 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.451713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726432eb3d00>]}
[0m11:44:25.454114 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:25.455419 [info ] [MainThread]: 
[0m11:44:25.479888 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:44:25.481779 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:44:25.484580 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:44:25.485709 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:44:25.495113 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:25.500399 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:25.506422 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:44:25.506783 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:25.514778 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:25.525196 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:25.531974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:25.539912 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:44:25.486770 => 11:44:25.539209
[0m11:44:25.541947 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:44:25.543147 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.601124 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:25.610199 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.615572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x700911932d00>]}
[0m11:44:25.617811 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:25.619169 [info ] [MainThread]: 
[0m11:44:25.644675 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:44:25.646355 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:44:25.647640 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:44:25.649566 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:44:25.651243 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:44:25.662738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:25.665295 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:44:25.680245 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:25.681310 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:44:25.652418 => 11:44:25.680714
[0m11:44:25.685673 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:44:25.686787 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.693759 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:44:25.693948 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:25.699667 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:25.706363 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:25.708788 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:44:25.713793 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:25.718865 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:25.724007 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:25.734001 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.745013 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:44:25.753585 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:44:25.757202 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:25.785895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:44:25.788249 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:25.796437 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.797317 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:25.799599 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.802246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a80b4cd0>]}
[0m11:44:25.804302 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.804906 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:25.806279 [info ] [MainThread]: 
[0m11:44:25.816448 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:44:25.818710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:25.821196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:25.826403 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.827895 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:44:25.544322 => 11:44:25.827494
[0m11:44:25.829828 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '25cb047e-9db0-437d-81aa-c925e5c0e84e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726431f7aeb0>]}
[0m11:44:25.831609 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.35s]
[0m11:44:25.833929 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:44:25.833536 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:44:25.836079 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:44:25.838619 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:25.838516 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:44:25.840004 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:25.841163 [debug] [MainThread]: On list__silver: Close
[0m11:44:25.841349 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:44:25.842371 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:44:25.843124 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:44:25.843373 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:44:25.844545 [info ] [MainThread]: 
[0m11:44:25.845744 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m11:44:25.847521 [debug] [MainThread]: Command end result
[0m11:44:25.851215 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:44:25.867548 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:44:25.871263 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:25.882382 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:44:25.885159 [info ] [MainThread]: 
[0m11:44:25.886853 [info ] [MainThread]: Completed successfully
[0m11:44:25.887946 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:44:25.843940 => 11:44:25.887203
[0m11:44:25.889434 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:44:25.889322 [info ] [MainThread]: 
[0m11:44:25.890086 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.891080 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:25.893905 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:25.893320 after 1.71 seconds
[0m11:44:25.895333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264365dd460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7264348ced60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726431f8e370>]}
[0m11:44:25.896815 [debug] [MainThread]: Flushing usage events
[0m11:44:25.938971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:25.945969 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:25.957183 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:44:25.960253 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:25.963189 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:44:25.686705 => 11:44:25.962896
[0m11:44:25.964715 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9c691b75-034d-4f58-afc6-c75b5034ae73', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7009109fd670>]}
[0m11:44:25.965886 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.32s]
[0m11:44:25.967156 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:44:25.971011 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:25.972171 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:25.973200 [debug] [MainThread]: On list__silver: Close
[0m11:44:25.974287 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:44:25.975149 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:44:25.976212 [info ] [MainThread]: 
[0m11:44:25.977268 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m11:44:25.978489 [debug] [MainThread]: Command end result
[0m11:44:25.985774 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:44:26.012166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:26.012769 [info ] [MainThread]: 
[0m11:44:26.014222 [info ] [MainThread]: Completed successfully
[0m11:44:26.015230 [info ] [MainThread]: 
[0m11:44:26.016137 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:26.017907 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:26.017663 after 1.78 seconds
[0m11:44:26.018886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70091505d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7009113c45e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7009113ecb50>]}
[0m11:44:26.019860 [debug] [MainThread]: Flushing usage events
[0m11:44:26.035934 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:26.043023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:26.048676 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:44:26.067861 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:44:26.082360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:26.090011 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:44:26.094002 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:26.129972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:26.137795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:26.154936 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:44:26.158927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:26.167439 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:44:25.890577 => 11:44:26.167003
[0m11:44:26.169563 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f5c3d509-4351-411a-a4bd-9af57bf72f64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a2c408e0>]}
[0m11:44:26.171354 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.33s]
[0m11:44:26.173217 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:44:26.177291 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:26.178191 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:26.179066 [debug] [MainThread]: On list__silver: Close
[0m11:44:26.180484 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:44:26.181564 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:44:26.182766 [info ] [MainThread]: 
[0m11:44:26.183816 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:44:26.185081 [debug] [MainThread]: Command end result
[0m11:44:26.219288 [info ] [MainThread]: 
[0m11:44:26.222816 [info ] [MainThread]: Completed successfully
[0m11:44:26.224725 [info ] [MainThread]: 
[0m11:44:26.226103 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:26.227971 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:26.227732 after 1.99 seconds
[0m11:44:26.228985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12ab2a7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a2d8fd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d12a95ced30>]}
[0m11:44:26.230107 [debug] [MainThread]: Flushing usage events
[0m11:44:31.211881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466c7fe400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466d1efd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466d1efdc0>]}


============================== 11:44:31.219007 | d697f579-2d6d-4f43-9d31-8995b7c80e9d ==============================
[0m11:44:31.219007 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:31.220296 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:31.351786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466d1efd90>]}
[0m11:44:31.375980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466acefdc0>]}
[0m11:44:31.377739 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:31.400940 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:31.840326 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:31.841428 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:31.842819 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:31.849382 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466aaec7f0>]}
[0m11:44:31.875564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466ac52af0>]}
[0m11:44:31.876496 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:31.877407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466ac52a90>]}
[0m11:44:31.879544 [info ] [MainThread]: 
[0m11:44:31.881806 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:31.885197 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:31.904974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:32.108098 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:32.112196 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:32.116840 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:44:32.117986 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:44:32.126356 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:32.128900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:32.137415 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:32.192704 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:32.199387 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:32.203577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466aab4be0>]}
[0m11:44:32.205228 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:32.206630 [info ] [MainThread]: 
[0m11:44:32.226690 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:44:32.227945 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:44:32.229829 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:44:32.231206 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:44:32.244509 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:44:32.263222 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:44:32.232046 => 11:44:32.262337
[0m11:44:32.265267 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:44:32.328288 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:44:32.346594 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:32.362602 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:32.369771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:32.374989 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:44:32.398101 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:44:32.409127 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:32.417110 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:44:32.421362 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:32.460839 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:32.467391 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:32.477948 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:44:32.481314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:32.484441 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:44:32.266257 => 11:44:32.484201
[0m11:44:32.485943 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd697f579-2d6d-4f43-9d31-8995b7c80e9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466817bee0>]}
[0m11:44:32.487242 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.26s]
[0m11:44:32.489141 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:44:32.492939 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:32.494150 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:44:32.495290 [debug] [MainThread]: On list__gold: Close
[0m11:44:32.496440 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:44:32.497540 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:44:32.498541 [info ] [MainThread]: 
[0m11:44:32.499419 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.62 seconds (0.62s).
[0m11:44:32.500805 [debug] [MainThread]: Command end result
[0m11:44:32.528985 [info ] [MainThread]: 
[0m11:44:32.530430 [info ] [MainThread]: Completed successfully
[0m11:44:32.531578 [info ] [MainThread]: 
[0m11:44:32.532943 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:32.534905 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:32.534742 after 1.35 seconds
[0m11:44:32.535868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466c7fe400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f466acefdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f46682cdbe0>]}
[0m11:44:32.537290 [debug] [MainThread]: Flushing usage events
[0m11:44:38.589157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c381cc3400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c382745d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c382745fd0>]}


============================== 11:44:38.599889 | 0968e9dc-6954-482d-8057-45b65ac9a92a ==============================
[0m11:44:38.599889 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:38.601823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:38.755217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c382745df0>]}
[0m11:44:38.748713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70447206f430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704472abedc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704472abee50>]}
[0m11:44:38.748681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c3dbe4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c4803fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c4803df0>]}


============================== 11:44:38.758271 | ce563096-232d-448e-ade4-5f4738d1441f ==============================
[0m11:44:38.758271 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:44:38.759420 | b960cd94-a5ed-4d95-bdc4-2decf96a5a5a ==============================
[0m11:44:38.759420 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:38.759525 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:38.760575 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:38.791606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c3801e1e50>]}
[0m11:44:38.793500 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:38.824984 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:38.915450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c4803e50>]}
[0m11:44:38.925119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704472abed60>]}
[0m11:44:38.959392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c22a7eb0>]}
[0m11:44:38.960929 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:38.968037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704470560e80>]}
[0m11:44:38.969706 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:38.994730 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:39.003477 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:39.251446 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:39.252763 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:39.255367 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:39.266882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c37ffec850>]}
[0m11:44:39.291919 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:39.291787 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:39.293242 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:39.293343 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:39.295229 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:39.295573 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:39.299106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c380152b50>]}
[0m11:44:39.300493 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:39.302083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c380152af0>]}
[0m11:44:39.306027 [info ] [MainThread]: 
[0m11:44:39.307548 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:39.308374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c20ac8b0>]}
[0m11:44:39.310456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70447036d880>]}
[0m11:44:39.310374 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:39.334089 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:39.341865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c2212bb0>]}
[0m11:44:39.344695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044704c6b80>]}
[0m11:44:39.344987 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:39.346659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c2212b50>]}
[0m11:44:39.346560 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:39.347977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7044704c6b20>]}
[0m11:44:39.350096 [info ] [MainThread]: 
[0m11:44:39.351301 [info ] [MainThread]: 
[0m11:44:39.352561 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:39.354412 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:39.355681 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:39.357350 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:39.383926 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:39.386354 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:39.675713 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:39.681202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:39.686904 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:39.694435 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:39.696160 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:39.702277 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:39.708451 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:44:39.708409 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:39.712696 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:39.710090 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:44:39.722389 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:39.725121 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:39.728517 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:39.735096 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:39.732776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:39.739544 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:39.737316 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:39.756050 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:39.761758 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:39.769136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:39.781561 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:39.810412 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:39.821572 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:39.830109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c37e5b2ca0>]}
[0m11:44:39.832771 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:39.835371 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:39.835577 [info ] [MainThread]: 
[0m11:44:39.847039 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:39.852743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c2074c40>]}
[0m11:44:39.855421 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:39.857209 [info ] [MainThread]: 
[0m11:44:39.859397 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:39.865069 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:44:39.866701 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:44:39.868765 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:44:39.868601 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:39.870065 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:44:39.875792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70446e932cd0>]}
[0m11:44:39.877887 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:39.879485 [info ] [MainThread]: 
[0m11:44:39.882964 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:44:39.889464 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:44:39.891047 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:44:39.892940 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:44:39.894605 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:44:39.900053 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:44:39.871192 => 11:44:39.899624
[0m11:44:39.901776 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:44:39.907637 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:44:39.908928 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:44:39.910422 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:44:39.911234 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:44:39.912097 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:44:39.933359 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:44:39.895561 => 11:44:39.932611
[0m11:44:39.935079 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:44:39.936304 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:44:39.956721 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:44:39.913632 => 11:44:39.956068
[0m11:44:39.958090 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:44:40.029550 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:44:40.052853 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:44:40.059677 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:44:40.065895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:44:40.072867 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:40.078376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:40.085008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:40.085982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:40.093469 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:44:40.093565 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:40.100953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:40.106493 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:40.109681 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:44:40.109724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:44:40.112892 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.123233 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:44:40.125576 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:44:40.128249 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:40.146246 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:44:40.147387 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:44:40.152780 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.161574 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:44:40.162415 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:40.173337 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:44:40.173497 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:44:40.178115 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.178723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.199270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:40.206366 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:40.216510 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:40.218405 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:40.223915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:40.223856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:44:40.225663 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:40.228542 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.231414 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:44:39.902958 => 11:44:40.231096
[0m11:44:40.233262 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0968e9dc-6954-482d-8057-45b65ac9a92a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c37d675f70>]}
[0m11:44:40.234856 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.36s]
[0m11:44:40.236754 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:44:40.238050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:44:40.238338 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:44:40.241195 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:40.242246 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.242357 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:40.242591 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:40.243804 [debug] [MainThread]: On list__silver: Close
[0m11:44:40.245138 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:44:40.246082 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:44:40.246808 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:44:39.959047 => 11:44:40.246374
[0m11:44:40.247053 [info ] [MainThread]: 
[0m11:44:40.247111 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:44:39.936068 => 11:44:40.246586
[0m11:44:40.248064 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m11:44:40.248380 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce563096-232d-448e-ade4-5f4738d1441f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70446d9fdfd0>]}
[0m11:44:40.248772 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b960cd94-a5ed-4d95-bdc4-2decf96a5a5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c00ed970>]}
[0m11:44:40.249545 [debug] [MainThread]: Command end result
[0m11:44:40.249814 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.34s]
[0m11:44:40.250438 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.36s]
[0m11:44:40.251901 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:44:40.252581 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:44:40.257175 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:40.259452 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:40.259149 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:40.260600 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:44:40.260790 [debug] [MainThread]: On list__silver: Close
[0m11:44:40.261563 [debug] [MainThread]: On list__gold: Close
[0m11:44:40.262306 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:44:40.262629 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:44:40.263800 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:44:40.263488 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:44:40.265224 [info ] [MainThread]: 
[0m11:44:40.265021 [info ] [MainThread]: 
[0m11:44:40.266446 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m11:44:40.266529 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m11:44:40.267951 [debug] [MainThread]: Command end result
[0m11:44:40.268152 [debug] [MainThread]: Command end result
[0m11:44:40.285094 [info ] [MainThread]: 
[0m11:44:40.286781 [info ] [MainThread]: Completed successfully
[0m11:44:40.288395 [info ] [MainThread]: 
[0m11:44:40.289919 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:40.291951 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:40.291618 after 1.74 seconds
[0m11:44:40.293160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c381cc3400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c37ffced00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74c37ffd59d0>]}
[0m11:44:40.294541 [debug] [MainThread]: Flushing usage events
[0m11:44:40.329303 [info ] [MainThread]: 
[0m11:44:40.331241 [info ] [MainThread]: Completed successfully
[0m11:44:40.331216 [info ] [MainThread]: 
[0m11:44:40.332951 [info ] [MainThread]: Completed successfully
[0m11:44:40.332906 [info ] [MainThread]: 
[0m11:44:40.334658 [info ] [MainThread]: 
[0m11:44:40.334736 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:40.336223 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:40.337024 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:40.336738 after 1.66 seconds
[0m11:44:40.338316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c3dbe4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198bb6c14f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7198c208ed60>]}
[0m11:44:40.339023 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:40.338505 after 1.75 seconds
[0m11:44:40.339499 [debug] [MainThread]: Flushing usage events
[0m11:44:40.340381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70447206f430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704470560e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70446db5cbe0>]}
[0m11:44:40.341720 [debug] [MainThread]: Flushing usage events
[0m11:44:46.543498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb60048e4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb600f1be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb600f2c790>]}


============================== 11:44:46.551140 | 5c13b477-ef6b-455b-a199-69430120d3ff ==============================
[0m11:44:46.551140 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:46.552882 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:46.669203 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb600f1bdc0>]}
[0m11:44:46.698184 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fe9e8f10>]}
[0m11:44:46.700082 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:46.728919 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:47.406855 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:47.407958 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:47.409450 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:47.419860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fe7ec910>]}
[0m11:44:47.453116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fe952c10>]}
[0m11:44:47.455275 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:47.456981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fe952bb0>]}
[0m11:44:47.460641 [info ] [MainThread]: 
[0m11:44:47.462360 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:47.465478 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:47.479725 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:47.719254 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:47.724279 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:47.728182 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:47.730098 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:47.757889 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:47.760170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:47.769265 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:47.823179 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:47.829490 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:47.834688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fcd71d60>]}
[0m11:44:47.837247 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:47.838696 [info ] [MainThread]: 
[0m11:44:47.858061 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:44:47.859194 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:44:47.860391 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:44:47.861342 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:44:47.870302 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:44:47.885483 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:44:47.862001 => 11:44:47.885137
[0m11:44:47.886298 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:44:47.938613 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:44:47.960897 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:47.976400 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:47.983478 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:47.990165 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:44:48.012567 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:44:48.024827 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:48.030695 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:44:48.035673 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:48.064837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:48.069824 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:48.079141 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:44:48.082197 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:48.085194 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:44:47.886835 => 11:44:48.084970
[0m11:44:48.086685 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5c13b477-ef6b-455b-a199-69430120d3ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fc614280>]}
[0m11:44:48.088004 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.23s]
[0m11:44:48.089326 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:44:48.092861 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:48.094096 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:48.094933 [debug] [MainThread]: On list__silver: Close
[0m11:44:48.095837 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:44:48.097387 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:44:48.098952 [info ] [MainThread]: 
[0m11:44:48.100115 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m11:44:48.101466 [debug] [MainThread]: Command end result
[0m11:44:48.130525 [info ] [MainThread]: 
[0m11:44:48.131467 [info ] [MainThread]: Completed successfully
[0m11:44:48.132562 [info ] [MainThread]: 
[0m11:44:48.133422 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:48.134934 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:48.134712 after 1.63 seconds
[0m11:44:48.135854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb60048e4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fc78dc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bb5fe7cedc0>]}
[0m11:44:48.136641 [debug] [MainThread]: Flushing usage events
[0m11:44:53.785995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca822ef430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca82c95e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca82c95e80>]}
[0m11:44:53.785233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b25e73d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b2f91d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b2f91df0>]}


============================== 11:44:53.794708 | 0d81843f-d2b5-42a8-a510-611fb502c141 ==============================
[0m11:44:53.794708 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:44:53.795478 | c797b6f7-bab4-4e3b-a335-efdc033538a6 ==============================
[0m11:44:53.795478 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:53.795960 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:53.796760 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:53.832629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0deef430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0e973dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0e973e50>]}


============================== 11:44:53.841384 | 6d6c840d-a08a-4278-8080-4c360dc05069 ==============================
[0m11:44:53.841384 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:44:53.842892 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:44:53.937421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b2f91dc0>]}
[0m11:44:53.954768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca82c95dc0>]}
[0m11:44:53.969916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b0b1bdf0>]}
[0m11:44:53.971495 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:53.991430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca80830e80>]}
[0m11:44:53.993529 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:53.997163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0e973d60>]}
[0m11:44:54.003200 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:54.029597 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:54.045214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0c421e80>]}
[0m11:44:54.046475 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:44:54.074839 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:44:54.322007 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:54.323000 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:54.324491 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:44:54.335233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b092d820>]}
[0m11:44:54.352346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:54.353799 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:54.355942 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:54.362124 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:54.363764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b0a89b20>]}
[0m11:44:54.364237 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:54.365183 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:54.366472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b0a89ac0>]}
[0m11:44:54.366105 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:44:54.370068 [info ] [MainThread]: 
[0m11:44:54.370529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca8062c880>]}
[0m11:44:54.372481 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:54.374931 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:54.380096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0c22c880>]}
[0m11:44:54.400578 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:54.402474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca80792b80>]}
[0m11:44:54.403909 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:54.405304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca80792b20>]}
[0m11:44:54.407462 [info ] [MainThread]: 
[0m11:44:54.409198 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:54.411833 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:54.430823 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:54.436808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0c392b80>]}
[0m11:44:54.438274 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:44:54.439641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0c392b20>]}
[0m11:44:54.442937 [info ] [MainThread]: 
[0m11:44:54.445053 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:44:54.448061 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:44:54.467498 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:54.681036 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:54.687838 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:54.695009 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:44:54.697684 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:44:54.723845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:54.720608 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:54.727735 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:54.736846 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:54.755579 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:54.760715 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:44:54.766611 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:44:54.801776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:54.809172 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:54.826815 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:44:54.828546 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:54.834576 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:54.844948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:44:54.851153 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:54.860449 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:44:54.863200 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:54.870397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b08f7c10>]}
[0m11:44:54.865186 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:54.873138 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:54.874327 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:54.874840 [info ] [MainThread]: 
[0m11:44:54.885047 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:54.913625 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:44:54.915378 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:44:54.918395 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:44:54.920580 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:44:54.923566 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:44:54.934176 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:54.940956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca7ebb3cd0>]}
[0m11:44:54.944108 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:44:54.946009 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:54.948652 [info ] [MainThread]: 
[0m11:44:54.964496 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:44:54.985031 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:54.994825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0a7f3cd0>]}
[0m11:44:54.996002 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:44:54.923134 => 11:44:54.995213
[0m11:44:54.997701 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:54.998769 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:44:54.999931 [info ] [MainThread]: 
[0m11:44:55.032149 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:44:55.034131 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:44:55.036575 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:44:55.038563 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:44:55.053212 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:44:55.054670 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:44:55.056121 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:44:55.057184 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:44:55.057572 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:44:55.071810 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:44:55.039669 => 11:44:55.071360
[0m11:44:55.073049 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:44:55.074147 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:44:55.088141 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:44:55.058449 => 11:44:55.087467
[0m11:44:55.089651 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:44:55.116965 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:44:55.139558 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:55.155221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:55.159226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:44:55.162318 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.168797 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:44:55.182618 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:55.188397 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:44:55.197819 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:44:55.203674 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.205676 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:55.212865 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.214807 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:55.215102 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:44:55.219550 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:44:55.219507 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:55.232960 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:55.235730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:44:55.240891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.247617 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:44:55.267863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:44:55.270821 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:44:55.271774 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:55.279081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.284377 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:44:55.285006 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:44:55.288248 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:55.294939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:44:55.298104 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:55.299153 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:44:55.300687 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:44:55.001297 => 11:44:55.300390
[0m11:44:55.303846 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c797b6f7-bab4-4e3b-a335-efdc033538a6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7adf76d30>]}
[0m11:44:55.304406 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:55.305773 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.39s]
[0m11:44:55.307060 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:44:55.310459 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:55.311872 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:44:55.312831 [debug] [MainThread]: On list__gold: Close
[0m11:44:55.313961 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:44:55.314800 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:44:55.315779 [info ] [MainThread]: 
[0m11:44:55.317054 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.94 seconds (0.94s).
[0m11:44:55.318892 [debug] [MainThread]: Command end result
[0m11:44:55.335163 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:55.343549 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.345249 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:44:55.347506 [info ] [MainThread]: 
[0m11:44:55.349377 [info ] [MainThread]: Completed successfully
[0m11:44:55.350923 [info ] [MainThread]: 
[0m11:44:55.352967 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:55.353251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:44:55.354916 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:55.354732 after 1.61 seconds
[0m11:44:55.355836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b25e73d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7b098aa00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aa7ae9444f0>]}
[0m11:44:55.356831 [debug] [MainThread]: Flushing usage events
[0m11:44:55.359938 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:44:55.364722 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:55.368805 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:44:55.073986 => 11:44:55.368310
[0m11:44:55.372013 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d81843f-d2b5-42a8-a510-611fb502c141', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca7dc9a910>]}
[0m11:44:55.374199 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:44:55.374406 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.34s]
[0m11:44:55.376695 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:44:55.378522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:44:55.381521 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:44:55.090637 => 11:44:55.381256
[0m11:44:55.381381 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:55.383245 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:44:55.383869 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6d6c840d-a08a-4278-8080-4c360dc05069', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c098bd6a0>]}
[0m11:44:55.384185 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:44:55.385266 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:55.386279 [debug] [MainThread]: On list__silver: Close
[0m11:44:55.385593 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.33s]
[0m11:44:55.387653 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:44:55.387516 [info ] [MainThread]: 
[0m11:44:55.388503 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.98 seconds (0.98s).
[0m11:44:55.390130 [debug] [MainThread]: Command end result
[0m11:44:55.390868 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:55.391882 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:44:55.392830 [debug] [MainThread]: On list__silver: Close
[0m11:44:55.393716 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:44:55.394688 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:44:55.395574 [info ] [MainThread]: 
[0m11:44:55.396579 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.95 seconds (0.95s).
[0m11:44:55.398753 [debug] [MainThread]: Command end result
[0m11:44:55.417491 [info ] [MainThread]: 
[0m11:44:55.418978 [info ] [MainThread]: Completed successfully
[0m11:44:55.420418 [info ] [MainThread]: 
[0m11:44:55.421563 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:55.423304 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:55.423084 after 1.67 seconds
[0m11:44:55.424267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca822ef430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca7dc46c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bca8060ed30>]}
[0m11:44:55.425137 [debug] [MainThread]: Flushing usage events
[0m11:44:55.457062 [info ] [MainThread]: 
[0m11:44:55.458277 [info ] [MainThread]: Completed successfully
[0m11:44:55.459450 [info ] [MainThread]: 
[0m11:44:55.460868 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:44:55.462609 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:55.462425 after 1.68 seconds
[0m11:44:55.463418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0deef430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c09a00be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764c0a7f3cd0>]}
[0m11:44:55.464273 [debug] [MainThread]: Flushing usage events
[0m11:45:01.503341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7968586df460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796859120e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796859120df0>]}


============================== 11:45:01.509092 | 1e0c1292-10cf-45ce-a01e-a3663923b9a7 ==============================
[0m11:45:01.509092 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:01.510021 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:01.599610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796859120e80>]}
[0m11:45:01.638129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796856be1eb0>]}
[0m11:45:01.639521 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:01.666089 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:02.058251 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:02.059169 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:02.060524 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:02.068869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7968569eb8b0>]}
[0m11:45:02.095704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796856b49bb0>]}
[0m11:45:02.096941 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:02.098081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796856b49b50>]}
[0m11:45:02.100010 [info ] [MainThread]: 
[0m11:45:02.101404 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:02.104441 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:02.116388 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:02.311884 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:02.316471 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:02.321601 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:45:02.323662 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:45:02.330040 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:02.333473 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:02.342354 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:02.388047 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:02.395449 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:02.399041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7968569b5c40>]}
[0m11:45:02.400613 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:02.401524 [info ] [MainThread]: 
[0m11:45:02.418813 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:45:02.420095 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:45:02.421722 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:45:02.423458 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:45:02.433614 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:45:02.454345 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:45:02.424118 => 11:45:02.453953
[0m11:45:02.455550 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:45:02.516704 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:45:02.543522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:45:02.556133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:02.562404 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:02.567763 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:45:02.590866 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:45:02.603565 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:02.609306 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:45:02.614204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:02.640362 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:02.646352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:02.656656 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:45:02.660545 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:02.663509 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:45:02.456359 => 11:45:02.663262
[0m11:45:02.665032 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e0c1292-10cf-45ce-a01e-a3663923b9a7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x796854083fa0>]}
[0m11:45:02.666252 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:45:02.667479 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:45:02.671023 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:02.672170 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:45:02.673140 [debug] [MainThread]: On list__gold: Close
[0m11:45:02.674189 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:45:02.675151 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:45:02.676064 [info ] [MainThread]: 
[0m11:45:02.677423 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m11:45:02.678797 [debug] [MainThread]: Command end result
[0m11:45:02.708287 [info ] [MainThread]: 
[0m11:45:02.709519 [info ] [MainThread]: Completed successfully
[0m11:45:02.710780 [info ] [MainThread]: 
[0m11:45:02.711844 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:02.713369 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:02.713211 after 1.23 seconds
[0m11:45:02.714616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7968586df460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7968541cbc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7968569ced60>]}
[0m11:45:02.715955 [debug] [MainThread]: Flushing usage events
[0m11:45:07.817713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a135a67400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a13651bd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a13651bfd0>]}


============================== 11:45:07.827664 | 3a8b2a52-d2da-4b48-b561-04e137b26aa3 ==============================
[0m11:45:07.827664 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:07.828919 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:07.972811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e690673d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e69abad00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e69abad90>]}
[0m11:45:07.972748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853a51f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853af94fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853af94df0>]}
[0m11:45:07.979860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a13651bdf0>]}


============================== 11:45:07.980416 | 575e87dd-ada7-4089-9ab8-06d6d8bcaf94 ==============================
[0m11:45:07.980416 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:45:07.980507 | e2523c67-e2e6-47b5-af1f-f289be73138b ==============================
[0m11:45:07.980507 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:07.981837 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:07.982021 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:08.020288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a134027e50>]}
[0m11:45:08.022121 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:08.059418 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:08.127131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e69abad60>]}
[0m11:45:08.140999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853af94e50>]}
[0m11:45:08.165283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e6756fd90>]}
[0m11:45:08.167257 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:08.176289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708538a64eb0>]}
[0m11:45:08.178042 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:08.198033 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:08.205185 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:08.421611 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:08.422890 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:08.424661 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:08.435601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a133dac850>]}
[0m11:45:08.465345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a133f09b50>]}
[0m11:45:08.467007 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:08.468367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a133f09af0>]}
[0m11:45:08.472734 [info ] [MainThread]: 
[0m11:45:08.474809 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:08.477123 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:08.491122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:08.492285 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:08.494305 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:08.498631 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:08.504589 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e6736c7c0>]}
[0m11:45:08.534198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e674c9a90>]}
[0m11:45:08.535687 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:08.537205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e674c9ac0>]}
[0m11:45:08.540439 [info ] [MainThread]: 
[0m11:45:08.542661 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:08.544827 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:08.545644 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:08.546346 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:08.548116 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:08.558358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853886d8b0>]}
[0m11:45:08.565708 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:08.584296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7085389c9bb0>]}
[0m11:45:08.585536 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:08.586528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7085389c9b50>]}
[0m11:45:08.588749 [info ] [MainThread]: 
[0m11:45:08.590195 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:08.592716 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:08.607221 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:08.779261 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:08.786615 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:08.793464 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:45:08.795759 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:45:08.816767 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:08.818066 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:08.826254 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:08.854733 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:08.859370 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:08.864872 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:08.872217 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:08.882197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:08.878471 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:08.885713 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:08.894161 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:08.894885 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:08.901296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a133d74c40>]}
[0m11:45:08.903682 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:08.905318 [info ] [MainThread]: 
[0m11:45:08.909601 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:08.914722 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:08.920106 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:45:08.922889 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:45:08.933232 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:45:08.934637 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:45:08.939069 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:45:08.939514 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:08.940441 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:45:08.940136 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:08.949119 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:08.950786 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:08.957379 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:45:08.958899 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:08.964540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e65933c10>]}
[0m11:45:08.966214 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:08.967436 [info ] [MainThread]: 
[0m11:45:08.974922 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:45:08.941353 => 11:45:08.974170
[0m11:45:08.976026 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:45:08.993366 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:45:08.994708 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:45:08.996105 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:45:08.997244 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:45:09.003884 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:09.010768 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.011649 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:45:09.015920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708538837c40>]}
[0m11:45:09.018062 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:09.019215 [info ] [MainThread]: 
[0m11:45:09.029239 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:45:08.998433 => 11:45:09.028807
[0m11:45:09.030298 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:45:09.044715 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:45:09.046282 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:45:09.047958 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:45:09.049066 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:45:09.065088 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:45:09.073079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:45:09.079835 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:45:09.049818 => 11:45:09.079174
[0m11:45:09.082542 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:45:09.095500 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:09.123971 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:09.131816 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.140877 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:45:09.156578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:45:09.160092 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:45:09.170230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.175742 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.179243 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:45:09.183895 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.195576 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:09.201543 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.207256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:45:09.211361 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:45:09.227748 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:09.230116 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:45:09.238137 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:09.247173 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.247594 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.249658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:09.264090 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.266341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:45:09.270953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.271027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:45:09.274713 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:45:09.276140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.279331 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:45:08.976900 => 11:45:09.279004
[0m11:45:09.281310 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3a8b2a52-d2da-4b48-b561-04e137b26aa3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a1313fd670>]}
[0m11:45:09.283200 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.34s]
[0m11:45:09.287425 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:45:09.292431 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:45:09.295363 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:09.296797 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:45:09.298366 [debug] [MainThread]: On list__gold: Close
[0m11:45:09.299614 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:45:09.304859 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:45:09.306512 [info ] [MainThread]: 
[0m11:45:09.308056 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m11:45:09.310554 [debug] [MainThread]: Command end result
[0m11:45:09.334504 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:09.337200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:45:09.342278 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.352857 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:45:09.352583 [info ] [MainThread]: 
[0m11:45:09.355206 [info ] [MainThread]: Completed successfully
[0m11:45:09.356732 [info ] [MainThread]: 
[0m11:45:09.358185 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:09.358834 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.360182 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:09.359922 after 1.58 seconds
[0m11:45:09.361749 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a135a67400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a133d8ed00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a1313dabe0>]}
[0m11:45:09.363231 [debug] [MainThread]: Flushing usage events
[0m11:45:09.363323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:45:09.370266 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.376269 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:45:09.031381 => 11:45:09.375734
[0m11:45:09.380141 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '575e87dd-ada7-4089-9ab8-06d6d8bcaf94', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e649fc5e0>]}
[0m11:45:09.382312 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.38s]
[0m11:45:09.384934 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:45:09.392456 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:09.395594 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:09.396965 [debug] [MainThread]: On list__silver: Close
[0m11:45:09.398275 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:45:09.399413 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:45:09.400535 [info ] [MainThread]: 
[0m11:45:09.402387 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:45:09.405287 [debug] [MainThread]: Command end result
[0m11:45:09.420373 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:09.427906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:09.438655 [info ] [MainThread]: 
[0m11:45:09.440404 [info ] [MainThread]: Completed successfully
[0m11:45:09.442415 [info ] [MainThread]: 
[0m11:45:09.444138 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:09.446004 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:09.445742 after 1.57 seconds
[0m11:45:09.446888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e690673d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e6756fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e2e64a1c9a0>]}
[0m11:45:09.447931 [debug] [MainThread]: Flushing usage events
[0m11:45:09.448058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:45:09.452673 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:09.457987 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:45:09.087086 => 11:45:09.457243
[0m11:45:09.464405 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2523c67-e2e6-47b5-af1f-f289be73138b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708535ed88e0>]}
[0m11:45:09.466249 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.42s]
[0m11:45:09.467702 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:45:09.471543 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:09.472788 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:45:09.474070 [debug] [MainThread]: On list__gold: Close
[0m11:45:09.475116 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:45:09.475973 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:45:09.476891 [info ] [MainThread]: 
[0m11:45:09.477902 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m11:45:09.479288 [debug] [MainThread]: Command end result
[0m11:45:09.507518 [info ] [MainThread]: 
[0m11:45:09.508864 [info ] [MainThread]: Completed successfully
[0m11:45:09.510092 [info ] [MainThread]: 
[0m11:45:09.511328 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:09.513578 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:09.513194 after 1.69 seconds
[0m11:45:09.514836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853a51f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x708535ea2220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70853884fd60>]}
[0m11:45:09.516027 [debug] [MainThread]: Flushing usage events
[0m11:45:14.035208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde30e7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde3b7ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde3b8f790>]}


============================== 11:45:14.042136 | bee712a9-6150-40f0-b83d-7d97856346e2 ==============================
[0m11:45:14.042136 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:14.043452 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:14.154122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde3b7de20>]}
[0m11:45:14.179922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde1624ee0>]}
[0m11:45:14.181746 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:14.205797 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:14.569359 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:14.570979 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:14.572605 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:14.582535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde142b8e0>]}
[0m11:45:14.616434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde1589be0>]}
[0m11:45:14.617593 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:14.618721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde1589b80>]}
[0m11:45:14.620624 [info ] [MainThread]: 
[0m11:45:14.622830 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:14.625417 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:14.638973 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:14.939429 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:14.945563 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:14.949848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:14.951485 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:14.960196 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:14.963660 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:14.970410 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:15.020034 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:15.027941 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:15.032988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cddb9b4d30>]}
[0m11:45:15.034917 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:15.036062 [info ] [MainThread]: 
[0m11:45:15.062867 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:45:15.064982 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:45:15.067415 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:45:15.069298 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:45:15.090152 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:45:15.116005 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:45:15.070338 => 11:45:15.115461
[0m11:45:15.117323 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:45:15.215656 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:45:15.242578 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:45:15.258596 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:15.265544 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:15.271285 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:45:15.300156 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:45:15.317078 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:15.326806 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:45:15.331146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:15.359455 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:15.366480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:15.374810 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:45:15.378623 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:15.382132 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:45:15.118368 => 11:45:15.381775
[0m11:45:15.384075 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bee712a9-6150-40f0-b83d-7d97856346e2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cddaa7ed00>]}
[0m11:45:15.385270 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.32s]
[0m11:45:15.386707 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:45:15.389694 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:15.390607 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:15.391702 [debug] [MainThread]: On list__silver: Close
[0m11:45:15.392542 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:45:15.393846 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:45:15.395009 [info ] [MainThread]: 
[0m11:45:15.396232 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.77 seconds (0.77s).
[0m11:45:15.397592 [debug] [MainThread]: Command end result
[0m11:45:15.427861 [info ] [MainThread]: 
[0m11:45:15.429538 [info ] [MainThread]: Completed successfully
[0m11:45:15.430753 [info ] [MainThread]: 
[0m11:45:15.431667 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:15.433454 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:15.433128 after 1.43 seconds
[0m11:45:15.434716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde30e7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cddb46e700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70cde140ed90>]}
[0m11:45:15.435956 [debug] [MainThread]: Flushing usage events
[0m11:45:20.572363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145ed5c430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145f7c4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145f7c4e50>]}


============================== 11:45:20.581666 | 9f78b44b-52d8-4a3a-a34e-1e983a0d638b ==============================
[0m11:45:20.581666 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:20.582800 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:20.724735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ec0ca7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ec170fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ec1721790>]}
[0m11:45:20.724166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c763727430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7641acdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7641ace50>]}


============================== 11:45:20.736888 | da8dc8f6-e055-4862-a82f-6b90282db34d ==============================
[0m11:45:20.736888 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:45:20.737203 | 7a213731-deee-4362-9dc6-928d6b344a0e ==============================
[0m11:45:20.737203 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:20.737481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145f7c4d60>]}
[0m11:45:20.738164 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:20.738574 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:20.782161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145d25be80>]}
[0m11:45:20.784100 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:20.818182 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:20.902865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ec170ffd0>]}
[0m11:45:20.903166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c7641acd60>]}
[0m11:45:20.941262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebf1e2ee0>]}
[0m11:45:20.941643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c761c6be80>]}
[0m11:45:20.942745 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:20.943068 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:20.971263 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:20.970721 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:21.217162 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:21.218225 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:21.220319 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:21.231972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145d06c880>]}
[0m11:45:21.265075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145d1d2b80>]}
[0m11:45:21.266599 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:21.268139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145d1d2b20>]}
[0m11:45:21.271673 [info ] [MainThread]: 
[0m11:45:21.273198 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:21.275443 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:21.282475 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:21.283528 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:21.283592 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:21.284941 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:21.285486 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:21.286789 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:21.293603 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:21.295824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebefec8e0>]}
[0m11:45:21.298033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c761a6b880>]}
[0m11:45:21.323003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebf152be0>]}
[0m11:45:21.324266 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:21.325531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebf152b80>]}
[0m11:45:21.327683 [info ] [MainThread]: 
[0m11:45:21.329625 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:21.332905 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:21.353493 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:21.357144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c761bc9b80>]}
[0m11:45:21.358484 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:21.359996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c761bc9b20>]}
[0m11:45:21.363886 [info ] [MainThread]: 
[0m11:45:21.365781 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:21.368271 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:21.392966 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:21.591091 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:21.596043 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:21.601289 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:21.608381 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:21.608587 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:21.613694 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:21.619136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:21.619602 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:21.621107 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:21.621047 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:21.630527 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.639672 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:21.644226 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:21.651987 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.668047 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:21.673108 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:21.677702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:45:21.682783 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:21.679805 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:45:21.689853 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.694537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7214575f4cd0>]}
[0m11:45:21.694526 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:21.695936 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:21.696400 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:21.697622 [info ] [MainThread]: 
[0m11:45:21.706525 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.711123 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:21.718361 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.723883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebd572d30>]}
[0m11:45:21.725704 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:45:21.726433 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:21.726943 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:45:21.727643 [info ] [MainThread]: 
[0m11:45:21.728356 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:45:21.729606 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:45:21.743377 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:45:21.753598 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:45:21.755174 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:45:21.756880 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:21.757308 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:45:21.758769 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:45:21.759214 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:45:21.730597 => 11:45:21.758495
[0m11:45:21.760403 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:45:21.765390 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.769473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c761a36b80>]}
[0m11:45:21.771787 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:21.773432 [info ] [MainThread]: 
[0m11:45:21.774051 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:45:21.787923 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:45:21.759826 => 11:45:21.787279
[0m11:45:21.789246 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:45:21.795089 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:45:21.796603 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:45:21.798626 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:45:21.800153 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:45:21.824633 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:45:21.839646 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:45:21.801527 => 11:45:21.838939
[0m11:45:21.840967 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:45:21.857002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:45:21.881760 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:21.905612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:21.907029 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:45:21.913602 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.923750 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:45:21.929027 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:21.940886 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:45:21.953897 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:21.957120 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.960811 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:21.969319 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:45:21.973679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:45:21.974588 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:45:21.981851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:22.007202 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:45:22.024641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:45:22.037590 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:22.052443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:22.052362 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:22.062913 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:22.065651 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:45:22.073582 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m11:45:22.082550 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:45:22.082481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:45:22.085484 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:45:22.088006 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:22.089941 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:22.092727 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:45:21.761270 => 11:45:22.092330
[0m11:45:22.094911 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9f78b44b-52d8-4a3a-a34e-1e983a0d638b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7214566bf640>]}
[0m11:45:22.097413 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.37s]
[0m11:45:22.099917 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:45:22.104250 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:22.109432 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:22.110649 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:22.112146 [debug] [MainThread]: On list__silver: Close
[0m11:45:22.113611 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:45:22.114807 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:45:22.116012 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:45:22.116014 [info ] [MainThread]: 
[0m11:45:22.117830 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m11:45:22.120695 [debug] [MainThread]: Command end result
[0m11:45:22.123607 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:22.143832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:22.151854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:22.157082 [info ] [MainThread]: 
[0m11:45:22.159163 [info ] [MainThread]: Completed successfully
[0m11:45:22.163718 [info ] [MainThread]: 
[0m11:45:22.165421 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:22.167499 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:22.167128 after 1.63 seconds
[0m11:45:22.168634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145ed5c430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72145d04ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x721456854b20>]}
[0m11:45:22.168635 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:45:22.169831 [debug] [MainThread]: Flushing usage events
[0m11:45:22.173307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:22.177503 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:45:21.790033 => 11:45:22.176966
[0m11:45:22.178672 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:22.180287 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da8dc8f6-e055-4862-a82f-6b90282db34d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebc63af10>]}
[0m11:45:22.183003 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.42s]
[0m11:45:22.185868 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:45:22.188760 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:22.194333 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:22.195541 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:22.196841 [debug] [MainThread]: On list__silver: Close
[0m11:45:22.198146 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:45:22.199578 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:45:22.201120 [info ] [MainThread]: 
[0m11:45:22.202640 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m11:45:22.204654 [debug] [MainThread]: Command end result
[0m11:45:22.205863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:45:22.209313 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:22.212449 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:45:21.841884 => 11:45:22.212158
[0m11:45:22.213956 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a213731-deee-4362-9dc6-928d6b344a0e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c75b0be6a0>]}
[0m11:45:22.215515 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.42s]
[0m11:45:22.217240 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:45:22.222553 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:22.223905 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:45:22.224882 [debug] [MainThread]: On list__gold: Close
[0m11:45:22.225927 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:45:22.226946 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:45:22.228059 [info ] [MainThread]: 
[0m11:45:22.229251 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:45:22.230943 [debug] [MainThread]: Command end result
[0m11:45:22.235073 [info ] [MainThread]: 
[0m11:45:22.236582 [info ] [MainThread]: Completed successfully
[0m11:45:22.237771 [info ] [MainThread]: 
[0m11:45:22.238780 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:22.240544 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:22.240249 after 1.64 seconds
[0m11:45:22.241908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ec0ca7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebc7e6610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774ebd572d30>]}
[0m11:45:22.243279 [debug] [MainThread]: Flushing usage events
[0m11:45:22.271619 [info ] [MainThread]: 
[0m11:45:22.273608 [info ] [MainThread]: Completed successfully
[0m11:45:22.274953 [info ] [MainThread]: 
[0m11:45:22.276115 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:22.277367 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:22.277211 after 1.72 seconds
[0m11:45:22.278224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c763727430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c761c6be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c75b207d30>]}
[0m11:45:22.279434 [debug] [MainThread]: Flushing usage events
[0m11:45:28.122508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ec0434c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ecaa2e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ecab4790>]}


============================== 11:45:28.128450 | 9988be9e-7a3a-4ffa-b853-11c8e6b25aab ==============================
[0m11:45:28.128450 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:28.129704 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:28.234300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ecaa2dc0>]}
[0m11:45:28.260373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ea564f10>]}
[0m11:45:28.262401 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:28.285451 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:28.729945 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:28.730897 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:28.732472 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:28.740054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ea36b910>]}
[0m11:45:28.768447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ea4c9c10>]}
[0m11:45:28.770069 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:28.771410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ea4c9bb0>]}
[0m11:45:28.775156 [info ] [MainThread]: 
[0m11:45:28.777572 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:28.780861 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:28.796877 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:28.987955 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:28.992944 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:28.996685 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:28.997835 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:29.005912 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:29.008465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:29.016585 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:29.071624 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:29.077825 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:29.082115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70e8930d60>]}
[0m11:45:29.083671 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:29.084992 [info ] [MainThread]: 
[0m11:45:29.103142 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:45:29.104807 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:45:29.106298 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:45:29.107510 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:45:29.117760 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:45:29.136601 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:45:29.108388 => 11:45:29.135845
[0m11:45:29.137698 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:45:29.202635 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:45:29.217825 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:29.228647 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:29.235434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:29.240495 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:45:29.262720 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:45:29.276292 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:29.283145 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:45:29.287103 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:29.315929 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:29.323882 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:29.332714 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:45:29.336967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:29.339890 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:45:29.138556 => 11:45:29.339231
[0m11:45:29.341747 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9988be9e-7a3a-4ffa-b853-11c8e6b25aab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70e821b940>]}
[0m11:45:29.342933 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:45:29.344409 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:45:29.346982 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:29.347826 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:29.348510 [debug] [MainThread]: On list__silver: Close
[0m11:45:29.349701 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:45:29.350410 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:45:29.351276 [info ] [MainThread]: 
[0m11:45:29.352903 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.57 seconds (0.57s).
[0m11:45:29.354231 [debug] [MainThread]: Command end result
[0m11:45:29.391700 [info ] [MainThread]: 
[0m11:45:29.393310 [info ] [MainThread]: Completed successfully
[0m11:45:29.394480 [info ] [MainThread]: 
[0m11:45:29.395255 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:29.396285 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:29.396177 after 1.31 seconds
[0m11:45:29.396989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ec0434c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70ea34edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d70e8397910>]}
[0m11:45:29.397722 [debug] [MainThread]: Flushing usage events
[0m11:45:35.289113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf5610c7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf561b7adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf561b8b790>]}


============================== 11:45:35.298558 | aba5a1a2-39a4-462d-b336-3e5c01a23826 ==============================
[0m11:45:35.298558 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:35.299718 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:35.429880 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf561b7afd0>]}
[0m11:45:35.459975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef759e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef7f5eaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef7f5ee50>]}


============================== 11:45:35.471780 | 60af00cd-e8a3-404a-99b0-a02ce0f62e1a ==============================
[0m11:45:35.471780 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:35.474078 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:35.474988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55f624ee0>]}
[0m11:45:35.476518 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:35.509439 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:35.601526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3178c583a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31796abd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31796abdc0>]}


============================== 11:45:35.609426 | 86b68673-53da-4061-a568-ec1e00bf77a2 ==============================
[0m11:45:35.609426 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:35.610796 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:35.617476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef7f5ee80>]}
[0m11:45:35.662421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef5ae2eb0>]}
[0m11:45:35.663943 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:35.695168 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:35.765914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31796abd90>]}
[0m11:45:35.803232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d317716fdc0>]}
[0m11:45:35.804823 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:35.838381 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:35.911183 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:35.912647 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:35.914178 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:35.923721 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55f42c8e0>]}
[0m11:45:35.955736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55f592be0>]}
[0m11:45:35.957322 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:35.958892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55f592b80>]}
[0m11:45:35.968507 [info ] [MainThread]: 
[0m11:45:35.972255 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:35.975815 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:35.997110 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:36.048382 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:36.049317 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:36.051499 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:36.064659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef58ec8b0>]}
[0m11:45:36.095837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef5a52bb0>]}
[0m11:45:36.097112 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:36.098157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef5a52b50>]}
[0m11:45:36.101000 [info ] [MainThread]: 
[0m11:45:36.103935 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:36.106473 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:36.124928 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:36.253025 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:36.254410 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:36.256134 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:36.263231 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:36.267851 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.268647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3176f6b7f0>]}
[0m11:45:36.273966 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:36.275635 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:36.296707 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:36.302280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31770daaf0>]}
[0m11:45:36.304264 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:36.305814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31770daa90>]}
[0m11:45:36.306975 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:36.310498 [info ] [MainThread]: 
[0m11:45:36.314426 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:36.315210 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.317572 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:36.342487 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:36.379684 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:36.388862 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.393783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55d9f1d30>]}
[0m11:45:36.395379 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:36.396628 [info ] [MainThread]: 
[0m11:45:36.421032 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:36.426168 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.427461 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:45:36.428631 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:45:36.430275 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:45:36.431802 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:36.433097 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:45:36.439336 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:36.449203 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:45:36.454445 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:36.457705 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:36.466093 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:45:36.434410 => 11:45:36.465446
[0m11:45:36.466674 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.467736 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:45:36.522987 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:36.530095 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.537158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef4374d00>]}
[0m11:45:36.539371 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:36.540855 [info ] [MainThread]: 
[0m11:45:36.565109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:45:36.569257 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:45:36.570953 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:45:36.573914 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:45:36.575577 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:45:36.580953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.593851 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:45:36.600019 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:36.611182 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.622136 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:45:36.636214 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:45:36.576604 => 11:45:36.635492
[0m11:45:36.639433 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:45:36.667843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:45:36.678804 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:36.681650 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.685378 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.692015 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:36.698798 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:45:36.694729 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:36.704532 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.714573 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:36.721132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:36.729765 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.757586 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:36.765022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:45:36.765357 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.779256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:45:36.782932 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.786425 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:45:36.468580 => 11:45:36.786054
[0m11:45:36.788108 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aba5a1a2-39a4-462d-b336-3e5c01a23826', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55cab6eb0>]}
[0m11:45:36.789384 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.36s]
[0m11:45:36.791018 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:36.792547 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:45:36.796817 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:36.798113 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:36.799114 [debug] [MainThread]: On list__silver: Close
[0m11:45:36.800755 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:45:36.802226 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:45:36.805082 [info ] [MainThread]: 
[0m11:45:36.806914 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:36.807060 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m11:45:36.809122 [debug] [MainThread]: Command end result
[0m11:45:36.814013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:36.815851 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.822646 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.824512 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3175532c40>]}
[0m11:45:36.826261 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:36.827440 [info ] [MainThread]: 
[0m11:45:36.829675 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:45:36.844060 [info ] [MainThread]: 
[0m11:45:36.845752 [info ] [MainThread]: Completed successfully
[0m11:45:36.848071 [info ] [MainThread]: 
[0m11:45:36.849509 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:45:36.850400 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:36.856358 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:36.855895 after 1.60 seconds
[0m11:45:36.858068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf5610c7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55f40ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cf55d9f1d30>]}
[0m11:45:36.859474 [debug] [MainThread]: Flushing usage events
[0m11:45:36.864551 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:45:36.867906 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:45:36.876507 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:45:36.878273 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:45:36.893543 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:45:36.900938 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:45:36.905056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:45:36.908773 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.917463 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:45:36.880567 => 11:45:36.916909
[0m11:45:36.918524 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:45:36.946335 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:36.953477 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:36.963981 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:45:36.967142 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:36.969881 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:45:36.641023 => 11:45:36.969631
[0m11:45:36.971665 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60af00cd-e8a3-404a-99b0-a02ce0f62e1a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef413cee0>]}
[0m11:45:36.973009 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.40s]
[0m11:45:36.974591 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:45:36.978587 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:36.979763 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:36.981033 [debug] [MainThread]: On list__silver: Close
[0m11:45:36.982900 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:45:36.984711 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:45:36.987851 [info ] [MainThread]: 
[0m11:45:36.999232 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m11:45:37.008257 [debug] [MainThread]: Command end result
[0m11:45:37.040301 [info ] [MainThread]: 
[0m11:45:37.042008 [info ] [MainThread]: Completed successfully
[0m11:45:37.043913 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:45:37.043933 [info ] [MainThread]: 
[0m11:45:37.045169 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:37.052779 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:37.052069 after 1.76 seconds
[0m11:45:37.054839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef759e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef5ae2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x797ef42eeca0>]}
[0m11:45:37.056759 [debug] [MainThread]: Flushing usage events
[0m11:45:37.066072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:37.088504 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:37.095233 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:37.102303 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:45:37.119328 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:45:37.134798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:37.144016 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:45:37.148062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:37.186964 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:37.194083 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:37.206598 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:45:37.211634 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:37.217973 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:45:36.919419 => 11:45:37.217458
[0m11:45:37.220195 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '86b68673-53da-4061-a568-ec1e00bf77a2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d31745f8f10>]}
[0m11:45:37.221966 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.35s]
[0m11:45:37.223944 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:45:37.228861 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:37.230345 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:37.231565 [debug] [MainThread]: On list__silver: Close
[0m11:45:37.233111 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:45:37.234279 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:45:37.235938 [info ] [MainThread]: 
[0m11:45:37.237481 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m11:45:37.239111 [debug] [MainThread]: Command end result
[0m11:45:37.269322 [info ] [MainThread]: 
[0m11:45:37.271195 [info ] [MainThread]: Completed successfully
[0m11:45:37.274578 [info ] [MainThread]: 
[0m11:45:37.276394 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:37.278431 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:37.278164 after 1.97 seconds
[0m11:45:37.279668 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3178c583a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3174feb550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d3176f4eca0>]}
[0m11:45:37.281097 [debug] [MainThread]: Flushing usage events
[0m11:45:43.766873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1ee00400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1f872d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1f872e20>]}


============================== 11:45:43.779833 | 47c5a6b7-8782-4935-b992-a72d952b1640 ==============================
[0m11:45:43.779833 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:43.781451 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:44.039760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1f872df0>]}
[0m11:45:44.184713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1d327e50>]}
[0m11:45:44.191741 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:44.350405 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:45.378309 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:45.379565 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:45.381675 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:45.390160 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1d12c850>]}
[0m11:45:45.422867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1d292b50>]}
[0m11:45:45.424493 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:45.426047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1d292af0>]}
[0m11:45:45.428588 [info ] [MainThread]: 
[0m11:45:45.431052 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:45.433793 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:45.453509 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:45.668021 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:45.672059 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:45.677179 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:45.678691 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:45.693584 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:45.690084 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:45.704664 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:45.744745 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:45.750974 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:45.755626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e176b4ca0>]}
[0m11:45:45.757330 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:45.758371 [info ] [MainThread]: 
[0m11:45:45.778205 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:45:45.779652 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:45:45.781682 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:45:45.782968 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:45:45.795383 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:45:45.810164 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:45:45.783767 => 11:45:45.809617
[0m11:45:45.811551 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:45:45.879408 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:45:45.893242 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:45.911099 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:45.918004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:45.926356 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:45:45.945469 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:45:45.960814 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:45.969021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:45:45.972667 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:45.998147 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:46.005516 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:46.015283 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:45:46.018277 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:46.020950 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:45:45.812422 => 11:45:46.020677
[0m11:45:46.022415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47c5a6b7-8782-4935-b992-a72d952b1640', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1677df40>]}
[0m11:45:46.023599 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:45:46.025317 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:45:46.029957 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:46.031188 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:46.032448 [debug] [MainThread]: On list__silver: Close
[0m11:45:46.033833 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:45:46.034980 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:45:46.036177 [info ] [MainThread]: 
[0m11:45:46.037543 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m11:45:46.038826 [debug] [MainThread]: Command end result
[0m11:45:46.065583 [info ] [MainThread]: 
[0m11:45:46.067795 [info ] [MainThread]: Completed successfully
[0m11:45:46.069163 [info ] [MainThread]: 
[0m11:45:46.070530 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:46.072040 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:46.071848 after 2.34 seconds
[0m11:45:46.072977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1ee00400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e168c49a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e8e1d10ed00>]}
[0m11:45:46.074335 [debug] [MainThread]: Flushing usage events
[0m11:45:51.698058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b214541f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2145e68fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2145e68df0>]}


============================== 11:45:51.707671 | 754653cd-3f60-43b9-9622-e3f38735e0cd ==============================
[0m11:45:51.707671 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:51.709366 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:51.825783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2145e68e50>]}
[0m11:45:51.860827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b214392deb0>]}
[0m11:45:51.862708 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:51.864294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db98e73d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733dba359d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733dba359df0>]}


============================== 11:45:51.875746 | 216f8ff4-4234-4185-9e30-4ac91cb2baae ==============================
[0m11:45:51.875746 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:51.877406 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:51.901214 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:52.019973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733dba359dc0>]}
[0m11:45:52.018609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51b467400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51beb3d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51beb3fd0>]}


============================== 11:45:52.027629 | 021644cb-9cc7-424b-9917-f4de03bc8a8b ==============================
[0m11:45:52.027629 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:52.029619 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:52.051740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db7e20df0>]}
[0m11:45:52.053135 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:52.078937 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:52.151151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51beb3df0>]}
[0m11:45:52.181010 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e5199e8e50>]}
[0m11:45:52.182505 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:52.207583 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:52.283765 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:52.284725 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:52.286422 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:45:52.302284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b214372c8b0>]}
[0m11:45:52.335685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2143892bb0>]}
[0m11:45:52.337102 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:52.338325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2143892b50>]}
[0m11:45:52.341245 [info ] [MainThread]: 
[0m11:45:52.343018 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:52.345618 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:52.365036 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:52.388556 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:52.391193 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:52.394489 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:52.404110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db7c2c820>]}
[0m11:45:52.433004 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db7d89b20>]}
[0m11:45:52.434279 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:52.435462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db7d89ac0>]}
[0m11:45:52.438179 [info ] [MainThread]: 
[0m11:45:52.440764 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:52.443341 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:52.463181 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:52.606386 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:52.607316 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:52.608741 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:52.615770 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:52.618130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51976c850>]}
[0m11:45:52.619686 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:52.623402 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:45:52.624705 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:45:52.633264 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:52.636532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:52.645537 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.657568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e5198d2b50>]}
[0m11:45:52.658930 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:52.660195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e5198d2af0>]}
[0m11:45:52.662543 [info ] [MainThread]: 
[0m11:45:52.664669 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:52.667607 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:52.685425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:52.703147 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:52.709353 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.712965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b21436f3c40>]}
[0m11:45:52.714585 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:52.715658 [info ] [MainThread]: 
[0m11:45:52.718655 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:52.723218 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:52.727938 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:52.735973 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:45:52.737276 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:45:52.738776 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:45:52.729267 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:52.740180 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:45:52.738603 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:52.743403 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:52.751990 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.753555 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:45:52.767900 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:45:52.741205 => 11:45:52.767390
[0m11:45:52.769071 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:45:52.805987 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:52.812788 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.818041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db61b2c70>]}
[0m11:45:52.820165 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:52.821541 [info ] [MainThread]: 
[0m11:45:52.840411 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:45:52.841633 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:45:52.843013 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:45:52.844089 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:45:52.861477 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:45:52.862031 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:45:52.876937 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:45:52.844851 => 11:45:52.876366
[0m11:45:52.877585 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.878279 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:45:52.892712 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:52.899240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.906558 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:45:52.921540 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:45:52.933157 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.940495 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:52.941445 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:45:52.944719 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:52.945415 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:52.949541 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:52.951576 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:52.965157 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:45:52.969911 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:52.973274 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:52.981341 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:52.984935 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:52.987941 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:52.991081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:53.003265 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:45:53.004917 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:53.007306 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.012033 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:45:52.770070 => 11:45:53.011585
[0m11:45:53.012016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:53.013722 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '754653cd-3f60-43b9-9622-e3f38735e0cd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2140db9fd0>]}
[0m11:45:53.015399 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.28s]
[0m11:45:53.016986 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:45:53.019940 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:45:53.021133 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:53.022140 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:45:53.023166 [debug] [MainThread]: On list__gold: Close
[0m11:45:53.024318 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:45:53.025178 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:45:53.026268 [info ] [MainThread]: 
[0m11:45:53.027267 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.68 seconds (0.68s).
[0m11:45:53.029083 [debug] [MainThread]: Command end result
[0m11:45:53.036342 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:53.036415 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:45:53.044501 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:53.050771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51821fca0>]}
[0m11:45:53.054515 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:53.056103 [info ] [MainThread]: 
[0m11:45:53.063767 [info ] [MainThread]: 
[0m11:45:53.065525 [info ] [MainThread]: Completed successfully
[0m11:45:53.067330 [info ] [MainThread]: 
[0m11:45:53.068475 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:45:53.068723 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:53.070599 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:53.070313 after 1.41 seconds
[0m11:45:53.071735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b214541f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b2140f25b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b214370ed60>]}
[0m11:45:53.072901 [debug] [MainThread]: Flushing usage events
[0m11:45:53.085429 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:45:53.089301 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:45:53.091639 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:45:53.094331 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:45:53.094816 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:53.096016 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:45:53.111044 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:45:53.126409 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:45:53.096969 => 11:45:53.125953
[0m11:45:53.127385 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:45:53.133267 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:53.138840 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.148618 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:45:53.152349 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.155033 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:45:52.879262 => 11:45:53.154800
[0m11:45:53.156203 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '216f8ff4-4234-4185-9e30-4ac91cb2baae', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db527afd0>]}
[0m11:45:53.157281 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.31s]
[0m11:45:53.158452 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:45:53.161474 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:53.162417 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:53.163235 [debug] [MainThread]: On list__silver: Close
[0m11:45:53.164132 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:45:53.164945 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:45:53.165755 [info ] [MainThread]: 
[0m11:45:53.166694 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.73 seconds (0.73s).
[0m11:45:53.167956 [debug] [MainThread]: Command end result
[0m11:45:53.190889 [info ] [MainThread]: 
[0m11:45:53.192249 [info ] [MainThread]: Completed successfully
[0m11:45:53.193618 [info ] [MainThread]: 
[0m11:45:53.194642 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:53.195918 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:53.195770 after 1.50 seconds
[0m11:45:53.196683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db98e73d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db7e20df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733db5290d30>]}
[0m11:45:53.197344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:45:53.197529 [debug] [MainThread]: Flushing usage events
[0m11:45:53.219911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:45:53.231868 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:53.236974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.242087 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:45:53.255821 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:45:53.266209 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:53.273841 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:45:53.277585 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.309488 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:53.315891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.334813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:45:53.337998 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:53.341583 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:45:53.128161 => 11:45:53.341162
[0m11:45:53.343562 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '021644cb-9cc7-424b-9917-f4de03bc8a8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e512dbe6a0>]}
[0m11:45:53.345163 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.25s]
[0m11:45:53.347249 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:45:53.350591 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:53.351728 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:53.352542 [debug] [MainThread]: On list__silver: Close
[0m11:45:53.353379 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:45:53.354316 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:45:53.355792 [info ] [MainThread]: 
[0m11:45:53.357149 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m11:45:53.359253 [debug] [MainThread]: Command end result
[0m11:45:53.383637 [info ] [MainThread]: 
[0m11:45:53.385292 [info ] [MainThread]: Completed successfully
[0m11:45:53.386686 [info ] [MainThread]: 
[0m11:45:53.387984 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:53.389750 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:53.389564 after 1.63 seconds
[0m11:45:53.390923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51b467400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e518142d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e51974ed00>]}
[0m11:45:53.391825 [debug] [MainThread]: Flushing usage events
[0m11:45:58.590100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6bec8490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6c9b8dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6c9b8e80>]}


============================== 11:45:58.595792 | 5535edc5-9f67-4cd3-a62c-c53bc6cb72d5 ==============================
[0m11:45:58.595792 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:45:58.596633 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:45:58.683950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6c9b8d60>]}
[0m11:45:58.706246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6a49be80>]}
[0m11:45:58.708009 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:45:58.726134 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:45:59.054731 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:45:59.055671 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:45:59.056942 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:45:59.064554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6a22b880>]}
[0m11:45:59.086967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6a389b80>]}
[0m11:45:59.088160 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:45:59.088996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6a389b20>]}
[0m11:45:59.091021 [info ] [MainThread]: 
[0m11:45:59.092459 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:45:59.094477 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:45:59.107294 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:59.272365 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:45:59.275698 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:59.279664 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:45:59.280882 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:45:59.287124 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:45:59.289261 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:59.295812 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:59.332777 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:45:59.338349 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:59.341995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da687f2cd0>]}
[0m11:45:59.343112 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:59.343935 [info ] [MainThread]: 
[0m11:45:59.357966 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:45:59.358844 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:45:59.360023 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:45:59.360786 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:45:59.371749 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:45:59.382985 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:45:59.361295 => 11:45:59.382482
[0m11:45:59.384818 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:45:59.443660 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:45:59.457045 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:59.467272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:59.472550 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:59.476762 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:45:59.489180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:45:59.498398 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:45:59.504774 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:45:59.507985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:59.532524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:45:59.537670 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:59.545363 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:45:59.547871 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:45:59.549821 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:45:59.386210 => 11:45:59.549628
[0m11:45:59.550961 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5535edc5-9f67-4cd3-a62c-c53bc6cb72d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da680bafd0>]}
[0m11:45:59.551884 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.19s]
[0m11:45:59.552928 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:45:59.556255 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:59.557209 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:45:59.557990 [debug] [MainThread]: On list__silver: Close
[0m11:45:59.558730 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:45:59.559443 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:45:59.560384 [info ] [MainThread]: 
[0m11:45:59.561370 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m11:45:59.562468 [debug] [MainThread]: Command end result
[0m11:45:59.588143 [info ] [MainThread]: 
[0m11:45:59.589340 [info ] [MainThread]: Completed successfully
[0m11:45:59.590475 [info ] [MainThread]: 
[0m11:45:59.591610 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:45:59.593345 [debug] [MainThread]: Command `dbt run` succeeded at 11:45:59.593086 after 1.03 seconds
[0m11:45:59.594152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6bec8490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6820cc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71da6a20ed30>]}
[0m11:45:59.595073 [debug] [MainThread]: Flushing usage events
[0m11:56:54.933510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd1005b490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd10a0cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd10a0ce50>]}


============================== 11:56:54.942053 | 59e02db4-2135-4348-8c29-cd53ebcee85a ==============================
[0m11:56:54.942053 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:56:54.943668 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:56:55.082370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd10a0cd60>]}
[0m11:56:55.119883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0e59de80>]}
[0m11:56:55.121372 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:56:55.153229 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:56:55.410586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e2829e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e28ceffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e28cefdf0>]}


============================== 11:56:55.419822 | 7c14308d-ffa1-4f1a-b9b9-9424f7d180fb ==============================
[0m11:56:55.419822 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:56:55.421154 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:56:55.520194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e232e7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e23d43dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e23d54790>]}


============================== 11:56:55.527795 | b4018d3d-2edd-42fd-a12e-5a554d114376 ==============================
[0m11:56:55.527795 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:56:55.529299 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:56:55.559183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e28cefe50>]}
[0m11:56:55.601008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e267afeb0>]}
[0m11:56:55.602620 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:56:55.620311 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:56:55.621412 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:56:55.623156 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:56:55.630495 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:56:55.634385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0e3ab880>]}
[0m11:56:55.665510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e23d43fd0>]}
[0m11:56:55.667626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0e512b80>]}
[0m11:56:55.669313 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:56:55.670298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0e512b20>]}
[0m11:56:55.674379 [info ] [MainThread]: 
[0m11:56:55.678824 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:56:55.681329 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:56:55.699791 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:55.710399 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e217e2ee0>]}
[0m11:56:55.713007 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:56:55.747440 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:56:55.957902 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:56:55.958908 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:56:55.960162 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:56:55.971661 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:56:55.972036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e265ac8b0>]}
[0m11:56:55.976360 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:55.981693 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:56:55.989133 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:56:56.002608 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:56:56.007618 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:56.010261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e26712bb0>]}
[0m11:56:56.016485 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.018957 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:56:56.020995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e26712b50>]}
[0m11:56:56.024000 [info ] [MainThread]: 
[0m11:56:56.030453 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:56:56.034213 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:56:56.060004 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:56.094140 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:56:56.106531 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.114437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0c3e1820>]}
[0m11:56:56.116164 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:56:56.118049 [info ] [MainThread]: 
[0m11:56:56.142927 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:56:56.144038 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:56:56.145583 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:56:56.146671 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:56:56.161005 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:56:56.164334 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:56:56.165622 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:56:56.167291 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:56:56.174623 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:56:56.148789 => 11:56:56.174038
[0m11:56:56.175861 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:56:56.180913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e215ec8e0>]}
[0m11:56:56.210626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e21752be0>]}
[0m11:56:56.211683 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:56:56.212934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e21752b80>]}
[0m11:56:56.215567 [info ] [MainThread]: 
[0m11:56:56.219882 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:56:56.222655 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:56:56.248859 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:56.276114 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:56:56.289023 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.301345 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:56:56.308339 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.313398 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:56:56.328376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:56:56.339667 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.345732 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:56:56.350095 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.381142 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:56:56.383329 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:56:56.385563 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.389747 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.390819 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:56:56.401798 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:56:56.392453 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:56:56.404709 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.407287 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:56:56.177162 => 11:56:56.406988
[0m11:56:56.403150 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:56:56.407591 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:56.409016 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '59e02db4-2135-4348-8c29-cd53ebcee85a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0c378e20>]}
[0m11:56:56.410291 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.26s]
[0m11:56:56.411957 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:56:56.415794 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.417088 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:56:56.420211 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:56:56.421243 [debug] [MainThread]: On list__gold: Close
[0m11:56:56.422003 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:56:56.422709 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:56:56.423620 [info ] [MainThread]: 
[0m11:56:56.424784 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.75 seconds (0.75s).
[0m11:56:56.426109 [debug] [MainThread]: Command end result
[0m11:56:56.462699 [info ] [MainThread]: 
[0m11:56:56.464182 [info ] [MainThread]: Completed successfully
[0m11:56:56.465842 [info ] [MainThread]: 
[0m11:56:56.470478 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:56:56.473750 [debug] [MainThread]: Command `dbt run` succeeded at 11:56:56.473430 after 1.58 seconds
[0m11:56:56.475914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd1005b490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0e38ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bd0c3edeb0>]}
[0m11:56:56.475746 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:56:56.477577 [debug] [MainThread]: Flushing usage events
[0m11:56:56.484142 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.491674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e26573c40>]}
[0m11:56:56.493667 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:56:56.495149 [info ] [MainThread]: 
[0m11:56:56.516290 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:56:56.518127 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:56:56.519680 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:56:56.520877 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:56:56.531704 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:56:56.541852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:56:56.545571 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.548492 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:56:56.521748 => 11:56:56.547711
[0m11:56:56.549925 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:56:56.550919 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:56:56.558512 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:56:56.563500 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:56:56.568196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:56:56.577641 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.624676 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:56:56.628707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:56:56.632153 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.636008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e200618b0>]}
[0m11:56:56.638263 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:56:56.639245 [info ] [MainThread]: 
[0m11:56:56.644812 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.659547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:56:56.661802 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:56:56.665733 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:56:56.666408 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.668720 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:56:56.670371 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:56:56.672686 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:56:56.683224 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:56:56.687550 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:56:56.698990 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:56:56.671643 => 11:56:56.698223
[0m11:56:56.700338 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:56:56.720437 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:56:56.738989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:56:56.742682 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.786581 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:56:56.793819 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.801736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:56:56.809245 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:56:56.812243 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.814645 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.815544 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:56:56.552207 => 11:56:56.815206
[0m11:56:56.817535 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7c14308d-ffa1-4f1a-b9b9-9424f7d180fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e244598e0>]}
[0m11:56:56.818894 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.30s]
[0m11:56:56.820269 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:56:56.823625 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:56:56.824861 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:56:56.826022 [debug] [MainThread]: On list__gold: Close
[0m11:56:56.827486 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:56:56.828347 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:56:56.828596 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:56:56.830451 [info ] [MainThread]: 
[0m11:56:56.832394 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.80 seconds (0.80s).
[0m11:56:56.834426 [debug] [MainThread]: Command end result
[0m11:56:56.837211 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.842090 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:56:56.859277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:56:56.859470 [info ] [MainThread]: 
[0m11:56:56.860918 [info ] [MainThread]: Completed successfully
[0m11:56:56.862189 [info ] [MainThread]: 
[0m11:56:56.863466 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:56:56.864971 [debug] [MainThread]: Command `dbt run` succeeded at 11:56:56.864750 after 1.62 seconds
[0m11:56:56.865792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e2829e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e24419ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x774e2658ed60>]}
[0m11:56:56.867031 [debug] [MainThread]: Flushing usage events
[0m11:56:56.872130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:56:56.881712 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:56:56.885442 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.912486 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:56:56.917979 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.926193 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:56:56.929282 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:56:56.931430 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:56:56.702591 => 11:56:56.931174
[0m11:56:56.932805 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b4018d3d-2edd-42fd-a12e-5a554d114376', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e1ac48700>]}
[0m11:56:56.933818 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.26s]
[0m11:56:56.934815 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:56:56.937960 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:56:56.938652 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:56:56.939238 [debug] [MainThread]: On list__gold: Close
[0m11:56:56.939883 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:56:56.940377 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:56:56.940958 [info ] [MainThread]: 
[0m11:56:56.941646 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m11:56:56.942544 [debug] [MainThread]: Command end result
[0m11:56:56.967203 [info ] [MainThread]: 
[0m11:56:56.968780 [info ] [MainThread]: Completed successfully
[0m11:56:56.970141 [info ] [MainThread]: 
[0m11:56:56.971502 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:56:56.973569 [debug] [MainThread]: Command `dbt run` succeeded at 11:56:56.973186 after 1.51 seconds
[0m11:56:56.975137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e232e7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e217e2ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x723e215d7220>]}
[0m11:56:56.977198 [debug] [MainThread]: Flushing usage events
[0m11:57:02.710107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f472e520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f50ffe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f5112790>]}


============================== 11:57:02.717309 | 96fd6157-2a3f-4a3d-8643-b330f29ac278 ==============================
[0m11:57:02.717309 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:02.718454 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:02.822864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f50ffdc0>]}
[0m11:57:02.852282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f2c6ff10>]}
[0m11:57:02.853662 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:02.879512 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:03.414912 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:03.416981 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:03.419551 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:03.433520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f2a6b910>]}
[0m11:57:03.466364 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f2bc9c10>]}
[0m11:57:03.468404 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:03.470077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f2bc9bb0>]}
[0m11:57:03.473417 [info ] [MainThread]: 
[0m11:57:03.475792 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:03.478753 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:03.493462 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:03.691486 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:03.695267 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:03.698940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:03.700046 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:03.707131 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:03.709527 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:03.717331 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:03.760497 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:03.766759 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:03.771048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f0ae08e0>]}
[0m11:57:03.772711 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:03.773936 [info ] [MainThread]: 
[0m11:57:03.793040 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:57:03.794340 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:57:03.795547 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:57:03.797149 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:57:03.809429 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:57:03.826649 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:57:03.798415 => 11:57:03.826135
[0m11:57:03.827845 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:57:03.884105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:57:03.907207 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:03.919107 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:03.923955 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:03.928696 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:57:03.948907 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:57:03.960998 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:03.968700 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:57:03.972370 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:04.014344 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:04.021173 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:04.032924 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:57:04.036909 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:04.040140 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:57:03.828462 => 11:57:04.039716
[0m11:57:04.041945 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '96fd6157-2a3f-4a3d-8643-b330f29ac278', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f010e2e0>]}
[0m11:57:04.043390 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.25s]
[0m11:57:04.044472 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:57:04.048580 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:04.049495 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:04.050285 [debug] [MainThread]: On list__gold: Close
[0m11:57:04.051161 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:57:04.051966 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:57:04.052797 [info ] [MainThread]: 
[0m11:57:04.053622 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.58 seconds (0.58s).
[0m11:57:04.055320 [debug] [MainThread]: Command end result
[0m11:57:04.077141 [info ] [MainThread]: 
[0m11:57:04.078465 [info ] [MainThread]: Completed successfully
[0m11:57:04.079565 [info ] [MainThread]: 
[0m11:57:04.080680 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:04.082212 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:04.081933 after 1.40 seconds
[0m11:57:04.083348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f472e520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f2c6ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7732f024bd60>]}
[0m11:57:04.084361 [debug] [MainThread]: Flushing usage events
[0m11:57:08.683246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959ce5e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959d8c0fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959d8c0df0>]}


============================== 11:57:08.692560 | 54840ae7-89e7-4584-b986-9a1cb7cd52c7 ==============================
[0m11:57:08.692560 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:08.694663 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:08.820202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58c898490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58d316dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58d327790>]}
[0m11:57:08.826626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959d8c0e50>]}


============================== 11:57:08.828245 | 9edd5064-1a1f-4c4a-b113-fd8f6b1d85da ==============================
[0m11:57:08.828245 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:08.831428 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:08.821009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df983fee430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df984a3ad60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df984a3adf0>]}


============================== 11:57:08.834006 | 4263090a-5a71-4302-9124-dfd034aea633 ==============================
[0m11:57:08.834006 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:08.835650 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:08.866487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959b362eb0>]}
[0m11:57:08.868317 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:08.895758 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:08.954654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58d316fd0>]}
[0m11:57:08.959079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df984a3adc0>]}
[0m11:57:08.995917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df9824dbdf0>]}
[0m11:57:08.996699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58adb1ee0>]}
[0m11:57:08.997868 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:08.998562 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:09.027976 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:09.029409 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:09.248732 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:09.249617 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:09.251178 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:09.261534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959b16b8b0>]}
[0m11:57:09.288659 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:09.289590 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:09.289695 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:09.290608 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:09.290610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959b2d2bb0>]}
[0m11:57:09.291727 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:09.291918 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:09.292094 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:09.293073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959b2d2b50>]}
[0m11:57:09.296006 [info ] [MainThread]: 
[0m11:57:09.300087 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:09.301441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58abac8e0>]}
[0m11:57:09.302403 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:09.304114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df9822ec820>]}
[0m11:57:09.321850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:09.334462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58ad12be0>]}
[0m11:57:09.336649 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:09.336688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df982452b20>]}
[0m11:57:09.338359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58ad12b80>]}
[0m11:57:09.338778 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:09.340121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df982452ac0>]}
[0m11:57:09.341252 [info ] [MainThread]: 
[0m11:57:09.344784 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:09.342441 [info ] [MainThread]: 
[0m11:57:09.350317 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:09.353173 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:09.356189 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:09.371318 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:09.381040 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:09.582280 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:09.586357 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.593165 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:09.594653 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:09.609851 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:09.605938 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:09.613663 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:09.618862 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.619917 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.624624 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:09.632095 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:09.639491 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:09.641295 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:09.642173 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:09.643557 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.648987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:09.652136 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.650776 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:09.660890 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:09.664332 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:09.666593 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:09.673676 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.674845 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.679407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x769599732d00>]}
[0m11:57:09.680889 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:09.681921 [info ] [MainThread]: 
[0m11:57:09.692905 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:09.699835 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.703255 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:57:09.703402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e589171d30>]}
[0m11:57:09.704428 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:57:09.704670 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:09.705854 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:57:09.705703 [info ] [MainThread]: 
[0m11:57:09.707500 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:57:09.719159 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:57:09.721864 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:09.727871 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.728506 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:57:09.729517 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:57:09.732165 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:57:09.732339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df9822b4c10>]}
[0m11:57:09.732355 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:57:09.708291 => 11:57:09.731841
[0m11:57:09.733370 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:57:09.733323 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:57:09.733719 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:09.735036 [info ] [MainThread]: 
[0m11:57:09.746922 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:57:09.759165 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:57:09.734210 => 11:57:09.758596
[0m11:57:09.759830 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:57:09.760534 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:57:09.760633 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:57:09.761722 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:57:09.762477 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:57:09.776100 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:57:09.788650 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:57:09.762910 => 11:57:09.787962
[0m11:57:09.789826 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:57:09.803737 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:57:09.820198 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:09.841589 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:09.845342 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:57:09.848981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.853785 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:57:09.861855 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.872553 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:57:09.881126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:57:09.882655 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:09.889653 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:09.890884 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.896945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.897923 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:57:09.898754 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:57:09.903145 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.913786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:57:09.917324 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:09.923374 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.933056 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:57:09.939214 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:09.943181 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:09.948609 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:57:09.949092 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:57:09.949418 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.952430 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.960183 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:09.961009 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:57:09.964044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.967619 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:57:09.969555 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:57:09.734101 => 11:57:09.969288
[0m11:57:09.970648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:09.971248 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '54840ae7-89e7-4584-b986-9a1cb7cd52c7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7695987f9fa0>]}
[0m11:57:09.972231 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.27s]
[0m11:57:09.973581 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:57:09.977329 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:09.978384 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:09.979181 [debug] [MainThread]: On list__silver: Close
[0m11:57:09.980106 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:57:09.981050 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:57:09.983350 [info ] [MainThread]: 
[0m11:57:09.984650 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.68 seconds (0.68s).
[0m11:57:09.986550 [debug] [MainThread]: Command end result
[0m11:57:09.989073 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:09.994282 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:10.002617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:10.008796 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:57:10.011798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:10.013612 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:10.017451 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:57:09.761337 => 11:57:10.017040
[0m11:57:10.019391 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9edd5064-1a1f-4c4a-b113-fd8f6b1d85da', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58823d760>]}
[0m11:57:10.020769 [info ] [MainThread]: 
[0m11:57:10.021188 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.29s]
[0m11:57:10.022007 [info ] [MainThread]: Completed successfully
[0m11:57:10.022850 [info ] [MainThread]: 
[0m11:57:10.023246 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:57:10.023838 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:10.025245 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:10.025017 after 1.38 seconds
[0m11:57:10.026180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959ce5e460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959b362eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76959882d190>]}
[0m11:57:10.026802 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:57:10.027543 [debug] [MainThread]: Flushing usage events
[0m11:57:10.028349 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:10.029460 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:57:10.032345 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:10.032365 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:57:10.033591 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:10.034923 [debug] [MainThread]: On list__gold: Close
[0m11:57:10.035695 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:57:09.790635 => 11:57:10.035354
[0m11:57:10.039344 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4263090a-5a71-4302-9124-dfd034aea633', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df98017cf40>]}
[0m11:57:10.038425 [info ] [MainThread]: 
[0m11:57:10.040583 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m11:57:10.040972 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.28s]
[0m11:57:10.041953 [debug] [MainThread]: Command end result
[0m11:57:10.042367 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:57:10.046976 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:10.049462 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:10.050635 [debug] [MainThread]: On list__gold: Close
[0m11:57:10.051908 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:57:10.052972 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:57:10.054719 [info ] [MainThread]: 
[0m11:57:10.055985 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.70 seconds (0.70s).
[0m11:57:10.058460 [debug] [MainThread]: Command end result
[0m11:57:10.070474 [info ] [MainThread]: 
[0m11:57:10.071982 [info ] [MainThread]: Completed successfully
[0m11:57:10.072890 [info ] [MainThread]: 
[0m11:57:10.073721 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:10.075273 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:10.074863 after 1.40 seconds
[0m11:57:10.076329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58c898490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58837d5e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e58ab75c70>]}
[0m11:57:10.077985 [debug] [MainThread]: Flushing usage events
[0m11:57:10.110501 [info ] [MainThread]: 
[0m11:57:10.112578 [info ] [MainThread]: Completed successfully
[0m11:57:10.113808 [info ] [MainThread]: 
[0m11:57:10.115128 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:10.117117 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:10.116735 after 1.43 seconds
[0m11:57:10.118461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df983fee430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df9822cecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df98031a550>]}
[0m11:57:10.119621 [debug] [MainThread]: Flushing usage events
[0m11:57:16.088893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bae08434c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bae12c5e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bae12d6790>]}


============================== 11:57:16.094503 | a48c1491-610e-46c0-8ee4-645c62c0a57e ==============================
[0m11:57:16.094503 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:16.095696 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:16.190878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bae12c5dc0>]}
[0m11:57:16.219401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73baded6ff10>]}
[0m11:57:16.220990 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:16.244487 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:16.624388 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:16.625486 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:16.626666 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:16.634485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73badeb6b910>]}
[0m11:57:16.667130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73badecc9c10>]}
[0m11:57:16.668701 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:16.669666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73badecc9bb0>]}
[0m11:57:16.671671 [info ] [MainThread]: 
[0m11:57:16.673046 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:16.675534 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:16.690110 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:16.889751 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:16.893660 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:16.899416 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:16.900639 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:16.907796 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:16.910469 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:16.918764 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:16.966939 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:16.973539 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:16.977403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73badcbdf8e0>]}
[0m11:57:16.979186 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:16.980092 [info ] [MainThread]: 
[0m11:57:16.997776 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:57:16.999217 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:57:17.000529 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:57:17.001541 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:57:17.011354 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:57:17.026283 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:57:17.002116 => 11:57:17.025658
[0m11:57:17.027748 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:57:17.087676 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:57:17.103060 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:17.113503 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:17.119899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:17.123988 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:57:17.141290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:57:17.153751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:17.160667 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:57:17.163785 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:17.190207 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:17.195124 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:17.203790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:57:17.207252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:17.209955 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:57:17.028558 => 11:57:17.209760
[0m11:57:17.211319 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a48c1491-610e-46c0-8ee4-645c62c0a57e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73badc20f2b0>]}
[0m11:57:17.212464 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.21s]
[0m11:57:17.213804 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:57:17.217506 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:17.218441 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:57:17.219383 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:57:17.220239 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:17.220873 [debug] [MainThread]: On list__silver: Close
[0m11:57:17.221595 [info ] [MainThread]: 
[0m11:57:17.222266 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.55 seconds (0.55s).
[0m11:57:17.223315 [debug] [MainThread]: Command end result
[0m11:57:17.245776 [info ] [MainThread]: 
[0m11:57:17.247504 [info ] [MainThread]: Completed successfully
[0m11:57:17.249050 [info ] [MainThread]: 
[0m11:57:17.250069 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:17.251751 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:17.251495 after 1.19 seconds
[0m11:57:17.252858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bae08434c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73baded6ff10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73badc33ec40>]}
[0m11:57:17.253529 [debug] [MainThread]: Flushing usage events
[0m11:57:22.839906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1fade490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af20557dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af20568790>]}


============================== 11:57:22.847594 | 43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2 ==============================
[0m11:57:22.847594 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:22.848909 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:22.972530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af20557fd0>]}
[0m11:57:23.008253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1e024ee0>]}
[0m11:57:23.010630 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:23.015617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b3746f430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b37e13dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b37e13e50>]}


============================== 11:57:23.024966 | fbccfdec-a3d0-4771-b58b-7e23afc5b9f3 ==============================
[0m11:57:23.024966 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:23.027078 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:23.043499 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:23.147602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fc0087400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fc0aead90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fc0aeafd0>]}


============================== 11:57:23.160887 | efc88944-0108-495b-8a08-47e05a5b7e23 ==============================
[0m11:57:23.160887 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:23.162310 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:23.179015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b37e13d30>]}
[0m11:57:23.230836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b359b0e80>]}
[0m11:57:23.233477 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:23.268122 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:23.343894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fc0aeadf0>]}
[0m11:57:23.394385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbe59ae50>]}
[0m11:57:23.396563 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:23.432333 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:23.447838 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:23.449053 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:23.450761 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:23.462590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1de2c8e0>]}
[0m11:57:23.496381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1df92be0>]}
[0m11:57:23.498962 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:23.500613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1df92b80>]}
[0m11:57:23.503624 [info ] [MainThread]: 
[0m11:57:23.505943 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:23.509755 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:23.530889 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:23.605958 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:23.607094 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:23.609913 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:23.621137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b357ad880>]}
[0m11:57:23.651833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b35909b80>]}
[0m11:57:23.653196 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:23.654498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b35909b20>]}
[0m11:57:23.659213 [info ] [MainThread]: 
[0m11:57:23.661178 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:23.663609 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:23.686841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:23.810184 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:23.811242 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:23.812522 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:23.823326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbe3ab850>]}
[0m11:57:23.835369 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:23.841982 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:23.850065 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:23.857941 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:23.864659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbe506b50>]}
[0m11:57:23.866589 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:23.868145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbe506af0>]}
[0m11:57:23.872008 [info ] [MainThread]: 
[0m11:57:23.868793 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:23.873717 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:23.874431 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:23.881864 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:23.885084 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:23.905046 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:23.945231 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:23.955543 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:23.960093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1c3628b0>]}
[0m11:57:23.961805 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:23.962774 [info ] [MainThread]: 
[0m11:57:23.973762 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:23.978670 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:23.983607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:23.985671 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:57:23.987369 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:57:23.988784 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:57:23.989730 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:57:23.984893 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:23.999767 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:24.000699 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:24.003348 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:57:24.012789 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.019883 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:57:23.990466 => 11:57:24.019323
[0m11:57:24.021076 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:57:24.052563 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:24.058704 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.062027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b34234cd0>]}
[0m11:57:24.063635 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:24.064896 [info ] [MainThread]: 
[0m11:57:24.088510 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:57:24.089771 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:57:24.090683 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:57:24.090950 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:57:24.091999 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:57:24.103491 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:57:24.107346 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.119714 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:57:24.092661 => 11:57:24.119101
[0m11:57:24.120849 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:57:24.123523 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:24.128810 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.133840 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:57:24.142225 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:24.146500 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:57:24.147040 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.152570 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:24.154188 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:24.164644 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:24.168169 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:24.171636 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:24.174402 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.181404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:57:24.188167 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.197730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:57:24.211141 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.223273 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:24.224442 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:24.225358 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:24.230316 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.232102 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.232193 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.238810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbe376c40>]}
[0m11:57:24.239729 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:57:24.240306 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:24.241089 [info ] [MainThread]: 
[0m11:57:24.242610 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:57:24.246190 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.249664 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:57:24.021874 => 11:57:24.249381
[0m11:57:24.251555 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '43f800f7-d93f-42cf-b6a4-db1e5a6ebfe2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1c186790>]}
[0m11:57:24.252428 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:57:24.252717 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.26s]
[0m11:57:24.253955 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:57:24.259417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:24.260570 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:24.261493 [debug] [MainThread]: On list__gold: Close
[0m11:57:24.262785 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:57:24.263305 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:57:24.264243 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:57:24.264772 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:57:24.265649 [info ] [MainThread]: 
[0m11:57:24.267184 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:57:24.267108 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.267233 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m11:57:24.269190 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:57:24.270579 [debug] [MainThread]: Command end result
[0m11:57:24.283469 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:57:24.291713 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:57:24.295293 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.310890 [info ] [MainThread]: 
[0m11:57:24.312924 [info ] [MainThread]: Completed successfully
[0m11:57:24.314175 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:57:24.271156 => 11:57:24.312484
[0m11:57:24.314422 [info ] [MainThread]: 
[0m11:57:24.315891 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:57:24.315624 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:24.317879 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:24.317458 after 1.50 seconds
[0m11:57:24.319294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1fade490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1de0ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70af1c2d0ca0>]}
[0m11:57:24.320467 [debug] [MainThread]: Flushing usage events
[0m11:57:24.343457 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:24.351610 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.364588 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:57:24.369659 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.372042 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:57:24.121489 => 11:57:24.371815
[0m11:57:24.373305 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbccfdec-a3d0-4771-b58b-7e23afc5b9f3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b2edc06a0>]}
[0m11:57:24.374254 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.28s]
[0m11:57:24.375322 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:57:24.379104 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:24.380057 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:24.381204 [debug] [MainThread]: On list__silver: Close
[0m11:57:24.382124 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:57:24.382875 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:57:24.383772 [info ] [MainThread]: 
[0m11:57:24.384602 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.72 seconds (0.72s).
[0m11:57:24.386081 [debug] [MainThread]: Command end result
[0m11:57:24.406702 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:57:24.416185 [info ] [MainThread]: 
[0m11:57:24.417893 [info ] [MainThread]: Completed successfully
[0m11:57:24.418979 [info ] [MainThread]: 
[0m11:57:24.419997 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:24.421349 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:24.421169 after 1.59 seconds
[0m11:57:24.422329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b3746f430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b359b0e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733b3580bc10>]}
[0m11:57:24.423258 [debug] [MainThread]: Flushing usage events
[0m11:57:24.428161 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:24.444870 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:24.451637 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.457132 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:57:24.473624 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:57:24.486452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.493923 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:57:24.498070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.527428 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:24.533856 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:24.549086 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:57:24.553390 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:24.555983 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:57:24.316913 => 11:57:24.555726
[0m11:57:24.557760 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efc88944-0108-495b-8a08-47e05a5b7e23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbc23e640>]}
[0m11:57:24.558941 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.29s]
[0m11:57:24.560097 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:57:24.563181 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:24.564258 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:24.564969 [debug] [MainThread]: On list__gold: Close
[0m11:57:24.565712 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:57:24.566577 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:57:24.567668 [info ] [MainThread]: 
[0m11:57:24.568824 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.69 seconds (0.69s).
[0m11:57:24.570241 [debug] [MainThread]: Command end result
[0m11:57:24.594480 [info ] [MainThread]: 
[0m11:57:24.595766 [info ] [MainThread]: Completed successfully
[0m11:57:24.596927 [info ] [MainThread]: 
[0m11:57:24.598783 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:24.600016 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:24.599867 after 1.74 seconds
[0m11:57:24.600869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fc0087400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbe59ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x754fbc4046d0>]}
[0m11:57:24.601882 [debug] [MainThread]: Flushing usage events
[0m11:57:30.150819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9f4e74f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9ff4fd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9ff61790>]}


============================== 11:57:30.166044 | d871d670-20d4-41a1-9eb1-c47bac4cb90c ==============================
[0m11:57:30.166044 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:30.168457 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:30.372374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9ff4fdf0>]}
[0m11:57:30.399343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9da22d90>]}
[0m11:57:30.400771 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:30.425077 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:30.769573 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:30.770392 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:30.771491 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:30.780078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9d82c940>]}
[0m11:57:30.805878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9d989c40>]}
[0m11:57:30.807531 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:30.809014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9d989be0>]}
[0m11:57:30.810701 [info ] [MainThread]: 
[0m11:57:30.812996 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:30.815674 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:30.833349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:31.037450 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:31.042042 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:31.047047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:31.048954 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:31.057229 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:31.060133 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:31.069291 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:31.118764 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:31.125963 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:31.130126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9c263910>]}
[0m11:57:31.131681 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:31.132600 [info ] [MainThread]: 
[0m11:57:31.152427 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:57:31.153495 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:57:31.154663 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:57:31.155799 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:57:31.166417 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:57:31.183557 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:57:31.156522 => 11:57:31.182976
[0m11:57:31.184783 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:57:31.277712 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:57:31.299770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:31.324538 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:31.331987 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:31.336968 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:57:31.355656 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:57:31.367707 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:31.373831 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:57:31.377969 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:31.402321 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:31.408739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:31.421396 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:57:31.425960 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:31.429838 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:57:31.185717 => 11:57:31.429132
[0m11:57:31.431941 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd871d670-20d4-41a1-9eb1-c47bac4cb90c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9c09d970>]}
[0m11:57:31.433460 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.28s]
[0m11:57:31.435751 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:57:31.440439 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:31.441644 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:57:31.442712 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:57:31.443833 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:31.444987 [debug] [MainThread]: On list__silver: Close
[0m11:57:31.446240 [info ] [MainThread]: 
[0m11:57:31.448091 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.63 seconds (0.63s).
[0m11:57:31.449928 [debug] [MainThread]: Command end result
[0m11:57:31.479315 [info ] [MainThread]: 
[0m11:57:31.480777 [info ] [MainThread]: Completed successfully
[0m11:57:31.482376 [info ] [MainThread]: 
[0m11:57:31.484021 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:31.486008 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:31.485643 after 1.37 seconds
[0m11:57:31.487403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9f4e74f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9c1cfc70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aaf9d80edf0>]}
[0m11:57:31.488461 [debug] [MainThread]: Flushing usage events
[0m11:57:37.282420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f820de400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f82b65d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f82b65fd0>]}


============================== 11:57:37.293937 | e2fb5fe8-fc2d-4036-b7b7-fc83578dd548 ==============================
[0m11:57:37.293937 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:37.296538 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:37.478415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f82b65df0>]}
[0m11:57:37.498737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137e29d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137ecfefd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137ecfedf0>]}


============================== 11:57:37.512352 | 85cb2ad0-fe79-41a4-b55a-f20b43922cc2 ==============================
[0m11:57:37.512352 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:37.514279 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:37.527944 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f8061de50>]}
[0m11:57:37.529446 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:37.565026 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:37.674369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137ecfee50>]}
[0m11:57:37.668725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec890983a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec89b06d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec89b06dc0>]}


============================== 11:57:37.676964 | 89c93c5d-b0e8-4004-8e77-e5a23a253fef ==============================
[0m11:57:37.676964 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:37.678720 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:37.715921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137c7a2eb0>]}
[0m11:57:37.717588 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:37.748718 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:37.838453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec89b06d90>]}
[0m11:57:37.882338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec875b2dc0>]}
[0m11:57:37.883875 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:37.910101 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:37.969753 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:37.970760 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:37.972406 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:37.982290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f8042d850>]}
[0m11:57:38.018499 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f80589b50>]}
[0m11:57:38.020012 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:38.021603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f80589af0>]}
[0m11:57:38.024810 [info ] [MainThread]: 
[0m11:57:38.027200 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:38.030190 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:38.049847 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:38.094549 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:38.096037 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:38.098243 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:38.108469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137c5ac8b0>]}
[0m11:57:38.141354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137c712bb0>]}
[0m11:57:38.142817 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:38.144225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137c712b50>]}
[0m11:57:38.148559 [info ] [MainThread]: 
[0m11:57:38.150657 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:38.152600 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:38.172731 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:38.309897 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:38.310816 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:38.312916 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:38.321629 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:38.323477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec873ac7f0>]}
[0m11:57:38.326907 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.330971 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:38.332269 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:38.341908 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:38.345322 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:38.355733 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.360915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec87512af0>]}
[0m11:57:38.362559 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:38.364309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec87512a90>]}
[0m11:57:38.368722 [info ] [MainThread]: 
[0m11:57:38.371094 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:38.374170 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:38.392784 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:38.413439 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:38.420090 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.424655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f803f3c40>]}
[0m11:57:38.427955 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:38.429863 [info ] [MainThread]: 
[0m11:57:38.453620 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:57:38.455642 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:57:38.457980 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:38.458156 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:57:38.459661 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:57:38.462969 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.468282 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:38.470223 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:38.481163 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:57:38.483080 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:38.488485 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:38.501163 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.504793 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:57:38.460361 => 11:57:38.503903
[0m11:57:38.506606 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:57:38.574250 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:38.582513 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.590985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137ab73d00>]}
[0m11:57:38.592460 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:38.593496 [info ] [MainThread]: 
[0m11:57:38.615885 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:57:38.617437 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:57:38.618894 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:57:38.620122 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:57:38.620206 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:57:38.637839 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:38.638730 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:57:38.654859 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:57:38.621083 => 11:57:38.654194
[0m11:57:38.656606 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:57:38.658025 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:38.664331 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.671621 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:57:38.683263 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:38.686823 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:57:38.688587 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.693257 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:38.695739 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:38.714306 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:38.715887 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:38.718584 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:57:38.724178 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.728879 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:57:38.732962 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.757085 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:57:38.771557 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.776974 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:38.779938 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:38.782646 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.787976 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.789072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:38.793545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec85972c40>]}
[0m11:57:38.795617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.796080 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:38.797844 [info ] [MainThread]: 
[0m11:57:38.798629 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:57:38.801870 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.804272 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:57:38.805286 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:57:38.509546 => 11:57:38.804772
[0m11:57:38.807400 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e2fb5fe8-fc2d-4036-b7b7-fc83578dd548', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f7dabafa0>]}
[0m11:57:38.808608 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.35s]
[0m11:57:38.810074 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:57:38.814408 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:38.815772 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:38.816964 [debug] [MainThread]: On list__gold: Close
[0m11:57:38.818260 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:57:38.819364 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:57:38.819736 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:57:38.820793 [info ] [MainThread]: 
[0m11:57:38.822064 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m11:57:38.823662 [debug] [MainThread]: Command end result
[0m11:57:38.825561 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:57:38.827290 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:57:38.829155 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:57:38.830755 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:57:38.833122 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:38.842352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:57:38.847209 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:57:38.847767 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.852620 [info ] [MainThread]: 
[0m11:57:38.854104 [info ] [MainThread]: Completed successfully
[0m11:57:38.855519 [info ] [MainThread]: 
[0m11:57:38.856865 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:38.858468 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:38.858224 after 1.62 seconds
[0m11:57:38.859522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f820de400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f7daa9c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x790f8040ed00>]}
[0m11:57:38.860776 [debug] [MainThread]: Flushing usage events
[0m11:57:38.865481 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:57:38.831800 => 11:57:38.864671
[0m11:57:38.867310 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:57:38.897009 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:38.902453 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.916777 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:57:38.920138 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:38.922909 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:57:38.657744 => 11:57:38.922644
[0m11:57:38.926199 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '85cb2ad0-fe79-41a4-b55a-f20b43922cc2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f1379c3cfa0>]}
[0m11:57:38.928217 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.31s]
[0m11:57:38.930436 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:57:38.934210 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:38.935422 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:38.936509 [debug] [MainThread]: On list__silver: Close
[0m11:57:38.937575 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:57:38.938508 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:57:38.939710 [info ] [MainThread]: 
[0m11:57:38.940698 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m11:57:38.942019 [debug] [MainThread]: Command end result
[0m11:57:38.968159 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:57:38.968367 [info ] [MainThread]: 
[0m11:57:38.969896 [info ] [MainThread]: Completed successfully
[0m11:57:38.972181 [info ] [MainThread]: 
[0m11:57:38.974281 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:38.977736 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:38.977013 after 1.68 seconds
[0m11:57:38.980506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137e29d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137c7a2eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f137c597c10>]}
[0m11:57:38.982137 [debug] [MainThread]: Flushing usage events
[0m11:57:38.986791 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:39.013944 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:39.020701 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:39.029194 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:57:39.048390 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:57:39.062030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:39.070881 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:57:39.074775 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:39.115105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:39.121114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:39.132813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:57:39.136908 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:39.139632 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:57:38.868313 => 11:57:39.139353
[0m11:57:39.140979 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89c93c5d-b0e8-4004-8e77-e5a23a253fef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec84a3b970>]}
[0m11:57:39.142280 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.31s]
[0m11:57:39.143566 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:57:39.147909 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:39.149337 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:39.150266 [debug] [MainThread]: On list__silver: Close
[0m11:57:39.151105 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:57:39.152062 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:57:39.153147 [info ] [MainThread]: 
[0m11:57:39.154383 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.78 seconds (0.78s).
[0m11:57:39.157138 [debug] [MainThread]: Command end result
[0m11:57:39.184399 [info ] [MainThread]: 
[0m11:57:39.186003 [info ] [MainThread]: Completed successfully
[0m11:57:39.188471 [info ] [MainThread]: 
[0m11:57:39.190348 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:39.192020 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:39.191822 after 1.81 seconds
[0m11:57:39.192986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec890983a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec8738eca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dec84be3dc0>]}
[0m11:57:39.194107 [debug] [MainThread]: Flushing usage events
[0m11:57:45.319185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7355241fe4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735524b77e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735524b77df0>]}


============================== 11:57:45.327866 | d204e8b9-baec-4fb2-96c8-8279001a6e21 ==============================
[0m11:57:45.327866 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:45.329685 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:45.447592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735524b77e80>]}
[0m11:57:45.477492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7355226e8eb0>]}
[0m11:57:45.479525 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:45.507176 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:45.972721 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:45.973915 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:45.975158 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:45.982404 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7355224eb8b0>]}
[0m11:57:46.018026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735522649bb0>]}
[0m11:57:46.019700 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:46.020823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735522649b50>]}
[0m11:57:46.023792 [info ] [MainThread]: 
[0m11:57:46.025812 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:46.028799 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:46.042341 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:46.235689 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:46.240988 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:46.244894 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:46.246691 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:46.254118 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:46.258488 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:46.267000 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:46.323411 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:46.330854 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:46.335213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x735520ab1d00>]}
[0m11:57:46.337090 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:46.338144 [info ] [MainThread]: 
[0m11:57:46.358453 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:57:46.359796 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:57:46.361403 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:57:46.363029 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:57:46.373933 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:57:46.402208 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:57:46.364557 => 11:57:46.401800
[0m11:57:46.403521 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:57:46.474352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:57:46.498875 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:46.511151 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:46.518100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:46.523542 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:57:46.547387 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:57:46.559700 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:46.566543 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:57:46.571004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:46.599627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:46.605445 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:46.614138 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:57:46.618268 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:46.620654 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:57:46.404422 => 11:57:46.620365
[0m11:57:46.622432 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd204e8b9-baec-4fb2-96c8-8279001a6e21', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73552037adc0>]}
[0m11:57:46.623686 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.26s]
[0m11:57:46.625329 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:57:46.630036 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:46.632134 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:46.633224 [debug] [MainThread]: On list__silver: Close
[0m11:57:46.634322 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:57:46.635006 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:57:46.636287 [info ] [MainThread]: 
[0m11:57:46.637215 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.61 seconds (0.61s).
[0m11:57:46.638564 [debug] [MainThread]: Command end result
[0m11:57:46.666881 [info ] [MainThread]: 
[0m11:57:46.668043 [info ] [MainThread]: Completed successfully
[0m11:57:46.668846 [info ] [MainThread]: 
[0m11:57:46.669696 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:46.670732 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:46.670612 after 1.38 seconds
[0m11:57:46.671834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7355241fe4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7355204c4c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7355224ced60>]}
[0m11:57:46.672893 [debug] [MainThread]: Flushing usage events
[0m11:57:52.172666 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ebc9e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ec62ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ec62de50>]}
[0m11:57:52.172325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09d099e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09d133ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09d133afd0>]}


============================== 11:57:52.184571 | b1b0160d-b99b-4424-ac7f-c9a3b4971e48 ==============================
[0m11:57:52.184571 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:57:52.184611 | c1ae5740-e4ce-4380-a902-b75166bed1af ==============================
[0m11:57:52.184611 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:52.185970 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:52.186147 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:52.266338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b61241dc460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6124c21d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6124c21fd0>]}


============================== 11:57:52.274913 | dd33467b-f8cb-4fe3-bcd2-edd1eeec0770 ==============================
[0m11:57:52.274913 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:52.276360 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:52.344175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ec62dd60>]}
[0m11:57:52.351946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09d133adf0>]}
[0m11:57:52.404133 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ea1a4e80>]}
[0m11:57:52.406038 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:52.412768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09ceeb0e50>]}
[0m11:57:52.414515 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:52.433921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6124c21df0>]}
[0m11:57:52.436371 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:52.442180 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:52.470422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b61226f0e50>]}
[0m11:57:52.476469 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:52.522793 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:57:52.726902 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:52.728189 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:52.729173 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:52.730312 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:52.730045 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:57:52.731954 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:52.741284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958e9fac880>]}
[0m11:57:52.742923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09cecad850>]}
[0m11:57:52.769373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ea112b80>]}
[0m11:57:52.770708 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:52.772312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ea112b20>]}
[0m11:57:52.774788 [info ] [MainThread]: 
[0m11:57:52.776970 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:52.780212 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:52.803288 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:52.803867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09cee09b50>]}
[0m11:57:52.805262 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:52.806921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09cee09af0>]}
[0m11:57:52.810473 [info ] [MainThread]: 
[0m11:57:52.812584 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:52.815289 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:52.836524 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:52.904204 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:57:52.905762 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:57:52.907799 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:57:52.923436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b61224ec850>]}
[0m11:57:52.962573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6122652b50>]}
[0m11:57:52.967019 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:57:52.968943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6122652af0>]}
[0m11:57:52.972542 [info ] [MainThread]: 
[0m11:57:52.974983 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:57:52.978505 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:57:53.003187 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:53.147334 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:53.153319 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.159270 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:53.160875 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:53.172470 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:53.176282 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:53.181846 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:53.185687 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.187594 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.194789 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:57:53.197136 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:57:53.212946 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:53.217184 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:53.227352 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.250984 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:53.260538 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.266682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958e9f73be0>]}
[0m11:57:53.270172 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:53.271963 [info ] [MainThread]: 
[0m11:57:53.292020 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:53.299928 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:57:53.300938 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.301415 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:57:53.303052 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:57:53.304263 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:57:53.305365 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09cd25fca0>]}
[0m11:57:53.307364 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:53.308490 [info ] [MainThread]: 
[0m11:57:53.318179 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:57:53.320720 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:57:53.322171 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.328644 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:57:53.332264 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:57:53.333477 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:57:53.335493 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:57:53.336665 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:57:53.337228 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:57:53.337613 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:57:53.305068 => 11:57:53.336924
[0m11:57:53.341964 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:57:53.347161 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:57:53.342261 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:57:53.356387 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.356325 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:57:53.379179 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:57:53.341661 => 11:57:53.378349
[0m11:57:53.380346 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:57:53.412675 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:57:53.419996 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.424125 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b612055f820>]}
[0m11:57:53.426053 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:57:53.427857 [info ] [MainThread]: 
[0m11:57:53.439764 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:57:53.450791 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:57:53.452155 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:57:53.454182 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:57:53.455684 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:57:53.457308 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:53.468104 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:57:53.469882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:57:53.473379 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:53.480021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.483814 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:57:53.456566 => 11:57:53.483359
[0m11:57:53.485207 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:57:53.485128 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.489446 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:57:53.500370 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:53.504361 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:57:53.507866 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.514760 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:57:53.532817 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:57:53.546825 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:57:53.548564 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.558436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:57:53.560887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:57:53.562678 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.565588 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.599688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:57:53.611147 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:53.620197 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.620264 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:53.620637 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:53.627333 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.634940 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:57:53.639436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:53.639796 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.643651 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:57:53.342755 => 11:57:53.643242
[0m11:57:53.644244 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:57:53.645885 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1b0160d-b99b-4424-ac7f-c9a3b4971e48', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958e35fffd0>]}
[0m11:57:53.646684 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.648142 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.34s]
[0m11:57:53.649419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.650183 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:57:53.652941 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:57:53.381213 => 11:57:53.652586
[0m11:57:53.654041 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:53.654342 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1ae5740-e4ce-4380-a902-b75166bed1af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09cc343f40>]}
[0m11:57:53.654355 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:57:53.655476 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:53.656071 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.32s]
[0m11:57:53.657072 [debug] [MainThread]: On list__gold: Close
[0m11:57:53.658752 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:57:53.658710 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:57:53.659917 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:57:53.661144 [info ] [MainThread]: 
[0m11:57:53.662684 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.88 seconds (0.88s).
[0m11:57:53.663528 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:53.664377 [debug] [MainThread]: Command end result
[0m11:57:53.664630 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:57:53.665913 [debug] [MainThread]: On list__silver: Close
[0m11:57:53.667409 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:57:53.668735 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:57:53.670126 [info ] [MainThread]: 
[0m11:57:53.671839 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:57:53.673661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:57:53.674245 [debug] [MainThread]: Command end result
[0m11:57:53.692803 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:57:53.710214 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:57:53.720540 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.722155 [info ] [MainThread]: 
[0m11:57:53.724204 [info ] [MainThread]: Completed successfully
[0m11:57:53.727591 [info ] [MainThread]: 
[0m11:57:53.731310 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:53.733431 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:53.733044 after 1.59 seconds
[0m11:57:53.735400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958ebc9e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958e3746c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7958e9f8ed30>]}
[0m11:57:53.739937 [debug] [MainThread]: Flushing usage events
[0m11:57:53.772986 [info ] [MainThread]: 
[0m11:57:53.775015 [info ] [MainThread]: Completed successfully
[0m11:57:53.777233 [info ] [MainThread]: 
[0m11:57:53.779688 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:53.782323 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:53.782012 after 1.64 seconds
[0m11:57:53.783709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09d099e400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09cec8fd00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d09ccd05520>]}
[0m11:57:53.786471 [debug] [MainThread]: Flushing usage events
[0m11:57:53.802048 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:57:53.809267 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:57:53.823480 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:57:53.828091 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:57:53.832661 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:57:53.486373 => 11:57:53.832204
[0m11:57:53.834327 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dd33467b-f8cb-4fe3-bcd2-edd1eeec0770', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b612037f670>]}
[0m11:57:53.835853 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.38s]
[0m11:57:53.837439 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:57:53.841523 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:57:53.842616 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:57:53.843572 [debug] [MainThread]: On list__gold: Close
[0m11:57:53.844650 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:57:53.846045 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:57:53.847585 [info ] [MainThread]: 
[0m11:57:53.849025 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m11:57:53.850629 [debug] [MainThread]: Command end result
[0m11:57:53.880770 [info ] [MainThread]: 
[0m11:57:53.882875 [info ] [MainThread]: Completed successfully
[0m11:57:53.884412 [info ] [MainThread]: 
[0m11:57:53.886227 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:57:53.888774 [debug] [MainThread]: Command `dbt run` succeeded at 11:57:53.888459 after 1.68 seconds
[0m11:57:53.889894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b61241dc460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b61226f0e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b6120521a30>]}
[0m11:57:53.891111 [debug] [MainThread]: Flushing usage events
[0m11:57:59.699527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e582674c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e58cabe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e58cbc790>]}


============================== 11:57:59.708529 | 0a9e4e55-6a39-41d9-b05b-6a731f72bcef ==============================
[0m11:57:59.708529 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:57:59.709824 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:57:59.866303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e58cabdc0>]}
[0m11:57:59.902799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e56762f10>]}
[0m11:57:59.904539 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:57:59.943495 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:00.816142 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:00.817848 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:00.821872 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:00.835742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e5656b910>]}
[0m11:58:00.873235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e566c9c10>]}
[0m11:58:00.875261 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:00.880166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e566c9bb0>]}
[0m11:58:00.883518 [info ] [MainThread]: 
[0m11:58:00.885927 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:00.889435 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:00.915947 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:01.257236 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:01.262973 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:01.271110 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:01.273949 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:01.296040 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:01.300942 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:01.311529 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:01.370987 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:01.379521 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:01.383662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e54b31d60>]}
[0m11:58:01.385686 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:01.387082 [info ] [MainThread]: 
[0m11:58:01.411654 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:58:01.413307 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:58:01.415127 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:58:01.416630 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:58:01.433132 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:58:01.452203 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:58:01.417787 => 11:58:01.451532
[0m11:58:01.453321 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:58:01.551305 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:58:01.570062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:01.591198 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:01.599159 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:01.606002 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:58:01.622613 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:58:01.638639 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:01.648579 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:58:01.652601 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:01.695202 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:01.702522 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:01.719408 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:58:01.723434 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:01.728332 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:58:01.454386 => 11:58:01.727781
[0m11:58:01.730524 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0a9e4e55-6a39-41d9-b05b-6a731f72bcef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e545ad9d0>]}
[0m11:58:01.732075 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.32s]
[0m11:58:01.734236 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:58:01.738994 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:01.740160 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:01.741176 [debug] [MainThread]: On list__gold: Close
[0m11:58:01.742317 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:58:01.743154 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:58:01.744379 [info ] [MainThread]: 
[0m11:58:01.745722 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.86 seconds (0.86s).
[0m11:58:01.748453 [debug] [MainThread]: Command end result
[0m11:58:01.780602 [info ] [MainThread]: 
[0m11:58:01.782341 [info ] [MainThread]: Completed successfully
[0m11:58:01.783971 [info ] [MainThread]: 
[0m11:58:01.785362 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:01.787745 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:01.787363 after 2.13 seconds
[0m11:58:01.789497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e582674c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e56762f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x701e543e44f0>]}
[0m11:58:01.791251 [debug] [MainThread]: Flushing usage events
[0m11:58:08.274373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885fdab460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b886082afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b886082adf0>]}
[0m11:58:08.274694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770437c87400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770438628d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770438628fd0>]}


============================== 11:58:08.285487 | e3e291bc-0967-491e-9078-4962bd719fe7 ==============================
[0m11:58:08.285487 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:08.287245 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}


============================== 11:58:08.287038 | b50f2d6c-32be-49d4-8678-01c060779911 ==============================
[0m11:58:08.287038 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:08.288451 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:08.278494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669fd833d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7366a07f8d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7366a07f8df0>]}


============================== 11:58:08.290559 | aecd0f26-2c3f-4db4-af89-951327028478 ==============================
[0m11:58:08.290559 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:08.292057 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:08.472953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770438628df0>]}
[0m11:58:08.476953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b886082ae50>]}
[0m11:58:08.481953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7366a07f8dc0>]}
[0m11:58:08.517039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77043619be50>]}
[0m11:58:08.518881 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:08.521942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885e2e2eb0>]}
[0m11:58:08.523514 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:08.530568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669e2b1df0>]}
[0m11:58:08.532505 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:08.550261 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:08.556253 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:08.566081 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:08.850701 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:08.851732 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:08.852956 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:08.864808 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:08.864885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770435fac850>]}
[0m11:58:08.866329 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:08.867951 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:08.878196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885e0ec8b0>]}
[0m11:58:08.879515 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:08.880615 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:08.882649 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:08.897452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770436112b50>]}
[0m11:58:08.898345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669e0ac820>]}
[0m11:58:08.898948 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:08.900043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770436112af0>]}
[0m11:58:08.903019 [info ] [MainThread]: 
[0m11:58:08.905267 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:08.907926 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:08.928434 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:08.935506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669e212b20>]}
[0m11:58:08.937097 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:08.938302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669e212ac0>]}
[0m11:58:08.938180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885e252bb0>]}
[0m11:58:08.939534 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:08.940355 [info ] [MainThread]: 
[0m11:58:08.940859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885e252b50>]}
[0m11:58:08.941751 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:08.943773 [info ] [MainThread]: 
[0m11:58:08.945683 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:08.947444 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:08.949811 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:08.968564 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:08.968712 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:09.225602 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:09.232543 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.238853 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:09.247092 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:09.260654 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:09.267899 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:09.268850 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:09.273705 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.277387 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.281415 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:09.291650 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:09.283760 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:09.306771 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.319938 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:09.320824 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:09.322863 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:09.333309 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.328931 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:09.348082 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:09.357368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:09.367223 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.370464 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:09.386775 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.398667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77042ffe5820>]}
[0m11:58:09.402491 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:09.405751 [info ] [MainThread]: 
[0m11:58:09.422040 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:09.440775 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:09.447743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669c65ec70>]}
[0m11:58:09.450134 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:09.451691 [info ] [MainThread]: 
[0m11:58:09.453250 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:58:09.453741 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:09.454983 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:58:09.457502 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:58:09.458999 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:58:09.466061 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.471389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885c15f880>]}
[0m11:58:09.473325 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:09.474943 [info ] [MainThread]: 
[0m11:58:09.480839 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:58:09.484689 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:58:09.486612 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:58:09.488747 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:58:09.490685 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:58:09.499097 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:58:09.461277 => 11:58:09.498458
[0m11:58:09.500630 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:58:09.518269 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:58:09.518377 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:58:09.519935 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:58:09.525076 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:58:09.526907 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:58:09.540063 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:58:09.492115 => 11:58:09.539405
[0m11:58:09.541250 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:58:09.546255 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:58:09.566954 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:58:09.528591 => 11:58:09.566440
[0m11:58:09.568096 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:58:09.618489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:58:09.636542 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:58:09.645157 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:58:09.651276 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.663013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:58:09.665950 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:09.667100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:09.672193 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.672678 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.678717 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:58:09.680491 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:58:09.685751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:09.690192 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:58:09.691897 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:58:09.702838 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.704305 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:09.705032 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.712067 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.714599 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:58:09.716429 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:58:09.718976 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.719964 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.720050 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:58:09.733189 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:58:09.763128 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:58:09.764779 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:09.771126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:58:09.771494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.771651 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:09.775453 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.778673 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.786668 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:58:09.791069 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.792376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:58:09.794609 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:58:09.542009 => 11:58:09.793964
[0m11:58:09.797279 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.797639 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'aecd0f26-2c3f-4db4-af89-951327028478', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669c0b6df0>]}
[0m11:58:09.798881 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.31s]
[0m11:58:09.800189 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:58:09.501596 => 11:58:09.799900
[0m11:58:09.801118 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:58:09.801647 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b50f2d6c-32be-49d4-8678-01c060779911', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77042f605880>]}
[0m11:58:09.802874 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.34s]
[0m11:58:09.804940 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:58:09.805331 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:09.806521 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:09.807774 [debug] [MainThread]: On list__silver: Close
[0m11:58:09.808889 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:09.808855 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:58:09.809831 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:58:09.809824 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:09.810987 [debug] [MainThread]: On list__gold: Close
[0m11:58:09.811165 [info ] [MainThread]: 
[0m11:58:09.812203 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:58:09.812544 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.87 seconds (0.87s).
[0m11:58:09.813194 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:58:09.814231 [info ] [MainThread]: 
[0m11:58:09.814698 [debug] [MainThread]: Command end result
[0m11:58:09.815632 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m11:58:09.817114 [debug] [MainThread]: Command end result
[0m11:58:09.818191 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:09.825411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:09.839401 [info ] [MainThread]: 
[0m11:58:09.840385 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:58:09.841112 [info ] [MainThread]: Completed successfully
[0m11:58:09.842354 [info ] [MainThread]: 
[0m11:58:09.845058 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:09.845130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:09.847140 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:09.846884 after 1.61 seconds
[0m11:58:09.848332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669fd833d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669e08ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73669e067220>]}
[0m11:58:09.849248 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:58:09.568970 => 11:58:09.848825
[0m11:58:09.849459 [debug] [MainThread]: Flushing usage events
[0m11:58:09.851383 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e291bc-0967-491e-9078-4962bd719fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885c12b970>]}
[0m11:58:09.852956 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.33s]
[0m11:58:09.854655 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:58:09.860603 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:09.862421 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:09.864157 [debug] [MainThread]: On list__gold: Close
[0m11:58:09.865707 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:58:09.867295 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:58:09.869028 [info ] [MainThread]: 
[0m11:58:09.870983 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.92 seconds (0.92s).
[0m11:58:09.873325 [debug] [MainThread]: Command end result
[0m11:58:09.902073 [info ] [MainThread]: 
[0m11:58:09.902800 [info ] [MainThread]: 
[0m11:58:09.903845 [info ] [MainThread]: Completed successfully
[0m11:58:09.904611 [info ] [MainThread]: Completed successfully
[0m11:58:09.905430 [info ] [MainThread]: 
[0m11:58:09.906119 [info ] [MainThread]: 
[0m11:58:09.906891 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:09.907530 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:09.909027 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:09.908665 after 1.67 seconds
[0m11:58:09.909619 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:09.909200 after 1.67 seconds
[0m11:58:09.910762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770437c87400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x770435f95b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77042f796640>]}
[0m11:58:09.911294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885fdab460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885c0e4520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b885c13acd0>]}
[0m11:58:09.912118 [debug] [MainThread]: Flushing usage events
[0m11:58:09.912624 [debug] [MainThread]: Flushing usage events
[0m11:58:15.397839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac688d8490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac6937bdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac6938d790>]}


============================== 11:58:15.404923 | 81fb7147-40a7-46d3-8bcd-d45395fa92d3 ==============================
[0m11:58:15.404923 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:15.406049 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:15.504710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac6937be20>]}
[0m11:58:15.531024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac66e22ee0>]}
[0m11:58:15.532420 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:15.556618 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:16.079848 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:16.080901 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:16.082263 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:16.090413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac66c2d8e0>]}
[0m11:58:16.121194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac66d89be0>]}
[0m11:58:16.122514 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:16.123451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac66d89b80>]}
[0m11:58:16.126768 [info ] [MainThread]: 
[0m11:58:16.129644 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:16.132402 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:16.146690 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:16.348842 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:16.355143 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:16.361060 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:16.362924 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:16.381454 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:16.383875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:16.394628 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:16.446982 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:16.452952 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:16.457156 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac651f1d30>]}
[0m11:58:16.458468 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:16.459509 [info ] [MainThread]: 
[0m11:58:16.475922 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:58:16.477438 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:58:16.479351 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:58:16.480470 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:58:16.489863 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:58:16.507893 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:58:16.481283 => 11:58:16.507386
[0m11:58:16.509844 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:58:16.565145 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:58:16.588455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:16.599302 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:16.604694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:16.609673 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:58:16.627364 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:58:16.640315 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:16.648714 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:58:16.652757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:16.687928 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:16.694675 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:16.711082 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:58:16.715452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:16.718693 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:58:16.510930 => 11:58:16.718403
[0m11:58:16.720317 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '81fb7147-40a7-46d3-8bcd-d45395fa92d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac642b6eb0>]}
[0m11:58:16.722099 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.24s]
[0m11:58:16.724058 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:58:16.728258 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:16.729416 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:16.730255 [debug] [MainThread]: On list__silver: Close
[0m11:58:16.731178 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:58:16.731943 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:58:16.732911 [info ] [MainThread]: 
[0m11:58:16.734063 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.60 seconds (0.60s).
[0m11:58:16.735488 [debug] [MainThread]: Command end result
[0m11:58:16.764060 [info ] [MainThread]: 
[0m11:58:16.765927 [info ] [MainThread]: Completed successfully
[0m11:58:16.768247 [info ] [MainThread]: 
[0m11:58:16.769716 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:16.771908 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:16.771636 after 1.40 seconds
[0m11:58:16.773166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac688d8490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac64cab700>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eac66c0ed90>]}
[0m11:58:16.774423 [debug] [MainThread]: Flushing usage events
[0m11:58:22.257748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7ecede430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7ed8b6dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7ed8b6e50>]}


============================== 11:58:22.274893 | 3d05c753-fce9-464d-9a8f-7a44b4126343 ==============================
[0m11:58:22.274893 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:22.276925 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:22.452928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7ed8b6d60>]}
[0m11:58:22.500483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d4c5f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d55fffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d55ffdf0>]}


============================== 11:58:22.515101 | 4500b74d-ae99-4d5c-8ed3-442d6a0026f6 ==============================
[0m11:58:22.515101 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:22.517040 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:22.521015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7eb425e80>]}
[0m11:58:22.522464 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:22.553278 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:22.671845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d55ffe50>]}
[0m11:58:22.714916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d3162eb0>]}
[0m11:58:22.716838 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:22.745231 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:22.741043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea05e27490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea06892dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea068a3790>]}


============================== 11:58:22.751402 | 65df023e-6ff6-44d2-8857-4320c1d178e0 ==============================
[0m11:58:22.751402 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:22.753047 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:22.913500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea06892fd0>]}
[0m11:58:22.955955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea04362ee0>]}
[0m11:58:22.957630 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:22.971195 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:22.972254 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:22.973630 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:22.986914 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:22.987407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7eb22b880>]}
[0m11:58:23.036905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7eb39cb80>]}
[0m11:58:23.039065 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:23.040580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7eb39cb20>]}
[0m11:58:23.044231 [info ] [MainThread]: 
[0m11:58:23.047060 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:23.051091 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:23.079222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:23.173295 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:23.174264 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:23.176876 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:23.187974 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d2f6c8b0>]}
[0m11:58:23.225560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d30c6bb0>]}
[0m11:58:23.227407 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:23.228940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d30c6b50>]}
[0m11:58:23.232617 [info ] [MainThread]: 
[0m11:58:23.235393 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:23.238760 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:23.260418 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:23.381055 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:23.386575 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:23.392152 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:23.394001 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:23.414229 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:23.420486 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:23.430659 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.485357 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:23.493565 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.499610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7eb1f5b80>]}
[0m11:58:23.501098 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:23.502400 [info ] [MainThread]: 
[0m11:58:23.531020 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:58:23.532645 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:58:23.534771 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:58:23.536264 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:58:23.560506 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:58:23.568691 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:23.569669 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:23.572618 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:23.576472 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:58:23.543209 => 11:58:23.575734
[0m11:58:23.578301 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:58:23.578319 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:23.583241 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:23.586490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea0416d8e0>]}
[0m11:58:23.589796 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:23.591939 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:23.602359 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:23.608874 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:23.618543 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.630823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea042c9be0>]}
[0m11:58:23.633319 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:23.638823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea042c9b80>]}
[0m11:58:23.642649 [info ] [MainThread]: 
[0m11:58:23.645849 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:23.650004 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:23.671479 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:23.690757 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:23.699160 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:58:23.699231 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.704913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d1532d00>]}
[0m11:58:23.707027 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:23.708369 [info ] [MainThread]: 
[0m11:58:23.716463 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:23.741403 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:58:23.741491 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:23.743716 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:58:23.752972 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:58:23.752925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.756077 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:58:23.768801 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:58:23.784662 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:58:23.792504 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:58:23.801492 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:58:23.757705 => 11:58:23.800782
[0m11:58:23.803064 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:58:23.824439 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:58:23.834289 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:58:23.839836 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:23.881755 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:23.889794 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.904387 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:58:23.907577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:58:23.909269 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:23.918697 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:58:23.579408 => 11:58:23.918333
[0m11:58:23.920711 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3d05c753-fce9-464d-9a8f-7a44b4126343', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7e88b9e80>]}
[0m11:58:23.922364 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.39s]
[0m11:58:23.923820 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:58:23.925202 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:23.928403 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:23.933246 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:23.934644 [debug] [MainThread]: On list__gold: Close
[0m11:58:23.936253 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:58:23.938074 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:58:23.939739 [info ] [MainThread]: 
[0m11:58:23.940901 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.89 seconds (0.89s).
[0m11:58:23.943112 [debug] [MainThread]: Command end result
[0m11:58:23.949371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:23.956944 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.964778 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:58:23.972781 [info ] [MainThread]: 
[0m11:58:23.974649 [info ] [MainThread]: Completed successfully
[0m11:58:23.976119 [info ] [MainThread]: 
[0m11:58:23.978765 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:23.981083 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:23.980791 after 1.77 seconds
[0m11:58:23.982303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7ecede430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7eb20ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73d7e8a79b80>]}
[0m11:58:23.983526 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:58:23.983780 [debug] [MainThread]: Flushing usage events
[0m11:58:23.992262 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:23.998947 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:23.999628 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.007665 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:24.010226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:58:24.018181 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.009665 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:24.030515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:24.026125 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:24.039837 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.064887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:24.071757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.085134 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:58:24.089869 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:24.093022 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:58:23.804137 => 11:58:24.092693
[0m11:58:24.095644 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4500b74d-ae99-4d5c-8ed3-442d6a0026f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d05f9fa0>]}
[0m11:58:24.097478 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:24.098132 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.34s]
[0m11:58:24.100704 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:58:24.106069 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.106724 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:24.107797 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:24.108875 [debug] [MainThread]: On list__silver: Close
[0m11:58:24.109990 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:58:24.113231 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:58:24.113402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea021a18b0>]}
[0m11:58:24.115346 [info ] [MainThread]: 
[0m11:58:24.116168 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:24.119657 [info ] [MainThread]: 
[0m11:58:24.120047 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.88 seconds (0.88s).
[0m11:58:24.121923 [debug] [MainThread]: Command end result
[0m11:58:24.156918 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:58:24.158775 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:58:24.160580 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m11:58:24.162885 [info ] [MainThread]: 
[0m11:58:24.164848 [info ] [MainThread]: Completed successfully
[0m11:58:24.162921 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:58:24.167488 [info ] [MainThread]: 
[0m11:58:24.169228 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:24.171892 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:24.171280 after 1.88 seconds
[0m11:58:24.173170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d4c5f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d05d9c40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d7d2f4ed60>]}
[0m11:58:24.175103 [debug] [MainThread]: Flushing usage events
[0m11:58:24.196134 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:58:24.215675 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:58:24.169031 => 11:58:24.214789
[0m11:58:24.217636 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:58:24.349120 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:58:24.370080 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:24.388984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:24.396722 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.406026 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:58:24.423765 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:58:24.440443 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:24.448803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:58:24.452578 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:24.504877 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:24.512951 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:24.526946 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:58:24.530843 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:24.533831 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:58:24.218840 => 11:58:24.533524
[0m11:58:24.536045 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '65df023e-6ff6-44d2-8857-4320c1d178e0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea017bd730>]}
[0m11:58:24.537869 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.38s]
[0m11:58:24.539262 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:58:24.543407 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:24.545321 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:24.546747 [debug] [MainThread]: On list__gold: Close
[0m11:58:24.548698 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:58:24.550817 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:58:24.552445 [info ] [MainThread]: 
[0m11:58:24.553963 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.91 seconds (0.91s).
[0m11:58:24.556209 [debug] [MainThread]: Command end result
[0m11:58:24.605169 [info ] [MainThread]: 
[0m11:58:24.606802 [info ] [MainThread]: Completed successfully
[0m11:58:24.608366 [info ] [MainThread]: 
[0m11:58:24.609735 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:24.611888 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:24.611397 after 2.10 seconds
[0m11:58:24.615339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea05e27490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea01900dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79ea0194ee20>]}
[0m11:58:24.618354 [debug] [MainThread]: Flushing usage events
[0m11:58:30.450484 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634fbde400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e63505dcd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e63505dcdc0>]}


============================== 11:58:30.457654 | 5de428b2-a763-4946-bf2f-9106a45cef16 ==============================
[0m11:58:30.457654 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:30.458569 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:30.582999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e63505dcd90>]}
[0m11:58:30.613660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634e0efdc0>]}
[0m11:58:30.615073 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:30.640410 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:31.021651 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:31.022489 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:31.023506 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:31.031221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634deec7f0>]}
[0m11:58:31.059927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634e052af0>]}
[0m11:58:31.062263 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:31.063376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634e052a90>]}
[0m11:58:31.067589 [info ] [MainThread]: 
[0m11:58:31.069995 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:31.072543 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:31.086938 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:31.282949 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:31.287359 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:31.290766 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:31.291886 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:31.299930 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:31.302689 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:31.311740 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:31.368154 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:31.373751 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:31.379761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634c4b2c40>]}
[0m11:58:31.381295 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:31.382353 [info ] [MainThread]: 
[0m11:58:31.401038 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:58:31.402133 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:58:31.403333 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m11:58:31.404629 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:58:31.413985 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:58:31.428195 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:58:31.405219 => 11:58:31.427210
[0m11:58:31.429442 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:58:31.490322 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:58:31.511291 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:31.522037 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:31.526810 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:31.532086 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:58:31.542692 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:58:31.555220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:31.563002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:58:31.566450 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:31.592092 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:31.598232 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:31.606673 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:58:31.610242 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:31.612715 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:58:31.430409 => 11:58:31.612507
[0m11:58:31.613958 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5de428b2-a763-4946-bf2f-9106a45cef16', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634c27dee0>]}
[0m11:58:31.615417 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.21s]
[0m11:58:31.617123 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:58:31.620050 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:31.620860 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:31.621615 [debug] [MainThread]: On list__silver: Close
[0m11:58:31.622498 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:58:31.623302 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:58:31.624532 [info ] [MainThread]: 
[0m11:58:31.625939 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m11:58:31.627711 [debug] [MainThread]: Command end result
[0m11:58:31.655722 [info ] [MainThread]: 
[0m11:58:31.657540 [info ] [MainThread]: Completed successfully
[0m11:58:31.658753 [info ] [MainThread]: 
[0m11:58:31.659993 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:31.661512 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:31.661295 after 1.24 seconds
[0m11:58:31.662678 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634fbde400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634c3bf3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e634dececa0>]}
[0m11:58:31.663542 [debug] [MainThread]: Flushing usage events
[0m11:58:37.639353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ec1adf460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ec2562fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ec2562df0>]}


============================== 11:58:37.652226 | 194e98a0-532f-4c44-8454-09c114c17e2b ==============================
[0m11:58:37.652226 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:37.653824 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:37.800849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ec2562e50>]}
[0m11:58:37.838492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ec0022eb0>]}
[0m11:58:37.840105 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:37.841309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecf2af430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecfd12dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecfd12e50>]}


============================== 11:58:37.852962 | 51f33cb3-5e6a-41e4-a812-d1ea11430385 ==============================
[0m11:58:37.852962 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:37.854673 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:37.874612 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:38.016473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecfd12d60>]}
[0m11:58:38.018029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f91245f400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f912ea7d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f912ea7fd0>]}


============================== 11:58:38.033790 | 1b87cae9-4722-4dce-a5f4-6ec26cf060b6 ==============================
[0m11:58:38.033790 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:38.035699 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:38.059041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecd7f0e80>]}
[0m11:58:38.060968 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:38.095286 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:38.203597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f912ea7df0>]}
[0m11:58:38.242557 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f910970e50>]}
[0m11:58:38.245393 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:38.277820 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:38.292417 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:38.294840 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:38.297266 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:38.307111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebfe2c8b0>]}
[0m11:58:38.340838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebff92bb0>]}
[0m11:58:38.341973 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:38.343247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebff92b50>]}
[0m11:58:38.347705 [info ] [MainThread]: 
[0m11:58:38.350322 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:38.353389 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:38.374033 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:38.484809 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:38.485995 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:38.487753 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:38.499266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecd5ec880>]}
[0m11:58:38.529545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecd752b80>]}
[0m11:58:38.530922 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:38.532198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecd752b20>]}
[0m11:58:38.535666 [info ] [MainThread]: 
[0m11:58:38.537769 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:38.540122 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:38.562707 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:38.670510 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:38.676325 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:38.682781 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:38.689850 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:38.703872 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:38.707407 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:38.716711 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:38.721366 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:38.722587 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:38.725447 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:38.736735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f91076c850>]}
[0m11:58:38.770021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f9108d2b50>]}
[0m11:58:38.771662 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:38.773171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f9108d2af0>]}
[0m11:58:38.775191 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:38.777321 [info ] [MainThread]: 
[0m11:58:38.779356 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:38.782087 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:38.785292 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:38.792514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebde9f880>]}
[0m11:58:38.794934 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:38.796694 [info ] [MainThread]: 
[0m11:58:38.807460 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:38.822319 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:58:38.823823 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:58:38.825810 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:58:38.831201 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:58:38.844654 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:58:38.859789 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:58:38.832129 => 11:58:38.859145
[0m11:58:38.860189 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:38.861106 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:58:38.864551 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:38.869837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:38.871862 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:38.891547 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:38.895424 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:38.908107 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:38.968699 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:58:38.972601 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:38.981553 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:38.981533 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:38.986529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecc073cd0>]}
[0m11:58:38.988473 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:38.989643 [info ] [MainThread]: 
[0m11:58:38.999222 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:39.007015 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.013150 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:58:39.014595 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:58:39.016747 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:58:39.019052 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:58:39.020255 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:58:39.029652 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:58:39.036207 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:58:39.042340 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.052424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:58:39.052432 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:58:39.021080 => 11:58:39.051745
[0m11:58:39.053824 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:58:39.056881 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.099962 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:39.106377 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.122733 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:58:39.124139 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:39.127661 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.129572 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.132131 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:58:38.862068 => 11:58:39.131616
[0m11:58:39.133905 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '194e98a0-532f-4c44-8454-09c114c17e2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebd4b9e50>]}
[0m11:58:39.134547 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:39.135615 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.31s]
[0m11:58:39.141609 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:58:39.141670 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:39.147266 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:39.148693 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:39.149846 [debug] [MainThread]: On list__gold: Close
[0m11:58:39.151002 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:58:39.151844 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:58:39.152716 [info ] [MainThread]: 
[0m11:58:39.153788 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.80 seconds (0.80s).
[0m11:58:39.154698 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:39.155834 [debug] [MainThread]: Command end result
[0m11:58:39.158752 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:39.159338 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:58:39.168587 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.185210 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:39.200489 [info ] [MainThread]: 
[0m11:58:39.202178 [info ] [MainThread]: Completed successfully
[0m11:58:39.203679 [info ] [MainThread]: 
[0m11:58:39.205150 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:39.207477 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:39.207147 after 1.61 seconds
[0m11:58:39.212333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ec1adf460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebd61ecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x714ebfe0ed60>]}
[0m11:58:39.213924 [debug] [MainThread]: Flushing usage events
[0m11:58:39.214170 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:39.222396 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.235961 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:58:39.238902 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:39.248639 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.253534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f90ed32ca0>]}
[0m11:58:39.254716 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:58:39.255264 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:39.257032 [info ] [MainThread]: 
[0m11:58:39.267424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.276367 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:58:39.280180 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.284205 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:58:39.285552 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:58:39.287512 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:58:39.288529 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:58:39.301016 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:58:39.315425 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:58:39.289146 => 11:58:39.314723
[0m11:58:39.317047 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:58:39.317561 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:39.323920 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.336316 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:58:39.339902 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.343148 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:58:39.055116 => 11:58:39.342645
[0m11:58:39.345093 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51f33cb3-5e6a-41e4-a812-d1ea11430385', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aec6bfbe20>]}
[0m11:58:39.346996 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.33s]
[0m11:58:39.348633 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:58:39.353142 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:39.354040 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:39.354967 [debug] [MainThread]: On list__silver: Close
[0m11:58:39.356240 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:58:39.357204 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:58:39.358167 [info ] [MainThread]: 
[0m11:58:39.359247 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:58:39.361198 [debug] [MainThread]: Command end result
[0m11:58:39.388157 [info ] [MainThread]: 
[0m11:58:39.390283 [info ] [MainThread]: Completed successfully
[0m11:58:39.391901 [info ] [MainThread]: 
[0m11:58:39.393444 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:39.395830 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:39.395364 after 1.76 seconds
[0m11:58:39.397507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecf2af430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aecd5cfd30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74aec6daa4c0>]}
[0m11:58:39.398930 [debug] [MainThread]: Flushing usage events
[0m11:58:39.404794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:58:39.433261 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:58:39.449126 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:39.456505 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:39.463186 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:58:39.480021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:58:39.507541 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m11:58:39.517210 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:58:39.521225 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.560056 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:39.567874 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.579969 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:58:39.584537 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:39.587889 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:58:39.318075 => 11:58:39.587573
[0m11:58:39.590253 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b87cae9-4722-4dce-a5f4-6ec26cf060b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f90df79d90>]}
[0m11:58:39.591592 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.30s]
[0m11:58:39.592900 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:58:39.597951 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:39.599274 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:39.600088 [debug] [MainThread]: On list__silver: Close
[0m11:58:39.600949 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:58:39.601803 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:58:39.602790 [info ] [MainThread]: 
[0m11:58:39.603968 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.82 seconds (0.82s).
[0m11:58:39.605673 [debug] [MainThread]: Command end result
[0m11:58:39.635120 [info ] [MainThread]: 
[0m11:58:39.636810 [info ] [MainThread]: Completed successfully
[0m11:58:39.639405 [info ] [MainThread]: 
[0m11:58:39.640487 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:39.641785 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:39.641572 after 1.99 seconds
[0m11:58:39.642636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f91245f400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f91074ed00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73f90e7c6520>]}
[0m11:58:39.643963 [debug] [MainThread]: Flushing usage events
[0m11:58:45.835426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8be7884c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bf1f4e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bf205790>]}


============================== 11:58:45.842903 | 849d112f-9cab-48cf-886a-46bd19c12cce ==============================
[0m11:58:45.842903 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:45.844682 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:45.951261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bf1f4dc0>]}
[0m11:58:45.979996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bcca4f10>]}
[0m11:58:45.981468 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:46.012669 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:46.718088 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:46.719552 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:46.721053 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:46.729984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bcaaa910>]}
[0m11:58:46.769181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bcc09c10>]}
[0m11:58:46.770338 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:46.771428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bcc09bb0>]}
[0m11:58:46.773765 [info ] [MainThread]: 
[0m11:58:46.775539 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:46.778561 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:46.793536 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:46.990183 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:46.994206 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:46.998048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:46.999193 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:47.009053 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:47.012543 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:47.018988 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:47.059186 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:47.064283 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:47.067890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bab1f8e0>]}
[0m11:58:47.069426 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:47.070580 [info ] [MainThread]: 
[0m11:58:47.086007 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:58:47.087568 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:58:47.088606 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:58:47.089388 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:58:47.099371 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:58:47.111748 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:58:47.089987 => 11:58:47.111175
[0m11:58:47.112731 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:58:47.171433 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:58:47.193350 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:47.204972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:47.211280 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:47.218125 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:58:47.233240 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:58:47.245239 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:47.251782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:58:47.255292 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:47.282340 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:47.287863 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:47.296752 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:58:47.299437 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:47.301524 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:58:47.113262 => 11:58:47.301345
[0m11:58:47.302937 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '849d112f-9cab-48cf-886a-46bd19c12cce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8ba14d2e0>]}
[0m11:58:47.304183 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.21s]
[0m11:58:47.305773 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:58:47.309389 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:47.310334 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:47.311165 [debug] [MainThread]: On list__gold: Close
[0m11:58:47.311857 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:58:47.312569 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:58:47.313305 [info ] [MainThread]: 
[0m11:58:47.314089 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m11:58:47.315412 [debug] [MainThread]: Command end result
[0m11:58:47.339218 [info ] [MainThread]: 
[0m11:58:47.340449 [info ] [MainThread]: Completed successfully
[0m11:58:47.341513 [info ] [MainThread]: 
[0m11:58:47.342351 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:47.343874 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:47.343665 after 1.54 seconds
[0m11:58:47.345041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8be7884c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bca8edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73c8bab1fd90>]}
[0m11:58:47.346161 [debug] [MainThread]: Flushing usage events
[0m11:58:53.518697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764446bfe430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764447644dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764447644e50>]}
[0m11:58:53.518534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c605a1d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c60647dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c60647ddf0>]}


============================== 11:58:53.527393 | 17b9990f-58b7-48fc-8611-47aa4896d757 ==============================
[0m11:58:53.527393 [info ] [MainThread]: Running with dbt=1.5.9


============================== 11:58:53.527410 | fbb02194-7c51-423f-8552-f2332fc495b2 ==============================
[0m11:58:53.527410 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:53.528910 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:53.528908 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:53.532295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724ab13de490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724ab1e25dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724ab1e37790>]}


============================== 11:58:53.542339 | 6f26bce8-e10f-463d-99f4-a915b9a873eb ==============================
[0m11:58:53.542339 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:58:53.544205 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:58:53.687797 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c60647de50>]}
[0m11:58:53.689693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764447644d60>]}
[0m11:58:53.706568 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724ab1e25fd0>]}
[0m11:58:53.724362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c603f24eb0>]}
[0m11:58:53.727005 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:53.728570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7644450dbe80>]}
[0m11:58:53.730476 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:53.750321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aaf8ebee0>]}
[0m11:58:53.752235 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:58:53.758323 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:53.763876 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:53.784987 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:58:54.048079 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:54.048847 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:54.050205 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:54.060474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c603d2c8b0>]}
[0m11:58:54.076928 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:54.078232 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:58:54.078765 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:54.079413 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:58:54.080858 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:58:54.080711 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:58:54.091271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c603e89bb0>]}
[0m11:58:54.091781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764444eeb880>]}
[0m11:58:54.093004 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:54.093908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aaf6ec8e0>]}
[0m11:58:54.094972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c603e89b50>]}
[0m11:58:54.098659 [info ] [MainThread]: 
[0m11:58:54.100925 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:54.103791 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:54.130940 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:54.133643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aaf852be0>]}
[0m11:58:54.135218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764445052b80>]}
[0m11:58:54.135783 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:54.137207 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:58:54.137610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aaf852b80>]}
[0m11:58:54.138732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764445052b20>]}
[0m11:58:54.140396 [info ] [MainThread]: 
[0m11:58:54.141659 [info ] [MainThread]: 
[0m11:58:54.142686 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:54.144039 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:58:54.146330 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:54.148966 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:58:54.167681 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:54.173253 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:54.521599 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:54.527866 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:54.534876 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:54.537564 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:54.549576 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:54.556554 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:54.560898 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:58:54.565498 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:58:54.566651 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:54.561411 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:54.568570 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:54.572173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:58:54.573079 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:58:54.579506 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.574532 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:58:54.583681 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:54.588145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:54.599893 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.606166 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:54.608159 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:58:54.618874 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.648217 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:54.659553 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.665439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c6022f2d00>]}
[0m11:58:54.668617 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:54.670820 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:58:54.671913 [info ] [MainThread]: 
[0m11:58:54.680838 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.687068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aadcb1d30>]}
[0m11:58:54.689496 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:54.691259 [info ] [MainThread]: 
[0m11:58:54.692656 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:58:54.701674 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:58:54.703218 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.703400 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:58:54.706255 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_merchants)
[0m11:58:54.708545 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:58:54.710488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764444eb5b80>]}
[0m11:58:54.712969 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:58:54.714249 [info ] [MainThread]: 
[0m11:58:54.723777 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:58:54.725182 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:58:54.727683 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:58:54.728369 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:58:54.729261 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:58:54.741628 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:58:54.743413 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:58:54.747056 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m11:58:54.749361 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:58:54.750044 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:58:54.750525 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:58:54.709766 => 11:58:54.749886
[0m11:58:54.752392 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:58:54.767223 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:58:54.769501 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:58:54.730182 => 11:58:54.768872
[0m11:58:54.771056 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:58:54.784217 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:58:54.750331 => 11:58:54.783795
[0m11:58:54.785273 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:58:54.855200 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:58:54.871901 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.875479 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:58:54.882366 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:58:54.889990 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:54.892510 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:58:54.896377 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.895932 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.902207 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:58:54.907708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:54.912030 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:54.914300 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.920074 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:54.920711 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:58:54.931317 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:58:54.928276 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:58:54.976432 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:58:54.983575 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m11:58:55.008350 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:58:55.044217 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m11:58:55.045390 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:55.048828 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:58:55.068741 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:55.074547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:58:55.082790 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:55.088537 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:58:55.094146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:55.154544 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:55.162950 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:55.174715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:55.185069 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:58:55.185372 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:55.190665 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:58:55.193616 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:55.200783 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:58:54.753631 => 11:58:55.200334
[0m11:58:55.200921 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:58:55.202855 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '17b9990f-58b7-48fc-8611-47aa4896d757', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c6013dc940>]}
[0m11:58:55.204584 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.50s]
[0m11:58:55.207876 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:58:55.210577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:58:55.216778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:55.217079 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:55.218503 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:55.219822 [debug] [MainThread]: On list__silver: Close
[0m11:58:55.221157 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:58:55.221532 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:58:54.771957 => 11:58:55.220973
[0m11:58:55.222390 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:58:55.223446 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:58:55.223933 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6f26bce8-e10f-463d-99f4-a915b9a873eb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aacd7c760>]}
[0m11:58:55.224516 [info ] [MainThread]: 
[0m11:58:55.229377 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:58:55.229470 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.12 seconds (1.12s).
[0m11:58:55.230084 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.50s]
[0m11:58:55.232632 [debug] [MainThread]: Command end result
[0m11:58:55.234767 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:58:54.786063 => 11:58:55.234149
[0m11:58:55.241843 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:58:55.242101 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbb02194-7c51-423f-8552-f2332fc495b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76443e6b8df0>]}
[0m11:58:55.248344 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:55.250410 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.49s]
[0m11:58:55.249955 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:58:55.252618 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:58:55.254712 [debug] [MainThread]: On list__silver: Close
[0m11:58:55.259483 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:58:55.272526 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:58:55.266020 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:58:55.274705 [debug] [MainThread]: On list__gold: Close
[0m11:58:55.276942 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:58:55.277080 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:58:55.279354 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:58:55.279534 [info ] [MainThread]: 
[0m11:58:55.282190 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.14 seconds (1.14s).
[0m11:58:55.282374 [info ] [MainThread]: 
[0m11:58:55.285933 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.14 seconds (1.14s).
[0m11:58:55.286926 [debug] [MainThread]: Command end result
[0m11:58:55.288855 [debug] [MainThread]: Command end result
[0m11:58:55.316960 [info ] [MainThread]: 
[0m11:58:55.320008 [info ] [MainThread]: Completed successfully
[0m11:58:55.321989 [info ] [MainThread]: 
[0m11:58:55.332296 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:55.350570 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:55.350165 after 1.86 seconds
[0m11:58:55.353703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c605a1d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c6014fd4f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71c601d865e0>]}
[0m11:58:55.355857 [debug] [MainThread]: Flushing usage events
[0m11:58:55.463471 [info ] [MainThread]: 
[0m11:58:55.467159 [info ] [MainThread]: Completed successfully
[0m11:58:55.467700 [info ] [MainThread]: 
[0m11:58:55.469407 [info ] [MainThread]: 
[0m11:58:55.469593 [info ] [MainThread]: Completed successfully
[0m11:58:55.471286 [info ] [MainThread]: 
[0m11:58:55.471424 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:55.476755 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:55.476135 after 1.97 seconds
[0m11:58:55.473883 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:58:55.485394 [debug] [MainThread]: Command `dbt run` succeeded at 11:58:55.485005 after 2.00 seconds
[0m11:58:55.486219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724ab13de490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aaf8ebee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x724aacedfd60>]}
[0m11:58:55.487087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764446bfe430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76443e5169a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764444eced30>]}
[0m11:58:55.488700 [debug] [MainThread]: Flushing usage events
[0m11:58:55.489266 [debug] [MainThread]: Flushing usage events
[0m11:59:01.173354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d26434c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d300de80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d301f7f0>]}


============================== 11:59:01.181961 | 33986616-1ab7-41c4-a0a0-16fc4e87c6d0 ==============================
[0m11:59:01.181961 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:59:01.183225 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:59:01.300671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d300ddc0>]}
[0m11:59:01.330838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d0ba2f10>]}
[0m11:59:01.332700 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:59:01.360055 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:59:02.159758 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:02.161074 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:02.162440 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:59:02.171073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d09ab910>]}
[0m11:59:02.209472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d0b09c10>]}
[0m11:59:02.211719 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:59:02.213057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d0b09bb0>]}
[0m11:59:02.217495 [info ] [MainThread]: 
[0m11:59:02.220178 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:59:02.223420 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:59:02.244205 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:02.502931 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:59:02.509837 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:02.516791 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:59:02.519133 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:59:02.549114 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:59:02.553755 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:02.565695 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:02.626504 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:59:02.635569 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:02.639882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915ce9e08e0>]}
[0m11:59:02.642086 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:59:02.643616 [info ] [MainThread]: 
[0m11:59:02.664778 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m11:59:02.666271 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m11:59:02.667922 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m11:59:02.669483 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m11:59:02.682646 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m11:59:02.696889 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 11:59:02.670100 => 11:59:02.696328
[0m11:59:02.697863 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m11:59:02.755144 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m11:59:02.768234 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:02.779058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:02.784360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:02.789369 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m11:59:02.804227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m11:59:02.814514 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:02.820579 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m11:59:02.823835 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:02.848211 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:02.852531 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:02.860639 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m11:59:02.863371 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:02.866162 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 11:59:02.698726 => 11:59:02.865954
[0m11:59:02.867718 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '33986616-1ab7-41c4-a0a0-16fc4e87c6d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915cdff6eb0>]}
[0m11:59:02.869144 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.20s]
[0m11:59:02.870427 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m11:59:02.873282 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:02.874086 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:59:02.874899 [debug] [MainThread]: On list__gold: Close
[0m11:59:02.875836 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m11:59:02.876639 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m11:59:02.877737 [info ] [MainThread]: 
[0m11:59:02.878514 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.66 seconds (0.66s).
[0m11:59:02.879755 [debug] [MainThread]: Command end result
[0m11:59:02.905699 [info ] [MainThread]: 
[0m11:59:02.907355 [info ] [MainThread]: Completed successfully
[0m11:59:02.908679 [info ] [MainThread]: 
[0m11:59:02.910400 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:59:02.911605 [debug] [MainThread]: Command `dbt run` succeeded at 11:59:02.911451 after 1.78 seconds
[0m11:59:02.912761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d26434c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915d098edc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7915ce9c4640>]}
[0m11:59:02.914154 [debug] [MainThread]: Flushing usage events
[0m11:59:09.493309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5550ef3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c555b4ed60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c555b4edf0>]}


============================== 11:59:09.502086 | 0872d300-f97b-44e2-9699-9c58ef865c55 ==============================
[0m11:59:09.502086 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:59:09.503746 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:59:09.653548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c555b4edc0>]}
[0m11:59:09.692467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5535efdf0>]}
[0m11:59:09.695042 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:59:09.726624 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:59:09.789513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41b0be400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41ba4dd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41ba4dfd0>]}


============================== 11:59:09.799711 | e174eb46-c090-4e08-9e37-e9f3ae3a3d44 ==============================
[0m11:59:09.799711 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:59:09.800880 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:59:09.951071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41ba4ddf0>]}
[0m11:59:09.983854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df4195dde50>]}
[0m11:59:09.985599 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:59:09.987480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761461483430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761461f0fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761461f0fe50>]}


============================== 11:59:09.995801 | 5ed921f6-3f25-4f0b-a27b-bc2c45277d0f ==============================
[0m11:59:09.995801 [info ] [MainThread]: Running with dbt=1.5.9
[0m11:59:09.996902 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m11:59:10.012311 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:59:10.131411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761461f0fd60>]}
[0m11:59:10.153324 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:10.154442 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:10.156302 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:59:10.166069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145f9dbe80>]}
[0m11:59:10.167384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5533ec820>]}
[0m11:59:10.167312 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m11:59:10.222550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c553552b20>]}
[0m11:59:10.224749 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:59:10.227346 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m11:59:10.226667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c553552ac0>]}
[0m11:59:10.240645 [info ] [MainThread]: 
[0m11:59:10.252253 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:59:10.269592 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:59:10.340059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:10.678516 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:10.679523 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:10.681095 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.bronze
- models.ck_project.gold.fact
[0m11:59:10.692321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df4193eb850>]}
[0m11:59:10.730626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41955ab50>]}
[0m11:59:10.732329 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:59:10.733752 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41955aaf0>]}
[0m11:59:10.737314 [info ] [MainThread]: 
[0m11:59:10.739023 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:59:10.741630 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:59:10.765403 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:10.766742 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:59:10.771432 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:10.778492 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m11:59:10.779916 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m11:59:10.792969 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:59:10.796963 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:10.805794 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:10.861312 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:59:10.869229 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:10.873401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5533b5c10>]}
[0m11:59:10.876458 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:59:10.877601 [info ] [MainThread]: 
[0m11:59:10.901090 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m11:59:10.902503 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m11:59:10.905318 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m11:59:10.906806 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m11:59:10.920261 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m11:59:10.925878 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:59:10.926888 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:59:10.928806 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 2 unused configuration paths:
- models.ck_project.gold.fact
- models.ck_project.bronze
[0m11:59:10.934729 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 11:59:10.907748 => 11:59:10.934254
[0m11:59:10.936191 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m11:59:10.940987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145f7ec880>]}
[0m11:59:10.981201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145f952b80>]}
[0m11:59:10.982855 [info ] [MainThread]: Found 7 models, 17 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m11:59:10.986063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145f952b20>]}
[0m11:59:10.988815 [info ] [MainThread]: 
[0m11:59:10.991178 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m11:59:10.996867 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m11:59:11.022859 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:11.077278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m11:59:11.085914 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:59:11.092603 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.101223 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:59:11.104806 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:59:11.108973 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:59:11.133413 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:59:11.137526 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:11.138641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:11.146957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.148192 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.157523 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m11:59:11.178988 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m11:59:11.224052 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m11:59:11.233267 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:59:11.240496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m11:59:11.245284 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.245591 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.251762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df413935ca0>]}
[0m11:59:11.253820 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:59:11.256411 [info ] [MainThread]: 
[0m11:59:11.285886 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m11:59:11.287721 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m11:59:11.289655 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m11:59:11.291315 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m11:59:11.303790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:11.311181 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m11:59:11.312372 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.329016 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 11:59:11.292294 => 11:59:11.328259
[0m11:59:11.330714 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m11:59:11.334561 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m11:59:11.339700 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.343281 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 11:59:10.937037 => 11:59:11.342928
[0m11:59:11.345036 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0872d300-f97b-44e2-9699-9c58ef865c55', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c550a83f70>]}
[0m11:59:11.347085 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.44s]
[0m11:59:11.349321 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m11:59:11.354366 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:11.355997 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m11:59:11.357378 [debug] [MainThread]: On list__gold: Close
[0m11:59:11.358738 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m11:59:11.359887 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m11:59:11.361324 [info ] [MainThread]: 
[0m11:59:11.362529 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.11 seconds (1.11s).
[0m11:59:11.365374 [debug] [MainThread]: Command end result
[0m11:59:11.401235 [info ] [MainThread]: 
[0m11:59:11.403281 [info ] [MainThread]: Completed successfully
[0m11:59:11.405670 [info ] [MainThread]: 
[0m11:59:11.409286 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:59:11.412640 [debug] [MainThread]: Command `dbt run` succeeded at 11:59:11.411615 after 1.96 seconds
[0m11:59:11.415037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5550ef3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c5533cecd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79c551445550>]}
[0m11:59:11.417297 [debug] [MainThread]: Flushing usage events
[0m11:59:11.463057 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m11:59:11.468346 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.473821 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m11:59:11.481345 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m11:59:11.476360 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m11:59:11.488121 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m11:59:11.492832 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:11.497944 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:59:11.503211 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.517705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:11.524419 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.532643 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m11:59:11.553173 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m11:59:11.571732 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m11:59:11.575739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m11:59:11.589944 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.595504 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m11:59:11.598783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145dd72cd0>]}
[0m11:59:11.600456 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.600817 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:59:11.601948 [info ] [MainThread]: 
[0m11:59:11.636498 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m11:59:11.638276 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m11:59:11.639905 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m11:59:11.641221 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m11:59:11.652322 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:11.660456 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.661954 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m11:59:11.680227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m11:59:11.681021 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 11:59:11.642244 => 11:59:11.680512
[0m11:59:11.682170 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m11:59:11.683852 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.687343 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 11:59:11.331967 => 11:59:11.687055
[0m11:59:11.689006 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e174eb46-c090-4e08-9e37-e9f3ae3a3d44', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df4129fe6a0>]}
[0m11:59:11.690721 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.40s]
[0m11:59:11.693535 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m11:59:11.698276 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:11.699308 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:59:11.700177 [debug] [MainThread]: On list__silver: Close
[0m11:59:11.701195 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m11:59:11.702027 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m11:59:11.703110 [info ] [MainThread]: 
[0m11:59:11.704599 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.96 seconds (0.96s).
[0m11:59:11.706750 [debug] [MainThread]: Command end result
[0m11:59:11.735562 [info ] [MainThread]: 
[0m11:59:11.737591 [info ] [MainThread]: Completed successfully
[0m11:59:11.739278 [info ] [MainThread]: 
[0m11:59:11.740948 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:59:11.742671 [debug] [MainThread]: Command `dbt run` succeeded at 11:59:11.742447 after 2.22 seconds
[0m11:59:11.744029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df41b0be400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df4193ced00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df413935ca0>]}
[0m11:59:11.745568 [debug] [MainThread]: Flushing usage events
[0m11:59:11.804901 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m11:59:11.819847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.834760 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:11.842385 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.848740 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m11:59:11.866113 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m11:59:11.879214 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.887668 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m11:59:11.892974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.943877 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m11:59:11.951704 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m11:59:11.966368 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m11:59:11.970161 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m11:59:11.973511 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 11:59:11.683133 => 11:59:11.973210
[0m11:59:11.975301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5ed921f6-3f25-4f0b-a27b-bc2c45277d0f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145ce436d0>]}
[0m11:59:11.977220 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.34s]
[0m11:59:11.978715 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m11:59:11.982284 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:11.983326 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m11:59:11.984419 [debug] [MainThread]: On list__silver: Close
[0m11:59:11.985916 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m11:59:11.987190 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m11:59:11.988474 [info ] [MainThread]: 
[0m11:59:11.990038 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.00 seconds (1.00s).
[0m11:59:11.991711 [debug] [MainThread]: Command end result
[0m11:59:12.027818 [info ] [MainThread]: 
[0m11:59:12.031915 [info ] [MainThread]: Completed successfully
[0m11:59:12.038694 [info ] [MainThread]: 
[0m11:59:12.040710 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:59:12.043029 [debug] [MainThread]: Command `dbt run` succeeded at 11:59:12.042711 after 2.51 seconds
[0m11:59:12.044715 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x761461483430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145cfcddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76145cfe45b0>]}
[0m11:59:12.046515 [debug] [MainThread]: Flushing usage events
[0m12:56:17.248123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ae2064f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2aebace80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2aebc0790>]}


============================== 12:56:17.261783 | 725f71a4-c41a-4784-ae32-b5ef8c38bb74 ==============================
[0m12:56:17.261783 [info ] [MainThread]: Running with dbt=1.5.9
[0m12:56:17.248295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737760a983a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7377614c9cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7377614c9d60>]}
[0m12:56:17.249153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d9083e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d91279d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d91279df0>]}
[0m12:56:17.248863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d2472f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d250c3fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d250c3df0>]}
[0m12:56:17.263393 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}


============================== 12:56:17.264029 | 8fe5685f-48d9-4991-b248-1d838044fb41 ==============================
[0m12:56:17.264029 [info ] [MainThread]: Running with dbt=1.5.9
[0m12:56:17.265614 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}


============================== 12:56:17.265024 | c9d7589d-9815-4c0f-a058-5e966cb98e7c ==============================
[0m12:56:17.265024 [info ] [MainThread]: Running with dbt=1.5.9


============================== 12:56:17.265817 | 10b05b27-e1f9-4610-b1e2-3ff63ac2a22d ==============================
[0m12:56:17.265817 [info ] [MainThread]: Running with dbt=1.5.9
[0m12:56:17.267195 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m12:56:17.267823 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m12:56:17.452211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '725f71a4-c41a-4784-ae32-b5ef8c38bb74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2aebace50>]}
[0m12:56:17.453680 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8fe5685f-48d9-4991-b248-1d838044fb41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d91279dc0>]}
[0m12:56:17.465967 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c9d7589d-9815-4c0f-a058-5e966cb98e7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7377614c9d30>]}
[0m12:56:17.469282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '10b05b27-e1f9-4610-b1e2-3ff63ac2a22d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d250c3e50>]}
[0m12:56:17.510462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8fe5685f-48d9-4991-b248-1d838044fb41', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d8ed29df0>]}
[0m12:56:17.512039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '725f71a4-c41a-4784-ae32-b5ef8c38bb74', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ac722d90>]}
[0m12:56:17.512337 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m12:56:17.514177 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m12:56:17.517835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c9d7589d-9815-4c0f-a058-5e966cb98e7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73775efb1d60>]}
[0m12:56:17.520028 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m12:56:17.526877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '10b05b27-e1f9-4610-b1e2-3ff63ac2a22d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d22c28eb0>]}
[0m12:56:17.529969 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m12:56:17.552793 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m12:56:17.552920 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m12:56:17.561701 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m12:56:17.568627 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m12:56:18.276826 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m12:56:18.277465 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m12:56:18.279475 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m12:56:18.280177 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m12:56:18.280773 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m12:56:18.280880 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m12:56:18.281848 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m12:56:18.283040 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m12:56:18.282788 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m12:56:18.343857 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m12:56:18.345602 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m12:56:18.347716 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m12:56:18.353058 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m12:56:18.353925 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m12:56:18.355382 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m12:56:18.383648 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m12:56:18.385192 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m12:56:18.387590 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m12:56:18.399923 [error] [MainThread]: Encountered an error:
Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)
[0m12:56:18.402457 [error] [MainThread]: Encountered an error:
Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)
[0m12:56:18.405046 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 86, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 71, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 142, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 168, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 215, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 242, in wrapper
    manifest = ManifestLoader.get_full_manifest(
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 227, in get_full_manifest
    manifest = loader.load()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 446, in load
    self.write_manifest_for_partial_parse()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 593, in write_manifest_for_partial_parse
    manifest_msgpack = self.manifest.to_msgpack()
  File "<string>", line 12, in to_msgpack
  File "<string>", line 12, in <dictcomp>
  File "<string>", line 10, in __pack_union_Manifest_files__b0c7549d1e4f46738419a4a4ab465db3
mashumaro.exceptions.InvalidFieldValue: Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)

[0m12:56:18.404951 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 86, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 71, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 142, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 168, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 215, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 242, in wrapper
    manifest = ManifestLoader.get_full_manifest(
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 227, in get_full_manifest
    manifest = loader.load()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 446, in load
    self.write_manifest_for_partial_parse()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 593, in write_manifest_for_partial_parse
    manifest_msgpack = self.manifest.to_msgpack()
  File "<string>", line 12, in to_msgpack
  File "<string>", line 12, in <dictcomp>
  File "<string>", line 10, in __pack_union_Manifest_files__7b794a42fd7e4743847ab782a7fe91a4
mashumaro.exceptions.InvalidFieldValue: Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)

[0m12:56:18.407561 [debug] [MainThread]: Command `dbt run` failed at 12:56:18.407274 after 1.29 seconds
[0m12:56:18.407594 [debug] [MainThread]: Command `dbt run` failed at 12:56:18.407270 after 1.29 seconds
[0m12:56:18.407705 [error] [MainThread]: Encountered an error:
Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)
[0m12:56:18.408722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d9083e430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d8eb33b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7d9d8eb33f40>]}
[0m12:56:18.408922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737760a983a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73775edb1ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73775edb1eb0>]}
[0m12:56:18.409370 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m12:56:18.410023 [debug] [MainThread]: Flushing usage events
[0m12:56:18.410639 [debug] [MainThread]: Flushing usage events
[0m12:56:18.411340 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 86, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 71, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 142, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 168, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 215, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 242, in wrapper
    manifest = ManifestLoader.get_full_manifest(
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 227, in get_full_manifest
    manifest = loader.load()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 446, in load
    self.write_manifest_for_partial_parse()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 593, in write_manifest_for_partial_parse
    manifest_msgpack = self.manifest.to_msgpack()
  File "<string>", line 12, in to_msgpack
  File "<string>", line 12, in <dictcomp>
  File "<string>", line 10, in __pack_union_Manifest_files__63466fcf00574b9d97077024f03cfdcc
mashumaro.exceptions.InvalidFieldValue: Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)

[0m12:56:18.414463 [debug] [MainThread]: Command `dbt run` failed at 12:56:18.414128 after 1.29 seconds
[0m12:56:18.415856 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ae2064f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ac5340d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ca2ac532c70>]}
[0m12:56:18.418857 [debug] [MainThread]: Flushing usage events
[0m12:56:18.443459 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m12:56:18.462416 [error] [MainThread]: Encountered an error:
Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)
[0m12:56:18.464741 [error] [MainThread]: Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 86, in wrapper
    result, success = func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 71, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 142, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 168, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 215, in wrapper
    return func(*args, **kwargs)
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/cli/requires.py", line 242, in wrapper
    manifest = ManifestLoader.get_full_manifest(
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 227, in get_full_manifest
    manifest = loader.load()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 446, in load
    self.write_manifest_for_partial_parse()
  File "/home/airflow/.local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 593, in write_manifest_for_partial_parse
    manifest_msgpack = self.manifest.to_msgpack()
  File "<string>", line 12, in to_msgpack
  File "<string>", line 12, in <dictcomp>
  File "<string>", line 10, in __pack_union_Manifest_files__76d48f839c9541458c50e7b739af8ca6
mashumaro.exceptions.InvalidFieldValue: Field "files" of type Union[SchemaSourceFile, SourceFile] in Manifest has invalid value SchemaSourceFile(path=FilePath(searched_path='models', relative_path='gold/fact/_schema.yml', modification_time=1762087704.6880863, project_root='/opt/airflow/dbt_project'), checksum=FileHash(name='sha256', checksum='e2e3f595ee7565079c6d59a1b282b245fa3b477bcda17aa75ccf66bd7e405266'), project_name='ck_project', parse_file_type=<ParseFileType.Schema: 'schema'>, contents='- name: fact_transactions\r\n  description: "Transaction ↔ payment evaluation fact"\r\n  columns:\r\n    - name: surrogate_key\r\n      tests: [not_null, unique]\r\n    - name: transactions_id\r\n      tests: [not_null]\r\n    - name: payment_reference\r\n    - name: state_sk\r\n    - name: merchant_sk\r\n    - name: payment_method_sk\r\n    - name: IsSuccessfulFinalPayment\r\n    - name: TimeBetweenInitiationAndPaymentMinutes\r\n    - name: datekey\r\n      tests: [not_null]', dfy=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], tests={}, sources=[], exposures=[], metrics=[], groups=[], ndp=[], mcp={}, sop=[], env_vars={}, pp_dict=[{'name': 'fact_transactions', 'description': 'Transaction ↔ payment evaluation fact', 'columns': [{'name': 'surrogate_key', 'tests': ['not_null', 'unique']}, {'name': 'transactions_id', 'tests': ['not_null']}, {'name': 'payment_reference'}, {'name': 'state_sk'}, {'name': 'merchant_sk'}, {'name': 'payment_method_sk'}, {'name': 'IsSuccessfulFinalPayment'}, {'name': 'TimeBetweenInitiationAndPaymentMinutes'}, {'name': 'datekey', 'tests': ['not_null']}]}], pp_test_index=None)

[0m12:56:18.467186 [debug] [MainThread]: Command `dbt run` failed at 12:56:18.466884 after 1.35 seconds
[0m12:56:18.468296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d2472f460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d22983e80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x726d22a31fa0>]}
[0m12:56:18.470091 [debug] [MainThread]: Flushing usage events
[0m13:01:32.714731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776983a83400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776984455d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776984455fd0>]}


============================== 13:01:32.739716 | b8333042-3eba-406f-9fdf-36505ba99c81 ==============================
[0m13:01:32.739716 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:01:32.743329 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:01:33.070143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776984455df0>]}
[0m13:01:33.075162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd45a7460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd5005e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd5005df0>]}
[0m13:01:33.075609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b0908de3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b09136ed30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b09136edc0>]}


============================== 13:01:33.094944 | 3b5cce05-277c-415f-8cc5-d807e857974e ==============================
[0m13:01:33.094944 [info ] [MainThread]: Running with dbt=1.5.9


============================== 13:01:33.094907 | a8d29b2a-4325-4d7e-8bb0-48c61505d4bf ==============================
[0m13:01:33.094907 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:01:33.097544 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:01:33.097686 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:01:33.176363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981ff0e50>]}
[0m13:01:33.178992 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:01:33.277061 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:01:33.704633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b09136ed90>]}
[0m13:01:33.779761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd5005e80>]}
[0m13:01:33.852161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08ee2fdc0>]}
[0m13:01:33.866418 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:01:34.039992 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd2aa4eb0>]}
[0m13:01:34.043509 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:01:34.051764 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:01:34.183906 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:01:34.765250 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m13:01:34.767552 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m13:01:34.769822 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m13:01:34.881459 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:01:34.905687 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m13:01:34.908854 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m13:01:34.910878 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m13:01:34.943144 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:01:35.026684 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m13:01:35.034503 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/_schema.yml
[0m13:01:35.036861 [debug] [MainThread]: Partial parsing: added file: ck_project://models/gold/fact/fact_transactions.sql
[0m13:01:35.048266 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:01:35.104681 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:01:35.157896 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:01:35.198289 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:01:35.226846 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:01:35.230863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981d627f0>]}
[0m13:01:35.379405 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:01:35.418598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08eba8790>]}
[0m13:01:35.428430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981de1f10>]}
[0m13:01:35.432273 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:01:35.438894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981de1ee0>]}
[0m13:01:35.451337 [info ] [MainThread]: 
[0m13:01:35.460317 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:01:35.465897 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:01:35.506808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08ec21dc0>]}
[0m13:01:35.509969 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:01:35.512019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08ec21df0>]}
[0m13:01:35.515199 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:35.518881 [info ] [MainThread]: 
[0m13:01:35.523540 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:01:35.529002 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:01:35.544829 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:01:35.564466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd282c850>]}
[0m13:01:35.566829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:35.618888 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd28a66a0>]}
[0m13:01:35.621673 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:01:35.623756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd28a65e0>]}
[0m13:01:35.629327 [info ] [MainThread]: 
[0m13:01:35.632461 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:01:35.637483 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:01:35.674003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:36.090917 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:01:36.101116 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:36.110222 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:01:36.112642 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:01:36.119149 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:36.115841 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m13:01:36.127335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:01:36.129923 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m13:01:36.152106 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:01:36.149073 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:01:36.156333 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:36.160564 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:36.163093 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:01:36.171278 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:36.176314 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:01:36.180511 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m13:01:36.201928 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:01:36.201703 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:01:36.277481 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:36.268440 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:01:36.319322 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:01:36.323554 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:01:36.344784 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:01:36.359074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981c98790>]}
[0m13:01:36.366225 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:01:36.369158 [info ] [MainThread]: 
[0m13:01:36.373451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:01:36.394289 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:01:36.404918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08ec27940>]}
[0m13:01:36.411630 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:01:36.414415 [info ] [MainThread]: 
[0m13:01:36.427989 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m13:01:36.431050 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m13:01:36.434726 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m13:01:36.440342 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m13:01:36.452173 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:01:36.470933 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m13:01:36.472545 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:01:36.476202 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m13:01:36.476847 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m13:01:36.480394 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m13:01:36.485015 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd27597f0>]}
[0m13:01:36.484556 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m13:01:36.488534 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:01:36.492739 [info ] [MainThread]: 
[0m13:01:36.516102 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m13:01:36.542528 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 13:01:36.442693 => 13:01:36.540975
[0m13:01:36.545254 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m13:01:36.545397 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m13:01:36.548332 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m13:01:36.551548 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m13:01:36.553787 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m13:01:36.564853 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 13:01:36.487039 => 13:01:36.563599
[0m13:01:36.567159 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m13:01:36.600692 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m13:01:36.666961 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 13:01:36.556013 => 13:01:36.666013
[0m13:01:36.669260 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m13:01:36.731932 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m13:01:36.765714 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m13:01:36.770504 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:01:36.811925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:01:36.835836 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:01:36.851928 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:36.859638 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:01:36.867635 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m13:01:36.871971 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:36.880923 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m13:01:36.886379 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m13:01:36.917073 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:01:36.930510 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m13:01:36.948835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m13:01:36.965080 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:01:36.968460 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:01:36.984347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:01:37.003788 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m13:01:37.003020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m13:01:37.019128 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.042982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m13:01:37.062112 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m13:01:37.076011 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.080528 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m13:01:37.118708 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:01:37.126423 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:01:37.137419 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m13:01:37.138999 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.143352 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:01:37.163272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m13:01:37.168592 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:01:37.172104 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:01:37.173343 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 13:01:36.547085 => 13:01:37.172834
[0m13:01:37.176038 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8333042-3eba-406f-9fdf-36505ba99c81', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776980209d30>]}
[0m13:01:37.181284 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.74s]
[0m13:01:37.183390 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.183896 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m13:01:37.190606 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:37.191886 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m13:01:37.193699 [debug] [MainThread]: On list__silver: Close
[0m13:01:37.195985 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m13:01:37.197613 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m13:01:37.199563 [info ] [MainThread]: 
[0m13:01:37.201395 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.74 seconds (1.74s).
[0m13:01:37.204660 [debug] [MainThread]: Command end result
[0m13:01:37.204790 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m13:01:37.213134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.213875 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:01:37.219159 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 13:01:36.568916 => 13:01:37.218568
[0m13:01:37.222497 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b5cce05-277c-415f-8cc5-d807e857974e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08c390ca0>]}
[0m13:01:37.226611 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.74s]
[0m13:01:37.231992 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.233908 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m13:01:37.243854 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:37.247313 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m13:01:37.250376 [debug] [MainThread]: On list__gold: Close
[0m13:01:37.252215 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m13:01:37.254138 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m13:01:37.258521 [info ] [MainThread]: 
[0m13:01:37.262581 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.74 seconds (1.74s).
[0m13:01:37.267936 [debug] [MainThread]: Command end result
[0m13:01:37.270406 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m13:01:37.281894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:01:37.287932 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 13:01:36.670491 => 13:01:37.287097
[0m13:01:37.291877 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8d29b2a-4325-4d7e-8bb0-48c61505d4bf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764ccbfd7d60>]}
[0m13:01:37.296826 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.74s]
[0m13:01:37.299915 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m13:01:37.307946 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:37.310734 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m13:01:37.312326 [debug] [MainThread]: On list__silver: Close
[0m13:01:37.314179 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m13:01:37.316466 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m13:01:37.322531 [info ] [MainThread]: 
[0m13:01:37.325721 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 1.69 seconds (1.69s).
[0m13:01:37.327170 [info ] [MainThread]: 
[0m13:01:37.329910 [debug] [MainThread]: Command end result
[0m13:01:37.330227 [info ] [MainThread]: Completed successfully
[0m13:01:37.336751 [info ] [MainThread]: 
[0m13:01:37.341432 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:01:37.344888 [debug] [MainThread]: Command `dbt run` succeeded at 13:01:37.344429 after 4.70 seconds
[0m13:01:37.346744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776983a83400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981df2f70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x776981df4940>]}
[0m13:01:37.348419 [debug] [MainThread]: Flushing usage events
[0m13:01:37.369767 [info ] [MainThread]: 
[0m13:01:37.372502 [info ] [MainThread]: Completed successfully
[0m13:01:37.375610 [info ] [MainThread]: 
[0m13:01:37.378303 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:01:37.381526 [debug] [MainThread]: Command `dbt run` succeeded at 13:01:37.380916 after 4.40 seconds
[0m13:01:37.383635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b0908de3a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08ec33f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b08ec3a8e0>]}
[0m13:01:37.386266 [debug] [MainThread]: Flushing usage events
[0m13:01:37.421209 [info ] [MainThread]: 
[0m13:01:37.423365 [info ] [MainThread]: Completed successfully
[0m13:01:37.427435 [info ] [MainThread]: 
[0m13:01:37.430069 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:01:37.433209 [debug] [MainThread]: Command `dbt run` succeeded at 13:01:37.432673 after 4.42 seconds
[0m13:01:37.435018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd45a7460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd28afe80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x764cd281d820>]}
[0m13:01:37.437296 [debug] [MainThread]: Flushing usage events
[0m13:08:05.051552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb1053e490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb10f98dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb10fa9790>]}


============================== 13:08:05.072300 | 4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b ==============================
[0m13:08:05.072300 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:08:05.076003 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:08:05.444350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb10f98e20>]}
[0m13:08:05.527173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0ea62ee0>]}
[0m13:08:05.531210 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:08:05.568805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7bdbe460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7c73afd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7c73adf0>]}


============================== 13:08:05.590567 | 4f4127d4-80e6-49ad-b55f-5de175661fe7 ==============================
[0m13:08:05.590567 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:08:05.596352 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:08:05.599376 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:08:05.613849 [debug] [MainThread]: Partial parsing not enabled
[0m13:08:05.899540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77ff27430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b7808c9dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b7808c9e50>]}


============================== 13:08:05.926164 | 51402792-ffb5-4a43-b947-7665e0f159d2 ==============================
[0m13:08:05.926164 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:08:05.929384 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:08:06.008718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7c73ae50>]}
[0m13:08:06.148095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7a29beb0>]}
[0m13:08:06.151309 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:08:06.257692 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:08:06.314111 [debug] [MainThread]: Partial parsing not enabled
[0m13:08:06.276111 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738ee5d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738f8bcd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738f8bcfd0>]}


============================== 13:08:06.325667 | 7a810e8c-44b8-4e33-b534-121594d4f23e ==============================
[0m13:08:06.325667 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:08:06.331910 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:08:06.431120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b7808c9d60>]}
[0m13:08:06.575716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77e45de80>]}
[0m13:08:06.578938 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:08:06.663539 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:08:06.679017 [debug] [MainThread]: Partial parsing not enabled
[0m13:08:06.788220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738f8bcdf0>]}
[0m13:08:06.925144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738d35de50>]}
[0m13:08:06.929501 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:08:06.999025 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:08:07.017545 [debug] [MainThread]: Partial parsing not enabled
[0m13:08:10.244474 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:08:10.283559 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:08:10.295147 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:08:10.319011 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:08:10.328273 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:08:10.341921 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:08:10.358017 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:08:10.405552 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:08:10.417280 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:08:10.447830 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:08:10.455098 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:08:10.537490 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:08:10.545522 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:08:10.551648 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:08:10.584805 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:08:10.587172 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:08:10.597768 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:08:10.618902 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:08:10.628105 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:08:10.644066 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:08:10.663075 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:08:10.707581 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:08:10.717936 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:08:10.748554 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:08:10.754770 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:08:10.773985 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:08:10.807298 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:08:10.820639 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:08:10.847499 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:08:10.857559 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:08:10.873733 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:08:10.876329 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:08:10.889819 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:08:10.892545 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:08:10.932514 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:08:10.946277 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:08:10.959396 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:08:10.996472 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:08:11.015193 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:08:11.114898 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:08:11.123875 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:08:11.168998 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:08:11.199015 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:08:11.241751 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:08:11.254566 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:08:11.286505 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:08:11.298229 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:08:11.320314 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:08:11.335137 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:08:11.382892 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:08:11.393408 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:08:11.428780 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:08:11.439236 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:08:11.466912 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:08:11.506634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0e8c5a30>]}
[0m13:08:11.556039 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:08:11.566473 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:08:11.604121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0eadbbe0>]}
[0m13:08:11.606540 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:08:11.615532 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:08:11.616305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0eadb7f0>]}
[0m13:08:11.627825 [info ] [MainThread]: 
[0m13:08:11.633721 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:08:11.640753 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:08:11.679377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:11.869395 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:08:11.900327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7a108c10>]}
[0m13:08:11.999853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7a0d0340>]}
[0m13:08:12.010372 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:08:12.016013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7a1437f0>]}
[0m13:08:12.024141 [info ] [MainThread]: 
[0m13:08:12.029690 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:08:12.036550 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:08:12.061854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:12.148547 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:08:12.174964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77e35af70>]}
[0m13:08:12.280303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77e4dcbb0>]}
[0m13:08:12.287364 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:08:12.290193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77e4dc790>]}
[0m13:08:12.296478 [info ] [MainThread]: 
[0m13:08:12.300909 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:08:12.308226 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:08:12.339622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:12.433415 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:08:12.443702 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:12.453682 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:08:12.458012 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m13:08:12.512557 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:12.509966 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:08:12.537966 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:12.541630 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:08:12.571429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738d1c0460>]}
[0m13:08:12.656052 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:08:12.682990 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:12.698159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738d190670>]}
[0m13:08:12.703134 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:08:12.705981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738d246fd0>]}
[0m13:08:12.706605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0c2268b0>]}
[0m13:08:12.710991 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:12.711398 [info ] [MainThread]: 
[0m13:08:12.713713 [info ] [MainThread]: 
[0m13:08:12.715527 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:08:12.722116 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:08:12.745753 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:12.771212 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m13:08:12.773895 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m13:08:12.778801 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_date)
[0m13:08:12.780932 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m13:08:12.814053 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:08:12.819892 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m13:08:12.824107 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:12.838393 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:08:12.856947 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 13:08:12.782723 => 13:08:12.855550
[0m13:08:12.861480 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m13:08:12.847835 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m13:08:12.878391 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:08:12.883550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:12.903882 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:13.021001 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:08:13.042166 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:13.054170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c79fe6f10>]}
[0m13:08:13.065663 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:13.070210 [info ] [MainThread]: 
[0m13:08:13.131813 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date__dbt_backup
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m13:08:13.139158 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m13:08:13.141963 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m13:08:13.147550 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m13:08:13.156635 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m13:08:13.163894 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:08:13.173693 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:13.179071 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:08:13.190206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:08:13.199412 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m13:08:13.200683 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m13:08:13.226171 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:13.245515 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:13.244431 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:08:13.250600 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:13.273493 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:13.272965 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m13:08:13.277960 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 13:08:13.159368 => 13:08:13.275801
[0m13:08:13.281479 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m13:08:13.323440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date__dbt_backup
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m13:08:13.368321 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:08:13.391745 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */
EXCHANGE TABLES gold.dim_date__dbt_backup AND gold.dim_date 
  
  ...
[0m13:08:13.401973 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:08:13.414832 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:08:13.431452 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:13.438691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b75722edc0>]}
[0m13:08:13.441579 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:13.445077 [info ] [MainThread]: 
[0m13:08:13.496763 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m13:08:13.499379 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m13:08:13.503291 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m13:08:13.503527 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:13.505408 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m13:08:13.516625 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:13.522010 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m13:08:13.529080 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:08:13.541484 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:13.550569 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m13:08:13.553308 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:13.553245 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:08:13.559242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    drop table if exists gold.dim_date__dbt_backup 
  ...
[0m13:08:13.556908 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m13:08:13.569617 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:08:13.575883 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 13:08:12.863610 => 13:08:13.575126
[0m13:08:13.581949 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4ebdf218-d414-4fcd-8cfd-4c0a6eaffc5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0c04bd00>]}
[0m13:08:13.587478 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.80s]
[0m13:08:13.594458 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m13:08:13.600307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:13.608809 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:13.611927 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m13:08:13.611894 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:13.617845 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m13:08:13.616862 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:08:13.620225 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m13:08:13.624229 [debug] [MainThread]: On list__silver: Close
[0m13:08:13.625307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:13.629258 [info ] [MainThread]: 
[0m13:08:13.630491 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 13:08:13.506821 => 13:08:13.626902
[0m13:08:13.634108 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.00 seconds (2.00s).
[0m13:08:13.638915 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m13:08:13.641322 [debug] [MainThread]: Command end result
[0m13:08:13.649506 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:13.664967 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m13:08:13.752003 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m13:08:13.817815 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:08:13.872221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m13:08:13.884575 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:08:13.904943 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:13.919293 [info ] [MainThread]: 
[0m13:08:13.924733 [info ] [MainThread]: Completed successfully
[0m13:08:13.929610 [info ] [MainThread]: 
[0m13:08:13.924442 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:13.942092 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:08:13.949218 [debug] [MainThread]: Command `dbt run` succeeded at 13:08:13.948629 after 8.98 seconds
[0m13:08:13.957425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738d0a6eb0>]}
[0m13:08:13.957068 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb1053e490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0e81ff40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74bb0e923dc0>]}
[0m13:08:13.962158 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:13.962349 [debug] [MainThread]: Flushing usage events
[0m13:08:13.966776 [info ] [MainThread]: 
[0m13:08:14.040447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m13:08:14.053913 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m13:08:14.056911 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m13:08:14.065415 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m13:08:14.066226 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:14.067866 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m13:08:14.082081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.090438 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:08:14.101393 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m13:08:14.116775 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m13:08:14.132370 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.145664 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:14.157126 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 13:08:13.283727 => 13:08:14.154851
[0m13:08:14.163694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.163386 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f4127d4-80e6-49ad-b55f-5de175661fe7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c526b7c70>]}
[0m13:08:14.168032 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 1.02s]
[0m13:08:14.171865 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m13:08:14.183473 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:14.191768 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m13:08:14.192494 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m13:08:14.191714 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 13:08:14.069508 => 13:08:14.190185
[0m13:08:14.195784 [debug] [MainThread]: On list__silver: Close
[0m13:08:14.198217 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m13:08:14.198879 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m13:08:14.200230 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m13:08:14.203770 [info ] [MainThread]: 
[0m13:08:14.207631 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.18 seconds (2.18s).
[0m13:08:14.215088 [debug] [MainThread]: Command end result
[0m13:08:14.249312 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m13:08:14.330289 [info ] [MainThread]: 
[0m13:08:14.337741 [info ] [MainThread]: Completed successfully
[0m13:08:14.356251 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m13:08:14.347299 [info ] [MainThread]: 
[0m13:08:14.361809 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:08:14.365630 [debug] [MainThread]: Command `dbt run` succeeded at 13:08:14.365154 after 9.20 seconds
[0m13:08:14.368207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7bdbe460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c7a29b670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x740c79fe49d0>]}
[0m13:08:14.370861 [debug] [MainThread]: Flushing usage events
[0m13:08:14.391682 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m13:08:14.400589 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.499641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:14.504272 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m13:08:14.514168 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.531220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:14.548489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m13:08:14.554956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:08:14.561965 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 13:08:13.640788 => 13:08:14.560265
[0m13:08:14.563437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:14.565274 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51402792-ffb5-4a43-b947-7665e0f159d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b756852e80>]}
[0m13:08:14.567791 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 1.06s]
[0m13:08:14.571769 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m13:08:14.575103 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.580343 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:14.582442 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m13:08:14.584703 [debug] [MainThread]: On list__gold: Close
[0m13:08:14.586689 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m13:08:14.588738 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m13:08:14.590676 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m13:08:14.590963 [info ] [MainThread]: 
[0m13:08:14.593903 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.29 seconds (2.29s).
[0m13:08:14.597678 [debug] [MainThread]: Command end result
[0m13:08:14.649195 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m13:08:14.650445 [info ] [MainThread]: 
[0m13:08:14.653069 [info ] [MainThread]: Completed successfully
[0m13:08:14.656841 [info ] [MainThread]: 
[0m13:08:14.663691 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:08:14.668692 [debug] [MainThread]: Command `dbt run` succeeded at 13:08:14.667708 after 9.48 seconds
[0m13:08:14.670459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77ff27430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77e349c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77b77e3f1d90>]}
[0m13:08:14.672318 [debug] [MainThread]: Flushing usage events
[0m13:08:14.673976 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:14.701493 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m13:08:14.709424 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.774493 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:14.790421 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.819984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m13:08:14.828692 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:14.833902 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 13:08:14.202717 => 13:08:14.833126
[0m13:08:14.837608 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7a810e8c-44b8-4e33-b534-121594d4f23e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c737d750e80>]}
[0m13:08:14.843353 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.78s]
[0m13:08:14.847779 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m13:08:14.855157 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:14.857091 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m13:08:14.858783 [debug] [MainThread]: On list__silver: Close
[0m13:08:14.860630 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m13:08:14.862098 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m13:08:14.864933 [info ] [MainThread]: 
[0m13:08:14.867539 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 2.15 seconds (2.15s).
[0m13:08:14.870300 [debug] [MainThread]: Command end result
[0m13:08:14.933835 [info ] [MainThread]: 
[0m13:08:14.937133 [info ] [MainThread]: Completed successfully
[0m13:08:14.943657 [info ] [MainThread]: 
[0m13:08:14.947346 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:08:14.950951 [debug] [MainThread]: Command `dbt run` succeeded at 13:08:14.950555 after 9.67 seconds
[0m13:08:14.952532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738ee5d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738d190670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c738f8bcd30>]}
[0m13:08:14.967584 [debug] [MainThread]: Flushing usage events
[0m13:08:26.455590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e594fde490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e595999e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e5959ab790>]}


============================== 13:08:26.472600 | bac5a181-f05b-477d-994f-7a8f41f9c4e7 ==============================
[0m13:08:26.472600 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:08:26.478436 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:08:26.822763 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e595999b20>]}
[0m13:08:26.890132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e59352bee0>]}
[0m13:08:26.892496 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:08:26.955957 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:08:26.970557 [debug] [MainThread]: Partial parsing not enabled
[0m13:08:30.336886 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:08:30.365305 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:08:30.371472 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:08:30.388730 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:08:30.395385 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:08:30.410754 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:08:30.423108 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:08:30.454014 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:08:30.461557 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:08:30.484303 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:08:30.490902 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:08:30.563588 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:08:30.570324 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:08:30.598738 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:08:31.231049 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:08:31.253045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e5933a35b0>]}
[0m13:08:31.311306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e59359cbe0>]}
[0m13:08:31.314955 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:08:31.318076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e59359c7f0>]}
[0m13:08:31.322586 [info ] [MainThread]: 
[0m13:08:31.326031 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:08:31.331976 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:08:31.334927 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:08:31.358709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:31.365297 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:08:31.837117 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:08:31.841588 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:08:31.848610 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:31.856013 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:31.866297 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:08:31.868802 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:08:31.897738 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:08:31.902725 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:08:31.917903 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:31.920508 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:31.931766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e5933df5b0>]}
[0m13:08:31.934062 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:08:31.936318 [info ] [MainThread]: 
[0m13:08:31.986530 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m13:08:31.989061 [debug] [Thread-2  ]: Began running node model.ck_project.dim_payment_state
[0m13:08:31.990651 [debug] [Thread-3  ]: Began running node model.ck_project.silver_link_transactions
[0m13:08:31.993059 [info ] [Thread-1  ]: 1 of 7 START sql table model gold.dim_payment_method ........................... [RUN]
[0m13:08:31.996128 [debug] [Thread-4  ]: Began running node model.ck_project.silver_merchants
[0m13:08:31.997722 [info ] [Thread-2  ]: 2 of 7 START sql table model gold.dim_payment_state ............................ [RUN]
[0m13:08:32.000132 [info ] [Thread-3  ]: 3 of 7 START sql incremental model silver.link_transactions .................... [RUN]
[0m13:08:32.007582 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m13:08:32.013361 [info ] [Thread-4  ]: 4 of 7 START sql incremental model silver.merchants ............................ [RUN]
[0m13:08:32.018191 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m13:08:32.021840 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ck_project.silver_link_transactions'
[0m13:08:32.024163 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m13:08:32.030202 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ck_project.silver_merchants'
[0m13:08:32.032906 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_payment_state
[0m13:08:32.037099 [debug] [Thread-3  ]: Began compiling node model.ck_project.silver_link_transactions
[0m13:08:32.051465 [debug] [Thread-4  ]: Began compiling node model.ck_project.silver_merchants
[0m13:08:32.109916 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m13:08:32.162914 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m13:08:32.181486 [debug] [Thread-3  ]: Writing injected SQL for node "model.ck_project.silver_link_transactions"
[0m13:08:32.194061 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m13:08:32.198255 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (compile): 13:08:32.068637 => 13:08:32.197362
[0m13:08:32.200312 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 13:08:32.039603 => 13:08:32.199498
[0m13:08:32.205011 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_payment_state
[0m13:08:32.207835 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m13:08:32.330559 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (compile): 13:08:32.099881 => 13:08:32.329549
[0m13:08:32.337774 [debug] [Thread-3  ]: Began executing node model.ck_project.silver_link_transactions
[0m13:08:32.753769 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m13:08:32.763223 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m13:08:32.809706 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m13:08:32.818750 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:08:32.834979 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:32.837056 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:08:32.855032 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:32.867795 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:32.871508 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:32.884192 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m13:08:32.890404 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m13:08:32.909180 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  SELECT
    countIf(name='id')            AS c_id,
    countIf(name='acquirer_id')   AS c_acquirer_id,
    countIf(name='name')          AS c_name,
    countIf(name='state')         AS c_state,
    countIf(name='created_at')    AS c_created_at,
    countIf(name='updated_at')    AS c_updated_at,
    countIf(name='_ingested_at')  AS c_ingested_at,
    countIf(name='_snapshot_date')AS c_snapshot_date
  FROM system.columns
  WHERE database = 'bronze' AND table = 'merchants'

  ...
[0m13:08:32.911496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m13:08:32.914868 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m13:08:32.939970 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:32.943589 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:32.953889 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.silver_merchants"
[0m13:08:32.957305 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:08:32.974621 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m13:08:32.981688 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m13:08:32.989563 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:32.991981 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:33.080003 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (compile): 13:08:32.111361 => 13:08:33.079354
[0m13:08:33.103462 [debug] [Thread-4  ]: Began executing node model.ck_project.silver_merchants
[0m13:08:33.166924 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:33.187721 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:33.207110 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:08:33.213177 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:08:33.221167 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:33.225600 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:33.256974 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m13:08:33.260882 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:08:33.275343 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m13:08:33.279603 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:08:33.288060 [debug] [Thread-4  ]: Writing runtime sql for node "model.ck_project.silver_merchants"
[0m13:08:33.298019 [debug] [Thread-3  ]: Writing runtime sql for node "model.ck_project.silver_link_transactions"
[0m13:08:33.299961 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:33.301042 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:33.311209 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (execute): 13:08:32.211218 => 13:08:33.309917
[0m13:08:33.319694 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 13:08:32.228471 => 13:08:33.318397
[0m13:08:33.323357 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e58b88f730>]}
[0m13:08:33.333240 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e58b88f670>]}
[0m13:08:33.338498 [info ] [Thread-2  ]: 2 of 7 OK created sql table model gold.dim_payment_state ....................... [OK in 1.31s]
[0m13:08:33.345006 [info ] [Thread-1  ]: 1 of 7 OK created sql table model gold.dim_payment_method ...................... [OK in 1.33s]
[0m13:08:33.354147 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_payment_state
[0m13:08:33.357766 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m13:08:33.360850 [debug] [Thread-2  ]: Began running node model.ck_project.silver_payments
[0m13:08:33.364475 [info ] [Thread-2  ]: 5 of 7 START sql incremental model silver.payments ............................. [RUN]
[0m13:08:33.369121 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_state, now model.ck_project.silver_payments)
[0m13:08:33.371743 [debug] [Thread-2  ]: Began compiling node model.ck_project.silver_payments
[0m13:08:33.376981 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

        insert into silver.merchants
        ("merchant_id", "_snapshot_date", "acquirer_id", "merchant_name", "state", "created_at", "updated_at", "dim_fingerprint")





with day_rows as (
  select
      toUInt64OrNull(id)                         as merchant_id_raw,
      toUInt64OrNull(acquirer_id)                as acquirer_id_raw,
      nullIf(name,'')                            as merchant_name_raw,
      state                                      as state_raw,
      created_at                                 as created_at_raw,
      updated_at                                 as updated_at_raw,
      _ingested_at,
      toDate(_snapshot_date)                     as _snapshot_date
  from bronze.merchants
  
),
agg as (
  select
      merchant_id_raw                                              as merchant_id_nullable,
      _snapshot_date,
      argMax(acquirer_id_raw, _ingested_at)                        as acquirer_id,
      argMax(merchant_name_raw, _ingested_at)                      as merchant_name,
      toLowCardinality(argMax(state_raw, _ingested_at))            as state,
      parseDateTimeBestEffortOrNull(argMax(created_at_raw, _ingested_at)) as created_at,
      parseDateTimeBestEffortOrNull(argMax(updated_at_raw, _ingested_at)) as updated_at
  from day_rows
  where merchant_id_raw is not null
  group by merchant_id_nullable, _snapshot_date
)
select
  toUInt64(merchant_id_nullable)                as merchant_id,      -- <- NON-NULLABLE for ORDER BY
  _snapshot_date,                                                   -- <- NON-NULLABLE Date
  acquirer_id,
  merchant_name,
  state,
  created_at,
  updated_at,
  cityHash64(
    concat(
      toString(merchant_id),'|',
      ifNull(toString(acquirer_id),''),'|',
      ifNull(merchant_name,''),'|',
      ifNull(state,''),'|',
      ifNull(toString(created_at),''),'|',
      ifNull(toString(updated_at),'')
    )
  ) as dim_fingerprint
from agg

  
    ...
[0m13:08:33.379563 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

        insert into silver.link_transactions
        ("transaction_id", "state", "reference", "details", "created_at", "updated_at", "_snapshot_date")



with base as (
  select
    -- make key non-nullable in the schema; also exclude null id upstream
    assumeNotNull(toUInt64OrNull(id))                      as transaction_id,
    state,
    linkpay_reference                                      as reference,
    payment_details                                        as details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                 as _snapshot_date
  from bronze.link_transactions
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    -- pick latest by ingestion time
    argMax(state, _ingested_at)                                     as state,
    argMax(reference, _ingested_at)                                  as reference,
    argMax(details, _ingested_at)                                    as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))  as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))  as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


-- first build
select * from agg_day

  
    ...
[0m13:08:33.439722 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.silver_payments"
[0m13:08:33.568820 [debug] [Thread-2  ]: Timing info for model.ck_project.silver_payments (compile): 13:08:33.382617 => 13:08:33.567736
[0m13:08:33.571488 [debug] [Thread-2  ]: Began executing node model.ck_project.silver_payments
[0m13:08:33.577253 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m13:08:33.620877 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:08:33.636544 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:08:33.646706 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.25 seconds
[0m13:08:33.651723 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:33.666762 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:08:33.670822 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:08:33.677153 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.silver_payments"
[0m13:08:33.700709 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:33.708848 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    
  alter table silver.link_transactions 
   modify comment 
  $dbt_comment_literal_block$Link transactions cleaned$dbt_comment_literal_block$

  ...
[0m13:08:33.732827 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  alter table silver.merchants 
   modify comment 
  $dbt_comment_literal_block$Merchants deduped$dbt_comment_literal_block$

  ...
[0m13:08:33.794084 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:08:33.800755 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:08:33.810249 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (execute): 13:08:32.360511 => 13:08:33.809378
[0m13:08:33.833414 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e5900d6fd0>]}
[0m13:08:33.830465 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (execute): 13:08:33.110417 => 13:08:33.826053
[0m13:08:33.837244 [info ] [Thread-3  ]: 3 of 7 OK created sql incremental model silver.link_transactions ............... [OK in 1.81s]
[0m13:08:33.855843 [debug] [Thread-3  ]: Finished running node model.ck_project.silver_link_transactions
[0m13:08:33.851683 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e58b8e9a90>]}
[0m13:08:33.884039 [info ] [Thread-4  ]: 4 of 7 OK created sql incremental model silver.merchants ....................... [OK in 1.82s]
[0m13:08:33.890033 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

        insert into silver.payments
        ("transaction_id", "merchant_id", "acquirer_id", "payment_state", "card_type", "reference", "order_reference", "details", "created_at", "updated_at", "_snapshot_date")





with base as (
  select
    /* make sort key non-nullable */
    cast(assumeNotNull(toUInt64OrNull(id)) as UInt64)                 as transaction_id,
    toUInt64OrNull(merchant_id)                                        as merchant_id,
    toUInt64OrNull(acquirer_id)                                        as acquirer_id,
    state,
    card_type,
    reference,
    order_reference,
    details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                             as _snapshot_date
  from bronze.payments
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    anyHeavy(merchant_id)                                              as merchant_id,      -- stable enough; not in sort key
    anyHeavy(acquirer_id)                                              as acquirer_id,
    toLowCardinality(argMax(state, _ingested_at))                      as payment_state,
    toLowCardinality(argMax(card_type, _ingested_at))                  as card_type,
    argMax(reference, _ingested_at)                                    as reference,
    argMax(order_reference, _ingested_at)                              as order_reference,
    argMax(details, _ingested_at)                                      as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))    as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))    as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


select * from agg_day

  
    ...
[0m13:08:33.900163 [debug] [Thread-4  ]: Finished running node model.ck_project.silver_merchants
[0m13:08:33.908050 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m13:08:33.911597 [info ] [Thread-1  ]: 6 of 7 START sql table model gold.dim_merchants ................................ [RUN]
[0m13:08:33.914857 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_method, now model.ck_project.dim_merchants)
[0m13:08:33.920465 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m13:08:33.953910 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m13:08:34.003405 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 13:08:33.928365 => 13:08:34.001693
[0m13:08:34.006377 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m13:08:34.034588 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m13:08:34.088653 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:08:34.105844 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.20 seconds
[0m13:08:34.114302 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:34.132197 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:08:34.153687 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:34.157302 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:08:34.167626 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m13:08:34.179323 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    
  alter table silver.payments 
   modify comment 
  $dbt_comment_literal_block$Payments cleaned$dbt_comment_literal_block$

  ...
[0m13:08:34.225172 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:08:34.217094 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m13:08:34.242272 [debug] [Thread-2  ]: Timing info for model.ck_project.silver_payments (execute): 13:08:33.579458 => 13:08:34.239124
[0m13:08:34.255127 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e5901964f0>]}
[0m13:08:34.262415 [info ] [Thread-2  ]: 5 of 7 OK created sql incremental model silver.payments ........................ [OK in 0.89s]
[0m13:08:34.271377 [debug] [Thread-2  ]: Finished running node model.ck_project.silver_payments
[0m13:08:34.327946 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m13:08:34.331658 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m13:08:34.339695 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:34.355892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:08:34.369927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:08:34.392441 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m13:08:34.400072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:08:34.404993 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 13:08:34.011392 => 13:08:34.404607
[0m13:08:34.409302 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e59009eeb0>]}
[0m13:08:34.412839 [info ] [Thread-1  ]: 6 of 7 OK created sql table model gold.dim_merchants ........................... [OK in 0.49s]
[0m13:08:34.417942 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m13:08:34.421624 [debug] [Thread-4  ]: Began running node model.ck_project.fact_transactions
[0m13:08:34.426283 [info ] [Thread-4  ]: 7 of 7 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m13:08:34.432060 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.ck_project.silver_merchants, now model.ck_project.fact_transactions)
[0m13:08:34.434315 [debug] [Thread-4  ]: Began compiling node model.ck_project.fact_transactions
[0m13:08:34.453273 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m13:08:34.493233 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (compile): 13:08:34.435611 => 13:08:34.492131
[0m13:08:34.496686 [debug] [Thread-4  ]: Began executing node model.ck_project.fact_transactions
[0m13:08:34.511342 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



;
          )
        ...
[0m13:08:34.524048 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



;
          )
        
[0m13:08:34.528595 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (execute): 13:08:34.498111 => 13:08:34.526875
[0m13:08:34.545725 [debug] [Thread-4  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 3328 (end of query) (line 134, col 1): ;
            )
          . Expected one of: token, OpeningRoundBracket, FILTER, RESPECT NULLS, IGNORE NULLS, OVER, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, table, table function, subquery or list of joined tables, array join, LEFT ARRAY JOIN, INNER, ARRAY JOIN, GLOBAL, LOCAL, ANY, ALL, ASOF, SEMI, ANTI, ONLY, LEFT, RIGHT, FULL, CROSS, PASTE, JOIN, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
  2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
  3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
  4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
  5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  7. DB::TCPHandler::run() @ 0x0000000019e4f119
  8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  10. Poco::PooledThread::run() @ 0x000000001ef15b87
  11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  12. ? @ 0x0000000000094ac3
  13. ? @ 0x0000000000125a74
[0m13:08:34.547932 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bac5a181-f05b-477d-994f-7a8f41f9c4e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e590075940>]}
[0m13:08:34.550149 [error] [Thread-4  ]: 7 of 7 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.12s]
[0m13:08:34.552345 [debug] [Thread-4  ]: Finished running node model.ck_project.fact_transactions
[0m13:08:34.560261 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:08:34.561844 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m13:08:34.563297 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m13:08:34.565163 [debug] [MainThread]: Connection 'model.ck_project.silver_payments' was left open.
[0m13:08:34.566958 [debug] [MainThread]: On model.ck_project.silver_payments: Close
[0m13:08:34.568652 [debug] [MainThread]: Connection 'model.ck_project.silver_link_transactions' was left open.
[0m13:08:34.569780 [debug] [MainThread]: On model.ck_project.silver_link_transactions: Close
[0m13:08:34.571261 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m13:08:34.573040 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m13:08:34.575920 [info ] [MainThread]: 
[0m13:08:34.579301 [info ] [MainThread]: Finished running 3 table models, 4 incremental models in 0 hours 0 minutes and 3.25 seconds (3.25s).
[0m13:08:34.584251 [debug] [MainThread]: Command end result
[0m13:08:34.633961 [info ] [MainThread]: 
[0m13:08:34.637589 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m13:08:34.639798 [info ] [MainThread]: 
[0m13:08:34.641923 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m13:08:34.645107 [error] [MainThread]:   Code: 62.
[0m13:08:34.648014 [error] [MainThread]:   DB::Exception: Syntax error: failed at position 3328 (end of query) (line 134, col 1): ;
[0m13:08:34.650131 [error] [MainThread]:             )
[0m13:08:34.654338 [error] [MainThread]:           . Expected one of: token, OpeningRoundBracket, FILTER, RESPECT NULLS, IGNORE NULLS, OVER, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, table, table function, subquery or list of joined tables, array join, LEFT ARRAY JOIN, INNER, ARRAY JOIN, GLOBAL, LOCAL, ANY, ALL, ASOF, SEMI, ANTI, ONLY, LEFT, RIGHT, FULL, CROSS, PASTE, JOIN, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
[0m13:08:34.656807 [error] [MainThread]:   
[0m13:08:34.658892 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m13:08:34.660657 [error] [MainThread]:   1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
[0m13:08:34.662946 [error] [MainThread]:   2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
[0m13:08:34.665435 [error] [MainThread]:   3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
[0m13:08:34.668647 [error] [MainThread]:   4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
[0m13:08:34.670682 [error] [MainThread]:   5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m13:08:34.673110 [error] [MainThread]:   6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m13:08:34.675457 [error] [MainThread]:   7. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m13:08:34.678049 [error] [MainThread]:   8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m13:08:34.680149 [error] [MainThread]:   9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m13:08:34.681814 [error] [MainThread]:   10. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m13:08:34.684643 [error] [MainThread]:   11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m13:08:34.686780 [error] [MainThread]:   12. ? @ 0x0000000000094ac3
[0m13:08:34.689299 [error] [MainThread]:   13. ? @ 0x0000000000125a74
[0m13:08:34.691192 [info ] [MainThread]: 
[0m13:08:34.693460 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m13:08:34.696549 [debug] [MainThread]: Command `dbt run` failed at 13:08:34.696110 after 8.33 seconds
[0m13:08:34.698358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e594fde490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e593334bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78e59324fac0>]}
[0m13:08:34.700934 [debug] [MainThread]: Flushing usage events
[0m13:09:55.571227 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4dba5ee460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4dbaf9c9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4dbaf9ce20>]}


============================== 13:09:55.590303 | 341b1385-a853-4cf2-b17a-27327c265251 ==============================
[0m13:09:55.590303 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:09:55.594691 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:09:55.880106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4dbaf9ce80>]}
[0m13:09:55.952233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db8ae5eb0>]}
[0m13:09:55.956238 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:09:56.011682 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:09:56.023917 [debug] [MainThread]: Partial parsing not enabled
[0m13:09:59.520725 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:09:59.569969 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:09:59.587127 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:09:59.619671 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:09:59.647906 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:09:59.667663 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:09:59.693234 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:09:59.739199 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:09:59.749186 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:09:59.774798 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:09:59.784431 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:09:59.879078 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:09:59.890274 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:09:59.920974 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:10:00.552639 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:10:00.585124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db8949580>]}
[0m13:10:00.642633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db890d340>]}
[0m13:10:00.645597 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:10:00.648059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db89f9fa0>]}
[0m13:10:00.654145 [info ] [MainThread]: 
[0m13:10:00.659396 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:10:00.664474 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:10:00.673779 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:10:00.696430 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:10:00.698760 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:10:01.272267 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:10:01.275592 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:10:01.285294 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:01.287092 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:01.300441 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:10:01.303591 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:10:01.355688 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:10:01.358055 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:10:01.372564 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:01.376680 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:10:01.393532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db8949e50>]}
[0m13:10:01.396365 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:10:01.398698 [info ] [MainThread]: 
[0m13:10:01.451088 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m13:10:01.452533 [debug] [Thread-2  ]: Began running node model.ck_project.dim_payment_state
[0m13:10:01.454378 [debug] [Thread-3  ]: Began running node model.ck_project.silver_link_transactions
[0m13:10:01.455974 [info ] [Thread-1  ]: 1 of 7 START sql table model gold.dim_payment_method ........................... [RUN]
[0m13:10:01.459047 [debug] [Thread-4  ]: Began running node model.ck_project.silver_merchants
[0m13:10:01.460377 [info ] [Thread-2  ]: 2 of 7 START sql table model gold.dim_payment_state ............................ [RUN]
[0m13:10:01.463368 [info ] [Thread-3  ]: 3 of 7 START sql incremental model silver.link_transactions .................... [RUN]
[0m13:10:01.467350 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m13:10:01.469274 [info ] [Thread-4  ]: 4 of 7 START sql incremental model silver.merchants ............................ [RUN]
[0m13:10:01.471976 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m13:10:01.476165 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ck_project.silver_link_transactions'
[0m13:10:01.479049 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m13:10:01.481541 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ck_project.silver_merchants'
[0m13:10:01.483226 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_payment_state
[0m13:10:01.485001 [debug] [Thread-3  ]: Began compiling node model.ck_project.silver_link_transactions
[0m13:10:01.498565 [debug] [Thread-4  ]: Began compiling node model.ck_project.silver_merchants
[0m13:10:01.521756 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m13:10:01.532156 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m13:10:01.597400 [debug] [Thread-3  ]: Writing injected SQL for node "model.ck_project.silver_link_transactions"
[0m13:10:01.621689 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m13:10:01.624191 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 13:10:01.486732 => 13:10:01.623048
[0m13:10:01.626149 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (compile): 13:10:01.515461 => 13:10:01.625547
[0m13:10:01.629264 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m13:10:01.631684 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (compile): 13:10:01.534492 => 13:10:01.630891
[0m13:10:01.633278 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_payment_state
[0m13:10:01.648998 [debug] [Thread-3  ]: Began executing node model.ck_project.silver_link_transactions
[0m13:10:02.029513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m13:10:02.039620 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m13:10:02.112826 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m13:10:02.114800 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m13:10:02.120912 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m13:10:02.142061 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:10:02.146939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:10:02.161607 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.168584 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:10:02.186206 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m13:10:02.193375 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m13:10:02.216227 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m13:10:02.228284 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m13:10:02.250960 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.252814 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  SELECT
    countIf(name='id')            AS c_id,
    countIf(name='acquirer_id')   AS c_acquirer_id,
    countIf(name='name')          AS c_name,
    countIf(name='state')         AS c_state,
    countIf(name='created_at')    AS c_created_at,
    countIf(name='updated_at')    AS c_updated_at,
    countIf(name='_ingested_at')  AS c_ingested_at,
    countIf(name='_snapshot_date')AS c_snapshot_date
  FROM system.columns
  WHERE database = 'bronze' AND table = 'merchants'

  ...
[0m13:10:02.255981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.283062 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m13:10:02.281228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m13:10:02.293583 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.313536 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.338507 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m13:10:02.349469 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.silver_merchants"
[0m13:10:02.437863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:10:02.445206 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (compile): 13:10:01.546221 => 13:10:02.444307
[0m13:10:02.448185 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:10:02.449453 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:10:02.451377 [debug] [Thread-4  ]: Began executing node model.ck_project.silver_merchants
[0m13:10:02.456749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.492771 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.505428 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:10:02.510286 [debug] [Thread-3  ]: Writing runtime sql for node "model.ck_project.silver_link_transactions"
[0m13:10:02.525160 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m13:10:02.527618 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m13:10:02.544260 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.546766 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m13:10:02.556573 [debug] [Thread-4  ]: Writing runtime sql for node "model.ck_project.silver_merchants"
[0m13:10:02.562046 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.564565 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.570059 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 13:10:01.636332 => 13:10:02.569119
[0m13:10:02.572856 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

        insert into silver.link_transactions
        ("transaction_id", "state", "reference", "details", "created_at", "updated_at", "_snapshot_date")



with base as (
  select
    -- make key non-nullable in the schema; also exclude null id upstream
    assumeNotNull(toUInt64OrNull(id))                      as transaction_id,
    state,
    linkpay_reference                                      as reference,
    payment_details                                        as details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                 as _snapshot_date
  from bronze.link_transactions
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    -- pick latest by ingestion time
    argMax(state, _ingested_at)                                     as state,
    argMax(reference, _ingested_at)                                  as reference,
    argMax(details, _ingested_at)                                    as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))  as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))  as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


-- first build
select * from agg_day

  
    ...
[0m13:10:02.577250 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (execute): 13:10:01.656523 => 13:10:02.576719
[0m13:10:02.580595 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db4e77940>]}
[0m13:10:02.585944 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db4e9db80>]}
[0m13:10:02.590221 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

        insert into silver.merchants
        ("merchant_id", "_snapshot_date", "acquirer_id", "merchant_name", "state", "created_at", "updated_at", "dim_fingerprint")





with day_rows as (
  select
      toUInt64OrNull(id)                         as merchant_id_raw,
      toUInt64OrNull(acquirer_id)                as acquirer_id_raw,
      nullIf(name,'')                            as merchant_name_raw,
      state                                      as state_raw,
      created_at                                 as created_at_raw,
      updated_at                                 as updated_at_raw,
      _ingested_at,
      toDate(_snapshot_date)                     as _snapshot_date
  from bronze.merchants
  
),
agg as (
  select
      merchant_id_raw                                              as merchant_id_nullable,
      _snapshot_date,
      argMax(acquirer_id_raw, _ingested_at)                        as acquirer_id,
      argMax(merchant_name_raw, _ingested_at)                      as merchant_name,
      toLowCardinality(argMax(state_raw, _ingested_at))            as state,
      parseDateTimeBestEffortOrNull(argMax(created_at_raw, _ingested_at)) as created_at,
      parseDateTimeBestEffortOrNull(argMax(updated_at_raw, _ingested_at)) as updated_at
  from day_rows
  where merchant_id_raw is not null
  group by merchant_id_nullable, _snapshot_date
)
select
  toUInt64(merchant_id_nullable)                as merchant_id,      -- <- NON-NULLABLE for ORDER BY
  _snapshot_date,                                                   -- <- NON-NULLABLE Date
  acquirer_id,
  merchant_name,
  state,
  created_at,
  updated_at,
  cityHash64(
    concat(
      toString(merchant_id),'|',
      ifNull(toString(acquirer_id),''),'|',
      ifNull(merchant_name,''),'|',
      ifNull(state,''),'|',
      ifNull(toString(created_at),''),'|',
      ifNull(toString(updated_at),'')
    )
  ) as dim_fingerprint
from agg

  
    ...
[0m13:10:02.593351 [info ] [Thread-1  ]: 1 of 7 OK created sql table model gold.dim_payment_method ...................... [OK in 1.11s]
[0m13:10:02.597519 [info ] [Thread-2  ]: 2 of 7 OK created sql table model gold.dim_payment_state ....................... [OK in 1.11s]
[0m13:10:02.601746 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m13:10:02.607741 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_payment_state
[0m13:10:02.610548 [debug] [Thread-1  ]: Began running node model.ck_project.silver_payments
[0m13:10:02.615751 [info ] [Thread-1  ]: 5 of 7 START sql incremental model silver.payments ............................. [RUN]
[0m13:10:02.619251 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_method, now model.ck_project.silver_payments)
[0m13:10:02.623749 [debug] [Thread-1  ]: Began compiling node model.ck_project.silver_payments
[0m13:10:02.659502 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.silver_payments"
[0m13:10:02.663224 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m13:10:02.685390 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:10:02.693124 [debug] [Thread-1  ]: Timing info for model.ck_project.silver_payments (compile): 13:10:02.626603 => 13:10:02.692150
[0m13:10:02.695552 [debug] [Thread-1  ]: Began executing node model.ck_project.silver_payments
[0m13:10:02.697774 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.716348 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m13:10:02.714767 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:10:02.725553 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    
  alter table silver.link_transactions 
   modify comment 
  $dbt_comment_literal_block$Link transactions cleaned$dbt_comment_literal_block$

  ...
[0m13:10:02.734949 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:10:02.746330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.749608 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.759980 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.silver_payments"
[0m13:10:02.766825 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  alter table silver.merchants 
   modify comment 
  $dbt_comment_literal_block$Merchants deduped$dbt_comment_literal_block$

  ...
[0m13:10:02.768109 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.778739 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (execute): 13:10:01.700621 => 13:10:02.777809
[0m13:10:02.782524 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db4fef790>]}
[0m13:10:02.785784 [info ] [Thread-3  ]: 3 of 7 OK created sql incremental model silver.link_transactions ............... [OK in 1.31s]
[0m13:10:02.793314 [debug] [Thread-3  ]: Finished running node model.ck_project.silver_link_transactions
[0m13:10:02.798533 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.800632 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

        insert into silver.payments
        ("transaction_id", "merchant_id", "acquirer_id", "payment_state", "card_type", "reference", "order_reference", "details", "created_at", "updated_at", "_snapshot_date")





with base as (
  select
    /* make sort key non-nullable */
    cast(assumeNotNull(toUInt64OrNull(id)) as UInt64)                 as transaction_id,
    toUInt64OrNull(merchant_id)                                        as merchant_id,
    toUInt64OrNull(acquirer_id)                                        as acquirer_id,
    state,
    card_type,
    reference,
    order_reference,
    details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                             as _snapshot_date
  from bronze.payments
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    anyHeavy(merchant_id)                                              as merchant_id,      -- stable enough; not in sort key
    anyHeavy(acquirer_id)                                              as acquirer_id,
    toLowCardinality(argMax(state, _ingested_at))                      as payment_state,
    toLowCardinality(argMax(card_type, _ingested_at))                  as card_type,
    argMax(reference, _ingested_at)                                    as reference,
    argMax(order_reference, _ingested_at)                              as order_reference,
    argMax(details, _ingested_at)                                      as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))    as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))    as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


select * from agg_day

  
    ...
[0m13:10:02.809045 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (execute): 13:10:02.461637 => 13:10:02.808596
[0m13:10:02.812680 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db45b1670>]}
[0m13:10:02.816545 [info ] [Thread-4  ]: 4 of 7 OK created sql incremental model silver.merchants ....................... [OK in 1.33s]
[0m13:10:02.820631 [debug] [Thread-4  ]: Finished running node model.ck_project.silver_merchants
[0m13:10:02.825614 [debug] [Thread-2  ]: Began running node model.ck_project.dim_merchants
[0m13:10:02.828512 [info ] [Thread-2  ]: 6 of 7 START sql table model gold.dim_merchants ................................ [RUN]
[0m13:10:02.831888 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_state, now model.ck_project.dim_merchants)
[0m13:10:02.834743 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_merchants
[0m13:10:02.858331 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m13:10:02.885111 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_merchants (compile): 13:10:02.836462 => 13:10:02.883925
[0m13:10:02.887440 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_merchants
[0m13:10:02.905669 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m13:10:02.922583 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m13:10:02.932138 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:10:02.933986 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:10:02.945126 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:10:02.950730 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:10:02.954004 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.960153 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    
  alter table silver.payments 
   modify comment 
  $dbt_comment_literal_block$Payments cleaned$dbt_comment_literal_block$

  ...
[0m13:10:02.964556 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m13:10:02.976997 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:02.982588 [debug] [Thread-1  ]: Timing info for model.ck_project.silver_payments (execute): 13:10:02.698610 => 13:10:02.981953
[0m13:10:02.984854 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db4e7f4f0>]}
[0m13:10:02.987418 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model silver.payments ........................ [OK in 0.37s]
[0m13:10:02.992995 [debug] [Thread-1  ]: Finished running node model.ck_project.silver_payments
[0m13:10:02.994727 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m13:10:03.049108 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:10:03.054283 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m13:10:03.062550 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:10:03.082456 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:10:03.103941 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:10:03.118572 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m13:10:03.125838 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:10:03.131867 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_merchants (execute): 13:10:02.889262 => 13:10:03.131064
[0m13:10:03.135354 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db4f56e50>]}
[0m13:10:03.137643 [info ] [Thread-2  ]: 6 of 7 OK created sql table model gold.dim_merchants ........................... [OK in 0.30s]
[0m13:10:03.140716 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_merchants
[0m13:10:03.146151 [debug] [Thread-4  ]: Began running node model.ck_project.fact_transactions
[0m13:10:03.148008 [info ] [Thread-4  ]: 7 of 7 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m13:10:03.150646 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.ck_project.silver_merchants, now model.ck_project.fact_transactions)
[0m13:10:03.152604 [debug] [Thread-4  ]: Began compiling node model.ck_project.fact_transactions
[0m13:10:03.173934 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m13:10:03.200953 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (compile): 13:10:03.154903 => 13:10:03.200043
[0m13:10:03.202989 [debug] [Thread-4  ]: Began executing node model.ck_project.fact_transactions
[0m13:10:03.220476 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



          )
        ...
[0m13:10:03.243114 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



          )
        
[0m13:10:03.246206 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (execute): 13:10:03.204609 => 13:10:03.245428
[0m13:10:03.254762 [debug] [Thread-4  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Identifier 't.tx_id' cannot be resolved from table with name t. In scope  txn AS tx. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
  4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
  5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
  6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
  7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
  8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
  10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  23. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  24. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  25. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  26. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  27. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  28. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  29. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  30. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  31. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m13:10:03.257822 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '341b1385-a853-4cf2-b17a-27327c265251', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db45c81f0>]}
[0m13:10:03.260224 [error] [Thread-4  ]: 7 of 7 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.11s]
[0m13:10:03.264646 [debug] [Thread-4  ]: Finished running node model.ck_project.fact_transactions
[0m13:10:03.272571 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:10:03.273968 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m13:10:03.276275 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m13:10:03.277695 [debug] [MainThread]: Connection 'model.ck_project.silver_payments' was left open.
[0m13:10:03.278906 [debug] [MainThread]: On model.ck_project.silver_payments: Close
[0m13:10:03.279877 [debug] [MainThread]: Connection 'model.ck_project.silver_link_transactions' was left open.
[0m13:10:03.281365 [debug] [MainThread]: On model.ck_project.silver_link_transactions: Close
[0m13:10:03.284369 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m13:10:03.286765 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m13:10:03.288427 [info ] [MainThread]: 
[0m13:10:03.289909 [info ] [MainThread]: Finished running 3 table models, 4 incremental models in 0 hours 0 minutes and 2.63 seconds (2.63s).
[0m13:10:03.294536 [debug] [MainThread]: Command end result
[0m13:10:03.339068 [info ] [MainThread]: 
[0m13:10:03.343952 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m13:10:03.347030 [info ] [MainThread]: 
[0m13:10:03.350711 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m13:10:03.353800 [error] [MainThread]:   Code: 47.
[0m13:10:03.356302 [error] [MainThread]:   DB::Exception: Identifier 't.tx_id' cannot be resolved from table with name t. In scope  txn AS tx. Stack trace:
[0m13:10:03.358758 [error] [MainThread]:   
[0m13:10:03.362758 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m13:10:03.365041 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m13:10:03.367354 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m13:10:03.369750 [error] [MainThread]:   3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
[0m13:10:03.372580 [error] [MainThread]:   4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
[0m13:10:03.375444 [error] [MainThread]:   5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
[0m13:10:03.377930 [error] [MainThread]:   6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
[0m13:10:03.381314 [error] [MainThread]:   7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
[0m13:10:03.384165 [error] [MainThread]:   8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
[0m13:10:03.386414 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
[0m13:10:03.388324 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m13:10:03.390070 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m13:10:03.392729 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m13:10:03.394493 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m13:10:03.396179 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m13:10:03.397911 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:10:03.399944 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:10:03.401904 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:10:03.403905 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:10:03.406758 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:10:03.409505 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:10:03.412441 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:10:03.414224 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:10:03.416197 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m13:10:03.418109 [error] [MainThread]:   24. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m13:10:03.419959 [error] [MainThread]:   25. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m13:10:03.422714 [error] [MainThread]:   26. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m13:10:03.424366 [error] [MainThread]:   27. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m13:10:03.426975 [error] [MainThread]:   28. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m13:10:03.428503 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m13:10:03.430593 [error] [MainThread]:   30. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m13:10:03.432830 [error] [MainThread]:   31. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m13:10:03.434613 [info ] [MainThread]: 
[0m13:10:03.437080 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m13:10:03.439756 [debug] [MainThread]: Command `dbt run` failed at 13:10:03.439448 after 7.94 seconds
[0m13:10:03.443091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4dba5ee460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db8ae5eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a4db50ab460>]}
[0m13:10:03.445466 [debug] [MainThread]: Flushing usage events
[0m13:15:13.206885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882d01db490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882d0c55dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882d0c67790>]}


============================== 13:15:13.222933 | 346e9848-c264-4192-afea-d95ca3f2dd9a ==============================
[0m13:15:13.222933 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:15:13.225459 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:15:13.514973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882d0c55fd0>]}
[0m13:15:13.580783 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882ce71bee0>]}
[0m13:15:13.584901 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:15:13.638880 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:15:13.654467 [debug] [MainThread]: Partial parsing not enabled
[0m13:15:17.014321 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:15:17.039769 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:15:17.046552 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:15:17.058374 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:15:17.067929 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:15:17.075585 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:15:17.088216 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:15:17.114483 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:15:17.120358 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:15:17.137964 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:15:17.146624 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:15:17.222714 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:15:17.228782 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:15:17.267306 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:15:17.837791 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:15:17.855381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882ce5a32b0>]}
[0m13:15:17.908012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882ce79cbe0>]}
[0m13:15:17.910631 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:15:17.913001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882ce79c7f0>]}
[0m13:15:17.918449 [info ] [MainThread]: 
[0m13:15:17.923051 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:15:17.928605 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:15:17.933402 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:15:17.959580 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:15:17.960295 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:15:18.447316 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:15:18.457888 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:15:18.459218 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:18.473410 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:18.485486 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:15:18.489607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:15:18.529543 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:15:18.536066 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:15:18.552885 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:18.557652 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:18.581186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882ce441190>]}
[0m13:15:18.591208 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:15:18.593631 [info ] [MainThread]: 
[0m13:15:18.637198 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m13:15:18.638709 [debug] [Thread-2  ]: Began running node model.ck_project.dim_payment_state
[0m13:15:18.639722 [debug] [Thread-3  ]: Began running node model.ck_project.silver_link_transactions
[0m13:15:18.640462 [debug] [Thread-4  ]: Began running node model.ck_project.silver_merchants
[0m13:15:18.641931 [info ] [Thread-1  ]: 1 of 7 START sql table model gold.dim_payment_method ........................... [RUN]
[0m13:15:18.645034 [info ] [Thread-2  ]: 2 of 7 START sql table model gold.dim_payment_state ............................ [RUN]
[0m13:15:18.647749 [info ] [Thread-3  ]: 3 of 7 START sql incremental model silver.link_transactions .................... [RUN]
[0m13:15:18.649548 [info ] [Thread-4  ]: 4 of 7 START sql incremental model silver.merchants ............................ [RUN]
[0m13:15:18.651942 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m13:15:18.653800 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m13:15:18.657016 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ck_project.silver_link_transactions'
[0m13:15:18.660277 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ck_project.silver_merchants'
[0m13:15:18.662250 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m13:15:18.664281 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_payment_state
[0m13:15:18.666633 [debug] [Thread-3  ]: Began compiling node model.ck_project.silver_link_transactions
[0m13:15:18.667965 [debug] [Thread-4  ]: Began compiling node model.ck_project.silver_merchants
[0m13:15:18.697407 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m13:15:18.696769 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m13:15:18.744732 [debug] [Thread-3  ]: Writing injected SQL for node "model.ck_project.silver_link_transactions"
[0m13:15:18.749695 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m13:15:18.772121 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (compile): 13:15:18.680022 => 13:15:18.771051
[0m13:15:18.776242 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (compile): 13:15:18.699690 => 13:15:18.773904
[0m13:15:18.777800 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_payment_state
[0m13:15:18.780112 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 13:15:18.668875 => 13:15:18.779174
[0m13:15:18.783876 [debug] [Thread-3  ]: Began executing node model.ck_project.silver_link_transactions
[0m13:15:18.800627 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m13:15:19.231514 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m13:15:19.240581 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m13:15:19.310890 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m13:15:19.314064 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:15:19.327467 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:15:19.333910 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m13:15:19.350623 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:15:19.353498 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:19.356708 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  SELECT
    countIf(name='id')            AS c_id,
    countIf(name='acquirer_id')   AS c_acquirer_id,
    countIf(name='name')          AS c_name,
    countIf(name='state')         AS c_state,
    countIf(name='created_at')    AS c_created_at,
    countIf(name='updated_at')    AS c_updated_at,
    countIf(name='_ingested_at')  AS c_ingested_at,
    countIf(name='_snapshot_date')AS c_snapshot_date
  FROM system.columns
  WHERE database = 'bronze' AND table = 'merchants'

  ...
[0m13:15:19.373939 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m13:15:19.382119 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:19.389734 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m13:15:19.396394 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:19.407503 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.silver_merchants"
[0m13:15:19.413122 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m13:15:19.416954 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m13:15:19.441627 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:15:19.444295 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (compile): 13:15:18.710981 => 13:15:19.443324
[0m13:15:19.459464 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:15:19.465311 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m13:15:19.466743 [debug] [Thread-4  ]: Began executing node model.ck_project.silver_merchants
[0m13:15:19.471122 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m13:15:19.498492 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:15:19.506931 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:15:19.509098 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:19.523738 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:19.593375 [debug] [Thread-4  ]: Writing runtime sql for node "model.ck_project.silver_merchants"
[0m13:15:19.623141 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:15:19.678844 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:15:19.695180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:15:19.709828 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:19.714205 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:15:19.724548 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:15:19.734124 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

        insert into silver.merchants
        ("merchant_id", "_snapshot_date", "acquirer_id", "merchant_name", "state", "created_at", "updated_at", "dim_fingerprint")





with day_rows as (
  select
      toUInt64OrNull(id)                         as merchant_id_raw,
      toUInt64OrNull(acquirer_id)                as acquirer_id_raw,
      nullIf(name,'')                            as merchant_name_raw,
      state                                      as state_raw,
      created_at                                 as created_at_raw,
      updated_at                                 as updated_at_raw,
      _ingested_at,
      toDate(_snapshot_date)                     as _snapshot_date
  from bronze.merchants
  
),
agg as (
  select
      merchant_id_raw                                              as merchant_id_nullable,
      _snapshot_date,
      argMax(acquirer_id_raw, _ingested_at)                        as acquirer_id,
      argMax(merchant_name_raw, _ingested_at)                      as merchant_name,
      toLowCardinality(argMax(state_raw, _ingested_at))            as state,
      parseDateTimeBestEffortOrNull(argMax(created_at_raw, _ingested_at)) as created_at,
      parseDateTimeBestEffortOrNull(argMax(updated_at_raw, _ingested_at)) as updated_at
  from day_rows
  where merchant_id_raw is not null
  group by merchant_id_nullable, _snapshot_date
)
select
  toUInt64(merchant_id_nullable)                as merchant_id,      -- <- NON-NULLABLE for ORDER BY
  _snapshot_date,                                                   -- <- NON-NULLABLE Date
  acquirer_id,
  merchant_name,
  state,
  created_at,
  updated_at,
  cityHash64(
    concat(
      toString(merchant_id),'|',
      ifNull(toString(acquirer_id),''),'|',
      ifNull(merchant_name,''),'|',
      ifNull(state,''),'|',
      ifNull(toString(created_at),''),'|',
      ifNull(toString(updated_at),'')
    )
  ) as dim_fingerprint
from agg

  
    ...
[0m13:15:19.767650 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m13:15:19.772063 [debug] [Thread-3  ]: Writing runtime sql for node "model.ck_project.silver_link_transactions"
[0m13:15:19.773731 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m13:15:19.783605 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:15:19.785545 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:19.791271 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 13:15:18.866132 => 13:15:19.790323
[0m13:15:19.799621 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (execute): 13:15:18.788366 => 13:15:19.798423
[0m13:15:19.803655 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6ac7b20>]}
[0m13:15:19.808701 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6a87c10>]}
[0m13:15:19.812912 [info ] [Thread-1  ]: 1 of 7 OK created sql table model gold.dim_payment_method ...................... [OK in 1.15s]
[0m13:15:19.817593 [info ] [Thread-2  ]: 2 of 7 OK created sql table model gold.dim_payment_state ....................... [OK in 1.16s]
[0m13:15:19.820735 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

        insert into silver.link_transactions
        ("transaction_id", "state", "reference", "details", "created_at", "updated_at", "_snapshot_date")



with base as (
  select
    -- make key non-nullable in the schema; also exclude null id upstream
    assumeNotNull(toUInt64OrNull(id))                      as transaction_id,
    state,
    linkpay_reference                                      as reference,
    payment_details                                        as details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                 as _snapshot_date
  from bronze.link_transactions
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    -- pick latest by ingestion time
    argMax(state, _ingested_at)                                     as state,
    argMax(reference, _ingested_at)                                  as reference,
    argMax(details, _ingested_at)                                    as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))  as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))  as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


-- first build
select * from agg_day

  
    ...
[0m13:15:19.823295 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m13:15:19.826633 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_payment_state
[0m13:15:19.832593 [debug] [Thread-1  ]: Began running node model.ck_project.silver_payments
[0m13:15:19.838457 [info ] [Thread-1  ]: 5 of 7 START sql incremental model silver.payments ............................. [RUN]
[0m13:15:19.841522 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_method, now model.ck_project.silver_payments)
[0m13:15:19.843751 [debug] [Thread-1  ]: Began compiling node model.ck_project.silver_payments
[0m13:15:19.883543 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.silver_payments"
[0m13:15:19.900840 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.13 seconds
[0m13:15:19.925906 [debug] [Thread-1  ]: Timing info for model.ck_project.silver_payments (compile): 13:15:19.846738 => 13:15:19.924972
[0m13:15:19.934253 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:15:19.936696 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m13:15:19.938470 [debug] [Thread-1  ]: Began executing node model.ck_project.silver_payments
[0m13:15:19.958634 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:15:19.979609 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:15:19.983705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:15:19.993802 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  alter table silver.merchants 
   modify comment 
  $dbt_comment_literal_block$Merchants deduped$dbt_comment_literal_block$

  ...
[0m13:15:20.005668 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:15:20.017185 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    
  alter table silver.link_transactions 
   modify comment 
  $dbt_comment_literal_block$Link transactions cleaned$dbt_comment_literal_block$

  ...
[0m13:15:20.021559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:20.023272 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:20.028992 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.silver_payments"
[0m13:15:20.036170 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (execute): 13:15:19.474199 => 13:15:20.035703
[0m13:15:20.040741 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a41a0b80>]}
[0m13:15:20.047639 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:20.044084 [info ] [Thread-4  ]: 4 of 7 OK created sql incremental model silver.merchants ....................... [OK in 1.38s]
[0m13:15:20.058205 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (execute): 13:15:18.823573 => 13:15:20.057329
[0m13:15:20.060679 [debug] [Thread-4  ]: Finished running node model.ck_project.silver_merchants
[0m13:15:20.066987 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6accbb0>]}
[0m13:15:20.073708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

        insert into silver.payments
        ("transaction_id", "merchant_id", "acquirer_id", "payment_state", "card_type", "reference", "order_reference", "details", "created_at", "updated_at", "_snapshot_date")





with base as (
  select
    /* make sort key non-nullable */
    cast(assumeNotNull(toUInt64OrNull(id)) as UInt64)                 as transaction_id,
    toUInt64OrNull(merchant_id)                                        as merchant_id,
    toUInt64OrNull(acquirer_id)                                        as acquirer_id,
    state,
    card_type,
    reference,
    order_reference,
    details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                             as _snapshot_date
  from bronze.payments
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    anyHeavy(merchant_id)                                              as merchant_id,      -- stable enough; not in sort key
    anyHeavy(acquirer_id)                                              as acquirer_id,
    toLowCardinality(argMax(state, _ingested_at))                      as payment_state,
    toLowCardinality(argMax(card_type, _ingested_at))                  as card_type,
    argMax(reference, _ingested_at)                                    as reference,
    argMax(order_reference, _ingested_at)                              as order_reference,
    argMax(details, _ingested_at)                                      as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))    as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))    as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


select * from agg_day

  
    ...
[0m13:15:20.071604 [info ] [Thread-3  ]: 3 of 7 OK created sql incremental model silver.link_transactions ............... [OK in 1.41s]
[0m13:15:20.078296 [debug] [Thread-2  ]: Began running node model.ck_project.dim_merchants
[0m13:15:20.080240 [debug] [Thread-3  ]: Finished running node model.ck_project.silver_link_transactions
[0m13:15:20.083973 [info ] [Thread-2  ]: 6 of 7 START sql table model gold.dim_merchants ................................ [RUN]
[0m13:15:20.087957 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_state, now model.ck_project.dim_merchants)
[0m13:15:20.089502 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_merchants
[0m13:15:20.108789 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m13:15:20.135683 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_merchants (compile): 13:15:20.091209 => 13:15:20.134626
[0m13:15:20.137826 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_merchants
[0m13:15:20.158037 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m13:15:20.189977 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m13:15:20.191929 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:15:20.203709 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:15:20.217089 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:15:20.228040 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:20.231478 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:20.238812 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m13:15:20.246773 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    
  alter table silver.payments 
   modify comment 
  $dbt_comment_literal_block$Payments cleaned$dbt_comment_literal_block$

  ...
[0m13:15:20.266872 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:15:20.273752 [debug] [Thread-1  ]: Timing info for model.ck_project.silver_payments (execute): 13:15:19.959704 => 13:15:20.273300
[0m13:15:20.277360 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6af2580>]}
[0m13:15:20.283268 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m13:15:20.279956 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model silver.payments ........................ [OK in 0.44s]
[0m13:15:20.286617 [debug] [Thread-1  ]: Finished running node model.ck_project.silver_payments
[0m13:15:20.347298 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:15:20.352889 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m13:15:20.359208 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:15:20.374209 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:15:20.386854 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:15:20.399985 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m13:15:20.405652 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:15:20.412565 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_merchants (execute): 13:15:20.139490 => 13:15:20.411987
[0m13:15:20.416836 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6a94370>]}
[0m13:15:20.419299 [info ] [Thread-2  ]: 6 of 7 OK created sql table model gold.dim_merchants ........................... [OK in 0.33s]
[0m13:15:20.421808 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_merchants
[0m13:15:20.426777 [debug] [Thread-4  ]: Began running node model.ck_project.fact_transactions
[0m13:15:20.429392 [info ] [Thread-4  ]: 7 of 7 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m13:15:20.432801 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.ck_project.silver_merchants, now model.ck_project.fact_transactions)
[0m13:15:20.434886 [debug] [Thread-4  ]: Began compiling node model.ck_project.fact_transactions
[0m13:15:20.450897 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m13:15:20.474898 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (compile): 13:15:20.436005 => 13:15:20.473861
[0m13:15:20.477003 [debug] [Thread-4  ]: Began executing node model.ck_project.fact_transactions
[0m13:15:20.495588 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



          )
        ...
[0m13:15:20.510167 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



          )
        
[0m13:15:20.514527 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (execute): 13:15:20.479145 => 13:15:20.513077
[0m13:15:20.532632 [debug] [Thread-4  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Identifier 't.tx_id' cannot be resolved from table with name t. In scope  txn AS tx. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
  4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
  5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
  6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
  7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
  8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
  10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  23. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  24. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  25. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  26. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  27. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  28. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  29. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  30. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  31. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m13:15:20.536311 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '346e9848-c264-4192-afea-d95ca3f2dd9a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6b767f0>]}
[0m13:15:20.539048 [error] [Thread-4  ]: 7 of 7 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.10s]
[0m13:15:20.548202 [debug] [Thread-4  ]: Finished running node model.ck_project.fact_transactions
[0m13:15:20.558611 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:15:20.560312 [debug] [MainThread]: Connection 'model.ck_project.silver_payments' was left open.
[0m13:15:20.568895 [debug] [MainThread]: On model.ck_project.silver_payments: Close
[0m13:15:20.571878 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m13:15:20.575101 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m13:15:20.577727 [debug] [MainThread]: Connection 'model.ck_project.silver_link_transactions' was left open.
[0m13:15:20.587606 [debug] [MainThread]: On model.ck_project.silver_link_transactions: Close
[0m13:15:20.591521 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m13:15:20.593411 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m13:15:20.598785 [info ] [MainThread]: 
[0m13:15:20.603153 [info ] [MainThread]: Finished running 3 table models, 4 incremental models in 0 hours 0 minutes and 2.68 seconds (2.68s).
[0m13:15:20.614468 [debug] [MainThread]: Command end result
[0m13:15:20.704376 [info ] [MainThread]: 
[0m13:15:20.706893 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m13:15:20.709338 [info ] [MainThread]: 
[0m13:15:20.713031 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m13:15:20.716732 [error] [MainThread]:   Code: 47.
[0m13:15:20.720049 [error] [MainThread]:   DB::Exception: Identifier 't.tx_id' cannot be resolved from table with name t. In scope  txn AS tx. Stack trace:
[0m13:15:20.722374 [error] [MainThread]:   
[0m13:15:20.725039 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m13:15:20.727666 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m13:15:20.731949 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m13:15:20.734757 [error] [MainThread]:   3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
[0m13:15:20.736656 [error] [MainThread]:   4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
[0m13:15:20.738577 [error] [MainThread]:   5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
[0m13:15:20.740852 [error] [MainThread]:   6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
[0m13:15:20.743477 [error] [MainThread]:   7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
[0m13:15:20.746901 [error] [MainThread]:   8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
[0m13:15:20.750177 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
[0m13:15:20.753464 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m13:15:20.755744 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m13:15:20.757972 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m13:15:20.759367 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m13:15:20.760975 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m13:15:20.765097 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:15:20.767913 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:15:20.769676 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:15:20.771995 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:15:20.773664 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:15:20.775378 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:15:20.777610 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:15:20.784283 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:15:20.786796 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m13:15:20.788969 [error] [MainThread]:   24. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m13:15:20.790944 [error] [MainThread]:   25. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m13:15:20.793168 [error] [MainThread]:   26. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m13:15:20.796657 [error] [MainThread]:   27. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m13:15:20.799187 [error] [MainThread]:   28. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m13:15:20.801464 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m13:15:20.803531 [error] [MainThread]:   30. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m13:15:20.806182 [error] [MainThread]:   31. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m13:15:20.808061 [info ] [MainThread]: 
[0m13:15:20.810723 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m13:15:20.814841 [debug] [MainThread]: Command `dbt run` failed at 13:15:20.814399 after 7.65 seconds
[0m13:15:20.817712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882d01db490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882ce532bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7882a6c56820>]}
[0m13:15:20.820206 [debug] [MainThread]: Flushing usage events
[0m13:20:27.204214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4d0287430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4d0c50e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4d0c50e80>]}


============================== 13:20:27.220537 | 84248fcc-ce97-49cc-9fff-7e31e3a2ec23 ==============================
[0m13:20:27.220537 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:20:27.223065 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:20:27.389427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4d0c50dc0>]}
[0m13:20:27.427168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4ce7e0e80>]}
[0m13:20:27.429353 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:20:27.486585 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:20:27.501168 [debug] [MainThread]: Partial parsing not enabled
[0m13:22:26.097061 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:22:26.198933 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:22:26.233492 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:22:26.293977 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:22:26.321589 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:22:26.369128 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:22:26.417367 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:22:26.538820 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:22:26.550171 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:22:26.650712 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:22:26.670401 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:22:26.892219 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:22:26.923024 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:22:27.020055 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:22:29.287745 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:22:29.352918 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4ce6e8f70>]}
[0m13:22:29.493283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4ce859bb0>]}
[0m13:22:29.498303 [info ] [MainThread]: Found 8 models, 21 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:22:29.503431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4ce859790>]}
[0m13:22:29.527477 [info ] [MainThread]: 
[0m13:22:29.533411 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:22:29.549699 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:22:29.558880 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:22:29.624877 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:22:29.630767 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:22:30.798841 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:22:30.819119 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:22:30.828781 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:30.838034 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:30.857143 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m13:22:30.866035 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:22:30.926670 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:22:30.928746 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:22:30.964877 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:22:30.984505 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:22:31.002324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4ce695640>]}
[0m13:22:31.016765 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:22:31.020636 [info ] [MainThread]: 
[0m13:22:31.096893 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m13:22:31.099949 [debug] [Thread-2  ]: Began running node model.ck_project.dim_payment_state
[0m13:22:31.102470 [debug] [Thread-3  ]: Began running node model.ck_project.silver_link_transactions
[0m13:22:31.105025 [debug] [Thread-4  ]: Began running node model.ck_project.silver_merchants
[0m13:22:31.108230 [info ] [Thread-1  ]: 1 of 7 START sql table model gold.dim_payment_method ........................... [RUN]
[0m13:22:31.113909 [info ] [Thread-2  ]: 2 of 7 START sql table model gold.dim_payment_state ............................ [RUN]
[0m13:22:31.117560 [info ] [Thread-3  ]: 3 of 7 START sql incremental model silver.link_transactions .................... [RUN]
[0m13:22:31.120615 [info ] [Thread-4  ]: 4 of 7 START sql incremental model silver.merchants ............................ [RUN]
[0m13:22:31.124696 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_method)
[0m13:22:31.128888 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m13:22:31.133174 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ck_project.silver_link_transactions'
[0m13:22:31.137093 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ck_project.silver_merchants'
[0m13:22:31.140158 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m13:22:31.145056 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_payment_state
[0m13:22:31.147898 [debug] [Thread-3  ]: Began compiling node model.ck_project.silver_link_transactions
[0m13:22:31.151948 [debug] [Thread-4  ]: Began compiling node model.ck_project.silver_merchants
[0m13:22:31.195308 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m13:22:31.227206 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m13:22:31.251725 [debug] [Thread-3  ]: Writing injected SQL for node "model.ck_project.silver_link_transactions"
[0m13:22:31.336776 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m13:22:31.352059 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 13:22:31.153844 => 13:22:31.350675
[0m13:22:31.358436 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m13:22:31.362536 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (compile): 13:22:31.196307 => 13:22:31.360237
[0m13:22:31.379235 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (compile): 13:22:31.165145 => 13:22:31.375675
[0m13:22:31.395216 [debug] [Thread-3  ]: Began executing node model.ck_project.silver_link_transactions
[0m13:22:31.410421 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_payment_state
[0m13:22:32.032572 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m13:22:32.099055 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state__dbt_backup
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m13:22:32.111870 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method__dbt_backup
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m13:22:32.159057 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:22:32.168309 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:22:32.182670 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:22:32.198213 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:22:32.235227 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:22:32.240966 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:22:32.266951 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m13:22:32.282607 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m13:22:32.284599 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  SELECT
    countIf(name='id')            AS c_id,
    countIf(name='acquirer_id')   AS c_acquirer_id,
    countIf(name='name')          AS c_name,
    countIf(name='state')         AS c_state,
    countIf(name='created_at')    AS c_created_at,
    countIf(name='updated_at')    AS c_updated_at,
    countIf(name='_ingested_at')  AS c_ingested_at,
    countIf(name='_snapshot_date')AS c_snapshot_date
  FROM system.columns
  WHERE database = 'bronze' AND table = 'merchants'

  ...
[0m13:22:32.307490 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:22:32.319845 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method__dbt_backup
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m13:22:32.327422 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state__dbt_backup
        ("link_state_sk", "link_state_name", "is_final_state", "is_payment_reached_provider")


WITH st AS (
    SELECT toUInt8(1) AS link_state_sk, 'settled'            AS link_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
  
  ...
[0m13:22:32.325623 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.silver_merchants"
[0m13:22:32.354766 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:22:32.372469 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:22:32.376868 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.380229 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:22:32.401079 [debug] [Thread-3  ]: Writing runtime sql for node "model.ck_project.silver_link_transactions"
[0m13:22:32.412023 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */
EXCHANGE TABLES gold.dim_payment_method__dbt_backup AND gold.dim_payment_method 
  
  ...
[0m13:22:32.418786 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */
EXCHANGE TABLES gold.dim_payment_state__dbt_backup AND gold.dim_payment_state 
  
  ...
[0m13:22:32.421395 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (compile): 13:22:31.237099 => 13:22:32.420507
[0m13:22:32.429098 [debug] [Thread-4  ]: Began executing node model.ck_project.silver_merchants
[0m13:22:32.430974 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.439054 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.480821 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:22:32.517256 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

        insert into silver.link_transactions
        ("transaction_id", "state", "reference", "details", "created_at", "updated_at", "_snapshot_date")



with base as (
  select
    -- make key non-nullable in the schema; also exclude null id upstream
    assumeNotNull(toUInt64OrNull(id))                      as transaction_id,
    state,
    linkpay_reference                                      as reference,
    payment_details                                        as details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                 as _snapshot_date
  from bronze.link_transactions
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    -- pick latest by ingestion time
    argMax(state, _ingested_at)                                     as state,
    argMax(reference, _ingested_at)                                  as reference,
    argMax(details, _ingested_at)                                    as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))  as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))  as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


-- first build
select * from agg_day

  
    ...
[0m13:22:32.559700 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m13:22:32.621090 [debug] [Thread-4  ]: Writing runtime sql for node "model.ck_project.silver_merchants"
[0m13:22:32.664940 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:22:32.667041 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:22:32.687047 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.692292 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:22:32.697062 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m13:22:32.735388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    drop table if exists gold.dim_payment_method__dbt_backup 
  ...
[0m13:22:32.750088 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

        insert into silver.merchants
        ("merchant_id", "_snapshot_date", "acquirer_id", "merchant_name", "state", "created_at", "updated_at", "dim_fingerprint")





with day_rows as (
  select
      toUInt64OrNull(id)                         as merchant_id_raw,
      toUInt64OrNull(acquirer_id)                as acquirer_id_raw,
      nullIf(name,'')                            as merchant_name_raw,
      state                                      as state_raw,
      created_at                                 as created_at_raw,
      updated_at                                 as updated_at_raw,
      _ingested_at,
      toDate(_snapshot_date)                     as _snapshot_date
  from bronze.merchants
  
),
agg as (
  select
      merchant_id_raw                                              as merchant_id_nullable,
      _snapshot_date,
      argMax(acquirer_id_raw, _ingested_at)                        as acquirer_id,
      argMax(merchant_name_raw, _ingested_at)                      as merchant_name,
      toLowCardinality(argMax(state_raw, _ingested_at))            as state,
      parseDateTimeBestEffortOrNull(argMax(created_at_raw, _ingested_at)) as created_at,
      parseDateTimeBestEffortOrNull(argMax(updated_at_raw, _ingested_at)) as updated_at
  from day_rows
  where merchant_id_raw is not null
  group by merchant_id_nullable, _snapshot_date
)
select
  toUInt64(merchant_id_nullable)                as merchant_id,      -- <- NON-NULLABLE for ORDER BY
  _snapshot_date,                                                   -- <- NON-NULLABLE Date
  acquirer_id,
  merchant_name,
  state,
  created_at,
  updated_at,
  cityHash64(
    concat(
      toString(merchant_id),'|',
      ifNull(toString(acquirer_id),''),'|',
      ifNull(merchant_name,''),'|',
      ifNull(state,''),'|',
      ifNull(toString(created_at),''),'|',
      ifNull(toString(updated_at),'')
    )
  ) as dim_fingerprint
from agg

  
    ...
[0m13:22:32.754990 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    drop table if exists gold.dim_payment_state__dbt_backup 
  ...
[0m13:22:32.768764 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    select name, type from system.columns where table = 'link_transactions'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:22:32.774847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.779842 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.791484 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:32.793919 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 13:22:31.365644 => 13:22:32.787772
[0m13:22:32.799768 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_payment_state (execute): 13:22:31.435021 => 13:22:32.799027
[0m13:22:32.822333 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c6da9bb0>]}
[0m13:22:32.824156 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ck_project.silver_link_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_link_transactions"} */

    
  alter table silver.link_transactions 
   modify comment 
  $dbt_comment_literal_block$Link transactions cleaned$dbt_comment_literal_block$

  ...
[0m13:22:32.828029 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c6d7f6d0>]}
[0m13:22:32.831490 [info ] [Thread-1  ]: 1 of 7 OK created sql table model gold.dim_payment_method ...................... [OK in 1.70s]
[0m13:22:32.843866 [info ] [Thread-2  ]: 2 of 7 OK created sql table model gold.dim_payment_state ....................... [OK in 1.70s]
[0m13:22:32.851771 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m13:22:32.875292 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_payment_state
[0m13:22:32.877630 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m13:22:32.884734 [debug] [Thread-1  ]: Began running node model.ck_project.silver_payments
[0m13:22:32.902133 [debug] [Thread-3  ]: Timing info for model.ck_project.silver_link_transactions (execute): 13:22:31.417520 => 13:22:32.901437
[0m13:22:32.904482 [info ] [Thread-1  ]: 5 of 7 START sql incremental model silver.payments ............................. [RUN]
[0m13:22:32.912313 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c6d89070>]}
[0m13:22:32.916762 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_method, now model.ck_project.silver_payments)
[0m13:22:32.920182 [info ] [Thread-3  ]: 3 of 7 OK created sql incremental model silver.link_transactions ............... [OK in 1.78s]
[0m13:22:32.923956 [debug] [Thread-1  ]: Began compiling node model.ck_project.silver_payments
[0m13:22:32.929270 [debug] [Thread-3  ]: Finished running node model.ck_project.silver_link_transactions
[0m13:22:32.939510 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.17 seconds
[0m13:22:33.001067 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.silver_payments"
[0m13:22:33.007994 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    select name, type from system.columns where table = 'merchants'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:22:33.023674 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:33.041960 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.silver_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_merchants"} */

    
  alter table silver.merchants 
   modify comment 
  $dbt_comment_literal_block$Merchants deduped$dbt_comment_literal_block$

  ...
[0m13:22:33.053270 [debug] [Thread-1  ]: Timing info for model.ck_project.silver_payments (compile): 13:22:32.931310 => 13:22:33.052359
[0m13:22:33.057127 [debug] [Thread-1  ]: Began executing node model.ck_project.silver_payments
[0m13:22:33.072251 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:22:33.083790 [debug] [Thread-4  ]: Timing info for model.ck_project.silver_merchants (execute): 13:22:32.432316 => 13:22:33.083383
[0m13:22:33.098814 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c4242fd0>]}
[0m13:22:33.102548 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:22:33.105243 [info ] [Thread-4  ]: 4 of 7 OK created sql incremental model silver.merchants ....................... [OK in 1.96s]
[0m13:22:33.114197 [debug] [Thread-4  ]: Finished running node model.ck_project.silver_merchants
[0m13:22:33.118611 [debug] [Thread-2  ]: Began running node model.ck_project.dim_merchants
[0m13:22:33.121159 [info ] [Thread-2  ]: 6 of 7 START sql table model gold.dim_merchants ................................ [RUN]
[0m13:22:33.127623 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly model.ck_project.dim_payment_state, now model.ck_project.dim_merchants)
[0m13:22:33.129576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m13:22:33.131399 [debug] [Thread-2  ]: Began compiling node model.ck_project.dim_merchants
[0m13:22:33.137642 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.silver_payments"
[0m13:22:33.149699 [debug] [Thread-2  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m13:22:33.177196 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

        insert into silver.payments
        ("transaction_id", "merchant_id", "acquirer_id", "payment_state", "card_type", "reference", "order_reference", "details", "created_at", "updated_at", "_snapshot_date")





with base as (
  select
    /* make sort key non-nullable */
    cast(assumeNotNull(toUInt64OrNull(id)) as UInt64)                 as transaction_id,
    toUInt64OrNull(merchant_id)                                        as merchant_id,
    toUInt64OrNull(acquirer_id)                                        as acquirer_id,
    state,
    card_type,
    reference,
    order_reference,
    details,
    created_at,
    updated_at,
    _ingested_at,
    toDate(_snapshot_date)                                             as _snapshot_date
  from bronze.payments
  where id is not null
  
),

agg_day as (
  select
    transaction_id,
    anyHeavy(merchant_id)                                              as merchant_id,      -- stable enough; not in sort key
    anyHeavy(acquirer_id)                                              as acquirer_id,
    toLowCardinality(argMax(state, _ingested_at))                      as payment_state,
    toLowCardinality(argMax(card_type, _ingested_at))                  as card_type,
    argMax(reference, _ingested_at)                                    as reference,
    argMax(order_reference, _ingested_at)                              as order_reference,
    argMax(details, _ingested_at)                                      as details,
    parseDateTimeBestEffortOrNull(argMax(created_at, _ingested_at))    as created_at,
    parseDateTimeBestEffortOrNull(argMax(updated_at, _ingested_at))    as updated_at,
    _snapshot_date
  from base
  group by transaction_id, _snapshot_date
)


select * from agg_day

  
    ...
[0m13:22:33.179901 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_merchants (compile): 13:22:33.140179 => 13:22:33.178998
[0m13:22:33.183450 [debug] [Thread-2  ]: Began executing node model.ck_project.dim_merchants
[0m13:22:33.203585 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants__dbt_backup
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m13:22:33.235519 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:22:33.243002 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants__dbt_backup'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:22:33.257795 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:33.270385 [debug] [Thread-2  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m13:22:33.280086 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m13:22:33.309842 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    select name, type from system.columns where table = 'payments'
    
      and database = 'silver'
    
    order by position
  ...
[0m13:22:33.319738 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants__dbt_backup
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m13:22:33.324915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:33.335022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.silver_payments: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.silver_payments"} */

    
  alter table silver.payments 
   modify comment 
  $dbt_comment_literal_block$Payments cleaned$dbt_comment_literal_block$

  ...
[0m13:22:33.364365 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m13:22:33.375449 [debug] [Thread-1  ]: Timing info for model.ck_project.silver_payments (execute): 13:22:33.059595 => 13:22:33.374126
[0m13:22:33.379877 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m13:22:33.385821 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c6db6370>]}
[0m13:22:33.396212 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */
EXCHANGE TABLES gold.dim_merchants__dbt_backup AND gold.dim_merchants 
  
  ...
[0m13:22:33.398867 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model silver.payments ........................ [OK in 0.47s]
[0m13:22:33.402736 [debug] [Thread-1  ]: Finished running node model.ck_project.silver_payments
[0m13:22:33.408956 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:33.426023 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m13:22:33.437908 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:22:33.453836 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    drop table if exists gold.dim_merchants__dbt_backup 
  ...
[0m13:22:33.461596 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:22:33.468811 [debug] [Thread-2  ]: Timing info for model.ck_project.dim_merchants (execute): 13:22:33.187881 => 13:22:33.467953
[0m13:22:33.471892 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c4242fd0>]}
[0m13:22:33.475195 [info ] [Thread-2  ]: 6 of 7 OK created sql table model gold.dim_merchants ........................... [OK in 0.35s]
[0m13:22:33.479321 [debug] [Thread-2  ]: Finished running node model.ck_project.dim_merchants
[0m13:22:33.483253 [debug] [Thread-4  ]: Began running node model.ck_project.fact_transactions
[0m13:22:33.485658 [info ] [Thread-4  ]: 7 of 7 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m13:22:33.489959 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly model.ck_project.silver_merchants, now model.ck_project.fact_transactions)
[0m13:22:33.493202 [debug] [Thread-4  ]: Began compiling node model.ck_project.fact_transactions
[0m13:22:33.511070 [debug] [Thread-4  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m13:22:33.536908 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (compile): 13:22:33.494688 => 13:22:33.535857
[0m13:22:33.540307 [debug] [Thread-4  ]: Began executing node model.ck_project.fact_transactions
[0m13:22:33.559284 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



          )
        ...
[0m13:22:33.571306 [debug] [Thread-4  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (surrogate_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


with
-- Pull the basic transaction attributes, including payment_reference from JSON
txn as (
  select
      t.tx_id                                     as transactions_id,
      t.event_date                                as transaction_event_dt,
      t.merchant_id                               as merchant_id,
      -- If your JSON path differs, replace the key below
      JSONExtractString(t.details, 'payment_reference') as payment_reference
  from silver.link_transactions t
  
),


-- Collapse payments to the final observation per reference
payments_final as (
  select
      p.reference,
      -- final state per reference by latest event_date
      argMax(p.state, p.event_date)       as final_state_name,
      max(p.event_date)                   as final_payment_event_dt,
      -- also carry a representative payment_method for the reference
      argMax(p.payment_method, p.event_date) as final_payment_method
  from silver.payments p
  group by p.reference
),


-- Dimension lookups
dim_state as (
  select
      s.link_state_sk,
      s.link_state_name,
      s.is_final_state,
      s.is_payment_reached_provider
  from gold.dim_payment_state s
),


dim_merchant as (
  select
      m.merchant_id,
      m.merchant_sk
  from gold.dim_merchants m
),


dim_method as (
  select
      pm.payment_method_sk,
      pm.payment_method_name
  from gold.dim_payment_method pm
)


select
    /* --- Keys --- */
    -- Stable surrogate from tx_id + payment_reference
    toUInt64(cityHash64(concat(toString(tx.transactions_id), '|', coalesce(tx.payment_reference, '')))) as surrogate_key,


    tx.transactions_id,
    tx.payment_reference,


    -- FK to payment state (final)
    st.link_state_sk                as state_sk,


    -- FK to merchant
    dm.merchant_sk                  as merchant_sk,


    -- FK to payment method
    dpm.payment_method_sk           as payment_method_sk,


    /* --- Measures / flags --- */
    -- TRUE if final core payment state is successful ('settled'); adjust if your success criteria differ
    toUInt8(st.link_state_name = 'settled' and st.is_final_state = 1) as IsSuccessfulFinalPayment,


    -- Minutes from transaction initiation to the final payment update
    -- If no payment arrived, returns NULL
    CAST(
      ifNull(dateDiff('minute', tx.transaction_event_dt, pf.final_payment_event_dt), NULL),
      'Nullable(Int32)'
    ) as TimeBetweenInitiationAndPaymentMinutes,


    /* --- Date FK for transaction event --- */
    toUInt32(toYYYYMMDD(tx.transaction_event_dt)) as datekey


from txn tx
left join payments_final pf
  on pf.reference = tx.payment_reference


left join dim_state st
  on st.link_state_name = pf.final_state_name


left join dim_merchant dm
  on dm.merchant_id = tx.merchant_id


left join dim_method dpm
  -- case-insensitive match if your naming may vary in case
  on lower(dpm.payment_method_name) = lower(pf.final_payment_method)



          )
        
[0m13:22:33.575915 [debug] [Thread-4  ]: Timing info for model.ck_project.fact_transactions (execute): 13:22:33.542093 => 13:22:33.573953
[0m13:22:33.589942 [debug] [Thread-4  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Identifier 't.tx_id' cannot be resolved from table with name t. In scope  txn AS tx. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
  4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
  5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
  6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
  7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
  8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
  10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  23. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  24. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  25. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  26. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  27. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  28. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  29. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  30. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  31. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m13:22:33.593999 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84248fcc-ce97-49cc-9fff-7e31e3a2ec23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c6f1dcd0>]}
[0m13:22:33.596995 [error] [Thread-4  ]: 7 of 7 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.10s]
[0m13:22:33.600027 [debug] [Thread-4  ]: Finished running node model.ck_project.fact_transactions
[0m13:22:33.607328 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:22:33.609267 [debug] [MainThread]: Connection 'model.ck_project.silver_payments' was left open.
[0m13:22:33.610992 [debug] [MainThread]: On model.ck_project.silver_payments: Close
[0m13:22:33.612856 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m13:22:33.614905 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m13:22:33.616611 [debug] [MainThread]: Connection 'model.ck_project.silver_link_transactions' was left open.
[0m13:22:33.618570 [debug] [MainThread]: On model.ck_project.silver_link_transactions: Close
[0m13:22:33.620310 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m13:22:33.621986 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m13:22:33.624293 [info ] [MainThread]: 
[0m13:22:33.627411 [info ] [MainThread]: Finished running 3 table models, 4 incremental models in 0 hours 0 minutes and 4.09 seconds (4.09s).
[0m13:22:33.632855 [debug] [MainThread]: Command end result
[0m13:22:33.682772 [info ] [MainThread]: 
[0m13:22:33.685583 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m13:22:33.687174 [info ] [MainThread]: 
[0m13:22:33.689536 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m13:22:33.693087 [error] [MainThread]:   Code: 47.
[0m13:22:33.694818 [error] [MainThread]:   DB::Exception: Identifier 't.tx_id' cannot be resolved from table with name t. In scope  txn AS tx. Stack trace:
[0m13:22:33.697598 [error] [MainThread]:   
[0m13:22:33.699362 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m13:22:33.701853 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m13:22:33.704203 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m13:22:33.707498 [error] [MainThread]:   3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
[0m13:22:33.711123 [error] [MainThread]:   4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
[0m13:22:33.713741 [error] [MainThread]:   5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
[0m13:22:33.716177 [error] [MainThread]:   6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
[0m13:22:33.718737 [error] [MainThread]:   7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
[0m13:22:33.720380 [error] [MainThread]:   8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
[0m13:22:33.723044 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
[0m13:22:33.725391 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m13:22:33.728639 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m13:22:33.730508 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m13:22:33.731976 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m13:22:33.734871 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m13:22:33.738763 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:22:33.741212 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:22:33.743698 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:22:33.745112 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:22:33.747322 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:22:33.748899 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:22:33.750442 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m13:22:33.751847 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m13:22:33.754140 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m13:22:33.756988 [error] [MainThread]:   24. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m13:22:33.759291 [error] [MainThread]:   25. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m13:22:33.761858 [error] [MainThread]:   26. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m13:22:33.764059 [error] [MainThread]:   27. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m13:22:33.766400 [error] [MainThread]:   28. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m13:22:33.768720 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m13:22:33.770485 [error] [MainThread]:   30. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m13:22:33.772377 [error] [MainThread]:   31. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m13:22:33.775289 [info ] [MainThread]: 
[0m13:22:33.776956 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=0 TOTAL=7
[0m13:22:33.779051 [debug] [MainThread]: Command `dbt run` failed at 13:22:33.778810 after 15.47 seconds
[0m13:22:33.780451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4d0287430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4ce7710d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79a4c6f266a0>]}
[0m13:22:33.782605 [debug] [MainThread]: Flushing usage events
[0m13:59:49.874261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac3a86490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac452ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac453e790>]}


============================== 13:59:49.881341 | fbdad851-dc6f-436a-ac9f-26dd43349037 ==============================
[0m13:59:49.881341 [info ] [MainThread]: Running with dbt=1.5.9
[0m13:59:49.883781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m13:59:49.989134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac452dfd0>]}
[0m13:59:50.018261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac1fe1ee0>]}
[0m13:59:50.020446 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m13:59:50.050012 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m13:59:50.058640 [debug] [MainThread]: Partial parsing not enabled
[0m13:59:51.567550 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m13:59:51.587004 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m13:59:51.590758 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m13:59:51.597868 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m13:59:51.601771 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m13:59:51.605773 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m13:59:51.611388 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m13:59:51.623349 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m13:59:51.627713 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m13:59:51.639119 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m13:59:51.643649 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m13:59:51.669932 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m13:59:51.673853 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m13:59:51.685015 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m13:59:52.014707 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m13:59:52.035931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac1e636a0>]}
[0m13:59:52.102713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac1e638b0>]}
[0m13:59:52.105057 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m13:59:52.106280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac205b7f0>]}
[0m13:59:52.108710 [info ] [MainThread]: 
[0m13:59:52.112092 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m13:59:52.115966 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m13:59:52.127667 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:59:52.369381 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m13:59:52.374223 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m13:59:52.378471 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m13:59:52.379875 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m13:59:52.388205 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m13:59:52.391416 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:59:52.401713 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:59:52.469164 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m13:59:52.476306 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m13:59:52.479416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac1d1f8b0>]}
[0m13:59:52.481146 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:59:52.482578 [info ] [MainThread]: 
[0m13:59:52.499697 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m13:59:52.501560 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m13:59:52.502849 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m13:59:52.503527 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m13:59:52.514403 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m13:59:52.527002 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 13:59:52.504056 => 13:59:52.526630
[0m13:59:52.527931 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m13:59:52.646835 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, ''),
        -- last resort: regex pull from raw string (returns capture group 1)
        nullIf(
          regexpExtract(
            details_json,
            '(?i)"?payment[_ ]?ref(?:erence)?"?\\s*[:=]\\s*["\\\']?([A-Za-z0-9._:-]+)',
            1
          ),
          ''
        )
      ) AS payment_reference
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m13:59:52.655734 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, ''),
        -- last resort: regex pull from raw string (returns capture group 1)
        nullIf(
          regexpExtract(
            details_json,
            '(?i)"?payment[_ ]?ref(?:erence)?"?\\s*[:=]\\s*["\\\']?([A-Za-z0-9._:-]+)',
            1
          ),
          ''
        )
      ) AS payment_reference
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m13:59:52.657380 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 13:59:52.528552 => 13:59:52.657043
[0m13:59:52.663120 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 4292 ()) (line 142, col 11): )
          . Unmatched parentheses: ). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
  2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
  3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
  4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
  5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  7. DB::TCPHandler::run() @ 0x0000000019e4f119
  8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  10. Poco::PooledThread::run() @ 0x000000001ef15b87
  11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  12. ? @ 0x0000000000094ac3
  13. ? @ 0x0000000000125a74
[0m13:59:52.665752 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fbdad851-dc6f-436a-ac9f-26dd43349037', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786aba74bee0>]}
[0m13:59:52.667089 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.16s]
[0m13:59:52.668531 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m13:59:52.671855 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:59:52.672718 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m13:59:52.673441 [debug] [MainThread]: On list__silver: Close
[0m13:59:52.674090 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m13:59:52.674795 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m13:59:52.675719 [info ] [MainThread]: 
[0m13:59:52.676968 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m13:59:52.678026 [debug] [MainThread]: Command end result
[0m13:59:52.708211 [info ] [MainThread]: 
[0m13:59:52.709743 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m13:59:52.711948 [info ] [MainThread]: 
[0m13:59:52.713181 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m13:59:52.715183 [error] [MainThread]:   Code: 62.
[0m13:59:52.716625 [error] [MainThread]:   DB::Exception: Syntax error: failed at position 4292 ()) (line 142, col 11): )
[0m13:59:52.717927 [error] [MainThread]:           . Unmatched parentheses: ). Stack trace:
[0m13:59:52.719287 [error] [MainThread]:   
[0m13:59:52.721038 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m13:59:52.722076 [error] [MainThread]:   1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
[0m13:59:52.722958 [error] [MainThread]:   2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
[0m13:59:52.723853 [error] [MainThread]:   3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
[0m13:59:52.724633 [error] [MainThread]:   4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
[0m13:59:52.725765 [error] [MainThread]:   5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m13:59:52.727928 [error] [MainThread]:   6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m13:59:52.728913 [error] [MainThread]:   7. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m13:59:52.729973 [error] [MainThread]:   8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m13:59:52.733198 [error] [MainThread]:   9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m13:59:52.735066 [error] [MainThread]:   10. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m13:59:52.736898 [error] [MainThread]:   11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m13:59:52.738187 [error] [MainThread]:   12. ? @ 0x0000000000094ac3
[0m13:59:52.739334 [error] [MainThread]:   13. ? @ 0x0000000000125a74
[0m13:59:52.740452 [info ] [MainThread]: 
[0m13:59:52.741628 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:59:52.742889 [debug] [MainThread]: Command `dbt run` failed at 13:59:52.742712 after 2.91 seconds
[0m13:59:52.743847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac3a86490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786ac1fe1ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x786aba771e80>]}
[0m13:59:52.744598 [debug] [MainThread]: Flushing usage events
[0m14:03:35.095533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29cfee4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29da24df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29da35760>]}


============================== 14:03:35.102392 | fb28adde-8c5b-4ee9-9f1f-a415cf812626 ==============================
[0m14:03:35.102392 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:03:35.103457 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:03:35.227649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29da24e50>]}
[0m14:03:35.262591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29b566ee0>]}
[0m14:03:35.264289 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:03:35.291783 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:03:35.299978 [debug] [MainThread]: Partial parsing not enabled
[0m14:03:36.768279 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:03:36.780738 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:03:36.783421 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:03:36.789625 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:03:36.793372 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:03:36.798870 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:03:36.804358 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:03:36.820321 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:03:36.824936 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:03:36.842387 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:03:36.845241 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:03:36.866975 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:03:36.872067 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:03:36.884328 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:03:37.213731 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:03:37.222590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29b3636a0>]}
[0m14:03:37.254931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29b363850>]}
[0m14:03:37.256467 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:03:37.258530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29b4dc7f0>]}
[0m14:03:37.262410 [info ] [MainThread]: 
[0m14:03:37.264242 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:03:37.266612 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:03:37.276031 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:03:37.513564 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:03:37.519092 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:03:37.523511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:03:37.524624 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:03:37.531885 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:03:37.534484 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:03:37.542712 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:03:37.590759 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:03:37.597376 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:03:37.600896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29b21d8b0>]}
[0m14:03:37.602239 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:03:37.603183 [info ] [MainThread]: 
[0m14:03:37.624645 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:03:37.626071 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:03:37.628436 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:03:37.629484 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:03:37.643627 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:03:37.659463 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:03:37.630196 => 14:03:37.658763
[0m14:03:37.660574 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:03:37.753394 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, ''),
        -- last resort: regex pull from raw string (returns capture group 1)
      ) AS payment_reference
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:03:37.757999 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, ''),
        -- last resort: regex pull from raw string (returns capture group 1)
      ) AS payment_reference
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:03:37.759675 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:03:37.661400 => 14:03:37.759342
[0m14:03:37.762992 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 4087 ()) (line 134, col 11): )
          . Unmatched parentheses: ). Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
  2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
  3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
  4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
  5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  7. DB::TCPHandler::run() @ 0x0000000019e4f119
  8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  10. Poco::PooledThread::run() @ 0x000000001ef15b87
  11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  12. ? @ 0x0000000000094ac3
  13. ? @ 0x0000000000125a74
[0m14:03:37.764146 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fb28adde-8c5b-4ee9-9f1f-a415cf812626', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29845c6a0>]}
[0m14:03:37.765221 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.14s]
[0m14:03:37.766246 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:03:37.769494 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:03:37.770493 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:03:37.771344 [debug] [MainThread]: On list__silver: Close
[0m14:03:37.772322 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:03:37.773243 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:03:37.773805 [info ] [MainThread]: 
[0m14:03:37.774570 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m14:03:37.775813 [debug] [MainThread]: Command end result
[0m14:03:37.804659 [info ] [MainThread]: 
[0m14:03:37.806118 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:03:37.807233 [info ] [MainThread]: 
[0m14:03:37.809060 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:03:37.810206 [error] [MainThread]:   Code: 62.
[0m14:03:37.811303 [error] [MainThread]:   DB::Exception: Syntax error: failed at position 4087 ()) (line 134, col 11): )
[0m14:03:37.812748 [error] [MainThread]:           . Unmatched parentheses: ). Stack trace:
[0m14:03:37.813600 [error] [MainThread]:   
[0m14:03:37.814444 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:03:37.815168 [error] [MainThread]:   1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
[0m14:03:37.816096 [error] [MainThread]:   2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
[0m14:03:37.817486 [error] [MainThread]:   3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
[0m14:03:37.818962 [error] [MainThread]:   4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
[0m14:03:37.819938 [error] [MainThread]:   5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:03:37.820972 [error] [MainThread]:   6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:03:37.821978 [error] [MainThread]:   7. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:03:37.823880 [error] [MainThread]:   8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:03:37.825301 [error] [MainThread]:   9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:03:37.826534 [error] [MainThread]:   10. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:03:37.827998 [error] [MainThread]:   11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:03:37.829272 [error] [MainThread]:   12. ? @ 0x0000000000094ac3
[0m14:03:37.830251 [error] [MainThread]:   13. ? @ 0x0000000000125a74
[0m14:03:37.831435 [info ] [MainThread]: 
[0m14:03:37.832567 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:03:37.833685 [debug] [MainThread]: Command `dbt run` failed at 14:03:37.833544 after 2.77 seconds
[0m14:03:37.834355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29cfee4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d29b566ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71d2984aafd0>]}
[0m14:03:37.834989 [debug] [MainThread]: Flushing usage events
[0m14:07:30.559313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd7e18430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd87cedc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd87cee50>]}


============================== 14:07:30.567438 | 135c8766-7eb1-4539-bdaf-ba36eb450094 ==============================
[0m14:07:30.567438 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:07:30.569616 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:07:30.703228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd87ced60>]}
[0m14:07:30.730826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd635de80>]}
[0m14:07:30.732841 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:07:30.760516 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:07:30.769834 [debug] [MainThread]: Partial parsing not enabled
[0m14:07:32.177729 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:07:32.190364 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:07:32.194196 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:07:32.203453 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:07:32.206549 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:07:32.211833 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:07:32.217520 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:07:32.232170 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:07:32.235195 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:07:32.243452 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:07:32.247235 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:07:32.272224 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:07:32.275461 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:07:32.286859 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:07:32.669102 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:07:32.675791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd6215790>]}
[0m14:07:32.707737 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd6215820>]}
[0m14:07:32.709691 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:07:32.710768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd63db790>]}
[0m14:07:32.713544 [info ] [MainThread]: 
[0m14:07:32.715537 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:07:32.718340 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:07:32.726865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:07:32.948977 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:07:32.954738 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:07:32.959476 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:07:32.961102 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:07:32.970807 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:07:32.973986 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:07:32.984020 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:07:33.038902 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:07:33.047870 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:07:33.052735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779baf0e4d90>]}
[0m14:07:33.054033 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:07:33.054899 [info ] [MainThread]: 
[0m14:07:33.074411 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:07:33.075725 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:07:33.077727 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:07:33.078670 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:07:33.091920 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:07:33.111023 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:07:33.079343 => 14:07:33.110582
[0m14:07:33.112182 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:07:33.209078 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, ''),
        -- last resort: regex pull from raw string (returns capture group 1)
      ) AS payment_reference,
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:07:33.213683 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, ''),
        -- last resort: regex pull from raw string (returns capture group 1)
      ) AS payment_reference,
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:07:33.215521 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:07:33.113160 => 14:07:33.215168
[0m14:07:33.221411 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 1478 ()) (line 45, col 7): ) AS payment_reference,
    FROM tx_raw
  )
  
  
  
  -- 2) Payments collapsed to the final state per reference
  pay_final AS (
    SELECT
        reference                             ... Expected one of: CAST operator, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
  2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
  3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
  4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
  5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  7. DB::TCPHandler::run() @ 0x0000000019e4f119
  8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  10. Poco::PooledThread::run() @ 0x000000001ef15b87
  11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  12. ? @ 0x0000000000094ac3
  13. ? @ 0x0000000000125a74
[0m14:07:33.223326 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '135c8766-7eb1-4539-bdaf-ba36eb450094', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bae6e7550>]}
[0m14:07:33.225254 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.15s]
[0m14:07:33.227418 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:07:33.232697 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:07:33.234143 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:07:33.235283 [debug] [MainThread]: On list__gold: Close
[0m14:07:33.236601 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:07:33.237652 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:07:33.238661 [info ] [MainThread]: 
[0m14:07:33.239695 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.52 seconds (0.52s).
[0m14:07:33.241014 [debug] [MainThread]: Command end result
[0m14:07:33.269421 [info ] [MainThread]: 
[0m14:07:33.270882 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:07:33.272295 [info ] [MainThread]: 
[0m14:07:33.273502 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:07:33.274694 [error] [MainThread]:   Code: 62.
[0m14:07:33.275905 [error] [MainThread]:   DB::Exception: Syntax error: failed at position 1478 ()) (line 45, col 7): ) AS payment_reference,
[0m14:07:33.277820 [error] [MainThread]:     FROM tx_raw
[0m14:07:33.278839 [error] [MainThread]:   )
[0m14:07:33.279629 [error] [MainThread]:   
[0m14:07:33.280436 [error] [MainThread]:   
[0m14:07:33.281589 [error] [MainThread]:   
[0m14:07:33.282683 [error] [MainThread]:   -- 2) Payments collapsed to the final state per reference
[0m14:07:33.283891 [error] [MainThread]:   pay_final AS (
[0m14:07:33.284676 [error] [MainThread]:     SELECT
[0m14:07:33.286883 [error] [MainThread]:         reference                             ... Expected one of: CAST operator, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. Stack trace:
[0m14:07:33.288240 [error] [MainThread]:   
[0m14:07:33.289311 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:07:33.290445 [error] [MainThread]:   1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
[0m14:07:33.291597 [error] [MainThread]:   2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
[0m14:07:33.292324 [error] [MainThread]:   3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
[0m14:07:33.292954 [error] [MainThread]:   4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
[0m14:07:33.293773 [error] [MainThread]:   5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:07:33.294688 [error] [MainThread]:   6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:07:33.295774 [error] [MainThread]:   7. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:07:33.297425 [error] [MainThread]:   8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:07:33.298954 [error] [MainThread]:   9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:07:33.300007 [error] [MainThread]:   10. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:07:33.300893 [error] [MainThread]:   11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:07:33.301949 [error] [MainThread]:   12. ? @ 0x0000000000094ac3
[0m14:07:33.302658 [error] [MainThread]:   13. ? @ 0x0000000000125a74
[0m14:07:33.303624 [info ] [MainThread]: 
[0m14:07:33.304578 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:07:33.306452 [debug] [MainThread]: Command `dbt run` failed at 14:07:33.306050 after 2.79 seconds
[0m14:07:33.307998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd7e18430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bd6192dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x779bae7130d0>]}
[0m14:07:33.308923 [debug] [MainThread]: Flushing usage events
[0m14:11:15.161817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dada1483430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dada1f14d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dada1f14df0>]}


============================== 14:11:15.168696 | bebe3ecc-733e-4104-9c5b-f047b1850c2a ==============================
[0m14:11:15.168696 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:11:15.170031 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:11:15.281533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dada1f14dc0>]}
[0m14:11:15.304112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9f9d8df0>]}
[0m14:11:15.305991 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:11:15.338719 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:11:15.353137 [debug] [MainThread]: Partial parsing not enabled
[0m14:11:16.679360 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:11:16.689323 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:11:16.692820 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:11:16.699990 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:11:16.702380 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:11:16.706244 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:11:16.711945 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:11:16.721081 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:11:16.723211 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:11:16.734389 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:11:16.738787 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:11:16.764063 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:11:16.767103 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:11:16.775584 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:11:17.020891 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:11:17.030298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9f885b50>]}
[0m14:11:17.057782 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9f885d60>]}
[0m14:11:17.058852 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:11:17.060358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9fa5c730>]}
[0m14:11:17.063183 [info ] [MainThread]: 
[0m14:11:17.065384 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:11:17.068327 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:11:17.077822 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:11:17.294282 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:11:17.299405 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:11:17.303125 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:11:17.305006 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:11:17.314623 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:11:17.317314 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:11:17.324620 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:11:17.378738 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:11:17.389459 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:11:17.395106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9f71f7f0>]}
[0m14:11:17.397225 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:11:17.398648 [info ] [MainThread]: 
[0m14:11:17.427162 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:11:17.428787 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:11:17.430740 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:11:17.432296 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:11:17.449888 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:11:17.464413 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:11:17.433361 => 14:11:17.464051
[0m14:11:17.465372 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:11:17.592529 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference,
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:11:17.597271 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference,
  FROM tx_raw
)



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:11:17.599699 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:11:17.466142 => 14:11:17.599337
[0m14:11:17.604353 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 62.
  DB::Exception: Syntax error: failed at position 1508 (tx_raw) (line 46, col 8): tx_raw
  )
  
  
  
  -- 2) Payments collapsed to the final state per reference
  pay_final AS (
    SELECT
        reference                                                       AS p... Expected one of: token sequence, Dot, token, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, alias, AS, Comma, FROM, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
  2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
  3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
  4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
  5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  7. DB::TCPHandler::run() @ 0x0000000019e4f119
  8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  10. Poco::PooledThread::run() @ 0x000000001ef15b87
  11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  12. ? @ 0x0000000000094ac3
  13. ? @ 0x0000000000125a74
[0m14:11:17.606069 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bebe3ecc-733e-4104-9c5b-f047b1850c2a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9c5d20d0>]}
[0m14:11:17.607780 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.18s]
[0m14:11:17.609668 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:11:17.614119 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:11:17.615423 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:11:17.616400 [debug] [MainThread]: On list__silver: Close
[0m14:11:17.617523 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:11:17.618536 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:11:17.619760 [info ] [MainThread]: 
[0m14:11:17.621462 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.56 seconds (0.56s).
[0m14:11:17.623388 [debug] [MainThread]: Command end result
[0m14:11:17.670639 [info ] [MainThread]: 
[0m14:11:17.672247 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:11:17.673950 [info ] [MainThread]: 
[0m14:11:17.675822 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:11:17.678024 [error] [MainThread]:   Code: 62.
[0m14:11:17.679508 [error] [MainThread]:   DB::Exception: Syntax error: failed at position 1508 (tx_raw) (line 46, col 8): tx_raw
[0m14:11:17.681384 [error] [MainThread]:   )
[0m14:11:17.683407 [error] [MainThread]:   
[0m14:11:17.684875 [error] [MainThread]:   
[0m14:11:17.686167 [error] [MainThread]:   
[0m14:11:17.688216 [error] [MainThread]:   -- 2) Payments collapsed to the final state per reference
[0m14:11:17.690166 [error] [MainThread]:   pay_final AS (
[0m14:11:17.691725 [error] [MainThread]:     SELECT
[0m14:11:17.693900 [error] [MainThread]:         reference                                                       AS p... Expected one of: token sequence, Dot, token, OR, AND, IS NOT DISTINCT FROM, IS NULL, IS NOT NULL, BETWEEN, NOT BETWEEN, LIKE, ILIKE, NOT LIKE, NOT ILIKE, REGEXP, IN, NOT IN, GLOBAL IN, GLOBAL NOT IN, MOD, DIV, alias, AS, Comma, FROM, PREWHERE, WHERE, GROUP BY, WITH, HAVING, WINDOW, QUALIFY, ORDER BY, LIMIT, OFFSET, FETCH, SETTINGS, UNION, EXCEPT, INTERSECT. Stack trace:
[0m14:11:17.695599 [error] [MainThread]:   
[0m14:11:17.697439 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:11:17.698789 [error] [MainThread]:   1. DB::Exception::Exception(String const&, int, String, bool) @ 0x0000000012423c8e
[0m14:11:17.700015 [error] [MainThread]:   2. DB::Exception::createDeprecated(String const&, int, bool) @ 0x0000000013a54f9f
[0m14:11:17.701760 [error] [MainThread]:   3. DB::parseQueryAndMovePosition(DB::IParser&, char const*&, char const*, String const&, bool, unsigned long, unsigned long, unsigned long) @ 0x000000001aace132
[0m14:11:17.703404 [error] [MainThread]:   4. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018779652
[0m14:11:17.704887 [error] [MainThread]:   5. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:11:17.705890 [error] [MainThread]:   6. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:11:17.707018 [error] [MainThread]:   7. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:11:17.708284 [error] [MainThread]:   8. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:11:17.709757 [error] [MainThread]:   9. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:11:17.711508 [error] [MainThread]:   10. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:11:17.713090 [error] [MainThread]:   11. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:11:17.714374 [error] [MainThread]:   12. ? @ 0x0000000000094ac3
[0m14:11:17.716007 [error] [MainThread]:   13. ? @ 0x0000000000125a74
[0m14:11:17.717784 [info ] [MainThread]: 
[0m14:11:17.720083 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:11:17.722367 [debug] [MainThread]: Command `dbt run` failed at 14:11:17.722151 after 2.60 seconds
[0m14:11:17.723842 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dada1483430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9f8ad670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dad9f9d8df0>]}
[0m14:11:17.725735 [debug] [MainThread]: Flushing usage events
[0m14:13:18.323966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9e59d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9eff5fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9eff5df0>]}


============================== 14:13:18.330662 | cafa3a29-66fe-4102-b0e8-29ce0fb86e5d ==============================
[0m14:13:18.330662 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:13:18.331931 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:13:18.444690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9eff5e50>]}
[0m14:13:18.466396 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9cb30eb0>]}
[0m14:13:18.468057 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:13:18.501231 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:13:18.509266 [debug] [MainThread]: Partial parsing not enabled
[0m14:13:20.021804 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:13:20.035092 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:13:20.038869 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:13:20.045104 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:13:20.048250 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:13:20.051975 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:13:20.058221 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:13:20.067728 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:13:20.070483 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:13:20.084484 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:13:20.087787 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:13:20.109405 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:13:20.112259 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:13:20.120370 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:13:20.347302 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:13:20.355033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9c97a670>]}
[0m14:13:20.387138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9c97a070>]}
[0m14:13:20.388673 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:13:20.389787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9c955790>]}
[0m14:13:20.392030 [info ] [MainThread]: 
[0m14:13:20.393268 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:13:20.395269 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:13:20.404442 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:13:20.614217 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:13:20.619195 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:13:20.623130 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:13:20.624660 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:13:20.631680 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:13:20.633750 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:13:20.642734 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:13:20.692612 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:13:20.700012 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:13:20.703231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9c7e0880>]}
[0m14:13:20.704387 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:13:20.705431 [info ] [MainThread]: 
[0m14:13:20.722292 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:13:20.723347 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:13:20.724547 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:13:20.725402 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:13:20.735164 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:13:20.753256 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:13:20.726261 => 14:13:20.752761
[0m14:13:20.754636 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:13:20.834322 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:13:20.854645 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      parseDateTimeBestEffortOrNull(created_at)                       AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:13:20.858362 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:13:20.755388 => 14:13:20.857664
[0m14:13:20.863329 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 43.
  DB::Exception: Illegal type DateTime of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: In scope  tx_raw. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000cae72ab
  4. DB::detail::FunctionConvertFromString<DB::DataTypeDateTime, DB::detail::NameParseDateTimeBestEffortOrNull, (DB::detail::ConvertFromStringExceptionMode)2, (DB::detail::ConvertFromStringParsingMode)1>::getReturnTypeImpl(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x000000000a5f0665
  5. DB::IFunctionOverloadResolver::getReturnTypeWithoutLowCardinality(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422531
  6. DB::IFunctionOverloadResolver::getReturnType(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x00000000164221b1
  7. DB::IFunctionOverloadResolver::build(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422ac6
  8. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aabd41
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  15. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  16. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  17. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  18. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  20. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  22. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  24. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  25. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  26. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  27. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  28. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  29. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  30. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  31. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:13:20.865600 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cafa3a29-66fe-4102-b0e8-29ce0fb86e5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9901a670>]}
[0m14:13:20.867564 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.14s]
[0m14:13:20.869361 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:13:20.873733 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:13:20.875496 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:13:20.876434 [debug] [MainThread]: On list__silver: Close
[0m14:13:20.878359 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:13:20.879363 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:13:20.880090 [info ] [MainThread]: 
[0m14:13:20.881226 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.49 seconds (0.49s).
[0m14:13:20.882425 [debug] [MainThread]: Command end result
[0m14:13:20.912525 [info ] [MainThread]: 
[0m14:13:20.913481 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:13:20.914509 [info ] [MainThread]: 
[0m14:13:20.915513 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:13:20.916705 [error] [MainThread]:   Code: 43.
[0m14:13:20.917811 [error] [MainThread]:   DB::Exception: Illegal type DateTime of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: In scope  tx_raw. Stack trace:
[0m14:13:20.918707 [error] [MainThread]:   
[0m14:13:20.919584 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:13:20.920574 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:13:20.921390 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:13:20.922453 [error] [MainThread]:   3. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000cae72ab
[0m14:13:20.923451 [error] [MainThread]:   4. DB::detail::FunctionConvertFromString<DB::DataTypeDateTime, DB::detail::NameParseDateTimeBestEffortOrNull, (DB::detail::ConvertFromStringExceptionMode)2, (DB::detail::ConvertFromStringParsingMode)1>::getReturnTypeImpl(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x000000000a5f0665
[0m14:13:20.924443 [error] [MainThread]:   5. DB::IFunctionOverloadResolver::getReturnTypeWithoutLowCardinality(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422531
[0m14:13:20.925408 [error] [MainThread]:   6. DB::IFunctionOverloadResolver::getReturnType(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x00000000164221b1
[0m14:13:20.926703 [error] [MainThread]:   7. DB::IFunctionOverloadResolver::build(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422ac6
[0m14:13:20.928229 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aabd41
[0m14:13:20.929152 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:13:20.930064 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:13:20.930778 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:13:20.931624 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:13:20.932523 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:13:20.933314 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:13:20.933983 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:13:20.934668 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:13:20.935628 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:13:20.937032 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:13:20.938670 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:13:20.939692 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:13:20.940639 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:13:20.941453 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:13:20.942319 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:13:20.943148 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:13:20.943971 [error] [MainThread]:   25. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:13:20.944793 [error] [MainThread]:   26. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:13:20.945528 [error] [MainThread]:   27. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:13:20.946475 [error] [MainThread]:   28. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:13:20.947847 [error] [MainThread]:   29. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:13:20.949075 [error] [MainThread]:   30. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:13:20.949934 [error] [MainThread]:   31. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:13:20.950912 [info ] [MainThread]: 
[0m14:13:20.951828 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:13:20.953099 [debug] [MainThread]: Command `dbt run` failed at 14:13:20.952980 after 2.67 seconds
[0m14:13:20.954211 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9e59d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9cb30eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b8c9ca9cc40>]}
[0m14:13:20.955124 [debug] [MainThread]: Flushing usage events
[0m14:16:39.298105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa61daf490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa62805dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa62816790>]}


============================== 14:16:39.305479 | 66b6c4c6-3366-4e3d-bf86-358afb38fe64 ==============================
[0m14:16:39.305479 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:16:39.306582 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:16:39.412373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa62805fd0>]}
[0m14:16:39.436204 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa602a2ee0>]}
[0m14:16:39.437333 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:16:39.455577 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:16:39.460955 [debug] [MainThread]: Partial parsing not enabled
[0m14:16:40.628431 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:16:40.641209 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:16:40.644745 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:16:40.653627 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:16:40.656773 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:16:40.661237 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:16:40.665937 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:16:40.676417 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:16:40.679555 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:16:40.689509 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:16:40.692269 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:16:40.722841 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:16:40.730775 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:16:40.740397 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:16:40.957642 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:16:40.967972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa601238e0>]}
[0m14:16:41.000082 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa60123190>]}
[0m14:16:41.001349 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:16:41.002419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa6031c7f0>]}
[0m14:16:41.005875 [info ] [MainThread]: 
[0m14:16:41.008252 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:16:41.010436 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:16:41.018128 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:41.216883 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:16:41.225742 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:16:41.229826 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:16:41.231309 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:16:41.239170 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:16:41.241690 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:41.250630 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:16:41.292165 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:16:41.297958 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:16:41.301516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa5d095df0>]}
[0m14:16:41.302847 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:16:41.304226 [info ] [MainThread]: 
[0m14:16:41.326196 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:16:41.327613 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:16:41.330387 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:16:41.331378 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:16:41.345282 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:16:41.361250 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:16:41.332045 => 14:16:41.360852
[0m14:16:41.362183 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:16:41.458162 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:16:41.482284 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(try(JSONExtractString(details_json, 'payment_reference')), ''),
        nullIf(try(JSONExtractString(details_json, 'paymentReference')), ''),
        nullIf(try(JSONExtractString(details_json, 'reference')), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:16:41.484490 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:16:41.362833 => 14:16:41.484090
[0m14:16:41.488786 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 46.
  DB::Exception: Function with name `try` does not exist. In scope  tx_norm AS t. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String, String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&, String&&) @ 0x000000000cbc05eb
  4. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aae7d7
  5. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  6. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  7. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  8. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  9. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  10. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  12. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  13. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  14. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  15. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  23. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  24. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  25. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  26. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  27. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  28. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  29. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  30. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  31. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:16:41.490201 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '66b6c4c6-3366-4e3d-bf86-358afb38fe64', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa5c6996a0>]}
[0m14:16:41.491985 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.16s]
[0m14:16:41.493859 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:16:41.498579 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:41.499746 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:16:41.500828 [debug] [MainThread]: On list__gold: Close
[0m14:16:41.502096 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:16:41.503342 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:16:41.504676 [info ] [MainThread]: 
[0m14:16:41.505774 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m14:16:41.507208 [debug] [MainThread]: Command end result
[0m14:16:41.549969 [info ] [MainThread]: 
[0m14:16:41.552020 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:16:41.554665 [info ] [MainThread]: 
[0m14:16:41.556636 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:16:41.558401 [error] [MainThread]:   Code: 46.
[0m14:16:41.560276 [error] [MainThread]:   DB::Exception: Function with name `try` does not exist. In scope  tx_norm AS t. Stack trace:
[0m14:16:41.561822 [error] [MainThread]:   
[0m14:16:41.563204 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:16:41.565737 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:16:41.567615 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:16:41.569093 [error] [MainThread]:   3. DB::Exception::Exception<String, String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&, String&&) @ 0x000000000cbc05eb
[0m14:16:41.571522 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aae7d7
[0m14:16:41.572945 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:16:41.574308 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:16:41.575560 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:16:41.577030 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:16:41.578630 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:16:41.580218 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:16:41.582299 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:16:41.583590 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:16:41.585108 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:16:41.586823 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:16:41.588307 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:16:41.589697 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:16:41.591022 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:16:41.592467 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:16:41.593694 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:16:41.595198 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:16:41.596760 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:16:41.598631 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:16:41.600203 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:16:41.601620 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:16:41.602903 [error] [MainThread]:   25. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:16:41.604174 [error] [MainThread]:   26. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:16:41.605641 [error] [MainThread]:   27. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:16:41.607778 [error] [MainThread]:   28. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:16:41.610726 [error] [MainThread]:   29. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:16:41.611965 [error] [MainThread]:   30. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:16:41.613606 [error] [MainThread]:   31. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:16:41.616104 [info ] [MainThread]: 
[0m14:16:41.618088 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:16:41.620042 [debug] [MainThread]: Command `dbt run` failed at 14:16:41.619830 after 2.35 seconds
[0m14:16:41.621574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa61daf490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa602a2ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7faa5ffdd850>]}
[0m14:16:41.622893 [debug] [MainThread]: Flushing usage events
[0m14:20:13.688102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb492f3e4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4938c8e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4938d97f0>]}


============================== 14:20:13.695335 | 44ebef7e-04ba-4c97-9641-10f60a74ff2b ==============================
[0m14:20:13.695335 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:20:13.696394 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:20:13.807190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4938c87c0>]}
[0m14:20:13.832178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb491422f10>]}
[0m14:20:13.834068 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:20:13.860135 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:20:13.869862 [debug] [MainThread]: Partial parsing not enabled
[0m14:20:15.157937 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:20:15.170475 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:20:15.175132 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:20:15.182295 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:20:15.185958 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:20:15.190652 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:20:15.196010 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:20:15.209833 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:20:15.213193 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:20:15.225176 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:20:15.228614 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:20:15.256572 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:20:15.260908 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:20:15.275896 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:20:15.519533 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:20:15.531819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4912a31c0>]}
[0m14:20:15.571386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4912a34f0>]}
[0m14:20:15.577606 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:20:15.580023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4958d2eb0>]}
[0m14:20:15.586086 [info ] [MainThread]: 
[0m14:20:15.588833 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:20:15.600364 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:20:15.614682 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:15.816066 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:20:15.819798 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:20:15.824350 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:20:15.826018 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:20:15.833262 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:20:15.836064 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:20:15.844997 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:20:15.889012 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:20:15.895414 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:20:15.898407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb48a1ccc70>]}
[0m14:20:15.899483 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:20:15.900268 [info ] [MainThread]: 
[0m14:20:15.916329 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:20:15.917283 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:20:15.918463 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:20:15.919053 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:20:15.929989 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:20:15.941918 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:20:15.919545 => 14:20:15.941366
[0m14:20:15.942859 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:20:16.021138 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:20:16.030059 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:20:16.032005 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:20:15.944042 => 14:20:16.031464
[0m14:20:16.037366 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:20:16.039361 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '44ebef7e-04ba-4c97-9641-10f60a74ff2b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb48999afa0>]}
[0m14:20:16.040626 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.12s]
[0m14:20:16.042288 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:20:16.045628 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:20:16.046575 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:20:16.047413 [debug] [MainThread]: On list__gold: Close
[0m14:20:16.048415 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:20:16.049194 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:20:16.049875 [info ] [MainThread]: 
[0m14:20:16.050644 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m14:20:16.051956 [debug] [MainThread]: Command end result
[0m14:20:16.080867 [info ] [MainThread]: 
[0m14:20:16.082276 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:20:16.083171 [info ] [MainThread]: 
[0m14:20:16.084802 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:20:16.086177 [error] [MainThread]:   Code: 47.
[0m14:20:16.087182 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
[0m14:20:16.088505 [error] [MainThread]:   
[0m14:20:16.089288 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:20:16.090074 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:20:16.090768 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:20:16.091715 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:20:16.092862 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:20:16.094200 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:20:16.095228 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:20:16.096258 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:20:16.097041 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:20:16.098115 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:20:16.099434 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:20:16.100838 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:20:16.101644 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:20:16.102538 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:20:16.103316 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:20:16.104208 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:20:16.105155 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:20:16.105967 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:20:16.106704 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:20:16.107375 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:20:16.108424 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:20:16.109477 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:20:16.110616 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:20:16.111690 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:20:16.112576 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:20:16.113385 [error] [MainThread]:   25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:20:16.114758 [error] [MainThread]:   26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:20:16.115644 [error] [MainThread]:   27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:20:16.116415 [error] [MainThread]:   28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:20:16.117535 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:20:16.118606 [error] [MainThread]:   30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:20:16.119521 [error] [MainThread]:   31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:20:16.120236 [info ] [MainThread]: 
[0m14:20:16.121034 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:20:16.122057 [debug] [MainThread]: Command `dbt run` failed at 14:20:16.121896 after 2.48 seconds
[0m14:20:16.122939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb492f3e4c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb491422f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fb4911608e0>]}
[0m14:20:16.124055 [debug] [MainThread]: Flushing usage events
[0m14:22:52.901895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce98474c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abcea29ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abcea2ab790>]}


============================== 14:22:52.908654 | 60e16f52-bc4b-4c66-b3d8-27c374a62eec ==============================
[0m14:22:52.908654 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:22:52.911301 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:22:53.052172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abcea29adc0>]}
[0m14:22:53.101801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce7d5bf10>]}
[0m14:22:53.106757 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:22:53.145050 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:22:53.157506 [debug] [MainThread]: Partial parsing not enabled
[0m14:22:54.496093 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:22:54.508029 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:22:54.510714 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:22:54.516658 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:22:54.519347 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:22:54.522993 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:22:54.528452 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:22:54.539291 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:22:54.542031 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:22:54.549955 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:22:54.552772 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:22:54.572578 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:22:54.575841 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:22:54.586270 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:22:54.816493 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:22:54.829283 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce7be3ee0>]}
[0m14:22:54.864735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce7be3cd0>]}
[0m14:22:54.865964 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:22:54.866868 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce7c671f0>]}
[0m14:22:54.868608 [info ] [MainThread]: 
[0m14:22:54.870479 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:22:54.873133 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:22:54.879865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:22:55.084725 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:22:55.089760 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:22:55.093953 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:22:55.095326 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:22:55.102098 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:22:55.105870 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:22:55.114484 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:22:55.177804 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:22:55.186421 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:22:55.190174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce4b46ee0>]}
[0m14:22:55.191506 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:22:55.192370 [info ] [MainThread]: 
[0m14:22:55.229812 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:22:55.230990 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:22:55.232483 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:22:55.233778 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:22:55.246427 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:22:55.270761 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:22:55.234750 => 14:22:55.270406
[0m14:22:55.271934 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:22:55.354130 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:22:55.363026 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:22:55.365007 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:22:55.272787 => 14:22:55.364662
[0m14:22:55.368533 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:22:55.370035 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60e16f52-bc4b-4c66-b3d8-27c374a62eec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce431b880>]}
[0m14:22:55.371268 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.14s]
[0m14:22:55.372764 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:22:55.376851 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:22:55.377870 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:22:55.378716 [debug] [MainThread]: On list__gold: Close
[0m14:22:55.379775 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:22:55.380531 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:22:55.381337 [info ] [MainThread]: 
[0m14:22:55.382312 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m14:22:55.383958 [debug] [MainThread]: Command end result
[0m14:22:55.412942 [info ] [MainThread]: 
[0m14:22:55.414679 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:22:55.415798 [info ] [MainThread]: 
[0m14:22:55.417319 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:22:55.418554 [error] [MainThread]:   Code: 47.
[0m14:22:55.419560 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
[0m14:22:55.420690 [error] [MainThread]:   
[0m14:22:55.421738 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:22:55.422750 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:22:55.423821 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:22:55.425004 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:22:55.426097 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:22:55.427077 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:22:55.428156 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:22:55.429355 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:22:55.430278 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:22:55.431023 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:22:55.432574 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:22:55.434076 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:22:55.435476 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:22:55.436759 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:22:55.437657 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:22:55.438500 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:22:55.439148 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:22:55.439743 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:22:55.440415 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:22:55.441561 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:22:55.442561 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:22:55.443907 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:22:55.444921 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:22:55.445768 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:22:55.446643 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:22:55.447496 [error] [MainThread]:   25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:22:55.448173 [error] [MainThread]:   26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:22:55.448845 [error] [MainThread]:   27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:22:55.449519 [error] [MainThread]:   28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:22:55.450217 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:22:55.450974 [error] [MainThread]:   30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:22:55.451684 [error] [MainThread]:   31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:22:55.452597 [info ] [MainThread]: 
[0m14:22:55.453554 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:22:55.454989 [debug] [MainThread]: Command `dbt run` failed at 14:22:55.454784 after 2.58 seconds
[0m14:22:55.455818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce98474c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce7d5bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abce4184ca0>]}
[0m14:22:55.456477 [debug] [MainThread]: Flushing usage events
[0m14:24:33.025067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe8fd8490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe995cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe996f790>]}


============================== 14:24:33.032237 | 2915be55-bd6c-4c71-85c8-69e0cfcb4dfd ==============================
[0m14:24:33.032237 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:24:33.033753 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:24:33.204325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe995cfd0>]}
[0m14:24:33.245629 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe74e2ee0>]}
[0m14:24:33.247317 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:24:33.271045 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:24:33.278186 [debug] [MainThread]: Partial parsing not enabled
[0m14:24:34.748208 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:24:34.760350 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:24:34.764915 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:24:34.771246 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:24:34.774147 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:24:34.777543 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:24:34.783814 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:24:34.793493 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:24:34.795809 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:24:34.804566 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:24:34.807839 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:24:34.830646 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:24:34.833886 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:24:34.841960 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:24:35.047395 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:24:35.055989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe7363250>]}
[0m14:24:35.083639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe7363760>]}
[0m14:24:35.085022 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:24:35.086349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe755c7f0>]}
[0m14:24:35.088751 [info ] [MainThread]: 
[0m14:24:35.090284 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:24:35.092943 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:24:35.101396 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:35.303215 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:24:35.307131 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:24:35.311049 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:24:35.317893 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:24:35.319873 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:24:35.322824 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:35.331087 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:24:35.378011 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:24:35.385680 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:24:35.388691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe721f8b0>]}
[0m14:24:35.389757 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:24:35.390543 [info ] [MainThread]: 
[0m14:24:35.407682 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:24:35.408707 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:24:35.410290 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:24:35.410975 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:24:35.420384 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:24:35.433749 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:24:35.411542 => 14:24:35.433174
[0m14:24:35.434615 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:24:35.516791 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:24:35.525909 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                                   AS transaction_id,
      reference                                                       AS reference_col,
      details                                                         AS details_json,      -- String JSON
      created_at                                                      AS tx_started_at
  FROM silver.link_transactions
),

-- 1) Best-effort reference extraction (JSON → fallback to column → regex rescue)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        -- JSON first (safe-guard with try(...); null out empty strings)
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        -- fallback to the plain column
        nullIf(reference_col, '')
        -- last resort: regex pull from raw string (returns capture group 1) 
      )AS payment_reference
  FROM tx_raw
),



-- 2) Payments collapsed to the final state per reference
pay_final AS (
  SELECT
      reference                                                       AS payment_reference,
      argMax(state,       event_time)                                 AS final_state,
      argMax(method,      event_time)                                 AS final_method,
      argMax(merchant_id, event_time)                                 AS final_merchant_id,
      max(event_time)                                                 AS final_state_ts
  FROM silver.payments p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))   AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                        AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                                AS wasSuccessful,


      ds.state_sk                                                      AS state_fk,
      dm.merchant_sk                                                   AS merchant_sk,
      dpm.method_sk                                                    AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                                AS TimeFromStartToEndMinutes,


      -- keep for incremental gating
      t.tx_started_at                                                  AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final pf
         ON pf.payment_reference = t.payment_reference


  LEFT JOIN d_state  ds ON ds.state_name_l  = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant dm ON dm.merchant_id   = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk       AS state,
  merchant_sk,
  method_fk      AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:24:35.527900 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:24:35.435348 => 14:24:35.527526
[0m14:24:35.531507 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:24:35.533586 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2915be55-bd6c-4c71-85c8-69e0cfcb4dfd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe42c6e20>]}
[0m14:24:35.534748 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.12s]
[0m14:24:35.535771 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:24:35.538893 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:35.539856 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:24:35.540879 [debug] [MainThread]: On list__silver: Close
[0m14:24:35.541868 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:24:35.542819 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:24:35.543762 [info ] [MainThread]: 
[0m14:24:35.544778 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.45 seconds (0.45s).
[0m14:24:35.545833 [debug] [MainThread]: Command end result
[0m14:24:35.575743 [info ] [MainThread]: 
[0m14:24:35.576834 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:24:35.577766 [info ] [MainThread]: 
[0m14:24:35.578946 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:24:35.579802 [error] [MainThread]:   Code: 47.
[0m14:24:35.580580 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
[0m14:24:35.581482 [error] [MainThread]:   
[0m14:24:35.582831 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:24:35.584048 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:24:35.585498 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:24:35.586640 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:24:35.588647 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:24:35.590431 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:24:35.592256 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:24:35.593240 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:24:35.594208 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:24:35.595095 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:24:35.596051 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:24:35.597130 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:24:35.598198 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:24:35.599132 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:24:35.599966 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:24:35.600782 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:24:35.601780 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:24:35.603364 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:24:35.605013 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:24:35.606629 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:24:35.607820 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:24:35.608995 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:24:35.610225 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:24:35.611376 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:24:35.612582 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:24:35.613687 [error] [MainThread]:   25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:24:35.614832 [error] [MainThread]:   26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:24:35.615891 [error] [MainThread]:   27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:24:35.616973 [error] [MainThread]:   28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:24:35.617799 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:24:35.618703 [error] [MainThread]:   30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:24:35.620001 [error] [MainThread]:   31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:24:35.620891 [info ] [MainThread]: 
[0m14:24:35.622263 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:24:35.625671 [debug] [MainThread]: Command `dbt run` failed at 14:24:35.625334 after 2.64 seconds
[0m14:24:35.626478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe8fd8490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe74e2ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76cbe7298070>]}
[0m14:24:35.627865 [debug] [MainThread]: Flushing usage events
[0m14:29:20.774895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72d0058490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72d0ab9dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72d0aca790>]}


============================== 14:29:20.812023 | 538ebd4a-56bb-4030-8a0f-d16350c9dc4f ==============================
[0m14:29:20.812023 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:29:20.817743 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:29:21.231040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72d0ab9fd0>]}
[0m14:29:21.334620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72ce562ee0>]}
[0m14:29:21.337601 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:29:21.399379 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:29:21.411939 [debug] [MainThread]: Partial parsing not enabled
[0m14:29:23.936136 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:29:23.950098 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:29:23.953256 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:29:23.961396 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:29:23.964474 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:29:23.967935 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:29:23.971601 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:29:23.983191 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:29:23.985961 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:29:23.996311 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:29:23.999404 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:29:24.035396 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:29:24.039433 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:29:24.057725 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:29:24.324895 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:29:24.333303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72ce3e3700>]}
[0m14:29:24.359066 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72ce3e3910>]}
[0m14:29:24.361251 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:29:24.363257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72ce5dc7f0>]}
[0m14:29:24.366473 [info ] [MainThread]: 
[0m14:29:24.368189 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:29:24.370593 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:29:24.379970 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:24.608013 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:29:24.613381 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:29:24.616989 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:29:24.618359 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:29:24.628523 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:29:24.631107 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:24.638058 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:29:24.686117 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:29:24.693411 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:29:24.698429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72ce29f8b0>]}
[0m14:29:24.699881 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:29:24.701222 [info ] [MainThread]: 
[0m14:29:24.718066 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:29:24.719090 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:29:24.720471 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:29:24.721676 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:29:24.732651 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:29:24.739965 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:29:24.722486 => 14:29:24.739540
[0m14:29:24.741161 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:29:24.830002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                         AS transaction_id,
      reference                                             AS reference_col,
      details                                               AS details_json,      -- JSON string
      parseDateTimeBestEffortOrNull(created_at)             AS tx_started_at
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Payments collapsed to the final state per reference (fully qualify with p.*)
pay_final AS (
  SELECT
      p.reference                                                   AS payment_reference,
      argMax(p.state,       p.event_time)                           AS final_state,
      argMax(p.method,      p.event_time)                           AS final_method,
      argMax(p.merchant_id, p.event_time)                           AS final_merchant_id,
      max(p.event_time)                                             AS final_state_ts
  FROM silver.payments AS p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference  = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l       = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l     = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id        = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:29:24.839412 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                         AS transaction_id,
      reference                                             AS reference_col,
      details                                               AS details_json,      -- JSON string
      parseDateTimeBestEffortOrNull(created_at)             AS tx_started_at
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Payments collapsed to the final state per reference (fully qualify with p.*)
pay_final AS (
  SELECT
      p.reference                                                   AS payment_reference,
      argMax(p.state,       p.event_time)                           AS final_state,
      argMax(p.method,      p.event_time)                           AS final_method,
      argMax(p.merchant_id, p.event_time)                           AS final_merchant_id,
      max(p.event_time)                                             AS final_state_ts
  FROM silver.payments AS p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference  = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l       = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l     = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id        = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:29:24.840985 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:29:24.742381 => 14:29:24.840545
[0m14:29:24.844445 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 43.
  DB::Exception: Illegal type DateTime of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: In scope  tx_raw. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000cae72ab
  4. DB::detail::FunctionConvertFromString<DB::DataTypeDateTime, DB::detail::NameParseDateTimeBestEffortOrNull, (DB::detail::ConvertFromStringExceptionMode)2, (DB::detail::ConvertFromStringParsingMode)1>::getReturnTypeImpl(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x000000000a5f0665
  5. DB::IFunctionOverloadResolver::getReturnTypeWithoutLowCardinality(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422531
  6. DB::IFunctionOverloadResolver::getReturnType(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x00000000164221b1
  7. DB::IFunctionOverloadResolver::build(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422ac6
  8. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aabd41
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  15. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  16. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  17. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  18. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  20. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  22. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  24. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  25. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  26. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  27. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  28. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  29. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  30. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  31. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:29:24.845717 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '538ebd4a-56bb-4030-8a0f-d16350c9dc4f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72a6aa46a0>]}
[0m14:29:24.847052 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.13s]
[0m14:29:24.848234 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:29:24.851239 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:29:24.852703 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:29:24.853851 [debug] [MainThread]: On list__silver: Close
[0m14:29:24.855023 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:29:24.855790 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:29:24.856475 [info ] [MainThread]: 
[0m14:29:24.857447 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.49 seconds (0.49s).
[0m14:29:24.858816 [debug] [MainThread]: Command end result
[0m14:29:24.877284 [info ] [MainThread]: 
[0m14:29:24.878498 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:29:24.879391 [info ] [MainThread]: 
[0m14:29:24.880399 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:29:24.881883 [error] [MainThread]:   Code: 43.
[0m14:29:24.891535 [error] [MainThread]:   DB::Exception: Illegal type DateTime of first argument of function parseDateTimeBestEffortOrNull. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: In scope  tx_raw. Stack trace:
[0m14:29:24.894487 [error] [MainThread]:   
[0m14:29:24.896274 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:29:24.897516 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:29:24.898421 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:29:24.899636 [error] [MainThread]:   3. DB::Exception::Exception<String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&) @ 0x000000000cae72ab
[0m14:29:24.900623 [error] [MainThread]:   4. DB::detail::FunctionConvertFromString<DB::DataTypeDateTime, DB::detail::NameParseDateTimeBestEffortOrNull, (DB::detail::ConvertFromStringExceptionMode)2, (DB::detail::ConvertFromStringParsingMode)1>::getReturnTypeImpl(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x000000000a5f0665
[0m14:29:24.901612 [error] [MainThread]:   5. DB::IFunctionOverloadResolver::getReturnTypeWithoutLowCardinality(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422531
[0m14:29:24.902288 [error] [MainThread]:   6. DB::IFunctionOverloadResolver::getReturnType(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x00000000164221b1
[0m14:29:24.903020 [error] [MainThread]:   7. DB::IFunctionOverloadResolver::build(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422ac6
[0m14:29:24.903734 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aabd41
[0m14:29:24.904370 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:29:24.904930 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:29:24.905546 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:29:24.906137 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:29:24.906853 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:29:24.907484 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:29:24.908082 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:29:24.908661 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:29:24.909225 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:29:24.909851 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:29:24.910437 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:29:24.911201 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:29:24.911915 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:29:24.912538 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:29:24.913142 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:29:24.913725 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:29:24.914489 [error] [MainThread]:   25. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:29:24.915345 [error] [MainThread]:   26. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:29:24.915999 [error] [MainThread]:   27. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:29:24.916579 [error] [MainThread]:   28. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:29:24.917262 [error] [MainThread]:   29. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:29:24.917855 [error] [MainThread]:   30. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:29:24.918427 [error] [MainThread]:   31. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:29:24.919018 [info ] [MainThread]: 
[0m14:29:24.919639 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:29:24.920639 [debug] [MainThread]: Command `dbt run` failed at 14:29:24.920484 after 4.30 seconds
[0m14:29:24.921456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72d0058490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72ce562ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7b72a6af4fd0>]}
[0m14:29:24.922180 [debug] [MainThread]: Flushing usage events
[0m14:31:56.427072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61ab2003d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61abc83d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61abc83df0>]}


============================== 14:31:56.433130 | 2e2083c6-8866-462e-a027-b677e8412da4 ==============================
[0m14:31:56.433130 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:31:56.434451 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:31:56.529009 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61abc83dc0>]}
[0m14:31:56.549401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a971ddf0>]}
[0m14:31:56.551441 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:31:56.577999 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:31:56.583799 [debug] [MainThread]: Partial parsing not enabled
[0m14:31:57.603755 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:31:57.614132 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:31:57.616764 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:31:57.622792 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:31:57.625263 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:31:57.628926 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:31:57.633271 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:31:57.642576 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:31:57.645166 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:31:57.653463 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:31:57.656279 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:31:57.674283 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:31:57.676635 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:31:57.685259 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:31:57.879488 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:31:57.889703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a95c5e50>]}
[0m14:31:57.913453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a95c5670>]}
[0m14:31:57.914349 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:31:57.915350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a979d730>]}
[0m14:31:57.918048 [info ] [MainThread]: 
[0m14:31:57.919986 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:31:57.923299 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:31:57.929455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:58.113550 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:31:58.117038 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:31:58.120892 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:31:58.122148 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:31:58.128865 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:31:58.131449 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:58.138636 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:31:58.182901 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:31:58.188501 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:31:58.191943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a26e2c40>]}
[0m14:31:58.192942 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:31:58.193691 [info ] [MainThread]: 
[0m14:31:58.209242 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:31:58.210557 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:31:58.211657 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:31:58.212718 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:31:58.222047 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:31:58.233757 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:31:58.213424 => 14:31:58.233420
[0m14:31:58.234419 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:31:58.368441 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                         AS transaction_id,
      reference                                             AS reference_col,
      details                                               AS details_json,      -- JSON string
      created_at             AS tx_started_at
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Payments collapsed to the final state per reference (fully qualify with p.*)
pay_final AS (
  SELECT
      p.reference                                                   AS payment_reference,
      argMax(p.state,       p.event_time)                           AS final_state,
      argMax(p.method,      p.event_time)                           AS final_method,
      argMax(p.merchant_id, p.event_time)                           AS final_merchant_id,
      max(p.event_time)                                             AS final_state_ts
  FROM silver.payments AS p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference  = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l       = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l     = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id        = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:31:58.377532 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)                         AS transaction_id,
      reference                                             AS reference_col,
      details                                               AS details_json,      -- JSON string
      created_at             AS tx_started_at
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Payments collapsed to the final state per reference (fully qualify with p.*)
pay_final AS (
  SELECT
      p.reference                                                   AS payment_reference,
      argMax(p.state,       p.event_time)                           AS final_state,
      argMax(p.method,      p.event_time)                           AS final_method,
      argMax(p.merchant_id, p.event_time)                           AS final_merchant_id,
      max(p.event_time)                                             AS final_state_ts
  FROM silver.payments AS p
  GROUP BY p.reference
),


-- 3) Dimension lookups (FKs)
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference  = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l       = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l     = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id        = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:31:58.378833 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:31:58.234903 => 14:31:58.378480
[0m14:31:58.382057 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Identifier 'p.state' cannot be resolved from table with name p. In scope  pay_final AS pf. Maybe you meant: ['p._table']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
  4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
  5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
  6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
  7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
  8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
  10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  11. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  12. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  13. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  14. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  15. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  16. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  17. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  18. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  20. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  22. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  24. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  25. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  26. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  27. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  28. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  29. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  30. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  31. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:31:58.382900 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e2083c6-8866-462e-a027-b677e8412da4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a1e64580>]}
[0m14:31:58.383636 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.17s]
[0m14:31:58.384645 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:31:58.386984 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:31:58.387621 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:31:58.388164 [debug] [MainThread]: On list__gold: Close
[0m14:31:58.388640 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:31:58.389715 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:31:58.390391 [info ] [MainThread]: 
[0m14:31:58.391173 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.47 seconds (0.47s).
[0m14:31:58.392189 [debug] [MainThread]: Command end result
[0m14:31:58.409453 [info ] [MainThread]: 
[0m14:31:58.411045 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:31:58.411987 [info ] [MainThread]: 
[0m14:31:58.412692 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:31:58.413285 [error] [MainThread]:   Code: 47.
[0m14:31:58.414236 [error] [MainThread]:   DB::Exception: Identifier 'p.state' cannot be resolved from table with name p. In scope  pay_final AS pf. Maybe you meant: ['p._table']. Stack trace:
[0m14:31:58.415620 [error] [MainThread]:   
[0m14:31:58.416643 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:31:58.417248 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:31:58.417862 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:31:58.418705 [error] [MainThread]:   3. DB::Exception::Exception<String const&, String&, String, String>(int, FormatStringHelperImpl<std::type_identity<String const&>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String const&, String&, String&&, String&&) @ 0x0000000017a97a70
[0m14:31:58.420269 [error] [MainThread]:   4. DB::IdentifierResolver::tryResolveIdentifierFromStorage(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::AnalysisTableExpressionData const&, DB::IdentifierResolveScope&, unsigned long, bool) @ 0x0000000017a972ae
[0m14:31:58.421763 [error] [MainThread]:   5. DB::IdentifierResolver::tryResolveIdentifierFromTableExpression(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a97d22
[0m14:31:58.422659 [error] [MainThread]:   6. DB::IdentifierResolver::tryResolveIdentifierFromJoinTreeNode(DB::IdentifierLookup const&, std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x0000000017a987fa
[0m14:31:58.423464 [error] [MainThread]:   7. DB::IdentifierResolver::tryResolveIdentifierFromJoinTree(DB::IdentifierLookup const&, DB::IdentifierResolveScope&) @ 0x0000000017a9de8d
[0m14:31:58.424313 [error] [MainThread]:   8. DB::QueryAnalyzer::tryResolveIdentifier(DB::IdentifierLookup const&, DB::IdentifierResolveScope&, DB::IdentifierResolveContext) @ 0x0000000017844909
[0m14:31:58.425180 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837a54
[0m14:31:58.426015 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:31:58.426846 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:31:58.427699 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:31:58.428479 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:31:58.429507 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:31:58.430818 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:31:58.432351 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:31:58.433311 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:31:58.434241 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:31:58.435298 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:31:58.436318 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:31:58.437231 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:31:58.438197 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:31:58.439148 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:31:58.439888 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:31:58.440753 [error] [MainThread]:   25. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:31:58.441451 [error] [MainThread]:   26. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:31:58.441984 [error] [MainThread]:   27. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:31:58.442540 [error] [MainThread]:   28. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:31:58.443388 [error] [MainThread]:   29. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:31:58.444216 [error] [MainThread]:   30. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:31:58.444881 [error] [MainThread]:   31. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:31:58.445608 [info ] [MainThread]: 
[0m14:31:58.446322 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:31:58.447242 [debug] [MainThread]: Command `dbt run` failed at 14:31:58.447142 after 2.05 seconds
[0m14:31:58.448007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61ab2003d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a95ed670>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61a9553520>]}
[0m14:31:58.448948 [debug] [MainThread]: Flushing usage events
[0m14:35:13.026243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7486731ef460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748673b99af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748673b99e50>]}


============================== 14:35:13.033133 | 631a9d29-83de-44bf-bb15-0ffca71aea77 ==============================
[0m14:35:13.033133 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:35:13.034101 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:35:13.118460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748673b99e80>]}
[0m14:35:13.140026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748671725eb0>]}
[0m14:35:13.141321 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:35:13.165910 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:35:13.172479 [debug] [MainThread]: Partial parsing not enabled
[0m14:35:14.226990 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:35:14.237800 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:35:14.241015 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:35:14.246673 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:35:14.249733 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:35:14.253697 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:35:14.257773 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:35:14.267557 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:35:14.270205 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:35:14.278130 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:35:14.281792 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:35:14.300575 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:35:14.303204 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:35:14.311639 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:35:14.515861 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:35:14.524342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7486715f7610>]}
[0m14:35:14.556743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7486715f76d0>]}
[0m14:35:14.557721 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:35:14.558674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7486715d58e0>]}
[0m14:35:14.561431 [info ] [MainThread]: 
[0m14:35:14.563126 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:35:14.565505 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:35:14.572307 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:35:14.769753 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:35:14.773799 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:35:14.777110 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:35:14.778584 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:35:14.787418 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:35:14.790612 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:35:14.798576 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:35:14.846333 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:35:14.855485 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:35:14.858899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748671460880>]}
[0m14:35:14.860525 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:35:14.861489 [info ] [MainThread]: 
[0m14:35:14.881212 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:35:14.882417 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:35:14.883570 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:35:14.884335 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:35:14.900268 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:35:14.911501 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:35:14.885160 => 14:35:14.910983
[0m14:35:14.913627 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:35:14.992873 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper timestamp
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (no table alias; use event_date)
pay_final AS (
  SELECT
      reference                                      AS payment_reference,
      argMax(state,       event_date)                AS final_state,
      argMax(method,      event_date)                AS final_method,
      argMax(merchant_id, event_date)                AS final_merchant_id,
      max(event_date)                                AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:35:15.000740 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper timestamp
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (no table alias; use event_date)
pay_final AS (
  SELECT
      reference                                      AS payment_reference,
      argMax(state,       event_date)                AS final_state,
      argMax(method,      event_date)                AS final_method,
      argMax(merchant_id, event_date)                AS final_merchant_id,
      max(event_date)                                AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:35:15.003660 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:35:14.914621 => 14:35:15.003361
[0m14:35:15.006853 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:35:15.008207 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '631a9d29-83de-44bf-bb15-0ffca71aea77', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748671468e50>]}
[0m14:35:15.009451 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.12s]
[0m14:35:15.010649 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:35:15.014816 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:35:15.015753 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:35:15.016339 [debug] [MainThread]: On list__silver: Close
[0m14:35:15.017022 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:35:15.017837 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:35:15.018556 [info ] [MainThread]: 
[0m14:35:15.019344 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.46 seconds (0.46s).
[0m14:35:15.020524 [debug] [MainThread]: Command end result
[0m14:35:15.039295 [info ] [MainThread]: 
[0m14:35:15.040748 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:35:15.041470 [info ] [MainThread]: 
[0m14:35:15.042151 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:35:15.042854 [error] [MainThread]:   Code: 47.
[0m14:35:15.043539 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `state` in scope  pay_final AS pf. Maybe you meant: ['state']. Stack trace:
[0m14:35:15.044236 [error] [MainThread]:   
[0m14:35:15.046557 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:35:15.047890 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:35:15.049380 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:35:15.050427 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:35:15.051188 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:35:15.052123 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:35:15.053739 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:35:15.054722 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:35:15.055402 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:35:15.056080 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:35:15.056699 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:35:15.057470 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:35:15.058268 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:35:15.059046 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:35:15.060030 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:35:15.061211 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:35:15.062524 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:35:15.063828 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:35:15.064760 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:35:15.065706 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:35:15.066529 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:35:15.067244 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:35:15.067945 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:35:15.068609 [error] [MainThread]:   23. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:35:15.069545 [error] [MainThread]:   24. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:35:15.070267 [error] [MainThread]:   25. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:35:15.070908 [error] [MainThread]:   26. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:35:15.071457 [error] [MainThread]:   27. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:35:15.072012 [error] [MainThread]:   28. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:35:15.072639 [error] [MainThread]:   29. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:35:15.073315 [error] [MainThread]:   30. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:35:15.073963 [error] [MainThread]:   31. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:35:15.074721 [info ] [MainThread]: 
[0m14:35:15.075435 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:35:15.076282 [debug] [MainThread]: Command `dbt run` failed at 14:35:15.076180 after 2.08 seconds
[0m14:35:15.076937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7486731ef460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74867157fca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x748671725eb0>]}
[0m14:35:15.077763 [debug] [MainThread]: Flushing usage events
[0m14:38:44.447482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e71df460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e7c33fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e7c33df0>]}


============================== 14:38:44.454806 | 67b95b93-bbb6-4dfe-aa81-93eb76c9591d ==============================
[0m14:38:44.454806 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:38:44.456859 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:38:44.591655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e7c33e50>]}
[0m14:38:44.625586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e56e4eb0>]}
[0m14:38:44.627057 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:38:44.659029 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:38:44.671003 [debug] [MainThread]: Partial parsing not enabled
[0m14:38:46.153448 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:38:46.166362 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:38:46.170498 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:38:46.177396 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:38:46.180408 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:38:46.185181 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:38:46.192654 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:38:46.204696 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:38:46.208216 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:38:46.219341 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:38:46.223458 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:38:46.245233 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:38:46.248332 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:38:46.258138 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:38:46.530301 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:38:46.543835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e55b3970>]}
[0m14:38:46.571159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e55b3700>]}
[0m14:38:46.574244 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:38:46.576076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e5595a30>]}
[0m14:38:46.580405 [info ] [MainThread]: 
[0m14:38:46.582687 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:38:46.584940 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:38:46.594699 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:46.816661 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:38:46.822037 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:38:46.826885 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:38:46.829229 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:38:46.838521 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:38:46.842391 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:38:46.852491 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:46.893123 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:38:46.899956 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:38:46.903151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28de68feb0>]}
[0m14:38:46.904784 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:38:46.906110 [info ] [MainThread]: 
[0m14:38:46.922800 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:38:46.923946 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:38:46.925285 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:38:46.926185 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:38:46.937273 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:38:46.953403 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:38:46.927098 => 14:38:46.952966
[0m14:38:46.954328 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:38:47.052267 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:38:47.063131 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:38:47.064837 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:38:46.955053 => 14:38:47.064422
[0m14:38:47.068103 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `state_name` in scope  d_state AS ds. Maybe you meant: ['state_name_l']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  20. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  22. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  23. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  24. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  25. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  26. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  27. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  28. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  29. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  30. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  31. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:38:47.070067 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '67b95b93-bbb6-4dfe-aa81-93eb76c9591d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28ddca4610>]}
[0m14:38:47.071321 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.14s]
[0m14:38:47.072985 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:38:47.076253 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:38:47.077093 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:38:47.078062 [debug] [MainThread]: On list__gold: Close
[0m14:38:47.079062 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:38:47.079788 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:38:47.080452 [info ] [MainThread]: 
[0m14:38:47.081335 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.50 seconds (0.50s).
[0m14:38:47.082722 [debug] [MainThread]: Command end result
[0m14:38:47.108287 [info ] [MainThread]: 
[0m14:38:47.110038 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:38:47.111256 [info ] [MainThread]: 
[0m14:38:47.112379 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:38:47.113328 [error] [MainThread]:   Code: 47.
[0m14:38:47.114447 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `state_name` in scope  d_state AS ds. Maybe you meant: ['state_name_l']. Stack trace:
[0m14:38:47.115244 [error] [MainThread]:   
[0m14:38:47.115995 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:38:47.117048 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:38:47.118636 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:38:47.119815 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:38:47.120910 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:38:47.122040 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:38:47.123925 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:38:47.125452 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:38:47.126468 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:38:47.127619 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:38:47.129380 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:38:47.130306 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:38:47.132009 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:38:47.133293 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:38:47.134650 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:38:47.136222 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:38:47.137769 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:38:47.139616 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:38:47.141447 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:38:47.142223 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:38:47.143032 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:38:47.143825 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:38:47.145298 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:38:47.146498 [error] [MainThread]:   23. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:38:47.147405 [error] [MainThread]:   24. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:38:47.148956 [error] [MainThread]:   25. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:38:47.149813 [error] [MainThread]:   26. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:38:47.150755 [error] [MainThread]:   27. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:38:47.151702 [error] [MainThread]:   28. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:38:47.152747 [error] [MainThread]:   29. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:38:47.153839 [error] [MainThread]:   30. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m14:38:47.155093 [error] [MainThread]:   31. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:38:47.156385 [info ] [MainThread]: 
[0m14:38:47.157718 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:38:47.159417 [debug] [MainThread]: Command `dbt run` failed at 14:38:47.159216 after 2.74 seconds
[0m14:38:47.160432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e71df460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e56e4eb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e28e55b3c40>]}
[0m14:38:47.161429 [debug] [MainThread]: Flushing usage events
[0m14:42:57.636407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00081ef460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0008c44fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0008c44df0>]}


============================== 14:42:57.648859 | 3c22661f-5acb-4033-95ca-6653e58a4eb0 ==============================
[0m14:42:57.648859 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:42:57.652182 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:42:57.793573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0008c44e50>]}
[0m14:42:57.824928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00066dbeb0>]}
[0m14:42:57.826397 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:42:57.848707 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:42:57.857246 [debug] [MainThread]: Partial parsing not enabled
[0m14:42:58.202751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a683dc400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a68e40d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a68e40dc0>]}


============================== 14:42:58.213378 | 5280c5a8-85a3-4315-a64e-03a8422463e9 ==============================
[0m14:42:58.213378 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:42:58.215497 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:42:58.468841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a68e40d90>]}
[0m14:42:58.521956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a668f1dc0>]}
[0m14:42:58.523836 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:42:58.551906 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:42:58.558067 [debug] [MainThread]: Partial parsing not enabled
[0m14:42:58.648775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559f0af460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559fa2cfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559fa2cdf0>]}


============================== 14:42:58.661002 | 419141d6-d535-4f15-aaf0-b8193a074afe ==============================
[0m14:42:58.661002 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:42:58.662478 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:42:58.784216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559fa2ce50>]}
[0m14:42:58.814373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559d5b0eb0>]}
[0m14:42:58.816191 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:42:58.841410 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:42:58.848558 [debug] [MainThread]: Partial parsing not enabled
[0m14:42:59.154733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655ccd604f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cd719d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cd7297f0>]}


============================== 14:42:59.167154 | 6a353638-ce9d-4b30-9a7a-b1d2a245ac24 ==============================
[0m14:42:59.167154 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:42:59.168779 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:42:59.324747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cd719e20>]}
[0m14:42:59.354760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cb2a4ee0>]}
[0m14:42:59.356049 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:42:59.382403 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:42:59.388597 [debug] [MainThread]: Partial parsing not enabled
[0m14:42:59.580108 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:42:59.593031 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:42:59.596852 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:42:59.608359 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:42:59.612544 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:42:59.619786 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:42:59.626299 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:42:59.643295 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:42:59.648816 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:42:59.659547 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:42:59.662329 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:42:59.692106 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:42:59.695655 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:42:59.711015 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:42:59.996070 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:43:00.011486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00065b99d0>]}
[0m14:43:00.055669 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00065b9be0>]}
[0m14:43:00.057199 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:43:00.058592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0006586310>]}
[0m14:43:00.061505 [info ] [MainThread]: 
[0m14:43:00.063690 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:43:00.069769 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:43:00.083003 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:00.217909 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:43:00.233366 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:43:00.236346 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:43:00.243535 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:43:00.246130 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:43:00.252567 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:43:00.258579 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:43:00.274722 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:43:00.277558 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:43:00.289691 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:43:00.293800 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:43:00.320412 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:43:00.324520 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:43:00.337171 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:43:00.343995 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:43:00.349337 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:43:00.352346 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now create__gold)
[0m14:43:00.355924 [debug] [ThreadPool]: Creating schema "schema: "gold"
"
[0m14:43:00.367908 [debug] [ThreadPool]: dbt_clickhouse adapter: On create__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "create__gold"} */
create database if not exists gold
        
  
        
  ...
[0m14:43:00.387185 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:43:00.391797 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create__gold, now list__gold)
[0m14:43:00.393105 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:43:00.403653 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:43:00.410177 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:00.420134 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:00.472151 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:43:00.480183 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:00.485845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e0006422880>]}
[0m14:43:00.487453 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:43:00.489076 [info ] [MainThread]: 
[0m14:43:00.518949 [debug] [Thread-1  ]: Began running node model.ck_project.dim_merchants
[0m14:43:00.520429 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_merchants ................................ [RUN]
[0m14:43:00.521946 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_merchants)
[0m14:43:00.522924 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_merchants
[0m14:43:00.539067 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_merchants"
[0m14:43:00.551453 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (compile): 14:43:00.523614 => 14:43:00.550769
[0m14:43:00.552307 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_merchants
[0m14:43:00.581414 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:43:00.588526 [debug] [Thread-1  ]: Creating new relation dim_merchants
[0m14:43:00.604614 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:43:00.609138 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:43:00.619765 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:43:00.625768 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:43:00.633904 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:43:00.639781 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:43:00.641571 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

            

    
        create table gold.dim_merchants
        
  
        
  engine = MergeTree()
        order by (merchant_sk)
        
        
        SETTINGS  allow_nullable_key=1,  replicated_deduplication_window=0

            empty
          as (
            

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
          )
        ...
[0m14:43:00.659536 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:43:00.662698 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:43:00.667178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:43:00.682654 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:43:00.682745 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:43:00.687200 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:43:00.688327 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:43:00.693061 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:00.702279 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_merchants"
[0m14:43:00.703530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a667b89a0>]}
[0m14:43:00.719331 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

  
    
    
    
        
        insert into gold.dim_merchants
        ("merchant_sk", "merchant_id", "merchant_name", "merchant_state", "acquirer_id", "scd_start_date", "scd_end_date", "updated_at_raw")

-- Build a current (Type-0/1 style) merchant dimension from Silver.
-- We pick the latest attributes per merchant_id using argMax over a timestamp that
-- prefers updated_at, falling back to _snapshot_date.

WITH staged AS (
  SELECT
      merchant_id,
      merchant_name,
      state                     AS merchant_state,
      acquirer_id,
      updated_at,
      _snapshot_date,
      coalesce(updated_at, toDateTime(_snapshot_date)) AS ts
  FROM silver.merchants     -- <-- use your silver MODEL NAME here
  WHERE merchant_id IS NOT NULL
),

agg AS (
  SELECT
      toUInt64(merchant_id)                                              AS merchant_id,
      argMax(merchant_name,   ts)                                        AS merchant_name,
      argMax(merchant_state,  ts)                                        AS merchant_state,
      argMax(acquirer_id,     ts)                                        AS acquirer_id,
      max(ts)                                                            AS scd_start_ts,
      argMax(updated_at,      ts)                                        AS updated_at_raw
  FROM staged
  GROUP BY merchant_id
)

SELECT
    cityHash64(merchant_id)               AS merchant_sk,        
    merchant_id,
    merchant_name,
    merchant_state,
    acquirer_id,
    toDate(scd_start_ts)                  AS scd_start_date,    
    toDate('9999-12-31')                  AS scd_end_date,
    updated_at_raw
FROM agg
ORDER BY merchant_sk
  
  ...
[0m14:43:00.738633 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:43:00.744563 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:43:00.745636 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a667b8f70>]}
[0m14:43:00.749158 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:43:00.752165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a6695cf70>]}
[0m14:43:00.755040 [info ] [MainThread]: 
[0m14:43:00.757573 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:43:00.761592 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:43:00.768127 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:43:00.773192 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:00.778059 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m14:43:00.818825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_merchants: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_merchants"} */

    select name, type from system.columns where table = 'dim_merchants'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:43:00.828200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:00.833847 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_merchants (execute): 14:43:00.552998 => 14:43:00.833553
[0m14:43:00.835632 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3c22661f-5acb-4033-95ca-6653e58a4eb0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dffdec0c250>]}
[0m14:43:00.837090 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_merchants ........................... [OK in 0.31s]
[0m14:43:00.839072 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_merchants
[0m14:43:00.842493 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:00.843374 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:43:00.844451 [debug] [MainThread]: On list__gold: Close
[0m14:43:00.845539 [debug] [MainThread]: Connection 'model.ck_project.dim_merchants' was left open.
[0m14:43:00.846519 [debug] [MainThread]: On model.ck_project.dim_merchants: Close
[0m14:43:00.849043 [info ] [MainThread]: 
[0m14:43:00.850597 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m14:43:00.852425 [debug] [MainThread]: Command end result
[0m14:43:00.883571 [info ] [MainThread]: 
[0m14:43:00.885374 [info ] [MainThread]: Completed successfully
[0m14:43:00.887147 [info ] [MainThread]: 
[0m14:43:00.888761 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:43:00.890865 [debug] [MainThread]: Command `dbt run` succeeded at 14:43:00.890582 after 3.29 seconds
[0m14:43:00.892349 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00081ef460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00064f89a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7e00065a53a0>]}
[0m14:43:00.896093 [debug] [MainThread]: Flushing usage events
[0m14:43:01.140217 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:43:01.147068 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.151953 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:43:01.153416 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:43:01.173036 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:43:01.176994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:01.187552 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.215229 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:43:01.232439 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:43:01.233020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559d47f910>]}
[0m14:43:01.255448 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:43:01.261050 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:43:01.260794 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:43:01.272092 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.276059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559d47fa30>]}
[0m14:43:01.276141 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:43:01.277394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a666217c0>]}
[0m14:43:01.278061 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:43:01.280122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559d4b4220>]}
[0m14:43:01.280332 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:43:01.281654 [info ] [MainThread]: 
[0m14:43:01.282351 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:43:01.283922 [info ] [MainThread]: 
[0m14:43:01.286435 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:43:01.290126 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:43:01.292225 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:43:01.301858 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:43:01.304907 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:01.314306 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_method
[0m14:43:01.316392 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_method ........................... [RUN]
[0m14:43:01.319445 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_method)
[0m14:43:01.320722 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_method
[0m14:43:01.322018 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:43:01.325805 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:43:01.336076 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_method"
[0m14:43:01.343496 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:43:01.352726 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:43:01.354069 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (compile): 14:43:01.321557 => 14:43:01.353609
[0m14:43:01.355278 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_method
[0m14:43:01.390645 [debug] [Thread-1  ]: Creating new relation dim_payment_method
[0m14:43:01.399670 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:43:01.403317 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:43:01.418885 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:43:01.436706 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

            

    
        create table gold.dim_payment_method
        
  
        
  engine = MergeTree()
        order by (payment_method_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
          )
        ...
[0m14:43:01.461630 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:43:01.477332 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:43:01.484025 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.490089 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_method"
[0m14:43:01.505011 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

  
    
    
    
        
        insert into gold.dim_payment_method
        ("payment_method_sk", "original_value", "payment_method_name")


WITH mapping AS (
    SELECT toUInt8(1) AS payment_method_sk, CAST('1' AS Nullable(String)) AS original_value, 'Visa'         AS payment_method_name
    UNION ALL
    SELECT toUInt8(2),                       CAST('2' AS Nullable(String)),                                   'Mastercard'
    UNION ALL
    SELECT toUInt8(3),                       CAST(NULL AS Nullable(String)),                                  'ACH transfer'
)
SELECT * FROM mapping
  
  ...
[0m14:43:01.521441 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.565376 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_method: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_method"} */

    select name, type from system.columns where table = 'dim_payment_method'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:43:01.576778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.582724 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_method (execute): 14:43:01.356385 => 14:43:01.581986
[0m14:43:01.584600 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5280c5a8-85a3-4315-a64e-03a8422463e9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a3ecd0580>]}
[0m14:43:01.588224 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_method ...................... [OK in 0.27s]
[0m14:43:01.590808 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_method
[0m14:43:01.594446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:01.595394 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:43:01.596316 [debug] [MainThread]: On list__silver: Close
[0m14:43:01.599136 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_method' was left open.
[0m14:43:01.600815 [debug] [MainThread]: On model.ck_project.dim_payment_method: Close
[0m14:43:01.602297 [info ] [MainThread]: 
[0m14:43:01.603889 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.85 seconds (0.85s).
[0m14:43:01.605417 [debug] [MainThread]: Command end result
[0m14:43:01.634590 [info ] [MainThread]: 
[0m14:43:01.636269 [info ] [MainThread]: Completed successfully
[0m14:43:01.637427 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:43:01.637741 [info ] [MainThread]: 
[0m14:43:01.639242 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:43:01.641402 [debug] [MainThread]: Command `dbt run` succeeded at 14:43:01.641110 after 4.02 seconds
[0m14:43:01.642528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a683dc400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a668f1dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x745a640dbdc0>]}
[0m14:43:01.643625 [debug] [MainThread]: Flushing usage events
[0m14:43:01.644149 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.654552 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:43:01.661891 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:43:01.675162 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:01.679327 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:43:01.693600 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.752898 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:43:01.764588 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:01.769890 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559d2e0880>]}
[0m14:43:01.772273 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:43:01.774157 [info ] [MainThread]: 
[0m14:43:01.808519 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m14:43:01.810759 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m14:43:01.815903 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m14:43:01.818236 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m14:43:01.846003 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m14:43:01.866659 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:43:01.869488 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 14:43:01.823049 => 14:43:01.868757
[0m14:43:01.871183 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m14:43:01.884647 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cb1233d0>]}
[0m14:43:01.924454 [debug] [Thread-1  ]: Creating new relation dim_payment_state
[0m14:43:01.927477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cb123460>]}
[0m14:43:01.929992 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:43:01.932646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cb31c7f0>]}
[0m14:43:01.937923 [info ] [MainThread]: 
[0m14:43:01.940951 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:43:01.945125 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:43:01.956831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:01.992777 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'            AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m14:43:02.021555 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'            AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        
[0m14:43:02.023525 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 14:43:01.872381 => 14:43:02.023113
[0m14:43:02.027968 [debug] [Thread-1  ]: Database Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
  Code: 47.
  DB::Exception: Missing columns: 'link_state_sk' while processing: 'link_state_sk', required columns: 'link_state_sk', available columns: 'is_payment_reached_provider' 'payment_state_name' 'is_final_state' 'payment_state_sk'. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::TreeRewriterResult::collectUsedColumns(std::shared_ptr<DB::IAST> const&, bool, bool) @ 0x00000000186dceb0
  4. DB::TreeRewriter::analyze(std::shared_ptr<DB::IAST>&, DB::NamesAndTypesList const&, std::shared_ptr<DB::IStorage const>, std::shared_ptr<DB::StorageSnapshot> const&, bool, bool, bool, bool) const @ 0x00000000186e7c97
  5. DB::KeyDescription::getSortingKeyFromAST(std::shared_ptr<DB::IAST> const&, DB::ColumnsDescription const&, std::shared_ptr<DB::Context const>, std::optional<String> const&) @ 0x0000000018dd3bc1
  6. DB::create(DB::StorageFactory::Arguments const&) @ 0x0000000019a5f818
  7. DB::StorageFactory::get(DB::ASTCreateQuery const&, String const&, std::shared_ptr<DB::Context>, std::shared_ptr<DB::Context>, DB::ColumnsDescription const&, DB::ConstraintsDescription const&, DB::LoadingStrictnessLevel, bool) const @ 0x0000000018e40d7b
  8. DB::InterpreterCreateQuery::doCreateTable(DB::ASTCreateQuery&, DB::InterpreterCreateQuery::TableProperties const&, std::unique_ptr<DB::DDLGuard, std::default_delete<DB::DDLGuard>>&, DB::LoadingStrictnessLevel) @ 0x00000000182fb075
  9. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ef810
  10. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  11. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  12. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  13. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  14. DB::TCPHandler::run() @ 0x0000000019e4f119
  15. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  16. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  17. Poco::PooledThread::run() @ 0x000000001ef15b87
  18. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  19. ? @ 0x0000000000094ac3
  20. ? @ 0x0000000000125a74
[0m14:43:02.030415 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '419141d6-d535-4f15-aaf0-b8193a074afe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76558db057c0>]}
[0m14:43:02.031999 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model gold.dim_payment_state ................... [ERROR in 0.22s]
[0m14:43:02.034114 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m14:43:02.037657 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:02.038746 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:43:02.039662 [debug] [MainThread]: On list__silver: Close
[0m14:43:02.040562 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m14:43:02.041573 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m14:43:02.042421 [info ] [MainThread]: 
[0m14:43:02.043341 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.76 seconds (0.76s).
[0m14:43:02.044613 [debug] [MainThread]: Command end result
[0m14:43:02.075844 [info ] [MainThread]: 
[0m14:43:02.077755 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:43:02.085174 [info ] [MainThread]: 
[0m14:43:02.091920 [error] [MainThread]: Database Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
[0m14:43:02.093922 [error] [MainThread]:   Code: 47.
[0m14:43:02.102514 [error] [MainThread]:   DB::Exception: Missing columns: 'link_state_sk' while processing: 'link_state_sk', required columns: 'link_state_sk', available columns: 'is_payment_reached_provider' 'payment_state_name' 'is_final_state' 'payment_state_sk'. Stack trace:
[0m14:43:02.104798 [error] [MainThread]:   
[0m14:43:02.106597 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:43:02.108199 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:43:02.110012 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:43:02.111524 [error] [MainThread]:   3. DB::TreeRewriterResult::collectUsedColumns(std::shared_ptr<DB::IAST> const&, bool, bool) @ 0x00000000186dceb0
[0m14:43:02.113001 [error] [MainThread]:   4. DB::TreeRewriter::analyze(std::shared_ptr<DB::IAST>&, DB::NamesAndTypesList const&, std::shared_ptr<DB::IStorage const>, std::shared_ptr<DB::StorageSnapshot> const&, bool, bool, bool, bool) const @ 0x00000000186e7c97
[0m14:43:02.114476 [error] [MainThread]:   5. DB::KeyDescription::getSortingKeyFromAST(std::shared_ptr<DB::IAST> const&, DB::ColumnsDescription const&, std::shared_ptr<DB::Context const>, std::optional<String> const&) @ 0x0000000018dd3bc1
[0m14:43:02.116207 [error] [MainThread]:   6. DB::create(DB::StorageFactory::Arguments const&) @ 0x0000000019a5f818
[0m14:43:02.117913 [error] [MainThread]:   7. DB::StorageFactory::get(DB::ASTCreateQuery const&, String const&, std::shared_ptr<DB::Context>, std::shared_ptr<DB::Context>, DB::ColumnsDescription const&, DB::ConstraintsDescription const&, DB::LoadingStrictnessLevel, bool) const @ 0x0000000018e40d7b
[0m14:43:02.120558 [error] [MainThread]:   8. DB::InterpreterCreateQuery::doCreateTable(DB::ASTCreateQuery&, DB::InterpreterCreateQuery::TableProperties const&, std::unique_ptr<DB::DDLGuard, std::default_delete<DB::DDLGuard>>&, DB::LoadingStrictnessLevel) @ 0x00000000182fb075
[0m14:43:02.122062 [error] [MainThread]:   9. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ef810
[0m14:43:02.123529 [error] [MainThread]:   10. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:43:02.126205 [error] [MainThread]:   11. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:43:02.127647 [error] [MainThread]:   12. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:43:02.128913 [error] [MainThread]:   13. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:43:02.130151 [error] [MainThread]:   14. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:43:02.132979 [error] [MainThread]:   15. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:43:02.134261 [error] [MainThread]:   16. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:43:02.136147 [error] [MainThread]:   17. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:43:02.137575 [error] [MainThread]:   18. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:43:02.139287 [error] [MainThread]:   19. ? @ 0x0000000000094ac3
[0m14:43:02.140495 [error] [MainThread]:   20. ? @ 0x0000000000125a74
[0m14:43:02.141692 [info ] [MainThread]: 
[0m14:43:02.143081 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:43:02.144451 [debug] [MainThread]: Command `dbt run` failed at 14:43:02.144267 after 4.36 seconds
[0m14:43:02.145328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76559f0af460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76558daf8880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76558daf8130>]}
[0m14:43:02.146185 [debug] [MainThread]: Flushing usage events
[0m14:43:02.283427 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:43:02.290119 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:43:02.296614 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:43:02.304448 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:43:02.319882 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:43:02.323623 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:02.335242 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:02.400253 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:43:02.408342 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:02.413891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655c8055700>]}
[0m14:43:02.415736 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:43:02.417182 [info ] [MainThread]: 
[0m14:43:02.443034 [debug] [Thread-1  ]: Began running node model.ck_project.dim_date
[0m14:43:02.444353 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_date ..................................... [RUN]
[0m14:43:02.446826 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_date)
[0m14:43:02.448755 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_date
[0m14:43:02.463984 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_date"
[0m14:43:02.480328 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (compile): 14:43:02.449999 => 14:43:02.479886
[0m14:43:02.481531 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_date
[0m14:43:02.519912 [debug] [Thread-1  ]: Creating new relation dim_date
[0m14:43:02.565819 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

            

    
        create table gold.dim_date
        
  
        
  engine = MergeTree()
        order by (date_key)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
          )
        ...
[0m14:43:02.587186 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:43:02.601125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:43:02.607821 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:02.617714 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_date"
[0m14:43:02.635728 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

  
    
    
    
        
        insert into gold.dim_date
        ("date_key", "full_date", "year", "month", "day", "day_of_week", "is_weekend", "is_holiday")

-- Generate dates from start..end using system.numbers.
-- IMPORTANT: use single-quoted literals from Jinja vars (no tojson).
WITH
  toDate('2000-01-01') AS sd,
  toDate('2040-12-31') AS ed
SELECT
  toUInt32(toYYYYMMDD(d))           AS date_key,
  d                                 AS full_date,
  toYear(d)                         AS year,
  toMonth(d)                        AS month,
  toDayOfMonth(d)                   AS day,
  toDayOfWeek(d)                    AS day_of_week,   -- 1=Mon..7=Sun
  toUInt8(toDayOfWeek(d) IN (6,7))  AS is_weekend,
  toUInt8(0)                        AS is_holiday
FROM
(
  SELECT addDays(sd, number) AS d
  FROM system.numbers
  LIMIT dateDiff('day', sd, ed) + 1
)
ORDER BY date_key
  
  ...
[0m14:43:02.660511 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:43:02.698460 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_date: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_date"} */

    select name, type from system.columns where table = 'dim_date'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:43:02.707028 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:02.712481 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_date (execute): 14:43:02.482766 => 14:43:02.712205
[0m14:43:02.714302 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6a353638-ce9d-4b30-9a7a-b1d2a245ac24', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655a364ea00>]}
[0m14:43:02.715848 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_date ................................ [OK in 0.27s]
[0m14:43:02.717730 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_date
[0m14:43:02.722152 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:02.723246 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:43:02.724358 [debug] [MainThread]: On list__gold: Close
[0m14:43:02.725375 [debug] [MainThread]: Connection 'model.ck_project.dim_date' was left open.
[0m14:43:02.726413 [debug] [MainThread]: On model.ck_project.dim_date: Close
[0m14:43:02.727528 [info ] [MainThread]: 
[0m14:43:02.729069 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.79 seconds (0.79s).
[0m14:43:02.731626 [debug] [MainThread]: Command end result
[0m14:43:02.764290 [info ] [MainThread]: 
[0m14:43:02.766804 [info ] [MainThread]: Completed successfully
[0m14:43:02.768480 [info ] [MainThread]: 
[0m14:43:02.770274 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:43:02.773013 [debug] [MainThread]: Command `dbt run` succeeded at 14:43:02.772471 after 5.05 seconds
[0m14:43:02.774953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655ccd604f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cb163dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7655cb0cef40>]}
[0m14:43:02.776251 [debug] [MainThread]: Flushing usage events
[0m14:43:53.875910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717231f87430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717232947dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717232947e50>]}


============================== 14:43:53.884139 | 9adbf00d-7d95-467f-aea7-bc66c0071dd0 ==============================
[0m14:43:53.884139 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:43:53.886156 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:43:54.032148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717232947d60>]}
[0m14:43:54.072126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71723049be80>]}
[0m14:43:54.073778 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:43:54.107561 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:43:54.117514 [debug] [MainThread]: Partial parsing not enabled
[0m14:43:55.440369 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:43:55.459966 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:43:55.464222 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:43:55.473629 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:43:55.477894 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:43:55.482663 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:43:55.489877 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:43:55.508737 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:43:55.512931 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:43:55.525545 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:43:55.530622 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:43:55.556353 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:43:55.562129 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:43:55.575081 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:43:55.850769 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:43:55.858129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7172303551f0>]}
[0m14:43:55.894509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717230355f40>]}
[0m14:43:55.896288 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:43:55.898075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71723051c790>]}
[0m14:43:55.900879 [info ] [MainThread]: 
[0m14:43:55.902370 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:43:55.904589 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:43:55.912768 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:56.118385 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:43:56.121763 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:43:56.125090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:43:56.126198 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:43:56.135711 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:43:56.139254 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:43:56.146470 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:56.216231 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:43:56.230583 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:43:56.235784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7172301e1850>]}
[0m14:43:56.238818 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:43:56.241150 [info ] [MainThread]: 
[0m14:43:56.273513 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m14:43:56.275569 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m14:43:56.277733 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m14:43:56.279551 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m14:43:56.300048 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m14:43:56.323139 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 14:43:56.281191 => 14:43:56.322624
[0m14:43:56.324501 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m14:43:56.349586 [debug] [Thread-1  ]: Creating new relation dim_payment_state
[0m14:43:56.387049 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'            AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m14:43:56.393636 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'            AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        
[0m14:43:56.396046 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 14:43:56.325481 => 14:43:56.394964
[0m14:43:56.401388 [debug] [Thread-1  ]: Database Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
  Code: 47.
  DB::Exception: Missing columns: 'link_state_sk' while processing: 'link_state_sk', required columns: 'link_state_sk', available columns: 'is_payment_reached_provider' 'payment_state_name' 'is_final_state' 'payment_state_sk'. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::TreeRewriterResult::collectUsedColumns(std::shared_ptr<DB::IAST> const&, bool, bool) @ 0x00000000186dceb0
  4. DB::TreeRewriter::analyze(std::shared_ptr<DB::IAST>&, DB::NamesAndTypesList const&, std::shared_ptr<DB::IStorage const>, std::shared_ptr<DB::StorageSnapshot> const&, bool, bool, bool, bool) const @ 0x00000000186e7c97
  5. DB::KeyDescription::getSortingKeyFromAST(std::shared_ptr<DB::IAST> const&, DB::ColumnsDescription const&, std::shared_ptr<DB::Context const>, std::optional<String> const&) @ 0x0000000018dd3bc1
  6. DB::create(DB::StorageFactory::Arguments const&) @ 0x0000000019a5f818
  7. DB::StorageFactory::get(DB::ASTCreateQuery const&, String const&, std::shared_ptr<DB::Context>, std::shared_ptr<DB::Context>, DB::ColumnsDescription const&, DB::ConstraintsDescription const&, DB::LoadingStrictnessLevel, bool) const @ 0x0000000018e40d7b
  8. DB::InterpreterCreateQuery::doCreateTable(DB::ASTCreateQuery&, DB::InterpreterCreateQuery::TableProperties const&, std::unique_ptr<DB::DDLGuard, std::default_delete<DB::DDLGuard>>&, DB::LoadingStrictnessLevel) @ 0x00000000182fb075
  9. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ef810
  10. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  11. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  12. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  13. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  14. DB::TCPHandler::run() @ 0x0000000019e4f119
  15. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  16. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  17. Poco::PooledThread::run() @ 0x000000001ef15b87
  18. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  19. ? @ 0x0000000000094ac3
  20. ? @ 0x0000000000125a74
[0m14:43:56.402834 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9adbf00d-7d95-467f-aea7-bc66c0071dd0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71722c8cadc0>]}
[0m14:43:56.404070 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model gold.dim_payment_state ................... [ERROR in 0.13s]
[0m14:43:56.405376 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m14:43:56.409475 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:43:56.410816 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:43:56.412375 [debug] [MainThread]: On list__silver: Close
[0m14:43:56.413520 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m14:43:56.414270 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m14:43:56.415305 [info ] [MainThread]: 
[0m14:43:56.416274 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.51 seconds (0.51s).
[0m14:43:56.417636 [debug] [MainThread]: Command end result
[0m14:43:56.444062 [info ] [MainThread]: 
[0m14:43:56.446105 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:43:56.447790 [info ] [MainThread]: 
[0m14:43:56.448926 [error] [MainThread]: Database Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
[0m14:43:56.451104 [error] [MainThread]:   Code: 47.
[0m14:43:56.452439 [error] [MainThread]:   DB::Exception: Missing columns: 'link_state_sk' while processing: 'link_state_sk', required columns: 'link_state_sk', available columns: 'is_payment_reached_provider' 'payment_state_name' 'is_final_state' 'payment_state_sk'. Stack trace:
[0m14:43:56.453361 [error] [MainThread]:   
[0m14:43:56.454161 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:43:56.454973 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:43:56.456195 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:43:56.458041 [error] [MainThread]:   3. DB::TreeRewriterResult::collectUsedColumns(std::shared_ptr<DB::IAST> const&, bool, bool) @ 0x00000000186dceb0
[0m14:43:56.459363 [error] [MainThread]:   4. DB::TreeRewriter::analyze(std::shared_ptr<DB::IAST>&, DB::NamesAndTypesList const&, std::shared_ptr<DB::IStorage const>, std::shared_ptr<DB::StorageSnapshot> const&, bool, bool, bool, bool) const @ 0x00000000186e7c97
[0m14:43:56.461468 [error] [MainThread]:   5. DB::KeyDescription::getSortingKeyFromAST(std::shared_ptr<DB::IAST> const&, DB::ColumnsDescription const&, std::shared_ptr<DB::Context const>, std::optional<String> const&) @ 0x0000000018dd3bc1
[0m14:43:56.462673 [error] [MainThread]:   6. DB::create(DB::StorageFactory::Arguments const&) @ 0x0000000019a5f818
[0m14:43:56.463772 [error] [MainThread]:   7. DB::StorageFactory::get(DB::ASTCreateQuery const&, String const&, std::shared_ptr<DB::Context>, std::shared_ptr<DB::Context>, DB::ColumnsDescription const&, DB::ConstraintsDescription const&, DB::LoadingStrictnessLevel, bool) const @ 0x0000000018e40d7b
[0m14:43:56.465257 [error] [MainThread]:   8. DB::InterpreterCreateQuery::doCreateTable(DB::ASTCreateQuery&, DB::InterpreterCreateQuery::TableProperties const&, std::unique_ptr<DB::DDLGuard, std::default_delete<DB::DDLGuard>>&, DB::LoadingStrictnessLevel) @ 0x00000000182fb075
[0m14:43:56.466481 [error] [MainThread]:   9. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ef810
[0m14:43:56.467658 [error] [MainThread]:   10. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:43:56.469032 [error] [MainThread]:   11. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:43:56.470720 [error] [MainThread]:   12. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:43:56.472061 [error] [MainThread]:   13. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:43:56.473262 [error] [MainThread]:   14. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:43:56.474666 [error] [MainThread]:   15. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:43:56.475775 [error] [MainThread]:   16. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:43:56.476815 [error] [MainThread]:   17. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:43:56.477974 [error] [MainThread]:   18. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:43:56.479023 [error] [MainThread]:   19. ? @ 0x0000000000094ac3
[0m14:43:56.480041 [error] [MainThread]:   20. ? @ 0x0000000000125a74
[0m14:43:56.480892 [info ] [MainThread]: 
[0m14:43:56.481785 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:43:56.483289 [debug] [MainThread]: Command `dbt run` failed at 14:43:56.483172 after 2.66 seconds
[0m14:43:56.484345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717231f87430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x717230386ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71723020a160>]}
[0m14:43:56.485612 [debug] [MainThread]: Flushing usage events
[0m14:49:01.102551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f8442a7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f844cdddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f844cee790>]}


============================== 14:49:01.109335 | 0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89 ==============================
[0m14:49:01.109335 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:49:01.110585 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:49:01.216528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f844cddfd0>]}
[0m14:49:01.253153 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f8427a2ee0>]}
[0m14:49:01.254453 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:49:01.276655 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:49:01.282506 [debug] [MainThread]: Partial parsing not enabled
[0m14:49:02.495641 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:49:02.506250 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:49:02.509453 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:49:02.515261 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:49:02.518762 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:49:02.522450 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:49:02.526153 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:49:02.539445 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:49:02.542147 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:49:02.549737 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:49:02.552306 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:49:02.573621 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:49:02.576888 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:49:02.585058 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:49:02.795789 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:49:02.804260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f842623e80>]}
[0m14:49:02.831367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f8426234c0>]}
[0m14:49:02.832559 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:49:02.833683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f84281b7f0>]}
[0m14:49:02.836221 [info ] [MainThread]: 
[0m14:49:02.839055 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:49:02.841408 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:49:02.847812 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:49:03.043370 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:49:03.047817 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:49:03.052063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:49:03.053398 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:49:03.060994 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:49:03.063035 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:49:03.070055 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:49:03.123472 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:49:03.140566 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:49:03.144325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f8424e18b0>]}
[0m14:49:03.145878 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:49:03.146769 [info ] [MainThread]: 
[0m14:49:03.161985 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m14:49:03.163538 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m14:49:03.165586 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.dim_payment_state)
[0m14:49:03.166687 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m14:49:03.175391 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m14:49:03.187551 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 14:49:03.167499 => 14:49:03.187220
[0m14:49:03.188537 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m14:49:03.207354 [debug] [Thread-1  ]: Creating new relation dim_payment_state
[0m14:49:03.236171 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'            AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        ...
[0m14:49:03.240586 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (link_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'            AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',           0, 0
    UNION ALL SELECT 3, 'failed',            1, 1
    UNION ALL SELECT 4, 'voided',            1, 1
    UNION ALL SELECT 5, 'refunded',          1, 1
    UNION ALL SELECT 6, 'waiting_for_sca',   0, 0
)
SELECT * FROM st
          )
        
[0m14:49:03.242192 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 14:49:03.189293 => 14:49:03.241935
[0m14:49:03.245241 [debug] [Thread-1  ]: Database Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
  Code: 47.
  DB::Exception: Missing columns: 'link_state_sk' while processing: 'link_state_sk', required columns: 'link_state_sk', available columns: 'is_payment_reached_provider' 'payment_state_name' 'is_final_state' 'payment_state_sk'. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::TreeRewriterResult::collectUsedColumns(std::shared_ptr<DB::IAST> const&, bool, bool) @ 0x00000000186dceb0
  4. DB::TreeRewriter::analyze(std::shared_ptr<DB::IAST>&, DB::NamesAndTypesList const&, std::shared_ptr<DB::IStorage const>, std::shared_ptr<DB::StorageSnapshot> const&, bool, bool, bool, bool) const @ 0x00000000186e7c97
  5. DB::KeyDescription::getSortingKeyFromAST(std::shared_ptr<DB::IAST> const&, DB::ColumnsDescription const&, std::shared_ptr<DB::Context const>, std::optional<String> const&) @ 0x0000000018dd3bc1
  6. DB::create(DB::StorageFactory::Arguments const&) @ 0x0000000019a5f818
  7. DB::StorageFactory::get(DB::ASTCreateQuery const&, String const&, std::shared_ptr<DB::Context>, std::shared_ptr<DB::Context>, DB::ColumnsDescription const&, DB::ConstraintsDescription const&, DB::LoadingStrictnessLevel, bool) const @ 0x0000000018e40d7b
  8. DB::InterpreterCreateQuery::doCreateTable(DB::ASTCreateQuery&, DB::InterpreterCreateQuery::TableProperties const&, std::unique_ptr<DB::DDLGuard, std::default_delete<DB::DDLGuard>>&, DB::LoadingStrictnessLevel) @ 0x00000000182fb075
  9. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ef810
  10. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  11. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  12. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  13. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  14. DB::TCPHandler::run() @ 0x0000000019e4f119
  15. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  16. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  17. Poco::PooledThread::run() @ 0x000000001ef15b87
  18. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  19. ? @ 0x0000000000094ac3
  20. ? @ 0x0000000000125a74
[0m14:49:03.246284 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0ad3cd12-d9fe-427f-8bdf-7c16f6df7d89', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f81ab9e5b0>]}
[0m14:49:03.247633 [error] [Thread-1  ]: 1 of 1 ERROR creating sql table model gold.dim_payment_state ................... [ERROR in 0.08s]
[0m14:49:03.248746 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m14:49:03.251318 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:49:03.251971 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:49:03.252515 [debug] [MainThread]: On list__silver: Close
[0m14:49:03.253145 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m14:49:03.254043 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m14:49:03.255010 [info ] [MainThread]: 
[0m14:49:03.255619 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.42 seconds (0.42s).
[0m14:49:03.256598 [debug] [MainThread]: Command end result
[0m14:49:03.275732 [info ] [MainThread]: 
[0m14:49:03.276708 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:49:03.277445 [info ] [MainThread]: 
[0m14:49:03.278197 [error] [MainThread]: Database Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
[0m14:49:03.278976 [error] [MainThread]:   Code: 47.
[0m14:49:03.279852 [error] [MainThread]:   DB::Exception: Missing columns: 'link_state_sk' while processing: 'link_state_sk', required columns: 'link_state_sk', available columns: 'is_payment_reached_provider' 'payment_state_name' 'is_final_state' 'payment_state_sk'. Stack trace:
[0m14:49:03.280726 [error] [MainThread]:   
[0m14:49:03.281730 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:49:03.282632 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:49:03.283349 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:49:03.284476 [error] [MainThread]:   3. DB::TreeRewriterResult::collectUsedColumns(std::shared_ptr<DB::IAST> const&, bool, bool) @ 0x00000000186dceb0
[0m14:49:03.285663 [error] [MainThread]:   4. DB::TreeRewriter::analyze(std::shared_ptr<DB::IAST>&, DB::NamesAndTypesList const&, std::shared_ptr<DB::IStorage const>, std::shared_ptr<DB::StorageSnapshot> const&, bool, bool, bool, bool) const @ 0x00000000186e7c97
[0m14:49:03.286628 [error] [MainThread]:   5. DB::KeyDescription::getSortingKeyFromAST(std::shared_ptr<DB::IAST> const&, DB::ColumnsDescription const&, std::shared_ptr<DB::Context const>, std::optional<String> const&) @ 0x0000000018dd3bc1
[0m14:49:03.287816 [error] [MainThread]:   6. DB::create(DB::StorageFactory::Arguments const&) @ 0x0000000019a5f818
[0m14:49:03.289415 [error] [MainThread]:   7. DB::StorageFactory::get(DB::ASTCreateQuery const&, String const&, std::shared_ptr<DB::Context>, std::shared_ptr<DB::Context>, DB::ColumnsDescription const&, DB::ConstraintsDescription const&, DB::LoadingStrictnessLevel, bool) const @ 0x0000000018e40d7b
[0m14:49:03.290901 [error] [MainThread]:   8. DB::InterpreterCreateQuery::doCreateTable(DB::ASTCreateQuery&, DB::InterpreterCreateQuery::TableProperties const&, std::unique_ptr<DB::DDLGuard, std::default_delete<DB::DDLGuard>>&, DB::LoadingStrictnessLevel) @ 0x00000000182fb075
[0m14:49:03.291893 [error] [MainThread]:   9. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ef810
[0m14:49:03.292678 [error] [MainThread]:   10. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:49:03.293686 [error] [MainThread]:   11. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:49:03.294923 [error] [MainThread]:   12. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:49:03.295779 [error] [MainThread]:   13. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:49:03.296431 [error] [MainThread]:   14. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:49:03.296977 [error] [MainThread]:   15. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:49:03.297661 [error] [MainThread]:   16. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:49:03.298414 [error] [MainThread]:   17. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:49:03.299123 [error] [MainThread]:   18. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:49:03.299991 [error] [MainThread]:   19. ? @ 0x0000000000094ac3
[0m14:49:03.300921 [error] [MainThread]:   20. ? @ 0x0000000000125a74
[0m14:49:03.302016 [info ] [MainThread]: 
[0m14:49:03.303113 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:49:03.304677 [debug] [MainThread]: Command `dbt run` failed at 14:49:03.304451 after 2.23 seconds
[0m14:49:03.305586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f8442a7490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f8427a2ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f84281b760>]}
[0m14:49:03.306537 [debug] [MainThread]: Flushing usage events
[0m14:49:35.105481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba429c430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba4d10dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba4d10e50>]}


============================== 14:49:35.112029 | 559261e4-8529-4c0e-8c2a-0a877a5534d0 ==============================
[0m14:49:35.112029 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:49:35.113197 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:49:35.231073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '559261e4-8529-4c0e-8c2a-0a877a5534d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba4d10d60>]}
[0m14:49:35.259704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '559261e4-8529-4c0e-8c2a-0a877a5534d0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba27e4e80>]}
[0m14:49:35.261214 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:49:35.286682 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:49:35.295603 [debug] [MainThread]: Partial parsing not enabled
[0m14:49:36.744593 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:49:36.756188 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:49:36.759268 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:49:36.765539 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:49:36.768619 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:49:36.772574 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_payment_state.sql
[0m14:49:36.789431 [error] [MainThread]: Encountered an error:
Compilation Error in model dim_payment_state (models/gold/dim/dim_payment_state.sql)
  unexpected char '←' at 142
    line 6
      order_by=['payment_state_sk']   -- ← must exist in SELECT
[0m14:49:36.791154 [debug] [MainThread]: Command `dbt run` failed at 14:49:36.790971 after 1.73 seconds
[0m14:49:36.792296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba429c430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba25d6dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a5ba25d6d90>]}
[0m14:49:36.793048 [debug] [MainThread]: Flushing usage events
[0m14:50:41.377321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8ece7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8f69ddc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8f69de50>]}


============================== 14:50:41.385844 | 9481d402-ec87-40e3-97f9-6a7d2673b099 ==============================
[0m14:50:41.385844 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:50:41.386925 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:50:41.501903 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8f69dd30>]}
[0m14:50:41.530493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8d21be80>]}
[0m14:50:41.532726 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:50:41.557071 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:50:41.566376 [debug] [MainThread]: Partial parsing not enabled
[0m14:50:42.936409 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:50:42.947509 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:50:42.951150 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:50:42.957882 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:50:42.960502 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:50:42.964110 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:50:42.970124 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:50:42.980924 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:50:42.984245 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:50:42.992335 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:50:42.995326 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:50:43.016418 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:50:43.019504 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:50:43.027276 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:50:43.249333 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:50:43.256017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8d0d59d0>]}
[0m14:50:43.286750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8d0d5730>]}
[0m14:50:43.288696 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:50:43.289908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8d29c790>]}
[0m14:50:43.292428 [info ] [MainThread]: 
[0m14:50:43.294803 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:50:43.296770 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:50:43.303144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:43.494296 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:50:43.498910 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:50:43.503109 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:50:43.504657 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:50:43.511079 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:50:43.513229 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:43.521861 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:50:43.586036 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:50:43.592859 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:50:43.597013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae7dfa16d0>]}
[0m14:50:43.599234 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:50:43.600387 [info ] [MainThread]: 
[0m14:50:43.618611 [debug] [Thread-1  ]: Began running node model.ck_project.dim_payment_state
[0m14:50:43.619682 [info ] [Thread-1  ]: 1 of 1 START sql table model gold.dim_payment_state ............................ [RUN]
[0m14:50:43.621151 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.dim_payment_state)
[0m14:50:43.621924 [debug] [Thread-1  ]: Began compiling node model.ck_project.dim_payment_state
[0m14:50:43.632174 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.dim_payment_state"
[0m14:50:43.649918 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (compile): 14:50:43.622637 => 14:50:43.649485
[0m14:50:43.651111 [debug] [Thread-1  ]: Began executing node model.ck_project.dim_payment_state
[0m14:50:43.674957 [debug] [Thread-1  ]: Creating new relation dim_payment_state
[0m14:50:43.703108 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

            

    
        create table gold.dim_payment_state
        
  
        
  engine = MergeTree()
        order by (payment_state_sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'          AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',         0, 0
    UNION ALL SELECT 3, 'failed',          1, 1
    UNION ALL SELECT 4, 'voided',          1, 1
    UNION ALL SELECT 5, 'refunded',        1, 1
    UNION ALL SELECT 6, 'waiting_for_sca', 0, 0
)
SELECT
  payment_state_sk::UInt8                 AS payment_state_sk,
  payment_state_name::String              AS payment_state_name,
  is_final_state::UInt8                   AS is_final_state,
  is_payment_reached_provider::UInt8      AS is_payment_reached_provider
FROM st
          )
        ...
[0m14:50:43.731976 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m14:50:43.742137 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:50:43.749376 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:50:43.753545 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.dim_payment_state"
[0m14:50:43.771972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

  
    
    
    
        
        insert into gold.dim_payment_state
        ("payment_state_sk", "payment_state_name", "is_final_state", "is_payment_reached_provider")

WITH st AS (
    SELECT toUInt8(1) AS payment_state_sk, 'settled'          AS payment_state_name, 1 AS is_final_state, 1 AS is_payment_reached_provider
    UNION ALL SELECT 2, 'initial',         0, 0
    UNION ALL SELECT 3, 'failed',          1, 1
    UNION ALL SELECT 4, 'voided',          1, 1
    UNION ALL SELECT 5, 'refunded',        1, 1
    UNION ALL SELECT 6, 'waiting_for_sca', 0, 0
)
SELECT
  payment_state_sk::UInt8                 AS payment_state_sk,
  payment_state_name::String              AS payment_state_name,
  is_final_state::UInt8                   AS is_final_state,
  is_payment_reached_provider::UInt8      AS is_payment_reached_provider
FROM st
  
  ...
[0m14:50:43.784684 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:50:43.809269 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.dim_payment_state: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.dim_payment_state"} */

    select name, type from system.columns where table = 'dim_payment_state'
    
      and database = 'gold'
    
    order by position
  ...
[0m14:50:43.814770 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m14:50:43.818132 [debug] [Thread-1  ]: Timing info for model.ck_project.dim_payment_state (execute): 14:50:43.651718 => 14:50:43.817962
[0m14:50:43.819505 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9481d402-ec87-40e3-97f9-6a7d2673b099', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae7d5ccf70>]}
[0m14:50:43.820768 [info ] [Thread-1  ]: 1 of 1 OK created sql table model gold.dim_payment_state ....................... [OK in 0.20s]
[0m14:50:43.822276 [debug] [Thread-1  ]: Finished running node model.ck_project.dim_payment_state
[0m14:50:43.825482 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:50:43.826615 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:50:43.827498 [debug] [MainThread]: On list__gold: Close
[0m14:50:43.828594 [debug] [MainThread]: Connection 'model.ck_project.dim_payment_state' was left open.
[0m14:50:43.829687 [debug] [MainThread]: On model.ck_project.dim_payment_state: Close
[0m14:50:43.830802 [info ] [MainThread]: 
[0m14:50:43.831937 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 0.54 seconds (0.54s).
[0m14:50:43.833624 [debug] [MainThread]: Command end result
[0m14:50:43.866691 [info ] [MainThread]: 
[0m14:50:43.867966 [info ] [MainThread]: Completed successfully
[0m14:50:43.869210 [info ] [MainThread]: 
[0m14:50:43.870437 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:50:43.871596 [debug] [MainThread]: Command `dbt run` succeeded at 14:50:43.871463 after 2.54 seconds
[0m14:50:43.872518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8ece7430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8d21be80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae8cf8b160>]}
[0m14:50:43.873663 [debug] [MainThread]: Flushing usage events
[0m14:50:52.943889 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c336b8ae400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c336c332d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c336c332fd0>]}


============================== 14:50:52.958910 | 0d44dfc7-dc21-405f-8319-770660967b4e ==============================
[0m14:50:52.958910 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:50:52.960475 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:50:53.454092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c336c332df0>]}
[0m14:50:53.519020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3369ddbe50>]}
[0m14:50:53.522338 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:50:53.574753 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:50:53.590842 [debug] [MainThread]: Partial parsing not enabled
[0m14:50:56.232913 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:50:56.300934 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:50:56.307180 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:50:56.319288 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:50:56.323232 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:50:56.330199 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:50:56.341647 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:50:56.363490 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:50:56.370867 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:50:56.392506 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:50:56.402007 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:50:56.450443 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:50:56.459163 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:50:56.478637 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:50:56.877123 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:50:56.896409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3369c874f0>]}
[0m14:50:56.944126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3369bf1790>]}
[0m14:50:56.947603 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:50:56.949643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c336c332d30>]}
[0m14:50:56.954305 [info ] [MainThread]: 
[0m14:50:56.958265 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:50:56.962173 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:50:56.980137 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:57.392938 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:50:57.403071 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:50:57.413274 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:50:57.422661 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:50:57.446185 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:50:57.447379 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:50:57.464376 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m14:50:57.557875 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:50:57.569128 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:50:57.576664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3369b1f820>]}
[0m14:50:57.580363 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:50:57.582901 [info ] [MainThread]: 
[0m14:50:57.619449 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:50:57.621349 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:50:57.623794 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:50:57.625406 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:50:57.654716 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:50:57.688371 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:50:57.626746 => 14:50:57.687323
[0m14:50:57.690579 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:50:57.937492 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:50:57.951652 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(state_name) AS state_name_l, link_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:50:57.954126 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:50:57.692159 => 14:50:57.953567
[0m14:50:57.963327 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `state_name` in scope  d_state AS ds. Maybe you meant: ['state_name_l']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  19. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  20. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  22. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  23. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  24. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  25. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  26. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  27. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  28. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  29. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  30. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  31. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:50:57.969451 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0d44dfc7-dc21-405f-8319-770660967b4e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c334a1c2070>]}
[0m14:50:57.972894 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.35s]
[0m14:50:57.976022 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:50:57.985565 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:50:57.988813 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:50:57.990891 [debug] [MainThread]: On list__silver: Close
[0m14:50:57.993348 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:50:57.995800 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:50:57.998598 [info ] [MainThread]: 
[0m14:50:58.004255 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.04 seconds (1.04s).
[0m14:50:58.008573 [debug] [MainThread]: Command end result
[0m14:50:58.076475 [info ] [MainThread]: 
[0m14:50:58.079517 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:50:58.081615 [info ] [MainThread]: 
[0m14:50:58.084369 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:50:58.086698 [error] [MainThread]:   Code: 47.
[0m14:50:58.089166 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `state_name` in scope  d_state AS ds. Maybe you meant: ['state_name_l']. Stack trace:
[0m14:50:58.091320 [error] [MainThread]:   
[0m14:50:58.093614 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:50:58.095592 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:50:58.098055 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:50:58.104788 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:50:58.107312 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:50:58.109481 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:50:58.111211 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:50:58.112638 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:50:58.114541 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:50:58.119147 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:50:58.122417 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:50:58.124335 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:50:58.126313 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:50:58.128609 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:50:58.130957 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:50:58.133816 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:50:58.135994 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:50:58.138608 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:50:58.140362 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:50:58.142338 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:50:58.143872 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:50:58.145621 [error] [MainThread]:   21. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:50:58.147239 [error] [MainThread]:   22. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:50:58.148784 [error] [MainThread]:   23. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:50:58.151800 [error] [MainThread]:   24. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:50:58.153437 [error] [MainThread]:   25. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:50:58.155086 [error] [MainThread]:   26. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:50:58.156494 [error] [MainThread]:   27. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:50:58.157859 [error] [MainThread]:   28. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:50:58.159302 [error] [MainThread]:   29. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:50:58.160773 [error] [MainThread]:   30. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m14:50:58.162383 [error] [MainThread]:   31. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:50:58.163841 [info ] [MainThread]: 
[0m14:50:58.165624 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:50:58.169826 [debug] [MainThread]: Command `dbt run` failed at 14:50:58.169529 after 5.28 seconds
[0m14:50:58.171498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c336b8ae400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3369ddbe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c3369b1fdc0>]}
[0m14:50:58.173623 [debug] [MainThread]: Flushing usage events
[0m14:55:25.067485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733916927490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7339173b4dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7339173c5790>]}


============================== 14:55:25.100207 | b28061ee-8138-4f1f-8204-fe440c9e4570 ==============================
[0m14:55:25.100207 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:55:25.102572 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:55:25.364572 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7339173b4fd0>]}
[0m14:55:25.420571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914e67ee0>]}
[0m14:55:25.423082 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:55:25.476582 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:55:25.494401 [debug] [MainThread]: Partial parsing not enabled
[0m14:55:28.445970 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:55:28.470516 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:55:28.478578 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:55:28.494019 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:55:28.499617 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:55:28.511476 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:55:28.528072 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:55:28.552191 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:55:28.560941 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:55:28.579789 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:55:28.587163 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:55:28.629739 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:55:28.637017 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:55:28.656234 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:55:29.153808 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:55:29.171604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914ce3b20>]}
[0m14:55:29.223454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914ce3970>]}
[0m14:55:29.226268 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:55:29.228778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914ed97f0>]}
[0m14:55:29.232244 [info ] [MainThread]: 
[0m14:55:29.235812 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:55:29.238893 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:55:29.252283 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:55:29.655679 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:55:29.665809 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:55:29.673636 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:55:29.681253 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:55:29.705214 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:55:29.710171 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:55:29.724537 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:55:29.815635 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:55:29.831761 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:55:29.840036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914b9d8b0>]}
[0m14:55:29.842838 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:55:29.845127 [info ] [MainThread]: 
[0m14:55:29.890759 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:55:29.893505 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:55:29.896302 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:55:29.898068 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:55:29.919986 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:55:29.953188 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:55:29.899434 => 14:55:29.952239
[0m14:55:29.955493 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:55:30.141489 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:55:30.166611 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:55:30.169898 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:55:29.957082 => 14:55:30.169213
[0m14:55:30.178539 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression or function identifier `method_name` in scope  d_method AS dpm. Maybe you meant: ['method_name_l']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
  14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
  16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
  17. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  18. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  20. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  21. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  22. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  23. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  24. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  25. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  26. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  27. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  28. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  29. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  30. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  31. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:55:30.181240 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b28061ee-8138-4f1f-8204-fe440c9e4570', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73390d3a45b0>]}
[0m14:55:30.184970 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.29s]
[0m14:55:30.190467 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:55:30.198016 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:55:30.199978 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:55:30.201306 [debug] [MainThread]: On list__silver: Close
[0m14:55:30.202935 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:55:30.204665 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:55:30.206180 [info ] [MainThread]: 
[0m14:55:30.208416 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.97 seconds (0.97s).
[0m14:55:30.211125 [debug] [MainThread]: Command end result
[0m14:55:30.257181 [info ] [MainThread]: 
[0m14:55:30.259883 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:55:30.263087 [info ] [MainThread]: 
[0m14:55:30.265536 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:55:30.267551 [error] [MainThread]:   Code: 47.
[0m14:55:30.269883 [error] [MainThread]:   DB::Exception: Unknown expression or function identifier `method_name` in scope  d_method AS dpm. Maybe you meant: ['method_name_l']. Stack trace:
[0m14:55:30.271708 [error] [MainThread]:   
[0m14:55:30.276062 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:55:30.281442 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:55:30.288191 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:55:30.292660 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:55:30.298845 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:55:30.301560 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:55:30.304197 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aa66c7
[0m14:55:30.306437 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:55:30.308980 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:55:30.310461 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:55:30.312683 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:55:30.314633 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:55:30.316582 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:55:30.318221 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c6a7
[0m14:55:30.319752 [error] [MainThread]:   14. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:55:30.321250 [error] [MainThread]:   15. DB::QueryAnalyzer::resolveJoin(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785c67a
[0m14:55:30.322639 [error] [MainThread]:   16. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785a8f8
[0m14:55:30.324512 [error] [MainThread]:   17. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:55:30.327589 [error] [MainThread]:   18. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:55:30.330316 [error] [MainThread]:   19. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:55:30.331976 [error] [MainThread]:   20. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:55:30.333329 [error] [MainThread]:   21. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:55:30.334725 [error] [MainThread]:   22. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:55:30.336195 [error] [MainThread]:   23. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:55:30.337942 [error] [MainThread]:   24. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:55:30.339757 [error] [MainThread]:   25. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:55:30.341469 [error] [MainThread]:   26. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:55:30.343195 [error] [MainThread]:   27. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:55:30.345817 [error] [MainThread]:   28. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m14:55:30.347622 [error] [MainThread]:   29. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:55:30.349163 [error] [MainThread]:   30. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:55:30.350892 [error] [MainThread]:   31. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:55:30.352453 [info ] [MainThread]: 
[0m14:55:30.354052 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:55:30.356530 [debug] [MainThread]: Command `dbt run` failed at 14:55:30.356144 after 5.42 seconds
[0m14:55:30.358176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733916927490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914e67ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x733914bc6d60>]}
[0m14:55:30.360670 [debug] [MainThread]: Flushing usage events
[0m14:56:42.019502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b8245e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b82e19d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b82e19df0>]}


============================== 14:56:42.039689 | 4905da01-7a1a-4e59-a630-1136b9520861 ==============================
[0m14:56:42.039689 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:56:42.042633 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'warn_error': 'None', 'log_path': '/opt/airflow/dbt_project/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:56:42.288805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b82e19dc0>]}
[0m14:56:42.365344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b8099bdf0>]}
[0m14:56:42.367821 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:56:42.418030 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:56:42.431946 [debug] [MainThread]: Partial parsing not enabled
[0m14:56:45.135734 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:56:45.156919 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:56:45.163056 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:56:45.176643 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:56:45.181496 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:56:45.188373 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:56:45.196801 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:56:45.216293 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:56:45.220040 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:56:45.233363 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:56:45.240295 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:56:45.280526 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:56:45.286934 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:56:45.310654 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:56:45.695663 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:56:45.708812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b808486a0>]}
[0m14:56:45.755981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b80848370>]}
[0m14:56:45.758689 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:56:45.760595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b80a1c730>]}
[0m14:56:45.765319 [info ] [MainThread]: 
[0m14:56:45.768392 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:56:45.773651 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:56:45.794654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:46.149737 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:56:46.156418 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:56:46.165513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:56:46.173240 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:56:46.187538 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:56:46.193739 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:56:46.204816 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:56:46.270984 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:56:46.282145 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:56:46.292172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b7d75ab80>]}
[0m14:56:46.294277 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:56:46.295875 [info ] [MainThread]: 
[0m14:56:46.322266 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:56:46.325057 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:56:46.327002 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:56:46.328492 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:56:46.346214 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:56:46.365703 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:56:46.329373 => 14:56:46.364678
[0m14:56:46.367599 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:56:46.546848 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:56:46.568740 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      anyHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:56:46.570794 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:56:46.369607 => 14:56:46.570414
[0m14:56:46.577043 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 46.
  DB::Exception: Function with name `anyHash64` does not exist. In scope  j. Maybe you meant: ['wyHash64','intHash64']. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String, String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&, String&&) @ 0x000000000cbc05eb
  4. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aae7d7
  5. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  6. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  7. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  8. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  10. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  11. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  12. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  13. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  14. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  15. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  16. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  17. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  18. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  19. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  20. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  21. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  22. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  23. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  24. DB::TCPHandler::run() @ 0x0000000019e4f119
  25. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  26. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  27. Poco::PooledThread::run() @ 0x000000001ef15b87
  28. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  29. ? @ 0x0000000000094ac3
  30. ? @ 0x0000000000125a74
[0m14:56:46.578853 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4905da01-7a1a-4e59-a630-1136b9520861', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b7cef12e0>]}
[0m14:56:46.580449 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.25s]
[0m14:56:46.581875 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:56:46.587824 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:56:46.589539 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:56:46.591142 [debug] [MainThread]: On list__gold: Close
[0m14:56:46.592564 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:56:46.593795 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:56:46.594872 [info ] [MainThread]: 
[0m14:56:46.596495 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.83 seconds (0.83s).
[0m14:56:46.597961 [debug] [MainThread]: Command end result
[0m14:56:46.632360 [info ] [MainThread]: 
[0m14:56:46.634751 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:56:46.636987 [info ] [MainThread]: 
[0m14:56:46.638555 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:56:46.640052 [error] [MainThread]:   Code: 46.
[0m14:56:46.641664 [error] [MainThread]:   DB::Exception: Function with name `anyHash64` does not exist. In scope  j. Maybe you meant: ['wyHash64','intHash64']. Stack trace:
[0m14:56:46.643146 [error] [MainThread]:   
[0m14:56:46.645020 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:56:46.647011 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:56:46.648748 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:56:46.651150 [error] [MainThread]:   3. DB::Exception::Exception<String, String, String>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, String&&, String&&, String&&) @ 0x000000000cbc05eb
[0m14:56:46.652736 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aae7d7
[0m14:56:46.654785 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:56:46.658690 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:56:46.662016 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:56:46.663916 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:56:46.665849 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:56:46.667557 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:56:46.669091 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:56:46.671224 [error] [MainThread]:   12. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:56:46.673734 [error] [MainThread]:   13. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:56:46.676492 [error] [MainThread]:   14. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:56:46.679114 [error] [MainThread]:   15. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:56:46.680680 [error] [MainThread]:   16. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:56:46.682087 [error] [MainThread]:   17. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:56:46.683646 [error] [MainThread]:   18. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:56:46.685645 [error] [MainThread]:   19. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m14:56:46.688225 [error] [MainThread]:   20. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:56:46.690500 [error] [MainThread]:   21. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:56:46.693026 [error] [MainThread]:   22. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:56:46.695672 [error] [MainThread]:   23. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:56:46.697375 [error] [MainThread]:   24. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:56:46.698818 [error] [MainThread]:   25. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:56:46.700335 [error] [MainThread]:   26. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:56:46.701408 [error] [MainThread]:   27. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:56:46.703659 [error] [MainThread]:   28. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:56:46.706422 [error] [MainThread]:   29. ? @ 0x0000000000094ac3
[0m14:56:46.709133 [error] [MainThread]:   30. ? @ 0x0000000000125a74
[0m14:56:46.711465 [info ] [MainThread]: 
[0m14:56:46.713336 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:56:46.716717 [debug] [MainThread]: Command `dbt run` failed at 14:56:46.716264 after 4.75 seconds
[0m14:56:46.717958 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b8245e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b8099bdf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x777b80775fa0>]}
[0m14:56:46.719455 [debug] [MainThread]: Flushing usage events
[0m14:58:07.947854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cdec3490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450ce981dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450ce992790>]}


============================== 14:58:07.959010 | 725172c6-c781-470c-98a7-f3e8ee01fe05 ==============================
[0m14:58:07.959010 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:58:07.963299 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:58:08.160079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450ce981fd0>]}
[0m14:58:08.217748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cc427ee0>]}
[0m14:58:08.220246 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:58:08.261232 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:58:08.271524 [debug] [MainThread]: Partial parsing not enabled
[0m14:58:11.107713 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:58:11.130286 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:58:11.135542 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:58:11.144542 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:58:11.148320 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:58:11.157509 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:58:11.171824 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:58:11.193751 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:58:11.202088 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:58:11.225601 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:58:11.230371 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:58:11.288228 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:58:11.296655 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:58:11.322220 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:58:11.739945 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:58:11.768032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cc2a3640>]}
[0m14:58:11.835305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cc2a30d0>]}
[0m14:58:11.837849 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:58:11.839983 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cc49b7f0>]}
[0m14:58:11.845081 [info ] [MainThread]: 
[0m14:58:11.848086 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:58:11.853521 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:58:11.871565 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:58:12.276162 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:58:12.284673 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:58:12.294587 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m14:58:12.298174 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m14:58:12.330544 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:58:12.337786 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:58:12.346583 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:58:12.421246 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:58:12.429769 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:58:12.436881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cc1618b0>]}
[0m14:58:12.438940 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:58:12.440607 [info ] [MainThread]: 
[0m14:58:12.479671 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:58:12.481518 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:58:12.485381 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m14:58:12.487765 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:58:12.517406 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:58:12.536598 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:58:12.490029 => 14:58:12.536039
[0m14:58:12.537920 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:58:12.732816 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      intHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:58:12.760998 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      intHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:58:12.763855 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:58:12.538879 => 14:58:12.762977
[0m14:58:12.772999 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 42.
  DB::Exception: Number of arguments for function intHash64 doesn't match: passed 2, should be 1: In scope  j. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<String, unsigned long&, unsigned long&>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<unsigned long&>::type, std::type_identity<unsigned long&>::type>, String&&, unsigned long&, unsigned long&) @ 0x0000000009a7a82b
  4. DB::IFunctionOverloadResolver::checkNumberOfArguments(unsigned long) const @ 0x0000000016421e6f
  5. DB::IFunctionOverloadResolver::build(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422a85
  6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aabd41
  7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
  8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
  12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
  13. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
  14. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  15. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  16. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  17. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  18. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  19. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  20. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  21. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  22. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  23. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  24. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  25. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  26. DB::TCPHandler::run() @ 0x0000000019e4f119
  27. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  28. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  29. Poco::PooledThread::run() @ 0x000000001ef15b87
  30. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  31. ? @ 0x0000000000094ac3
[0m14:58:12.775440 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '725172c6-c781-470c-98a7-f3e8ee01fe05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450c9216400>]}
[0m14:58:12.778691 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.29s]
[0m14:58:12.781051 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:58:12.786988 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:58:12.789348 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m14:58:12.790450 [debug] [MainThread]: On list__silver: Close
[0m14:58:12.792373 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:58:12.794032 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:58:12.795580 [info ] [MainThread]: 
[0m14:58:12.797214 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.95 seconds (0.95s).
[0m14:58:12.799171 [debug] [MainThread]: Command end result
[0m14:58:12.842209 [info ] [MainThread]: 
[0m14:58:12.844450 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:58:12.847533 [info ] [MainThread]: 
[0m14:58:12.849545 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:58:12.851835 [error] [MainThread]:   Code: 42.
[0m14:58:12.854777 [error] [MainThread]:   DB::Exception: Number of arguments for function intHash64 doesn't match: passed 2, should be 1: In scope  j. Stack trace:
[0m14:58:12.857685 [error] [MainThread]:   
[0m14:58:12.859643 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:58:12.861564 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:58:12.863398 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:58:12.865574 [error] [MainThread]:   3. DB::Exception::Exception<String, unsigned long&, unsigned long&>(int, FormatStringHelperImpl<std::type_identity<String>::type, std::type_identity<unsigned long&>::type, std::type_identity<unsigned long&>::type>, String&&, unsigned long&, unsigned long&) @ 0x0000000009a7a82b
[0m14:58:12.867680 [error] [MainThread]:   4. DB::IFunctionOverloadResolver::checkNumberOfArguments(unsigned long) const @ 0x0000000016421e6f
[0m14:58:12.871700 [error] [MainThread]:   5. DB::IFunctionOverloadResolver::build(std::vector<DB::ColumnWithTypeAndName, std::allocator<DB::ColumnWithTypeAndName>> const&) const @ 0x0000000016422a85
[0m14:58:12.873966 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveFunction(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017aabd41
[0m14:58:12.876726 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178372f3
[0m14:58:12.878022 [error] [MainThread]:   8. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:58:12.879662 [error] [MainThread]:   9. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:58:12.881761 [error] [MainThread]:   10. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:58:12.884641 [error] [MainThread]:   11. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x0000000017837221
[0m14:58:12.887687 [error] [MainThread]:   12. DB::QueryAnalyzer::resolveQueryJoinTreeNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, DB::QueryExpressionsAliasVisitor&) @ 0x000000001785ae58
[0m14:58:12.891780 [error] [MainThread]:   13. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d021
[0m14:58:12.894251 [error] [MainThread]:   14. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:58:12.896700 [error] [MainThread]:   15. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:58:12.898459 [error] [MainThread]:   16. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:58:12.899932 [error] [MainThread]:   17. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:58:12.902182 [error] [MainThread]:   18. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:58:12.904127 [error] [MainThread]:   19. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:58:12.905816 [error] [MainThread]:   20. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:58:12.907359 [error] [MainThread]:   21. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m14:58:12.908549 [error] [MainThread]:   22. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:58:12.910285 [error] [MainThread]:   23. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:58:12.912104 [error] [MainThread]:   24. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:58:12.913659 [error] [MainThread]:   25. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:58:12.915379 [error] [MainThread]:   26. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:58:12.917405 [error] [MainThread]:   27. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:58:12.919395 [error] [MainThread]:   28. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:58:12.921581 [error] [MainThread]:   29. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:58:12.923858 [error] [MainThread]:   30. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:58:12.925674 [error] [MainThread]:   31. ? @ 0x0000000000094ac3
[0m14:58:12.927603 [info ] [MainThread]: 
[0m14:58:12.929328 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:58:12.931926 [debug] [MainThread]: Command `dbt run` failed at 14:58:12.931703 after 5.02 seconds
[0m14:58:12.932973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cdec3490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450cc427ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7450c880aa00>]}
[0m14:58:12.935756 [debug] [MainThread]: Flushing usage events
[0m14:59:40.609061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a895a91c460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a895b2f2af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a895b2f2e50>]}


============================== 14:59:40.626340 | 23fa0b50-c448-443d-8fcd-4e7430d7a1ba ==============================
[0m14:59:40.626340 [info ] [MainThread]: Running with dbt=1.5.9
[0m14:59:40.628153 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m14:59:40.830617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a895b2f2e80>]}
[0m14:59:40.896086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8958e69eb0>]}
[0m14:59:40.899280 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m14:59:40.953149 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m14:59:40.963012 [debug] [MainThread]: Partial parsing not enabled
[0m14:59:43.914721 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m14:59:43.946258 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m14:59:43.952927 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m14:59:43.967467 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m14:59:43.973903 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m14:59:43.979678 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m14:59:43.988241 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m14:59:44.013940 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m14:59:44.019850 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m14:59:44.042361 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m14:59:44.050503 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m14:59:44.124079 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m14:59:44.130807 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m14:59:44.152144 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m14:59:44.579990 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m14:59:44.592820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8958d34c40>]}
[0m14:59:44.639337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8958d34670>]}
[0m14:59:44.641452 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m14:59:44.643723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8958d154f0>]}
[0m14:59:44.648577 [info ] [MainThread]: 
[0m14:59:44.652729 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m14:59:44.657828 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m14:59:44.672845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:45.260546 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m14:59:45.269923 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:45.280180 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m14:59:45.283823 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m14:59:45.318314 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m14:59:45.326763 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:59:45.342784 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:45.421949 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m14:59:45.432587 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m14:59:45.440060 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8951c1adc0>]}
[0m14:59:45.442117 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:59:45.444342 [info ] [MainThread]: 
[0m14:59:45.480311 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m14:59:45.484790 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m14:59:45.488914 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m14:59:45.490573 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m14:59:45.515343 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m14:59:45.536372 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 14:59:45.491872 => 14:59:45.535551
[0m14:59:45.537911 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m14:59:45.761707 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      cityHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m14:59:45.789142 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      cityHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m14:59:45.791650 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 14:59:45.539102 => 14:59:45.790903
[0m14:59:45.799352 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression identifier `payment_reference` in scope WITH tx_raw AS (SELECT assumeNotNull(transaction_id) AS transaction_id, reference AS reference_col, details AS details_json, created_at AS tx_started_at FROM silver.link_transactions), tx_norm AS (SELECT transaction_id, tx_started_at, coalesce(nullIf(JSONExtractString(details_json, 'payment_reference'), ''), nullIf(JSONExtractString(details_json, 'paymentReference'), ''), nullIf(JSONExtractString(details_json, 'reference'), ''), nullIf(reference_col, '')) AS payment_reference FROM tx_raw), pay_final AS (SELECT reference AS payment_reference, argMax(payment_state, coalesce(updated_at, created_at)) AS final_state, argMax(card_type, coalesce(updated_at, created_at)) AS final_method, argMax(merchant_id, coalesce(updated_at, created_at)) AS final_merchant_id, max(coalesce(updated_at, created_at)) AS final_state_ts FROM silver.payments GROUP BY reference), d_state AS (SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk FROM gold.dim_payment_state), d_method AS (SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk FROM gold.dim_payment_method), d_merchant AS (SELECT merchant_id, merchant_sk FROM gold.dim_merchants), j AS (SELECT cityHash64(t.transaction_id, coalesce(t.payment_reference, '')) AS sk, t.transaction_id, t.payment_reference, toUInt8(pf.payment_reference IS NOT NULL) AS hasPayment, toUInt8(lowerUTF8(coalesce(pf.final_state, '')) IN ('success', 'succeeded', 'paid', 'completed', 'ok')) AS wasSuccessful, ds.state_sk AS state_fk, dm.merchant_sk AS merchant_sk, dpm.method_sk AS method_fk, if((pf.final_state_ts IS NULL) OR (t.tx_started_at IS NULL), NULL, dateDiff('minute', t.tx_started_at, pf.final_state_ts)) AS TimeFromStartToEndMinutes, t.tx_started_at AS _gating_ts FROM tx_norm AS t LEFT JOIN pay_final AS pf ON pf.payment_reference = t.payment_reference LEFT JOIN d_state AS ds ON ds.state_name_l = lowerUTF8(coalesce(pf.final_state, '')) LEFT JOIN d_method AS dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, '')) LEFT JOIN d_merchant AS dm ON dm.merchant_id = pf.final_merchant_id) SELECT sk, transaction_id, payment_reference, hasPayment, wasSuccessful, state_fk AS state, merchant_sk, method_fk AS method, TimeFromStartToEndMinutes FROM j. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  8. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  9. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  10. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  11. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  12. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  13. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  14. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  15. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  16. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  17. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  18. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  19. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  20. DB::TCPHandler::run() @ 0x0000000019e4f119
  21. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  22. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  23. Poco::PooledThread::run() @ 0x000000001ef15b87
  24. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  25. ? @ 0x0000000000094ac3
  26. ? @ 0x0000000000125a74
[0m14:59:45.802034 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '23fa0b50-c448-443d-8fcd-4e7430d7a1ba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a89513c2670>]}
[0m14:59:45.806096 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.31s]
[0m14:59:45.809639 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m14:59:45.816744 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:59:45.819191 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m14:59:45.821460 [debug] [MainThread]: On list__gold: Close
[0m14:59:45.823988 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m14:59:45.825867 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m14:59:45.828471 [info ] [MainThread]: 
[0m14:59:45.831694 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.18 seconds (1.18s).
[0m14:59:45.836353 [debug] [MainThread]: Command end result
[0m14:59:45.897209 [info ] [MainThread]: 
[0m14:59:45.900687 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m14:59:45.905030 [info ] [MainThread]: 
[0m14:59:45.908502 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m14:59:45.911300 [error] [MainThread]:   Code: 47.
[0m14:59:45.914858 [error] [MainThread]:   DB::Exception: Unknown expression identifier `payment_reference` in scope WITH tx_raw AS (SELECT assumeNotNull(transaction_id) AS transaction_id, reference AS reference_col, details AS details_json, created_at AS tx_started_at FROM silver.link_transactions), tx_norm AS (SELECT transaction_id, tx_started_at, coalesce(nullIf(JSONExtractString(details_json, 'payment_reference'), ''), nullIf(JSONExtractString(details_json, 'paymentReference'), ''), nullIf(JSONExtractString(details_json, 'reference'), ''), nullIf(reference_col, '')) AS payment_reference FROM tx_raw), pay_final AS (SELECT reference AS payment_reference, argMax(payment_state, coalesce(updated_at, created_at)) AS final_state, argMax(card_type, coalesce(updated_at, created_at)) AS final_method, argMax(merchant_id, coalesce(updated_at, created_at)) AS final_merchant_id, max(coalesce(updated_at, created_at)) AS final_state_ts FROM silver.payments GROUP BY reference), d_state AS (SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk FROM gold.dim_payment_state), d_method AS (SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk FROM gold.dim_payment_method), d_merchant AS (SELECT merchant_id, merchant_sk FROM gold.dim_merchants), j AS (SELECT cityHash64(t.transaction_id, coalesce(t.payment_reference, '')) AS sk, t.transaction_id, t.payment_reference, toUInt8(pf.payment_reference IS NOT NULL) AS hasPayment, toUInt8(lowerUTF8(coalesce(pf.final_state, '')) IN ('success', 'succeeded', 'paid', 'completed', 'ok')) AS wasSuccessful, ds.state_sk AS state_fk, dm.merchant_sk AS merchant_sk, dpm.method_sk AS method_fk, if((pf.final_state_ts IS NULL) OR (t.tx_started_at IS NULL), NULL, dateDiff('minute', t.tx_started_at, pf.final_state_ts)) AS TimeFromStartToEndMinutes, t.tx_started_at AS _gating_ts FROM tx_norm AS t LEFT JOIN pay_final AS pf ON pf.payment_reference = t.payment_reference LEFT JOIN d_state AS ds ON ds.state_name_l = lowerUTF8(coalesce(pf.final_state, '')) LEFT JOIN d_method AS dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, '')) LEFT JOIN d_merchant AS dm ON dm.merchant_id = pf.final_merchant_id) SELECT sk, transaction_id, payment_reference, hasPayment, wasSuccessful, state_fk AS state, merchant_sk, method_fk AS method, TimeFromStartToEndMinutes FROM j. Stack trace:
[0m14:59:45.917835 [error] [MainThread]:   
[0m14:59:45.919798 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m14:59:45.921590 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m14:59:45.923355 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m14:59:45.925927 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m14:59:45.928028 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m14:59:45.931029 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m14:59:45.934469 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m14:59:45.937894 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m14:59:45.939868 [error] [MainThread]:   8. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m14:59:45.942435 [error] [MainThread]:   9. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m14:59:45.944643 [error] [MainThread]:   10. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m14:59:45.946384 [error] [MainThread]:   11. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m14:59:45.948754 [error] [MainThread]:   12. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m14:59:45.951380 [error] [MainThread]:   13. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m14:59:45.953948 [error] [MainThread]:   14. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m14:59:45.956420 [error] [MainThread]:   15. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m14:59:45.958322 [error] [MainThread]:   16. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m14:59:45.960688 [error] [MainThread]:   17. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m14:59:45.962499 [error] [MainThread]:   18. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m14:59:45.964270 [error] [MainThread]:   19. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m14:59:45.966742 [error] [MainThread]:   20. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m14:59:45.969790 [error] [MainThread]:   21. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m14:59:45.972102 [error] [MainThread]:   22. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m14:59:45.974011 [error] [MainThread]:   23. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m14:59:45.979782 [error] [MainThread]:   24. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m14:59:45.981566 [error] [MainThread]:   25. ? @ 0x0000000000094ac3
[0m14:59:45.984700 [error] [MainThread]:   26. ? @ 0x0000000000125a74
[0m14:59:45.987054 [info ] [MainThread]: 
[0m14:59:45.988911 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m14:59:45.991932 [debug] [MainThread]: Command `dbt run` failed at 14:59:45.991272 after 5.43 seconds
[0m14:59:45.993566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a895a91c460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8958d263a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8958edcc40>]}
[0m14:59:45.996278 [debug] [MainThread]: Flushing usage events
[0m15:04:53.547280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa56603430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa56fafdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa56fafdf0>]}


============================== 15:04:53.560290 | c3b8d018-a841-4829-8721-b0dc956b61ff ==============================
[0m15:04:53.560290 [info ] [MainThread]: Running with dbt=1.5.9
[0m15:04:53.562425 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/opt/airflow/dbt_project/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:04:53.736257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa56fafe50>]}
[0m15:04:53.779189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa54b18e50>]}
[0m15:04:53.781114 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m15:04:53.816468 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m15:04:53.827637 [debug] [MainThread]: Partial parsing not enabled
[0m15:04:56.216924 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m15:04:56.236329 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m15:04:56.241080 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m15:04:56.254239 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m15:04:56.259081 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m15:04:56.265994 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m15:04:56.272693 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m15:04:56.296127 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m15:04:56.301099 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m15:04:56.333962 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m15:04:56.344912 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m15:04:56.389666 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m15:04:56.395472 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m15:04:56.413670 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m15:04:56.807476 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m15:04:56.821935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa549c4820>]}
[0m15:04:56.873807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa5493a790>]}
[0m15:04:56.877591 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m15:04:56.879667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa56faffd0>]}
[0m15:04:56.883919 [info ] [MainThread]: 
[0m15:04:56.887535 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:04:56.893188 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:04:56.909774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:57.256653 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:04:57.264979 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:57.273390 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__gold)
[0m15:04:57.276508 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__silver'
[0m15:04:57.296509 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m15:04:57.304454 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:04:57.315258 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:57.413869 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m15:04:57.430149 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:04:57.439515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa5191ac70>]}
[0m15:04:57.443523 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:04:57.446172 [info ] [MainThread]: 
[0m15:04:57.482583 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m15:04:57.485233 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m15:04:57.487910 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__silver, now model.ck_project.fact_transactions)
[0m15:04:57.491029 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m15:04:57.515430 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m15:04:57.545797 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 15:04:57.493056 => 15:04:57.545281
[0m15:04:57.547086 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m15:04:57.690405 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      cityHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m15:04:57.703037 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            


WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),


-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),


-- 2) Final payment state per reference (collapse across snapshots by latest updated_at/created_at)
pay_final AS (
  SELECT
      reference                                                     AS payment_reference,
      argMax(payment_state, coalesce(updated_at, created_at))       AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at))       AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at))       AS final_merchant_id,
      max(coalesce(updated_at, created_at))                          AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),


-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),


-- 4) Join and shape
j AS (
  SELECT
      cityHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,


      t.transaction_id,
      t.payment_reference,


      toUInt8(pf.payment_reference IS NOT NULL)                       AS hasPayment,


      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                                               AS wasSuccessful,


      ds.state_sk                                                     AS state_fk,
      dm.merchant_sk                                                  AS merchant_sk,
      dpm.method_sk                                                   AS method_fk,


      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                                               AS TimeFromStartToEndMinutes,


      -- for incremental gating
      t.tx_started_at                                                 AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.payment_reference = t.payment_reference
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)


SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        
[0m15:04:57.705744 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 15:04:57.548043 => 15:04:57.705361
[0m15:04:57.710383 [debug] [Thread-1  ]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
  Code: 47.
  DB::Exception: Unknown expression identifier `payment_reference` in scope WITH tx_raw AS (SELECT assumeNotNull(transaction_id) AS transaction_id, reference AS reference_col, details AS details_json, created_at AS tx_started_at FROM silver.link_transactions), tx_norm AS (SELECT transaction_id, tx_started_at, coalesce(nullIf(JSONExtractString(details_json, 'payment_reference'), ''), nullIf(JSONExtractString(details_json, 'paymentReference'), ''), nullIf(JSONExtractString(details_json, 'reference'), ''), nullIf(reference_col, '')) AS payment_reference FROM tx_raw), pay_final AS (SELECT reference AS payment_reference, argMax(payment_state, coalesce(updated_at, created_at)) AS final_state, argMax(card_type, coalesce(updated_at, created_at)) AS final_method, argMax(merchant_id, coalesce(updated_at, created_at)) AS final_merchant_id, max(coalesce(updated_at, created_at)) AS final_state_ts FROM silver.payments GROUP BY reference), d_state AS (SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk FROM gold.dim_payment_state), d_method AS (SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk FROM gold.dim_payment_method), d_merchant AS (SELECT merchant_id, merchant_sk FROM gold.dim_merchants), j AS (SELECT cityHash64(t.transaction_id, coalesce(t.payment_reference, '')) AS sk, t.transaction_id, t.payment_reference, toUInt8(pf.payment_reference IS NOT NULL) AS hasPayment, toUInt8(lowerUTF8(coalesce(pf.final_state, '')) IN ('success', 'succeeded', 'paid', 'completed', 'ok')) AS wasSuccessful, ds.state_sk AS state_fk, dm.merchant_sk AS merchant_sk, dpm.method_sk AS method_fk, if((pf.final_state_ts IS NULL) OR (t.tx_started_at IS NULL), NULL, dateDiff('minute', t.tx_started_at, pf.final_state_ts)) AS TimeFromStartToEndMinutes, t.tx_started_at AS _gating_ts FROM tx_norm AS t LEFT JOIN pay_final AS pf ON pf.payment_reference = t.payment_reference LEFT JOIN d_state AS ds ON ds.state_name_l = lowerUTF8(coalesce(pf.final_state, '')) LEFT JOIN d_method AS dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, '')) LEFT JOIN d_merchant AS dm ON dm.merchant_id = pf.final_merchant_id) SELECT sk, transaction_id, payment_reference, hasPayment, wasSuccessful, state_fk AS state, merchant_sk, method_fk AS method, TimeFromStartToEndMinutes FROM j. Stack trace:
  
  0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
  1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
  2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
  3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
  4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
  5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
  6. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
  7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
  8. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
  9. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
  10. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
  11. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
  12. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
  13. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
  14. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
  15. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
  16. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
  17. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
  18. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
  19. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
  20. DB::TCPHandler::run() @ 0x0000000019e4f119
  21. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
  22. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
  23. Poco::PooledThread::run() @ 0x000000001ef15b87
  24. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
  25. ? @ 0x0000000000094ac3
  26. ? @ 0x0000000000125a74
[0m15:04:57.714061 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c3b8d018-a841-4829-8721-b0dc956b61ff', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa510c2cd0>]}
[0m15:04:57.715979 [error] [Thread-1  ]: 1 of 1 ERROR creating sql incremental model gold.fact_transactions ............. [ERROR in 0.23s]
[0m15:04:57.717738 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m15:04:57.721711 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:04:57.723771 [debug] [MainThread]: Connection 'list__gold' was left open.
[0m15:04:57.725240 [debug] [MainThread]: On list__gold: Close
[0m15:04:57.727702 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m15:04:57.729921 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m15:04:57.731344 [info ] [MainThread]: 
[0m15:04:57.733493 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 0.84 seconds (0.84s).
[0m15:04:57.735624 [debug] [MainThread]: Command end result
[0m15:04:57.774871 [info ] [MainThread]: 
[0m15:04:57.777409 [info ] [MainThread]: Completed with 1 error and 0 warnings:
[0m15:04:57.778799 [info ] [MainThread]: 
[0m15:04:57.780618 [error] [MainThread]: Database Error in model fact_transactions (models/gold/fact/fact_transactions.sql)
[0m15:04:57.782204 [error] [MainThread]:   Code: 47.
[0m15:04:57.784645 [error] [MainThread]:   DB::Exception: Unknown expression identifier `payment_reference` in scope WITH tx_raw AS (SELECT assumeNotNull(transaction_id) AS transaction_id, reference AS reference_col, details AS details_json, created_at AS tx_started_at FROM silver.link_transactions), tx_norm AS (SELECT transaction_id, tx_started_at, coalesce(nullIf(JSONExtractString(details_json, 'payment_reference'), ''), nullIf(JSONExtractString(details_json, 'paymentReference'), ''), nullIf(JSONExtractString(details_json, 'reference'), ''), nullIf(reference_col, '')) AS payment_reference FROM tx_raw), pay_final AS (SELECT reference AS payment_reference, argMax(payment_state, coalesce(updated_at, created_at)) AS final_state, argMax(card_type, coalesce(updated_at, created_at)) AS final_method, argMax(merchant_id, coalesce(updated_at, created_at)) AS final_merchant_id, max(coalesce(updated_at, created_at)) AS final_state_ts FROM silver.payments GROUP BY reference), d_state AS (SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk FROM gold.dim_payment_state), d_method AS (SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk FROM gold.dim_payment_method), d_merchant AS (SELECT merchant_id, merchant_sk FROM gold.dim_merchants), j AS (SELECT cityHash64(t.transaction_id, coalesce(t.payment_reference, '')) AS sk, t.transaction_id, t.payment_reference, toUInt8(pf.payment_reference IS NOT NULL) AS hasPayment, toUInt8(lowerUTF8(coalesce(pf.final_state, '')) IN ('success', 'succeeded', 'paid', 'completed', 'ok')) AS wasSuccessful, ds.state_sk AS state_fk, dm.merchant_sk AS merchant_sk, dpm.method_sk AS method_fk, if((pf.final_state_ts IS NULL) OR (t.tx_started_at IS NULL), NULL, dateDiff('minute', t.tx_started_at, pf.final_state_ts)) AS TimeFromStartToEndMinutes, t.tx_started_at AS _gating_ts FROM tx_norm AS t LEFT JOIN pay_final AS pf ON pf.payment_reference = t.payment_reference LEFT JOIN d_state AS ds ON ds.state_name_l = lowerUTF8(coalesce(pf.final_state, '')) LEFT JOIN d_method AS dpm ON dpm.method_name_l = lowerUTF8(coalesce(pf.final_method, '')) LEFT JOIN d_merchant AS dm ON dm.merchant_id = pf.final_merchant_id) SELECT sk, transaction_id, payment_reference, hasPayment, wasSuccessful, state_fk AS state, merchant_sk, method_fk AS method, TimeFromStartToEndMinutes FROM j. Stack trace:
[0m15:04:57.786115 [error] [MainThread]:   
[0m15:04:57.787229 [error] [MainThread]:   0. DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x00000000137a855f
[0m15:04:57.788267 [error] [MainThread]:   1. DB::Exception::Exception(String&&, int, String, bool) @ 0x000000000cae7e8e
[0m15:04:57.789896 [error] [MainThread]:   2. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x000000000cae7940
[0m15:04:57.792820 [error] [MainThread]:   3. DB::Exception::Exception<char const*, String&, String, String, String>(int, FormatStringHelperImpl<std::type_identity<char const*>::type, std::type_identity<String&>::type, std::type_identity<String>::type, std::type_identity<String>::type, std::type_identity<String>::type>, char const*&&, String&, String&&, String&&, String&&) @ 0x0000000017859102
[0m15:04:57.794694 [error] [MainThread]:   4. DB::QueryAnalyzer::resolveExpressionNode(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool, bool) @ 0x00000000178395e5
[0m15:04:57.796049 [error] [MainThread]:   5. DB::QueryAnalyzer::resolveExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&, bool, bool) @ 0x00000000178366c0
[0m15:04:57.797299 [error] [MainThread]:   6. DB::QueryAnalyzer::resolveProjectionExpressionNodeList(std::shared_ptr<DB::IQueryTreeNode>&, DB::IdentifierResolveScope&) @ 0x0000000017859ea7
[0m15:04:57.798851 [error] [MainThread]:   7. DB::QueryAnalyzer::resolveQuery(std::shared_ptr<DB::IQueryTreeNode> const&, DB::IdentifierResolveScope&) @ 0x000000001782d06b
[0m15:04:57.800382 [error] [MainThread]:   8. DB::QueryAnalyzer::resolve(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::IQueryTreeNode> const&, std::shared_ptr<DB::Context const>) @ 0x000000001782a87a
[0m15:04:57.802765 [error] [MainThread]:   9. DB::QueryAnalysisPass::run(std::shared_ptr<DB::IQueryTreeNode>&, std::shared_ptr<DB::Context const>) @ 0x0000000017829edc
[0m15:04:57.804941 [error] [MainThread]:   10. DB::QueryTreePassManager::run(std::shared_ptr<DB::IQueryTreeNode>) @ 0x000000001787d276
[0m15:04:57.806856 [error] [MainThread]:   11. DB::buildQueryTreeAndRunPasses(std::shared_ptr<DB::IAST> const&, DB::SelectQueryOptions const&, std::shared_ptr<DB::Context const> const&, std::shared_ptr<DB::IStorage> const&) (.llvm.8096503222789336007) @ 0x00000000183bd40d
[0m15:04:57.809294 [error] [MainThread]:   12. DB::InterpreterSelectQueryAnalyzer::InterpreterSelectQueryAnalyzer(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&, std::vector<String, std::allocator<String>> const&) @ 0x00000000183bb32a
[0m15:04:57.811558 [error] [MainThread]:   13. DB::InterpreterSelectQueryAnalyzer::getSampleBlock(std::shared_ptr<DB::IAST> const&, std::shared_ptr<DB::Context const> const&, DB::SelectQueryOptions const&) @ 0x00000000183bd86a
[0m15:04:57.813412 [error] [MainThread]:   14. DB::InterpreterCreateQuery::getTablePropertiesAndNormalizeCreateQuery(DB::ASTCreateQuery&, DB::LoadingStrictnessLevel) const @ 0x00000000182e49d3
[0m15:04:57.815205 [error] [MainThread]:   15. DB::InterpreterCreateQuery::createTable(DB::ASTCreateQuery&) @ 0x00000000182ed2c5
[0m15:04:57.816852 [error] [MainThread]:   16. DB::InterpreterCreateQuery::execute() @ 0x0000000018303978
[0m15:04:57.818119 [error] [MainThread]:   17. DB::executeQueryImpl(char const*, char const*, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum, std::unique_ptr<DB::ReadBuffer, std::default_delete<DB::ReadBuffer>>&, std::shared_ptr<DB::IAST>&, std::shared_ptr<DB::ImplicitTransactionControlExecutor>) @ 0x0000000018780440
[0m15:04:57.819785 [error] [MainThread]:   18. DB::executeQuery(String const&, std::shared_ptr<DB::Context>, DB::QueryFlags, DB::QueryProcessingStage::Enum) @ 0x00000000187786cb
[0m15:04:57.822559 [error] [MainThread]:   19. DB::TCPHandler::runImpl() @ 0x0000000019e2d3db
[0m15:04:57.827211 [error] [MainThread]:   20. DB::TCPHandler::run() @ 0x0000000019e4f119
[0m15:04:57.829784 [error] [MainThread]:   21. Poco::Net::TCPServerConnection::start() @ 0x000000001ef4ed07
[0m15:04:57.831236 [error] [MainThread]:   22. Poco::Net::TCPServerDispatcher::run() @ 0x000000001ef4f199
[0m15:04:57.832716 [error] [MainThread]:   23. Poco::PooledThread::run() @ 0x000000001ef15b87
[0m15:04:57.834340 [error] [MainThread]:   24. Poco::ThreadImpl::runnableEntry(void*) @ 0x000000001ef13f81
[0m15:04:57.835804 [error] [MainThread]:   25. ? @ 0x0000000000094ac3
[0m15:04:57.837005 [error] [MainThread]:   26. ? @ 0x0000000000125a74
[0m15:04:57.838723 [info ] [MainThread]: 
[0m15:04:57.840478 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m15:04:57.842497 [debug] [MainThread]: Command `dbt run` failed at 15:04:57.842242 after 4.33 seconds
[0m15:04:57.843803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa56603430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa54b18e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7eaa5486b430>]}
[0m15:04:57.845120 [debug] [MainThread]: Flushing usage events
[0m15:06:20.256033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc854b9d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc855569af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc855569e50>]}


============================== 15:06:20.269112 | 06f6276e-5250-4df8-9323-1381e45c324c ==============================
[0m15:06:20.269112 [info ] [MainThread]: Running with dbt=1.5.9
[0m15:06:20.273685 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/opt/airflow/dbt_project/logs', 'debug': 'False', 'profiles_dir': '/opt/airflow/dbt_project', 'use_colors': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'send_anonymous_usage_stats': 'True'}
[0m15:06:20.527894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc855569e80>]}
[0m15:06:20.628230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc8530e2eb0>]}
[0m15:06:20.630281 [info ] [MainThread]: Registered adapter: clickhouse=1.5.2
[0m15:06:20.706586 [debug] [MainThread]: checksum: dd837546c89c9d03f3c2cb0ca6165266a30da6076d5d44e9991f7c5a8e5f5831, vars: {}, profile: , target: , version: 1.5.9
[0m15:06:20.720689 [debug] [MainThread]: Partial parsing not enabled
[0m15:06:23.301073 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_date.sql
[0m15:06:23.326444 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_date.sql
[0m15:06:23.331949 [debug] [MainThread]: 1603: static parser failed on gold/dim/dim_merchants.sql
[0m15:06:23.342008 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/dim/dim_merchants.sql
[0m15:06:23.346856 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_method.sql
[0m15:06:23.356191 [debug] [MainThread]: 1699: static parser successfully parsed gold/dim/dim_payment_state.sql
[0m15:06:23.364134 [debug] [MainThread]: 1603: static parser failed on gold/fact/fact_transactions.sql
[0m15:06:23.381088 [debug] [MainThread]: 1602: parser fallback to jinja rendering on gold/fact/fact_transactions.sql
[0m15:06:23.385444 [debug] [MainThread]: 1603: static parser failed on silver/silver_link_transactions.sql
[0m15:06:23.399889 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_link_transactions.sql
[0m15:06:23.407435 [debug] [MainThread]: 1603: static parser failed on silver/silver_merchants.sql
[0m15:06:23.449958 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_merchants.sql
[0m15:06:23.456246 [debug] [MainThread]: 1603: static parser failed on silver/silver_payments.sql
[0m15:06:23.473406 [debug] [MainThread]: 1602: parser fallback to jinja rendering on silver/silver_payments.sql
[0m15:06:23.913466 [warn ] [MainThread]: [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.ck_project.bronze
[0m15:06:23.932436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc852fb7c70>]}
[0m15:06:23.980556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc852fb7ca0>]}
[0m15:06:23.984204 [info ] [MainThread]: Found 8 models, 20 tests, 0 snapshots, 0 analyses, 349 macros, 0 operations, 0 seed files, 6 sources, 0 exposures, 0 metrics, 0 groups
[0m15:06:23.986835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc852f950d0>]}
[0m15:06:23.991647 [info ] [MainThread]: 
[0m15:06:23.994124 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m15:06:23.997503 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m15:06:24.014795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:24.351439 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m15:06:24.357641 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m15:06:24.363368 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__silver)
[0m15:06:24.365453 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__gold'
[0m15:06:24.385889 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__silver: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__silver"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'silver'
      

  ...
[0m15:06:24.393552 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:06:24.405705 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:06:24.473713 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__gold: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "connection_name": "list__gold"} */
select
      t.name as name,
      t.database as schema,
      if(engine not in ('MaterializedView', 'View'), 'table', 'view') as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'gold'
      

  ...
[0m15:06:24.485305 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:06:24.491619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc852e1f880>]}
[0m15:06:24.493729 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:06:24.494851 [info ] [MainThread]: 
[0m15:06:24.530138 [debug] [Thread-1  ]: Began running node model.ck_project.fact_transactions
[0m15:06:24.532527 [info ] [Thread-1  ]: 1 of 1 START sql incremental model gold.fact_transactions ...................... [RUN]
[0m15:06:24.534874 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__gold, now model.ck_project.fact_transactions)
[0m15:06:24.536193 [debug] [Thread-1  ]: Began compiling node model.ck_project.fact_transactions
[0m15:06:24.554315 [debug] [Thread-1  ]: Writing injected SQL for node "model.ck_project.fact_transactions"
[0m15:06:24.572741 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (compile): 15:06:24.537319 => 15:06:24.570892
[0m15:06:24.574891 [debug] [Thread-1  ]: Began executing node model.ck_project.fact_transactions
[0m15:06:24.738503 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

            

    
        create table gold.fact_transactions
        
  
        
  engine = MergeTree()
        order by (sk)
        
        
        SETTINGS  replicated_deduplication_window=0

            empty
          as (
            

WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),

-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),

-- 2) Final payment state per reference (use distinct alias to avoid name collision)
pay_final AS (
  SELECT
      reference                                              AS pay_reference,      -- ← renamed
      argMax(payment_state, coalesce(updated_at, created_at)) AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at)) AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at)) AS final_merchant_id,
      max(coalesce(updated_at, created_at))                    AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),

-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

-- 4) Join and shape
j AS (
  SELECT
      cityHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,

      t.transaction_id,
      t.payment_reference,                      -- ← keep the tx-side name in the projection

      toUInt8(pf.pay_reference IS NOT NULL)     AS hasPayment,

      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                          AS wasSuccessful,

      ds.state_sk                                AS state_fk,
      dm.merchant_sk                             AS merchant_sk,
      dpm.method_sk                              AS method_fk,

      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                          AS TimeFromStartToEndMinutes,

      -- for incremental gating
      t.tx_started_at                            AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.pay_reference     = t.payment_reference  -- ← join on renamed col
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)

SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

          )
        ...
[0m15:06:24.767953 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m15:06:24.787803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

    select name, type from system.columns where table = 'fact_transactions'
    
      and database = 'gold'
    
    order by position
  ...
[0m15:06:24.795758 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:06:24.804171 [debug] [Thread-1  ]: Writing runtime sql for node "model.ck_project.fact_transactions"
[0m15:06:24.836292 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

        
  
    
    
    
        
        insert into gold.fact_transactions
        ("sk", "transaction_id", "payment_reference", "hasPayment", "wasSuccessful", "state", "merchant_sk", "method", "TimeFromStartToEndMinutes")

WITH
-- 0) Raw transactions
tx_raw AS (
  SELECT
      assumeNotNull(transaction_id)   AS transaction_id,
      reference                       AS reference_col,
      details                         AS details_json,      -- JSON string
      created_at                      AS tx_started_at      -- already proper type
  FROM silver.link_transactions
),

-- 1) Extract payment reference (JSON → column; NO regex, NO try)
tx_norm AS (
  SELECT
      transaction_id,
      tx_started_at,
      coalesce(
        nullIf(JSONExtractString(details_json, 'payment_reference'), ''),
        nullIf(JSONExtractString(details_json, 'paymentReference'), ''),
        nullIf(JSONExtractString(details_json, 'reference'), ''),
        nullIf(reference_col, '')
      ) AS payment_reference
  FROM tx_raw
),

-- 2) Final payment state per reference (use distinct alias to avoid name collision)
pay_final AS (
  SELECT
      reference                                              AS pay_reference,      -- ← renamed
      argMax(payment_state, coalesce(updated_at, created_at)) AS final_state,
      argMax(card_type,      coalesce(updated_at, created_at)) AS final_method,
      argMax(merchant_id,    coalesce(updated_at, created_at)) AS final_merchant_id,
      max(coalesce(updated_at, created_at))                    AS final_state_ts
  FROM silver.payments
  GROUP BY reference
),

-- 3) Dimension lookups
d_state AS (
  SELECT lower(payment_state_name) AS state_name_l, payment_state_sk AS state_sk
  FROM gold.dim_payment_state
),
d_method AS (
  SELECT lower(payment_method_name) AS method_name_l, payment_method_sk AS method_sk
  FROM gold.dim_payment_method
),
d_merchant AS (
  SELECT merchant_id, merchant_sk
  FROM gold.dim_merchants
),

-- 4) Join and shape
j AS (
  SELECT
      cityHash64(t.transaction_id, coalesce(t.payment_reference, ''))  AS sk,

      t.transaction_id,
      t.payment_reference,                      -- ← keep the tx-side name in the projection

      toUInt8(pf.pay_reference IS NOT NULL)     AS hasPayment,

      toUInt8(
        lowerUTF8(coalesce(pf.final_state, '')) IN
        ('success','succeeded','paid','completed','ok')
      )                                          AS wasSuccessful,

      ds.state_sk                                AS state_fk,
      dm.merchant_sk                             AS merchant_sk,
      dpm.method_sk                              AS method_fk,

      if(pf.final_state_ts IS NULL OR t.tx_started_at IS NULL,
         NULL,
         dateDiff('minute', t.tx_started_at, pf.final_state_ts)
      )                                          AS TimeFromStartToEndMinutes,

      -- for incremental gating
      t.tx_started_at                            AS _gating_ts
  FROM tx_norm t
  LEFT JOIN pay_final   pf  ON pf.pay_reference     = t.payment_reference  -- ← join on renamed col
  LEFT JOIN d_state     ds  ON ds.state_name_l      = lowerUTF8(coalesce(pf.final_state, ''))
  LEFT JOIN d_method    dpm ON dpm.method_name_l    = lowerUTF8(coalesce(pf.final_method, ''))
  LEFT JOIN d_merchant  dm  ON dm.merchant_id       = pf.final_merchant_id
)

SELECT
  sk,
  transaction_id,
  payment_reference,
  hasPayment,
  wasSuccessful,
  state_fk      AS state,
  merchant_sk,
  method_fk     AS method,
  TimeFromStartToEndMinutes
FROM j

  
  
    ...
[0m15:06:25.017648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.18 seconds
[0m15:06:25.250290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

    select name, type from system.columns where table = 'fact_transactions'
    
      and database = 'gold'
    
    order by position
  ...
[0m15:06:25.266149 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m15:06:25.286934 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ck_project.fact_transactions: /* {"app": "dbt", "dbt_version": "1.5.9", "profile_name": "ck_project", "target_name": "dev", "node_id": "model.ck_project.fact_transactions"} */

    
  alter table gold.fact_transactions 
   modify comment 
  $dbt_comment_literal_block$Transaction ↔ Payment fact, joining on payment_reference parsed from transactions.details (fallback to reference column).$dbt_comment_literal_block$, comment column payment_reference 
  $dbt_comment_literal_block$Nullable. Parsed from JSON details; may be null when not present.$dbt_comment_literal_block$

  ...
[0m15:06:25.326151 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m15:06:25.350845 [debug] [Thread-1  ]: Timing info for model.ck_project.fact_transactions (execute): 15:06:24.575941 => 15:06:25.349415
[0m15:06:25.356856 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '06f6276e-5250-4df8-9323-1381e45c324c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc850215f70>]}
[0m15:06:25.360733 [info ] [Thread-1  ]: 1 of 1 OK created sql incremental model gold.fact_transactions ................. [OK in 0.82s]
[0m15:06:25.364515 [debug] [Thread-1  ]: Finished running node model.ck_project.fact_transactions
[0m15:06:25.377544 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:06:25.379459 [debug] [MainThread]: Connection 'list__silver' was left open.
[0m15:06:25.381291 [debug] [MainThread]: On list__silver: Close
[0m15:06:25.383553 [debug] [MainThread]: Connection 'model.ck_project.fact_transactions' was left open.
[0m15:06:25.387704 [debug] [MainThread]: On model.ck_project.fact_transactions: Close
[0m15:06:25.390043 [info ] [MainThread]: 
[0m15:06:25.392863 [info ] [MainThread]: Finished running 1 incremental model in 0 hours 0 minutes and 1.40 seconds (1.40s).
[0m15:06:25.400290 [debug] [MainThread]: Command end result
[0m15:06:25.496225 [info ] [MainThread]: 
[0m15:06:25.498296 [info ] [MainThread]: Completed successfully
[0m15:06:25.500673 [info ] [MainThread]: 
[0m15:06:25.509385 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m15:06:25.516915 [debug] [MainThread]: Command `dbt run` succeeded at 15:06:25.514398 after 5.32 seconds
[0m15:06:25.519306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc854b9d460>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc852f3dca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc852fa63a0>]}
[0m15:06:25.522211 [debug] [MainThread]: Flushing usage events
